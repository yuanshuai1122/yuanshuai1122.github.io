<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Python数据分析之Pandas（三） - 🧀 - 你好</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="yuanshuai" /><meta name="description" content=": | &amp;mdash;&amp;ndash;: | &amp;mdash;&amp;mdash;: | &amp;mdash;&amp;ndash;: | &amp;mdash;&amp;mdash;&amp;ndash;: | | 0 | 1 | 1193 | 5 | 978300760 | | 1 | 1 | 661 | 3 | 978302109 | | 2 | 1 | 914 | 3 | 978301968 | | 3 | 1 | 3408 | 4 | 978300275 | | 4 | 1 | 2355 | 5 | 978824291 | In [3]: 1 2 3" /><meta name="keywords" content="blog, yuanshuai, yyss" />






<meta name="generator" content="Hugo 0.119.0 with theme even" />


<link rel="canonical" href="yuanshuai1122.github.io/post/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%B8%89-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%B8%89/" />
<link rel="apple-touch-icon" sizes="180x180" href="/yuanshuai1122.github.io/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/yuanshuai1122.github.io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/yuanshuai1122.github.io/favicon-16x16.png">
<link rel="manifest" href="/yuanshuai1122.github.io/manifest.json">
<link rel="mask-icon" href="/yuanshuai1122.github.io/safari-pinned-tab.svg" color="#5bbad5">



<link href="/yuanshuai1122.github.io/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Python数据分析之Pandas（三）" />
<meta property="og:description" content=": | &mdash;&ndash;: | &mdash;&mdash;: | &mdash;&ndash;: | &mdash;&mdash;&ndash;: | | 0 | 1 | 1193 | 5 | 978300760 | | 1 | 1 | 661 | 3 | 978302109 | | 2 | 1 | 914 | 3 | 978301968 | | 3 | 1 | 3408 | 4 | 978300275 | | 4 | 1 | 2355 | 5 | 978824291 | In [3]: 1 2 3" />
<meta property="og:type" content="article" />
<meta property="og:url" content="yuanshuai1122.github.io/post/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%B8%89-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%B8%89/" /><meta property="article:section" content="post" />


<meta itemprop="name" content="Python数据分析之Pandas（三）">
<meta itemprop="description" content=": | &mdash;&ndash;: | &mdash;&mdash;: | &mdash;&ndash;: | &mdash;&mdash;&ndash;: | | 0 | 1 | 1193 | 5 | 978300760 | | 1 | 1 | 661 | 3 | 978302109 | | 2 | 1 | 914 | 3 | 978301968 | | 3 | 1 | 3408 | 4 | 978300275 | | 4 | 1 | 2355 | 5 | 978824291 | In [3]: 1 2 3">

<meta itemprop="wordCount" content="9391">
<meta itemprop="keywords" content="Python,数据分析," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Python数据分析之Pandas（三）"/>
<meta name="twitter:description" content=": | &mdash;&ndash;: | &mdash;&mdash;: | &mdash;&ndash;: | &mdash;&mdash;&ndash;: | | 0 | 1 | 1193 | 5 | 978300760 | | 1 | 1 | 661 | 3 | 978302109 | | 2 | 1 | 914 | 3 | 978301968 | | 3 | 1 | 3408 | 4 | 978300275 | | 4 | 1 | 2355 | 5 | 978824291 | In [3]: 1 2 3"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">CNshuaiyuan</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="yuanshuai1122.github.io/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="yuanshuai1122.github.io/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="yuanshuai1122.github.io/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="yuanshuai1122.github.io/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">CNshuaiyuan</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="yuanshuai1122.github.io/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="yuanshuai1122.github.io/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="yuanshuai1122.github.io/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="yuanshuai1122.github.io/categories/">Categories</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Python数据分析之Pandas（三）</h1>

      <div class="post-meta">
        <span class="post-time"> 0001-01-01 </span>
        
          <span class="more-meta"> 约 9391 字 </span>
          <span class="more-meta"> 预计阅读 19 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li>
          <ul>
            <li><a href="#实例2怎样取每个分组的topn数据">实例2：怎样取每个分组的TOPN数据？</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#20pandas的stack和pivot实现数据透视">20、Pandas的stack和pivot实现数据透视</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-经过统计得到多维度指标数据">1. 经过统计得到多维度指标数据</a></li>
            <li><a href="#2-使用unstack实现数据二维透视">2. 使用unstack实现数据二维透视</a></li>
            <li><a href="#3-使用pivot简化透视">3. 使用pivot简化透视</a></li>
            <li><a href="#4-stackunstackpivot的语法">4. stack、unstack、pivot的语法</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#21pandas怎样快捷方便的处理日期数据">21、Pandas怎样快捷方便的处理日期数据</a>
      <ul>
        <li>
          <ul>
            <li><a href="#问题怎样统计每周每月每季度的最高温度">问题：怎样统计每周、每月、每季度的最高温度？</a></li>
            <li><a href="#1读取天气数据到dataframe">1、读取天气数据到dataframe</a></li>
            <li><a href="#2将日期列转换成pandas的日期">2、将日期列转换成pandas的日期</a></li>
            <li><a href="#3-方便的对datetimeindex进行查询">3、 方便的对DatetimeIndex进行查询</a></li>
            <li><a href="#4方便的获取周月季度">4、方便的获取周、月、季度</a></li>
            <li><a href="#5统计每周每月每个季度的最高温度">5、统计每周、每月、每个季度的最高温度</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#22pandas怎么处理日期索引的缺失">22、Pandas怎么处理日期索引的缺失？</a>
      <ul>
        <li><a href="#问题如果缺失了索引该怎么填充">问题：如果缺失了索引该怎么填充？</a></li>
        <li><a href="#方法1使用pandasreindex方法">方法1：使用pandas.reindex方法</a>
          <ul>
            <li><a href="#1将df的索引变成日期索引">1、将df的索引变成日期索引</a></li>
            <li><a href="#2使用pandasreindex填充缺失的索引">2、使用pandas.reindex填充缺失的索引</a></li>
          </ul>
        </li>
        <li><a href="#方法2使用pandasresample方法">方法2：使用pandas.resample方法</a>
          <ul>
            <li><a href="#1先将索引变成日期索引">1、先将索引变成日期索引</a></li>
            <li><a href="#2使用dataframe的resample的方法按照天重采样">2、使用dataframe的resample的方法按照天重采样</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#23pandas怎样实现excel的vlookup并且在指定列后面输出">23、Pandas怎样实现Excel的vlookup并且在指定列后面输出？</a>
      <ul>
        <li>
          <ul>
            <li><a href="#步骤1读取两个数据表">步骤1：读取两个数据表</a></li>
            <li><a href="#步骤2实现两个表的关联">步骤2：实现两个表的关联</a></li>
            <li><a href="#步骤3调整列的顺序">步骤3：调整列的顺序</a></li>
            <li><a href="#步骤4输出最终的excel文件">步骤4：输出最终的Excel文件</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#24pandas怎样结合pyecharts绘制交互性折线图">24、Pandas怎样结合Pyecharts绘制交互性折线图？</a>
      <ul>
        <li><a href="#1读取数据">1、读取数据</a></li>
        <li><a href="#2使用pyecharts绘制折线图">2、使用Pyecharts绘制折线图</a></li>
      </ul>
    </li>
    <li><a href="#25pandas结合sklearn实现泰坦尼克存活率预测">25、Pandas结合Sklearn实现泰坦尼克存活率预测</a>
      <ul>
        <li>
          <ul>
            <li><a href="#实例目标实现泰坦尼克存活预测">实例目标：实现泰坦尼克存活预测</a></li>
            <li><a href="#步骤1读取训练数据">步骤1：读取训练数据</a></li>
            <li><a href="#步骤2训练模型">步骤2：训练模型</a></li>
            <li><a href="#步骤3对于未知数据使用模型">步骤3：对于未知数据使用模型</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#26pandas处理分析网站原始访问日志">26、Pandas处理分析网站原始访问日志</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1读取数据并清理格式化">1、读取数据并清理格式化</a></li>
            <li><a href="#2统计spider的比例">2、统计spider的比例</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#27pandas怎样找出最影响结果的那些特征">27、Pandas怎样找出最影响结果的那些特征？</a>
      <ul>
        <li><a href="#实例演示泰坦尼克沉船事件中最影响生死的因素有哪些">实例演示：泰坦尼克沉船事件中，最影响生死的因素有哪些？</a>
          <ul>
            <li><a href="#1导入相关的包">1、导入相关的包</a></li>
            <li><a href="#2导入泰坦尼克号的数据">2、导入泰坦尼克号的数据</a></li>
            <li><a href="#3数据清理和转换">3、数据清理和转换</a></li>
            <li><a href="#4将特征列和结果列拆分开">4、将特征列和结果列拆分开</a></li>
            <li><a href="#5使用卡方检验选择topk的特征">5、使用卡方检验选择topK的特征</a></li>
            <li><a href="#6按照重要性顺序打印特征列表">6、按照重要性顺序打印特征列表</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
  <div class="post-outdated">
    <div class="warn">
      <p>【注意】最后更新于 <span class="timeago" datetime="0001-01-01T00:00:00" title="January 1, 0001">January 1, 0001</span>，文中内容可能已过时，请谨慎使用。</p>
    </div>
  </div>
    <div class="post-content">
      <p>: | &mdash;&ndash;: | &mdash;&mdash;: | &mdash;&ndash;: | &mdash;&mdash;&ndash;: |
|    0 |      1 |    1193 |      5 | 978300760 |
|    1 |      1 |     661 |      3 | 978302109 |
|    2 |      1 |     914 |      3 | 978301968 |
|    3 |      1 |    3408 |      4 | 978300275 |
|    4 |      1 |    2355 |      5 | 978824291 |</p>
<p>In [3]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 实现按照用户ID分组，然后对其中一列归一化</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">ratings_norm</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    @param df：每个用户分组的dataframe
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">min_value</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;Rating&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">max_value</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;Rating&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">[</span><span class="s2">&#34;Rating_norm&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;Rating&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">min_value</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_value</span><span class="o">-</span><span class="n">min_value</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">df</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ratings</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&#34;UserID&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ratings_norm</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [4]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ratings</span><span class="p">[</span><span class="n">ratings</span><span class="p">[</span><span class="s2">&#34;UserID&#34;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[4]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">UserID</th>
<th style="text-align:right">MovieID</th>
<th style="text-align:right">Rating</th>
<th style="text-align:right">Timestamp</th>
<th style="text-align:right">Rating_norm</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1193</td>
<td style="text-align:right">5</td>
<td style="text-align:right">978300760</td>
<td style="text-align:right">1.0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">661</td>
<td style="text-align:right">3</td>
<td style="text-align:right">978302109</td>
<td style="text-align:right">0.0</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">914</td>
<td style="text-align:right">3</td>
<td style="text-align:right">978301968</td>
<td style="text-align:right">0.0</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3408</td>
<td style="text-align:right">4</td>
<td style="text-align:right">978300275</td>
<td style="text-align:right">0.5</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2355</td>
<td style="text-align:right">5</td>
<td style="text-align:right">978824291</td>
<td style="text-align:right">1.0</td>
</tr>
</tbody>
</table>
<p>可以看到UserID==1这个用户，Rating==3是他的最低分，是个乐观派，我们归一化到0分；</p>
<h3 id="实例2怎样取每个分组的topn数据">实例2：怎样取每个分组的TOPN数据？</h3>
<p>获取2018年每个月温度最高的2天数据</p>
<p>In [5]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">fpath</span> <span class="o">=</span> <span class="s2">&#34;./datas/beijing_tianqi/beijing_tianqi_2018.csv&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 替换掉温度的后缀℃</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&#34;bWendu&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;℃&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&#34;yWendu&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;yWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;℃&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 新增一列为月份</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ymd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[5]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
<th style="text-align:right">month</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2018-01-01</td>
<td style="text-align:right">3</td>
<td style="text-align:right">-6</td>
<td style="text-align:right">晴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">59</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
<td style="text-align:right">2018-01</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01-02</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">阴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">49</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2018-01-03</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">28</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">2018-01-04</td>
<td style="text-align:right">0</td>
<td style="text-align:right">-8</td>
<td style="text-align:right">阴</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">28</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">2018-01-05</td>
<td style="text-align:right">3</td>
<td style="text-align:right">-6</td>
<td style="text-align:right">多云~晴</td>
<td style="text-align:right">西北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">50</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01</td>
</tr>
</tbody>
</table>
<p>In [6]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">getWenduTopN</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">topn</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    这里的df，是每个月份分组group的df
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&#34;bWendu&#34;</span><span class="p">)[[</span><span class="s2">&#34;ymd&#34;</span><span class="p">,</span> <span class="s2">&#34;bWendu&#34;</span><span class="p">]][</span><span class="o">-</span><span class="n">topn</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&#34;month&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">getWenduTopN</span><span class="p">,</span> <span class="n">topn</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[6]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">month</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2018-01</td>
<td style="text-align:right">18</td>
<td style="text-align:right">2018-01-19</td>
<td style="text-align:right">7</td>
</tr>
<tr>
<td style="text-align:right">2018-02</td>
<td style="text-align:right">56</td>
<td style="text-align:right">2018-02-26</td>
<td style="text-align:right">12</td>
</tr>
<tr>
<td style="text-align:right">2018-03</td>
<td style="text-align:right">85</td>
<td style="text-align:right">2018-03-27</td>
<td style="text-align:right">27</td>
</tr>
<tr>
<td style="text-align:right">2018-04</td>
<td style="text-align:right">118</td>
<td style="text-align:right">2018-04-29</td>
<td style="text-align:right">30</td>
</tr>
<tr>
<td style="text-align:right">2018-05</td>
<td style="text-align:right">150</td>
<td style="text-align:right">2018-05-31</td>
<td style="text-align:right">35</td>
</tr>
</tbody>
</table>
<p>我们看到，grouby的apply函数返回的dataframe，其实和原来的dataframe其实可以完全不一样</p>
<h1 id="20pandas的stack和pivot实现数据透视">20、Pandas的stack和pivot实现数据透视</h1>
<p><img src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/12.png" alt=""></p>
<ol>
<li>经过统计得到多维度指标数据</li>
<li>使用unstack实现数据二维透视</li>
<li>使用pivot简化透视</li>
<li>stack、unstack、pivot的语法</li>
</ol>
<h3 id="1-经过统计得到多维度指标数据">1. 经过统计得到多维度指标数据</h3>
<p>非常常见的统计场景，指定多个维度，计算聚合后的指标</p>
<p>实例：统计得到“电影评分数据集”，每个月份的每个分数被评分多少次：（月份、分数1~5、次数）</p>
<p>In [1]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [2]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;./datas/movielens-1m/ratings.dat&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">names</span><span class="o">=</span><span class="s2">&#34;UserID::MovieID::Rating::Timestamp&#34;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;::&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">sep</span><span class="o">=</span><span class="s2">&#34;::&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">engine</span><span class="o">=</span><span class="s2">&#34;python&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [3]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[3]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">UserID</th>
<th style="text-align:right">MovieID</th>
<th style="text-align:right">Rating</th>
<th style="text-align:right">Timestamp</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1193</td>
<td style="text-align:right">5</td>
<td style="text-align:right">978300760</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">661</td>
<td style="text-align:right">3</td>
<td style="text-align:right">978302109</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">914</td>
<td style="text-align:right">3</td>
<td style="text-align:right">978301968</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3408</td>
<td style="text-align:right">4</td>
<td style="text-align:right">978300275</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2355</td>
<td style="text-align:right">5</td>
<td style="text-align:right">978824291</td>
</tr>
</tbody>
</table>
<p>In [4]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;pdate&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Timestamp&#34;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [5]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[5]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">UserID</th>
<th style="text-align:right">MovieID</th>
<th style="text-align:right">Rating</th>
<th style="text-align:right">Timestamp</th>
<th style="text-align:right">pdate</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1193</td>
<td style="text-align:right">5</td>
<td style="text-align:right">978300760</td>
<td style="text-align:right">2000-12-31 22:12:40</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">661</td>
<td style="text-align:right">3</td>
<td style="text-align:right">978302109</td>
<td style="text-align:right">2000-12-31 22:35:09</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">914</td>
<td style="text-align:right">3</td>
<td style="text-align:right">978301968</td>
<td style="text-align:right">2000-12-31 22:32:48</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3408</td>
<td style="text-align:right">4</td>
<td style="text-align:right">978300275</td>
<td style="text-align:right">2000-12-31 22:04:35</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2355</td>
<td style="text-align:right">5</td>
<td style="text-align:right">978824291</td>
<td style="text-align:right">2001-01-06 23:38:11</td>
</tr>
</tbody>
</table>
<p>In [6]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[6]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">UserID</span>                <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">MovieID</span>               <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Rating</span>                <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Timestamp</span>             <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">pdate</span>        <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [19]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 实现数据统计</span>
</span></span><span class="line"><span class="cl"><span class="n">df_group</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;pdate&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="s2">&#34;Rating&#34;</span><span class="p">])[</span><span class="s2">&#34;UserID&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">pv</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [20]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_group</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[20]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right"></th>
<th style="text-align:right">pv</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">pdate</td>
<td style="text-align:right">Rating</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1127</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2608</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">6442</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">8400</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">4495</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">629</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">1464</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">3297</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">4403</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">2335</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">466</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">1077</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">2523</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">3032</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">1439</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1048</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2247</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">5501</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">6748</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">3863</td>
<td style="text-align:right"></td>
</tr>
</tbody>
</table>
<p>对这样格式的数据，我想查看按月份，不同评分的次数趋势，是没法实现的</p>
<p>需要将数据变换成每个评分是一列才可以实现</p>
<h3 id="2-使用unstack实现数据二维透视">2. 使用unstack实现数据二维透视</h3>
<p>目的：想要画图对比按照月份的不同评分的数量趋势</p>
<p>In [21]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_stack</span> <span class="o">=</span> <span class="n">df_group</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">df_stack</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[21]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">pv</th>
<th style="text-align:right"></th>
<th style="text-align:right"></th>
<th style="text-align:right"></th>
<th style="text-align:right"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">Rating</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
</tr>
<tr>
<td style="text-align:right">pdate</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1127</td>
<td style="text-align:right">2608</td>
<td style="text-align:right">6442</td>
<td style="text-align:right">8400</td>
<td style="text-align:right">4495</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">629</td>
<td style="text-align:right">1464</td>
<td style="text-align:right">3297</td>
<td style="text-align:right">4403</td>
<td style="text-align:right">2335</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">466</td>
<td style="text-align:right">1077</td>
<td style="text-align:right">2523</td>
<td style="text-align:right">3032</td>
<td style="text-align:right">1439</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">1048</td>
<td style="text-align:right">2247</td>
<td style="text-align:right">5501</td>
<td style="text-align:right">6748</td>
<td style="text-align:right">3863</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">4557</td>
<td style="text-align:right">7631</td>
<td style="text-align:right">18481</td>
<td style="text-align:right">25769</td>
<td style="text-align:right">17840</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">3196</td>
<td style="text-align:right">6500</td>
<td style="text-align:right">15211</td>
<td style="text-align:right">21838</td>
<td style="text-align:right">14365</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">4891</td>
<td style="text-align:right">9566</td>
<td style="text-align:right">25421</td>
<td style="text-align:right">34957</td>
<td style="text-align:right">22169</td>
</tr>
<tr>
<td style="text-align:right">8</td>
<td style="text-align:right">10873</td>
<td style="text-align:right">20597</td>
<td style="text-align:right">50509</td>
<td style="text-align:right">64198</td>
<td style="text-align:right">42497</td>
</tr>
<tr>
<td style="text-align:right">9</td>
<td style="text-align:right">3107</td>
<td style="text-align:right">5873</td>
<td style="text-align:right">14702</td>
<td style="text-align:right">19927</td>
<td style="text-align:right">13182</td>
</tr>
<tr>
<td style="text-align:right">10</td>
<td style="text-align:right">2121</td>
<td style="text-align:right">4785</td>
<td style="text-align:right">12175</td>
<td style="text-align:right">16095</td>
<td style="text-align:right">10324</td>
</tr>
<tr>
<td style="text-align:right">11</td>
<td style="text-align:right">17701</td>
<td style="text-align:right">32202</td>
<td style="text-align:right">76069</td>
<td style="text-align:right">102448</td>
<td style="text-align:right">67041</td>
</tr>
<tr>
<td style="text-align:right">12</td>
<td style="text-align:right">6458</td>
<td style="text-align:right">13007</td>
<td style="text-align:right">30866</td>
<td style="text-align:right">41156</td>
<td style="text-align:right">26760</td>
</tr>
</tbody>
</table>
<p>In [22]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_stack</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[22]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0x1ba09b0ce48</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/13.png" alt=""></p>
<p>In [23]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># unstack和stack是互逆操作</span>
</span></span><span class="line"><span class="cl"><span class="n">df_stack</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[23]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right"></th>
<th style="text-align:right">pv</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">pdate</td>
<td style="text-align:right">Rating</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1127</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2608</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">6442</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">8400</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">4495</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">629</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">1464</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">3297</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">4403</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">2335</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">466</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">1077</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">2523</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">3032</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">1439</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1048</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2247</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">5501</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">6748</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">3863</td>
<td style="text-align:right"></td>
</tr>
</tbody>
</table>
<h3 id="3-使用pivot简化透视">3. 使用pivot简化透视</h3>
<p>In [24]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_group</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[24]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right"></th>
<th style="text-align:right">pv</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">pdate</td>
<td style="text-align:right">Rating</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1127</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2608</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">6442</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">8400</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">4495</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">629</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">1464</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">3297</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">4403</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">2335</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">466</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">1077</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">2523</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">3032</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">1439</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1048</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2247</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">5501</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">6748</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">3863</td>
<td style="text-align:right"></td>
</tr>
</tbody>
</table>
<p>In [25]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_reset</span> <span class="o">=</span> <span class="n">df_group</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">df_reset</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[25]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">pdate</th>
<th style="text-align:right">Rating</th>
<th style="text-align:right">pv</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1127</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">2608</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3</td>
<td style="text-align:right">6442</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">4</td>
<td style="text-align:right">8400</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
<td style="text-align:right">5</td>
<td style="text-align:right">4495</td>
</tr>
</tbody>
</table>
<p>In [26]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_pivot</span> <span class="o">=</span> <span class="n">df_reset</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s2">&#34;pdate&#34;</span><span class="p">,</span> <span class="s2">&#34;Rating&#34;</span><span class="p">,</span> <span class="s2">&#34;pv&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [27]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_pivot</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[27]:</p>
<table>
<thead>
<tr>
<th style="text-align:right">Rating</th>
<th style="text-align:right">1</th>
<th style="text-align:right">2</th>
<th style="text-align:right">3</th>
<th style="text-align:right">4</th>
<th style="text-align:right">5</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">pdate</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1127</td>
<td style="text-align:right">2608</td>
<td style="text-align:right">6442</td>
<td style="text-align:right">8400</td>
<td style="text-align:right">4495</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">629</td>
<td style="text-align:right">1464</td>
<td style="text-align:right">3297</td>
<td style="text-align:right">4403</td>
<td style="text-align:right">2335</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">466</td>
<td style="text-align:right">1077</td>
<td style="text-align:right">2523</td>
<td style="text-align:right">3032</td>
<td style="text-align:right">1439</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">1048</td>
<td style="text-align:right">2247</td>
<td style="text-align:right">5501</td>
<td style="text-align:right">6748</td>
<td style="text-align:right">3863</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">4557</td>
<td style="text-align:right">7631</td>
<td style="text-align:right">18481</td>
<td style="text-align:right">25769</td>
<td style="text-align:right">17840</td>
</tr>
</tbody>
</table>
<p>In [28]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_pivot</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[28]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0x1ba09db6d48</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/14.png" alt=""></p>
<p>*<strong>pivot方法相当于对df使用set_index创建分层索引，然后调用unstack*</strong></p>
<h3 id="4-stackunstackpivot的语法">4. stack、unstack、pivot的语法</h3>
<h4 id="stackdataframestacklevel-1-dropnatrue将column变成index类似把横放的书籍变成竖放">stack：DataFrame.stack(level=-1, dropna=True)，将column变成index，类似把横放的书籍变成竖放</h4>
<p>level=-1代表多层索引的最内层，可以通过==0、1、2指定多层索引的对应层</p>
<p><img src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/15.png" alt=""></p>
<h4 id="unstackdataframeunstacklevel-1-fill_valuenone将index变成column类似把竖放的书籍变成横放">unstack：DataFrame.unstack(level=-1, fill_value=None)，将index变成column，类似把竖放的书籍变成横放</h4>
<p><img src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/16.png" alt=""></p>
<h4 id="pivotdataframepivotindexnone-columnsnone-valuesnone指定indexcolumnsvalues实现二维透视">pivot：DataFrame.pivot(index=None, columns=None, values=None)，指定index、columns、values实现二维透视</h4>
<p><img src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/17.png" alt=""></p>
<h1 id="21pandas怎样快捷方便的处理日期数据">21、Pandas怎样快捷方便的处理日期数据</h1>
<p>Pandas日期处理的作用：将2018-01-01、1/1/2018等多种日期格式映射成统一的格式对象，在该对象上提供强大的功能支持</p>
<p>几个概念：</p>
<ol>
<li>pd.to_datetime：pandas的一个函数，能将字符串、列表、series变成日期形式</li>
<li>Timestamp：pandas表示日期的对象形式</li>
<li>DatetimeIndex：pandas表示日期的对象列表形式</li>
</ol>
<p>其中：</p>
<ul>
<li>DatetimeIndex是Timestamp的列表形式</li>
<li>pd.to_datetime对单个日期字符串处理会得到Timestamp</li>
<li>pd.to_datetime对日期字符串列表处理会得到DatetimeIndex</li>
</ul>
<p><img src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/18.png" alt=""></p>
<h3 id="问题怎样统计每周每月每季度的最高温度">问题：怎样统计每周、每月、每季度的最高温度？</h3>
<h3 id="1读取天气数据到dataframe">1、读取天气数据到dataframe</h3>
<p>In [1]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [2]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">fpath</span> <span class="o">=</span> <span class="s2">&#34;./datas/beijing_tianqi/beijing_tianqi_2018.csv&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 替换掉温度的后缀℃</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&#34;bWendu&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;℃&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&#34;yWendu&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;yWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;℃&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[2]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2018-01-01</td>
<td style="text-align:right">3</td>
<td style="text-align:right">-6</td>
<td style="text-align:right">晴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">59</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01-02</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">阴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">49</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2018-01-03</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">28</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">2018-01-04</td>
<td style="text-align:right">0</td>
<td style="text-align:right">-8</td>
<td style="text-align:right">阴</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">28</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">2018-01-05</td>
<td style="text-align:right">3</td>
<td style="text-align:right">-6</td>
<td style="text-align:right">多云~晴</td>
<td style="text-align:right">西北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">50</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<h3 id="2将日期列转换成pandas的日期">2、将日期列转换成pandas的日期</h3>
<p>In [3]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;ymd&#34;</span><span class="p">]),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [4]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[4]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">ymd</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2018-01-01</td>
<td style="text-align:right">2018-01-01</td>
<td style="text-align:right">3</td>
<td style="text-align:right">-6</td>
<td style="text-align:right">晴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">59</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">2018-01-02</td>
<td style="text-align:right">2018-01-02</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">阴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">49</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2018-01-03</td>
<td style="text-align:right">2018-01-03</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">28</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2018-01-04</td>
<td style="text-align:right">2018-01-04</td>
<td style="text-align:right">0</td>
<td style="text-align:right">-8</td>
<td style="text-align:right">阴</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">28</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2018-01-05</td>
<td style="text-align:right">2018-01-05</td>
<td style="text-align:right">3</td>
<td style="text-align:right">-6</td>
<td style="text-align:right">多云~晴</td>
<td style="text-align:right">西北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">50</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<p>In [5]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">index</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[5]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2018-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-04&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-01-05&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-06&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-07&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-08&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-01-09&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-10&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="o">...</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-12-22&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-12-23&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-12-24&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-12-25&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-12-26&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-12-27&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-12-28&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-12-29&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-12-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-12-31&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ymd&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">365</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [6]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># DatetimeIndex是Timestamp的列表形式</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[6]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2018-01-01 00:00:00&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-方便的对datetimeindex进行查询">3、 方便的对DatetimeIndex进行查询</h3>
<p>In [7]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 筛选固定的某一天</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2018-01-05&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[7]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ymd</span>          <span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>
</span></span><span class="line"><span class="cl"><span class="n">bWendu</span>                <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">yWendu</span>               <span class="o">-</span><span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">tianqi</span>             <span class="n">多云</span><span class="o">~</span><span class="n">晴</span>
</span></span><span class="line"><span class="cl"><span class="n">fengxiang</span>           <span class="n">西北风</span>
</span></span><span class="line"><span class="cl"><span class="n">fengli</span>             <span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="n">级</span>
</span></span><span class="line"><span class="cl"><span class="n">aqi</span>                  <span class="mi">50</span>
</span></span><span class="line"><span class="cl"><span class="n">aqiInfo</span>               <span class="n">优</span>
</span></span><span class="line"><span class="cl"><span class="n">aqiLevel</span>              <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [8]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 日期区间</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2018-01-05&#39;</span><span class="p">:</span><span class="s1">&#39;2018-01-10&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[8]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">ymd</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2018-01-05</td>
<td style="text-align:right">2018-01-05</td>
<td style="text-align:right">3</td>
<td style="text-align:right">-6</td>
<td style="text-align:right">多云~晴</td>
<td style="text-align:right">西北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">50</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2018-01-06</td>
<td style="text-align:right">2018-01-06</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">多云~阴</td>
<td style="text-align:right">西南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">32</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2018-01-07</td>
<td style="text-align:right">2018-01-07</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-4</td>
<td style="text-align:right">阴~多云</td>
<td style="text-align:right">西南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">59</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">2018-01-08</td>
<td style="text-align:right">2018-01-08</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-6</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">西北风</td>
<td style="text-align:right">4-5级</td>
<td style="text-align:right">50</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2018-01-09</td>
<td style="text-align:right">2018-01-09</td>
<td style="text-align:right">1</td>
<td style="text-align:right">-8</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">西北风</td>
<td style="text-align:right">3-4级</td>
<td style="text-align:right">34</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2018-01-10</td>
<td style="text-align:right">2018-01-10</td>
<td style="text-align:right">-2</td>
<td style="text-align:right">-10</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">西北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">26</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<p>In [10]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 按月份前缀筛选</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2018-03&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[10]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">ymd</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2018-03-01</td>
<td style="text-align:right">2018-03-01</td>
<td style="text-align:right">8</td>
<td style="text-align:right">-3</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">西南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">46</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2018-03-02</td>
<td style="text-align:right">2018-03-02</td>
<td style="text-align:right">9</td>
<td style="text-align:right">-1</td>
<td style="text-align:right">晴~多云</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">95</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">2018-03-03</td>
<td style="text-align:right">2018-03-03</td>
<td style="text-align:right">13</td>
<td style="text-align:right">3</td>
<td style="text-align:right">多云~阴</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">214</td>
<td style="text-align:right">重度污染</td>
<td style="text-align:right">5</td>
</tr>
<tr>
<td style="text-align:right">2018-03-04</td>
<td style="text-align:right">2018-03-04</td>
<td style="text-align:right">7</td>
<td style="text-align:right">-2</td>
<td style="text-align:right">阴~多云</td>
<td style="text-align:right">东南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">144</td>
<td style="text-align:right">轻度污染</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">2018-03-05</td>
<td style="text-align:right">2018-03-05</td>
<td style="text-align:right">8</td>
<td style="text-align:right">-3</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">94</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">2018-03-06</td>
<td style="text-align:right">2018-03-06</td>
<td style="text-align:right">6</td>
<td style="text-align:right">-3</td>
<td style="text-align:right">多云~阴</td>
<td style="text-align:right">东南风</td>
<td style="text-align:right">3-4级</td>
<td style="text-align:right">67</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">2018-03-07</td>
<td style="text-align:right">2018-03-07</td>
<td style="text-align:right">6</td>
<td style="text-align:right">-2</td>
<td style="text-align:right">阴~多云</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">65</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">2018-03-08</td>
<td style="text-align:right">2018-03-08</td>
<td style="text-align:right">8</td>
<td style="text-align:right">-4</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">62</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">2018-03-09</td>
<td style="text-align:right">2018-03-09</td>
<td style="text-align:right">10</td>
<td style="text-align:right">-2</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">西南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">132</td>
<td style="text-align:right">轻度污染</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">2018-03-10</td>
<td style="text-align:right">2018-03-10</td>
<td style="text-align:right">14</td>
<td style="text-align:right">-2</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">东南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">171</td>
<td style="text-align:right">中度污染</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td style="text-align:right">2018-03-11</td>
<td style="text-align:right">2018-03-11</td>
<td style="text-align:right">11</td>
<td style="text-align:right">0</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">81</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">2018-03-12</td>
<td style="text-align:right">2018-03-12</td>
<td style="text-align:right">15</td>
<td style="text-align:right">3</td>
<td style="text-align:right">多云~晴</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">174</td>
<td style="text-align:right">中度污染</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td style="text-align:right">2018-03-13</td>
<td style="text-align:right">2018-03-13</td>
<td style="text-align:right">17</td>
<td style="text-align:right">5</td>
<td style="text-align:right">晴~多云</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">287</td>
<td style="text-align:right">重度污染</td>
<td style="text-align:right">5</td>
</tr>
<tr>
<td style="text-align:right">2018-03-14</td>
<td style="text-align:right">2018-03-14</td>
<td style="text-align:right">15</td>
<td style="text-align:right">6</td>
<td style="text-align:right">多云~阴</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">293</td>
<td style="text-align:right">重度污染</td>
<td style="text-align:right">5</td>
</tr>
<tr>
<td style="text-align:right">2018-03-15</td>
<td style="text-align:right">2018-03-15</td>
<td style="text-align:right">12</td>
<td style="text-align:right">-1</td>
<td style="text-align:right">多云~晴</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">3-4级</td>
<td style="text-align:right">70</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">2018-03-16</td>
<td style="text-align:right">2018-03-16</td>
<td style="text-align:right">10</td>
<td style="text-align:right">-1</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">58</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">2018-03-17</td>
<td style="text-align:right">2018-03-17</td>
<td style="text-align:right">4</td>
<td style="text-align:right">0</td>
<td style="text-align:right">小雨~阴</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">81</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">2018-03-18</td>
<td style="text-align:right">2018-03-18</td>
<td style="text-align:right">13</td>
<td style="text-align:right">1</td>
<td style="text-align:right">多云~晴</td>
<td style="text-align:right">西南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">134</td>
<td style="text-align:right">轻度污染</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">2018-03-19</td>
<td style="text-align:right">2018-03-19</td>
<td style="text-align:right">13</td>
<td style="text-align:right">2</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">东风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">107</td>
<td style="text-align:right">轻度污染</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">2018-03-20</td>
<td style="text-align:right">2018-03-20</td>
<td style="text-align:right">10</td>
<td style="text-align:right">-2</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">41</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2018-03-21</td>
<td style="text-align:right">2018-03-21</td>
<td style="text-align:right">11</td>
<td style="text-align:right">1</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">西南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">76</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">2018-03-22</td>
<td style="text-align:right">2018-03-22</td>
<td style="text-align:right">17</td>
<td style="text-align:right">4</td>
<td style="text-align:right">晴~多云</td>
<td style="text-align:right">西南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">112</td>
<td style="text-align:right">轻度污染</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">2018-03-23</td>
<td style="text-align:right">2018-03-23</td>
<td style="text-align:right">18</td>
<td style="text-align:right">5</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">146</td>
<td style="text-align:right">轻度污染</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">2018-03-24</td>
<td style="text-align:right">2018-03-24</td>
<td style="text-align:right">22</td>
<td style="text-align:right">5</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">西南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">119</td>
<td style="text-align:right">轻度污染</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">2018-03-25</td>
<td style="text-align:right">2018-03-25</td>
<td style="text-align:right">24</td>
<td style="text-align:right">7</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">78</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">2018-03-26</td>
<td style="text-align:right">2018-03-26</td>
<td style="text-align:right">25</td>
<td style="text-align:right">7</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">西南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">151</td>
<td style="text-align:right">中度污染</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td style="text-align:right">2018-03-27</td>
<td style="text-align:right">2018-03-27</td>
<td style="text-align:right">27</td>
<td style="text-align:right">11</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">243</td>
<td style="text-align:right">重度污染</td>
<td style="text-align:right">5</td>
</tr>
<tr>
<td style="text-align:right">2018-03-28</td>
<td style="text-align:right">2018-03-28</td>
<td style="text-align:right">25</td>
<td style="text-align:right">9</td>
<td style="text-align:right">多云~晴</td>
<td style="text-align:right">东风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">387</td>
<td style="text-align:right">严重污染</td>
<td style="text-align:right">6</td>
</tr>
<tr>
<td style="text-align:right">2018-03-29</td>
<td style="text-align:right">2018-03-29</td>
<td style="text-align:right">19</td>
<td style="text-align:right">7</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">119</td>
<td style="text-align:right">轻度污染</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">2018-03-30</td>
<td style="text-align:right">2018-03-30</td>
<td style="text-align:right">18</td>
<td style="text-align:right">8</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">68</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">2018-03-31</td>
<td style="text-align:right">2018-03-31</td>
<td style="text-align:right">23</td>
<td style="text-align:right">9</td>
<td style="text-align:right">多云~晴</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">125</td>
<td style="text-align:right">轻度污染</td>
<td style="text-align:right">3</td>
</tr>
</tbody>
</table>
<p>In [11]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 按月份前缀筛选</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&#34;2018-07&#34;</span><span class="p">:</span><span class="s2">&#34;2018-09&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[11]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2018-07-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-07-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-07-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-07-04&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-07-05&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-07-06&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-07-07&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-07-08&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-07-09&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-07-10&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-07-11&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-07-12&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-07-13&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-07-14&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-07-15&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-07-16&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-07-17&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-07-18&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-07-19&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-07-20&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-07-21&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-07-22&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-07-23&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-07-24&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-07-25&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-07-26&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-07-27&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-07-28&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-07-29&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-07-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-07-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-01&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-08-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-04&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-05&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-08-06&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-07&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-08&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-09&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-08-10&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-11&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-12&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-13&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-08-14&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-15&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-16&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-17&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-08-18&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-19&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-20&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-21&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-08-22&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-23&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-24&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-25&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-08-26&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-27&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-28&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-29&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-08-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-09-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-09-02&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-09-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-09-04&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-09-05&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-09-06&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-09-07&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-09-08&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-09-09&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-09-10&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-09-11&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-09-12&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-09-13&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-09-14&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-09-15&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-09-16&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-09-17&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-09-18&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-09-19&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-09-20&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-09-21&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-09-22&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-09-23&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-09-24&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-09-25&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-09-26&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-09-27&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-09-28&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-09-29&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-09-30&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ymd&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [12]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 按年份前缀筛选</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&#34;2018&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[12]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">ymd</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2018-01-01</td>
<td style="text-align:right">2018-01-01</td>
<td style="text-align:right">3</td>
<td style="text-align:right">-6</td>
<td style="text-align:right">晴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">59</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">2018-01-02</td>
<td style="text-align:right">2018-01-02</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">阴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">49</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2018-01-03</td>
<td style="text-align:right">2018-01-03</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">28</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2018-01-04</td>
<td style="text-align:right">2018-01-04</td>
<td style="text-align:right">0</td>
<td style="text-align:right">-8</td>
<td style="text-align:right">阴</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">28</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2018-01-05</td>
<td style="text-align:right">2018-01-05</td>
<td style="text-align:right">3</td>
<td style="text-align:right">-6</td>
<td style="text-align:right">多云~晴</td>
<td style="text-align:right">西北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">50</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<h3 id="4方便的获取周月季度">4、方便的获取周、月、季度</h3>
<p>Timestamp、DatetimeIndex支持大量的属性可以获取日期分量：
<a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#time-date-components">https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#time-date-components</a></p>
<p>In [13]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 周数字列表</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">week</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[13]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">Int64Index</span><span class="p">([</span> <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="o">...</span>
</span></span><span class="line"><span class="cl">            <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span>  <span class="mi">1</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">           <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int64&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ymd&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">365</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [14]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 月数字列表</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[14]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">Int64Index</span><span class="p">([</span> <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="o">...</span>
</span></span><span class="line"><span class="cl">            <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">           <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int64&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ymd&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">365</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [15]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 季度数字列表</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">quarter</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[15]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Int64Index([1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
</span></span><span class="line"><span class="cl">            ...
</span></span><span class="line"><span class="cl">            4, 4, 4, 4, 4, 4, 4, 4, 4, 4],
</span></span><span class="line"><span class="cl">           dtype=&#39;int64&#39;, name=&#39;ymd&#39;, length=365)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="5统计每周每月每个季度的最高温度">5、统计每周、每月、每个季度的最高温度</h3>
<h4 id="统计每周的数据">统计每周的数据</h4>
<p>In [16]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">week</span><span class="p">)[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[16]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ymd</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>    <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>   <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>    <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">bWendu</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int32</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [17]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">week</span><span class="p">)[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[17]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0x23300b75b88</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/19.png" alt=""></p>
<h4 id="统计每个月的数据">统计每个月的数据</h4>
<p>In [18]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[18]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ymd</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>     <span class="mi">12</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>     <span class="mi">27</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>     <span class="mi">30</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>     <span class="mi">35</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>     <span class="mi">38</span>
</span></span><span class="line"><span class="cl"><span class="mi">7</span>     <span class="mi">37</span>
</span></span><span class="line"><span class="cl"><span class="mi">8</span>     <span class="mi">36</span>
</span></span><span class="line"><span class="cl"><span class="mi">9</span>     <span class="mi">31</span>
</span></span><span class="line"><span class="cl"><span class="mi">10</span>    <span class="mi">25</span>
</span></span><span class="line"><span class="cl"><span class="mi">11</span>    <span class="mi">18</span>
</span></span><span class="line"><span class="cl"><span class="mi">12</span>    <span class="mi">10</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">bWendu</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int32</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [19]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[19]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0x23302dac4c8</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/20.png" alt=""></p>
<h4 id="统计每个季度的数据">统计每个季度的数据</h4>
<p>In [20]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">df.groupby(df.index.quarter)[&#34;bWendu&#34;].max()
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[20]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ymd</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="mi">27</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="mi">38</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>    <span class="mi">37</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>    <span class="mi">25</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">bWendu</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int32</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [21]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">quarter</span><span class="p">)[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[21]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0x23302e338c8</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/21.png" alt=""></p>
<h1 id="22pandas怎么处理日期索引的缺失">22、Pandas怎么处理日期索引的缺失？</h1>
<p>问题：按日期统计的数据，缺失了某天，导致数据不全该怎么补充日期？</p>
<p>可以用两种方法实现：
1、DataFrame.reindex，调整dataframe的索引以适应新的索引
2、DataFrame.resample，可以对时间序列重采样，支持补充缺失值</p>
<h2 id="问题如果缺失了索引该怎么填充">问题：如果缺失了索引该怎么填充？</h2>
<p>In [1]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [2]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;pdate&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;2019-12-01&#34;</span><span class="p">,</span> <span class="s2">&#34;2019-12-02&#34;</span><span class="p">,</span> <span class="s2">&#34;2019-12-04&#34;</span><span class="p">,</span> <span class="s2">&#34;2019-12-05&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;pv&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">500</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;uv&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[2]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">pdate</th>
<th style="text-align:right">pv</th>
<th style="text-align:right">uv</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2019-12-01</td>
<td style="text-align:right">100</td>
<td style="text-align:right">10</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2019-12-02</td>
<td style="text-align:right">200</td>
<td style="text-align:right">20</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2019-12-04</td>
<td style="text-align:right">400</td>
<td style="text-align:right">40</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">2019-12-05</td>
<td style="text-align:right">500</td>
<td style="text-align:right">50</td>
</tr>
</tbody>
</table>
<p>In [3]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&#34;pdate&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[3]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0x1a0d908bf48</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/22.png" alt=""></p>
<p>*<strong>问题，这里缺失了2019-12-03的数据，导致数据不全该怎么补充？*</strong></p>
<h2 id="方法1使用pandasreindex方法">方法1：使用pandas.reindex方法</h2>
<h3 id="1将df的索引变成日期索引">1、将df的索引变成日期索引</h3>
<p>In [4]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_date</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&#34;pdate&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_date</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[4]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">pv</th>
<th style="text-align:right">uv</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">pdate</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2019-12-01</td>
<td style="text-align:right">100</td>
<td style="text-align:right">10</td>
</tr>
<tr>
<td style="text-align:right">2019-12-02</td>
<td style="text-align:right">200</td>
<td style="text-align:right">20</td>
</tr>
<tr>
<td style="text-align:right">2019-12-04</td>
<td style="text-align:right">400</td>
<td style="text-align:right">40</td>
</tr>
<tr>
<td style="text-align:right">2019-12-05</td>
<td style="text-align:right">500</td>
<td style="text-align:right">50</td>
</tr>
</tbody>
</table>
<p>In [5]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_date</span><span class="o">.</span><span class="n">index</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[5]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;2019-12-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-12-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-12-04&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-12-05&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;pdate&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [6]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 将df的索引设置为日期索引</span>
</span></span><span class="line"><span class="cl"><span class="n">df_date</span> <span class="o">=</span> <span class="n">df_date</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_date</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">df_date</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[6]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">pv</th>
<th style="text-align:right">uv</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">pdate</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2019-12-01</td>
<td style="text-align:right">100</td>
<td style="text-align:right">10</td>
</tr>
<tr>
<td style="text-align:right">2019-12-02</td>
<td style="text-align:right">200</td>
<td style="text-align:right">20</td>
</tr>
<tr>
<td style="text-align:right">2019-12-04</td>
<td style="text-align:right">400</td>
<td style="text-align:right">40</td>
</tr>
<tr>
<td style="text-align:right">2019-12-05</td>
<td style="text-align:right">500</td>
<td style="text-align:right">50</td>
</tr>
</tbody>
</table>
<p>In [7]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_date</span><span class="o">.</span><span class="n">index</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[7]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2019-12-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-12-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-12-04&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-12-05&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;pdate&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2使用pandasreindex填充缺失的索引">2、使用pandas.reindex填充缺失的索引</h3>
<p>In [8]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 生成完整的日期序列</span>
</span></span><span class="line"><span class="cl"><span class="n">pdates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s2">&#34;2019-12-01&#34;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&#34;2019-12-05&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pdates</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[8]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2019-12-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-12-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-12-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-12-04&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2019-12-05&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [9]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_date_new</span> <span class="o">=</span> <span class="n">df_date</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">pdates</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_date_new</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[9]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">pv</th>
<th style="text-align:right">uv</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">2019-12-01</td>
<td style="text-align:right">100</td>
<td style="text-align:right">10</td>
</tr>
<tr>
<td style="text-align:right">2019-12-02</td>
<td style="text-align:right">200</td>
<td style="text-align:right">20</td>
</tr>
<tr>
<td style="text-align:right">2019-12-03</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">2019-12-04</td>
<td style="text-align:right">400</td>
<td style="text-align:right">40</td>
</tr>
<tr>
<td style="text-align:right">2019-12-05</td>
<td style="text-align:right">500</td>
<td style="text-align:right">50</td>
</tr>
</tbody>
</table>
<p>In [10]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_date_new</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[10]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0x1a0db1ab388</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/23.png" alt=""></p>
<h2 id="方法2使用pandasresample方法">方法2：使用pandas.resample方法</h2>
<h3 id="1先将索引变成日期索引">1、先将索引变成日期索引</h3>
<p>In [11]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[11]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">pdate</th>
<th style="text-align:right">pv</th>
<th style="text-align:right">uv</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2019-12-01</td>
<td style="text-align:right">100</td>
<td style="text-align:right">10</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2019-12-02</td>
<td style="text-align:right">200</td>
<td style="text-align:right">20</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2019-12-04</td>
<td style="text-align:right">400</td>
<td style="text-align:right">40</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">2019-12-05</td>
<td style="text-align:right">500</td>
<td style="text-align:right">50</td>
</tr>
</tbody>
</table>
<p>In [12]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_new2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;pdate&#34;</span><span class="p">]))</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&#34;pdate&#34;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_new2</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[12]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">pv</th>
<th style="text-align:right">uv</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">pdate</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2019-12-01</td>
<td style="text-align:right">100</td>
<td style="text-align:right">10</td>
</tr>
<tr>
<td style="text-align:right">2019-12-02</td>
<td style="text-align:right">200</td>
<td style="text-align:right">20</td>
</tr>
<tr>
<td style="text-align:right">2019-12-04</td>
<td style="text-align:right">400</td>
<td style="text-align:right">40</td>
</tr>
<tr>
<td style="text-align:right">2019-12-05</td>
<td style="text-align:right">500</td>
<td style="text-align:right">50</td>
</tr>
</tbody>
</table>
<p>In [13]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_new2</span><span class="o">.</span><span class="n">index</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[13]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2019-12-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-12-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-12-04&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-12-05&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;pdate&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2使用dataframe的resample的方法按照天重采样">2、使用dataframe的resample的方法按照天重采样</h3>
<p>resample的含义：
改变数据的时间频率，比如把天数据变成月份，或者把小时数据变成分钟级别</p>
<p>resample的语法：
(DataFrame or Series).resample(arguments).(aggregate function)</p>
<p>resample的采样规则参数：
<a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases">https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases</a></p>
<p>In [14]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 由于采样会让区间变成一个值，所以需要指定mean等采样值的设定方法</span>
</span></span><span class="line"><span class="cl"><span class="n">df_new2</span> <span class="o">=</span> <span class="n">df_new2</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&#34;D&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_new2</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[14]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">pv</th>
<th style="text-align:right">uv</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">pdate</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2019-12-01</td>
<td style="text-align:right">100.0</td>
<td style="text-align:right">10.0</td>
</tr>
<tr>
<td style="text-align:right">2019-12-02</td>
<td style="text-align:right">200.0</td>
<td style="text-align:right">20.0</td>
</tr>
<tr>
<td style="text-align:right">2019-12-03</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">0.0</td>
</tr>
<tr>
<td style="text-align:right">2019-12-04</td>
<td style="text-align:right">400.0</td>
<td style="text-align:right">40.0</td>
</tr>
<tr>
<td style="text-align:right">2019-12-05</td>
<td style="text-align:right">500.0</td>
<td style="text-align:right">50.0</td>
</tr>
</tbody>
</table>
<p>In [15]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># resample的使用方式</span>
</span></span><span class="line"><span class="cl"><span class="n">df_new2</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&#34;2D&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[15]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">pv</th>
<th style="text-align:right">uv</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">pdate</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2019-12-01</td>
<td style="text-align:right">150.0</td>
<td style="text-align:right">15.0</td>
</tr>
<tr>
<td style="text-align:right">2019-12-03</td>
<td style="text-align:right">200.0</td>
<td style="text-align:right">20.0</td>
</tr>
<tr>
<td style="text-align:right">2019-12-05</td>
<td style="text-align:right">500.0</td>
<td style="text-align:right">50.0</td>
</tr>
</tbody>
</table>
<h1 id="23pandas怎样实现excel的vlookup并且在指定列后面输出">23、Pandas怎样实现Excel的vlookup并且在指定列后面输出？</h1>
<p>背景：</p>
<ol>
<li>有两个excel，他们有相同的一个列；</li>
<li>按照这个列合并成一个大的excel，即vlookup功能，要求：
<ul>
<li>只需要第二个excel的少量的列，比如从40个列中挑选2个列</li>
<li>新增的来自第二个excel的列需要放到第一个excel指定的列后面；</li>
</ul>
</li>
<li>将结果输出到一个新的excel;</li>
</ol>
<h3 id="步骤1读取两个数据表">步骤1：读取两个数据表</h3>
<p>In [1]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [2]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 学生成绩表</span>
</span></span><span class="line"><span class="cl"><span class="n">df_grade</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&#34;./course_datas/c23_excel_vlookup/学生成绩表.xlsx&#34;</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="n">df_grade</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[2]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">班级</th>
<th style="text-align:right">学号</th>
<th style="text-align:right">语文成绩</th>
<th style="text-align:right">数学成绩</th>
<th style="text-align:right">英语成绩</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">C01</td>
<td style="text-align:right">S001</td>
<td style="text-align:right">99</td>
<td style="text-align:right">84</td>
<td style="text-align:right">88</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">C01</td>
<td style="text-align:right">S002</td>
<td style="text-align:right">66</td>
<td style="text-align:right">95</td>
<td style="text-align:right">77</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">C01</td>
<td style="text-align:right">S003</td>
<td style="text-align:right">68</td>
<td style="text-align:right">68</td>
<td style="text-align:right">61</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">C01</td>
<td style="text-align:right">S004</td>
<td style="text-align:right">63</td>
<td style="text-align:right">66</td>
<td style="text-align:right">82</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">C01</td>
<td style="text-align:right">S005</td>
<td style="text-align:right">72</td>
<td style="text-align:right">95</td>
<td style="text-align:right">94</td>
</tr>
</tbody>
</table>
<p>In [3]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 学生信息表</span>
</span></span><span class="line"><span class="cl"><span class="n">df_sinfo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&#34;./course_datas/c23_excel_vlookup/学生信息表.xlsx&#34;</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="n">df_sinfo</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[3]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">学号</th>
<th style="text-align:right">姓名</th>
<th style="text-align:right">性别</th>
<th style="text-align:right">年龄</th>
<th style="text-align:right">籍贯</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">S001</td>
<td style="text-align:right">怠涵</td>
<td style="text-align:right">女</td>
<td style="text-align:right">23</td>
<td style="text-align:right">山东</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">S002</td>
<td style="text-align:right">婉清</td>
<td style="text-align:right">女</td>
<td style="text-align:right">25</td>
<td style="text-align:right">河南</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">S003</td>
<td style="text-align:right">溪榕</td>
<td style="text-align:right">女</td>
<td style="text-align:right">23</td>
<td style="text-align:right">湖北</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">S004</td>
<td style="text-align:right">漠涓</td>
<td style="text-align:right">女</td>
<td style="text-align:right">19</td>
<td style="text-align:right">陕西</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">S005</td>
<td style="text-align:right">祈博</td>
<td style="text-align:right">女</td>
<td style="text-align:right">24</td>
<td style="text-align:right">山东</td>
</tr>
</tbody>
</table>
<p>*<strong>目标：怎样将第二个“学生信息表”的姓名、性别两列，添加到第一个表“学生成绩表”，并且放在第一个表的“学号”列后面？*</strong></p>
<h3 id="步骤2实现两个表的关联">步骤2：实现两个表的关联</h3>
<p>即excel的vloopup功能</p>
<p>In [4]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 只筛选第二个表的少量的列</span>
</span></span><span class="line"><span class="cl"><span class="n">df_sinfo</span> <span class="o">=</span> <span class="n">df_sinfo</span><span class="p">[[</span><span class="s2">&#34;学号&#34;</span><span class="p">,</span> <span class="s2">&#34;姓名&#34;</span><span class="p">,</span> <span class="s2">&#34;性别&#34;</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl"><span class="n">df_sinfo</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[4]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">学号</th>
<th style="text-align:right">姓名</th>
<th style="text-align:right">性别</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">S001</td>
<td style="text-align:right">怠涵</td>
<td style="text-align:right">女</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">S002</td>
<td style="text-align:right">婉清</td>
<td style="text-align:right">女</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">S003</td>
<td style="text-align:right">溪榕</td>
<td style="text-align:right">女</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">S004</td>
<td style="text-align:right">漠涓</td>
<td style="text-align:right">女</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">S005</td>
<td style="text-align:right">祈博</td>
<td style="text-align:right">女</td>
</tr>
</tbody>
</table>
<p>In [5]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_merge</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">df_grade</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">df_sinfo</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&#34;学号&#34;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&#34;学号&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_merge</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[5]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">班级</th>
<th style="text-align:right">学号</th>
<th style="text-align:right">语文成绩</th>
<th style="text-align:right">数学成绩</th>
<th style="text-align:right">英语成绩</th>
<th style="text-align:right">姓名</th>
<th style="text-align:right">性别</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">C01</td>
<td style="text-align:right">S001</td>
<td style="text-align:right">99</td>
<td style="text-align:right">84</td>
<td style="text-align:right">88</td>
<td style="text-align:right">怠涵</td>
<td style="text-align:right">女</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">C01</td>
<td style="text-align:right">S002</td>
<td style="text-align:right">66</td>
<td style="text-align:right">95</td>
<td style="text-align:right">77</td>
<td style="text-align:right">婉清</td>
<td style="text-align:right">女</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">C01</td>
<td style="text-align:right">S003</td>
<td style="text-align:right">68</td>
<td style="text-align:right">68</td>
<td style="text-align:right">61</td>
<td style="text-align:right">溪榕</td>
<td style="text-align:right">女</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">C01</td>
<td style="text-align:right">S004</td>
<td style="text-align:right">63</td>
<td style="text-align:right">66</td>
<td style="text-align:right">82</td>
<td style="text-align:right">漠涓</td>
<td style="text-align:right">女</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">C01</td>
<td style="text-align:right">S005</td>
<td style="text-align:right">72</td>
<td style="text-align:right">95</td>
<td style="text-align:right">94</td>
<td style="text-align:right">祈博</td>
<td style="text-align:right">女</td>
</tr>
</tbody>
</table>
<h3 id="步骤3调整列的顺序">步骤3：调整列的顺序</h3>
<p>In [6]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_merge</span><span class="o">.</span><span class="n">columns</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[6]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;班级&#39;</span><span class="p">,</span> <span class="s1">&#39;学号&#39;</span><span class="p">,</span> <span class="s1">&#39;语文成绩&#39;</span><span class="p">,</span> <span class="s1">&#39;数学成绩&#39;</span><span class="p">,</span> <span class="s1">&#39;英语成绩&#39;</span><span class="p">,</span> <span class="s1">&#39;姓名&#39;</span><span class="p">,</span> <span class="s1">&#39;性别&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="问题怎样将姓名-性别两列放到学号的后面">问题：怎样将&rsquo;姓名&rsquo;, &lsquo;性别&rsquo;两列，放到&rsquo;学号&rsquo;的后面？</h4>
<p>接下来需要用Python的语法实现列表的处理</p>
<p>In [7]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 将columns变成python的列表形式</span>
</span></span><span class="line"><span class="cl"><span class="n">new_columns</span> <span class="o">=</span> <span class="n">df_merge</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">new_columns</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[7]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">[</span><span class="s1">&#39;班级&#39;</span><span class="p">,</span> <span class="s1">&#39;学号&#39;</span><span class="p">,</span> <span class="s1">&#39;语文成绩&#39;</span><span class="p">,</span> <span class="s1">&#39;数学成绩&#39;</span><span class="p">,</span> <span class="s1">&#39;英语成绩&#39;</span><span class="p">,</span> <span class="s1">&#39;姓名&#39;</span><span class="p">,</span> <span class="s1">&#39;性别&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [8]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 按逆序insert，会将&#34;姓名&#34;，&#34;性别&#34;放到&#34;学号&#34;的后面
</span></span><span class="line"><span class="cl">for name in [&#34;姓名&#34;, &#34;性别&#34;][::-1]:
</span></span><span class="line"><span class="cl">    new_columns.remove(name)
</span></span><span class="line"><span class="cl">    new_columns.insert(new_columns.index(&#34;学号&#34;)+1, name)
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [9]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">new_columns</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[9]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">[</span><span class="s1">&#39;班级&#39;</span><span class="p">,</span> <span class="s1">&#39;学号&#39;</span><span class="p">,</span> <span class="s1">&#39;姓名&#39;</span><span class="p">,</span> <span class="s1">&#39;性别&#39;</span><span class="p">,</span> <span class="s1">&#39;语文成绩&#39;</span><span class="p">,</span> <span class="s1">&#39;数学成绩&#39;</span><span class="p">,</span> <span class="s1">&#39;英语成绩&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [10]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_merge</span> <span class="o">=</span> <span class="n">df_merge</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">new_columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_merge</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[10]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">班级</th>
<th style="text-align:right">学号</th>
<th style="text-align:right">姓名</th>
<th style="text-align:right">性别</th>
<th style="text-align:right">语文成绩</th>
<th style="text-align:right">数学成绩</th>
<th style="text-align:right">英语成绩</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">C01</td>
<td style="text-align:right">S001</td>
<td style="text-align:right">怠涵</td>
<td style="text-align:right">女</td>
<td style="text-align:right">99</td>
<td style="text-align:right">84</td>
<td style="text-align:right">88</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">C01</td>
<td style="text-align:right">S002</td>
<td style="text-align:right">婉清</td>
<td style="text-align:right">女</td>
<td style="text-align:right">66</td>
<td style="text-align:right">95</td>
<td style="text-align:right">77</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">C01</td>
<td style="text-align:right">S003</td>
<td style="text-align:right">溪榕</td>
<td style="text-align:right">女</td>
<td style="text-align:right">68</td>
<td style="text-align:right">68</td>
<td style="text-align:right">61</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">C01</td>
<td style="text-align:right">S004</td>
<td style="text-align:right">漠涓</td>
<td style="text-align:right">女</td>
<td style="text-align:right">63</td>
<td style="text-align:right">66</td>
<td style="text-align:right">82</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">C01</td>
<td style="text-align:right">S005</td>
<td style="text-align:right">祈博</td>
<td style="text-align:right">女</td>
<td style="text-align:right">72</td>
<td style="text-align:right">95</td>
<td style="text-align:right">94</td>
</tr>
</tbody>
</table>
<h3 id="步骤4输出最终的excel文件">步骤4：输出最终的Excel文件</h3>
<p>In [11]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_merge</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s2">&#34;./course_datas/c23_excel_vlookup/合并后的数据表.xlsx&#34;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="24pandas怎样结合pyecharts绘制交互性折线图">24、Pandas怎样结合Pyecharts绘制交互性折线图？</h1>
<p>背景：</p>
<ul>
<li>Pandas是Python用于数据分析领域的超级牛的库</li>
<li>Echarts是百度开源的非常好用强大的可视化图表库，Pyecharts是它的Python库版本</li>
</ul>
<h2 id="1读取数据">1、读取数据</h2>
<p>In [1]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [2]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">xlsx_path</span> <span class="o">=</span> <span class="s2">&#34;./datas/stocks/baidu_stocks.xlsx&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">xlsx_path</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s2">&#34;datetime&#34;</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[2]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">code</th>
<th style="text-align:right">open</th>
<th style="text-align:right">close</th>
<th style="text-align:right">high</th>
<th style="text-align:right">low</th>
<th style="text-align:right">vol</th>
<th style="text-align:right">p_change</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">datetime</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2019-12-03</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">115.199997</td>
<td style="text-align:right">114.800003</td>
<td style="text-align:right">116.019997</td>
<td style="text-align:right">113.300003</td>
<td style="text-align:right">3493249</td>
<td style="text-align:right">-2.25</td>
</tr>
<tr>
<td style="text-align:right">2019-12-02</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">118.389999</td>
<td style="text-align:right">117.440002</td>
<td style="text-align:right">119.764999</td>
<td style="text-align:right">116.400002</td>
<td style="text-align:right">2203313</td>
<td style="text-align:right">-0.92</td>
</tr>
<tr>
<td style="text-align:right">2019-11-29</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">118.300003</td>
<td style="text-align:right">118.529999</td>
<td style="text-align:right">118.690002</td>
<td style="text-align:right">117.599998</td>
<td style="text-align:right">1917004</td>
<td style="text-align:right">-0.82</td>
</tr>
<tr>
<td style="text-align:right">2019-11-27</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">119.180000</td>
<td style="text-align:right">119.510002</td>
<td style="text-align:right">119.839996</td>
<td style="text-align:right">118.440002</td>
<td style="text-align:right">2341070</td>
<td style="text-align:right">0.77</td>
</tr>
<tr>
<td style="text-align:right">2019-11-26</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">120.010002</td>
<td style="text-align:right">118.599998</td>
<td style="text-align:right">120.440002</td>
<td style="text-align:right">118.099998</td>
<td style="text-align:right">3813176</td>
<td style="text-align:right">-1.43</td>
</tr>
</tbody>
</table>
<p>In [3]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">index</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[3]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2019-12-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-12-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-11-29&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-11-27&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2019-11-26&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-11-25&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-11-22&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-11-21&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2019-11-20&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-11-19&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="o">...</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2019-01-15&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-01-14&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-01-11&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-01-10&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2019-01-09&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-01-08&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-01-07&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-01-04&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2019-01-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-01-02&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">227</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [4]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">df.sort_index(inplace=True)
</span></span><span class="line"><span class="cl">df.head()
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[4]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">code</th>
<th style="text-align:right">open</th>
<th style="text-align:right">close</th>
<th style="text-align:right">high</th>
<th style="text-align:right">low</th>
<th style="text-align:right">vol</th>
<th style="text-align:right">p_change</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">datetime</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2019-01-02</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">156.179993</td>
<td style="text-align:right">162.250000</td>
<td style="text-align:right">164.330002</td>
<td style="text-align:right">155.490005</td>
<td style="text-align:right">2996952</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2019-01-03</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">158.750000</td>
<td style="text-align:right">154.710007</td>
<td style="text-align:right">159.880005</td>
<td style="text-align:right">153.779999</td>
<td style="text-align:right">3879180</td>
<td style="text-align:right">-4.65</td>
</tr>
<tr>
<td style="text-align:right">2019-01-04</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">157.600006</td>
<td style="text-align:right">160.949997</td>
<td style="text-align:right">162.429993</td>
<td style="text-align:right">157.250000</td>
<td style="text-align:right">3847497</td>
<td style="text-align:right">4.03</td>
</tr>
<tr>
<td style="text-align:right">2019-01-07</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">162.600006</td>
<td style="text-align:right">162.600006</td>
<td style="text-align:right">164.490005</td>
<td style="text-align:right">158.509995</td>
<td style="text-align:right">3266091</td>
<td style="text-align:right">1.03</td>
</tr>
<tr>
<td style="text-align:right">2019-01-08</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">162.190002</td>
<td style="text-align:right">163.399994</td>
<td style="text-align:right">163.889999</td>
<td style="text-align:right">158.160004</td>
<td style="text-align:right">3253361</td>
<td style="text-align:right">0.49</td>
</tr>
</tbody>
</table>
<h2 id="2使用pyecharts绘制折线图">2、使用Pyecharts绘制折线图</h2>
<p>In [5]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 如果没有安装，使用pip install pyecharts安装</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyecharts.charts</span> <span class="kn">import</span> <span class="n">Line</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyecharts</span> <span class="kn">import</span> <span class="n">options</span> <span class="k">as</span> <span class="n">opts</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [6]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 折线图</span>
</span></span><span class="line"><span class="cl"><span class="n">line</span> <span class="o">=</span> <span class="n">Line</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># x轴</span>
</span></span><span class="line"><span class="cl"><span class="n">line</span><span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 每个y轴</span>
</span></span><span class="line"><span class="cl"><span class="n">line</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&#34;开盘价&#34;</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;open&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">line</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&#34;收盘价&#34;</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;close&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 图表配置</span>
</span></span><span class="line"><span class="cl"><span class="n">line</span><span class="o">.</span><span class="n">set_global_opts</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">title_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TitleOpts</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&#34;百度股票2019年&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">tooltip_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TooltipOpts</span><span class="p">(</span><span class="n">trigger</span><span class="o">=</span><span class="s2">&#34;axis&#34;</span><span class="p">,</span> <span class="n">axis_pointer_type</span><span class="o">=</span><span class="s2">&#34;cross&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[6]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">pyecharts</span><span class="o">.</span><span class="n">charts</span><span class="o">.</span><span class="n">basic_charts</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">Line</span> <span class="n">at</span> <span class="mh">0x201bd51d088</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [7]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 渲染数据</span>
</span></span><span class="line"><span class="cl"><span class="n">line</span><span class="o">.</span><span class="n">render_notebook</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="25pandas结合sklearn实现泰坦尼克存活率预测">25、Pandas结合Sklearn实现泰坦尼克存活率预测</h1>
<h3 id="实例目标实现泰坦尼克存活预测">实例目标：实现泰坦尼克存活预测</h3>
<p>处理步骤：
1、输入数据：使用Pandas读取训练数据(历史数据，特点是已经知道了这个人最后有没有活下来)
2、训练模型：使用Sklearn训练模型
3、使用模型：对于一个新的不知道存活的人，预估他存活的概率</p>
<h3 id="步骤1读取训练数据">步骤1：读取训练数据</h3>
<p>In [1]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [2]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&#34;./datas/titanic/titanic_train.csv&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[2]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">PassengerId</th>
<th style="text-align:right">Survived</th>
<th style="text-align:right">Pclass</th>
<th style="text-align:right">Name</th>
<th style="text-align:right">Sex</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">SibSp</th>
<th style="text-align:right">Parch</th>
<th style="text-align:right">Ticket</th>
<th style="text-align:right">Fare</th>
<th style="text-align:right">Cabin</th>
<th style="text-align:right">Embarked</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Braund, Mr. Owen Harris</td>
<td style="text-align:right">male</td>
<td style="text-align:right">22.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">A/5 21171</td>
<td style="text-align:right">7.2500</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Cumings, Mrs. John Bradley (Florence Briggs Th&hellip;</td>
<td style="text-align:right">female</td>
<td style="text-align:right">38.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">PC 17599</td>
<td style="text-align:right">71.2833</td>
<td style="text-align:right">C85</td>
<td style="text-align:right">C</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Heikkinen, Miss. Laina</td>
<td style="text-align:right">female</td>
<td style="text-align:right">26.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">STON/O2. 3101282</td>
<td style="text-align:right">7.9250</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Futrelle, Mrs. Jacques Heath (Lily May Peel)</td>
<td style="text-align:right">female</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">113803</td>
<td style="text-align:right">53.1000</td>
<td style="text-align:right">C123</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Allen, Mr. William Henry</td>
<td style="text-align:right">male</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">373450</td>
<td style="text-align:right">8.0500</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">S</td>
</tr>
</tbody>
</table>
<p>*<strong>其中，Survived==1代表这个人活下来了、==0代表没活下来；其他的都是这个人的信息和当时的仓位、票务情况*</strong></p>
<p>In [3]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 我们只挑选两列，作为预测需要的特征</span>
</span></span><span class="line"><span class="cl"><span class="n">feature_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Pclass&#39;</span><span class="p">,</span> <span class="s1">&#39;Parch&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">X</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">feature_cols</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">X</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[3]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">Pclass</th>
<th style="text-align:right">Parch</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">3</td>
<td style="text-align:right">0</td>
</tr>
</tbody>
</table>
<p>In [4]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 单独提取是否存活的列，作为预测的目标</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">Survived</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[4]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mi">0</span>    <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>    <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">Survived</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="步骤2训练模型">步骤2：训练模型</h3>
<p>In [5]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 创建模型对象</span>
</span></span><span class="line"><span class="cl"><span class="n">logreg</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 实现模型训练</span>
</span></span><span class="line"><span class="cl"><span class="n">logreg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">sklearn</span><span class="o">/</span><span class="n">linear_model</span><span class="o">/</span><span class="n">logistic</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">432</span><span class="p">:</span> <span class="ne">FutureWarning</span><span class="p">:</span> <span class="n">Default</span> <span class="n">solver</span> <span class="n">will</span> <span class="n">be</span> <span class="n">changed</span> <span class="n">to</span> <span class="s1">&#39;lbfgs&#39;</span> <span class="ow">in</span> <span class="mf">0.22</span><span class="o">.</span> <span class="n">Specify</span> <span class="n">a</span> <span class="n">solver</span> <span class="n">to</span> <span class="n">silence</span> <span class="n">this</span> <span class="n">warning</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">  <span class="ne">FutureWarning</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[5]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">LogisticRegression</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dual</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="n">intercept_scaling</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">l1_ratio</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="n">multi_class</span><span class="o">=</span><span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="n">warm_start</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [6]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">logreg</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[6]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mf">0.6879910213243546</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="步骤3对于未知数据使用模型">步骤3：对于未知数据使用模型</h3>
<p>机器学习的核心目标，是使用模型预测未知的事物</p>
<p>比如预测股票明天是涨还是跌、一套新的二手房成交价大概多少钱、用户打开APP最可能看那些视频等问题</p>
<p>In [7]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 找一个历史数据中不存在的数据</span>
</span></span><span class="line"><span class="cl"><span class="n">X</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;Pclass&#34;</span><span class="p">,</span> <span class="s2">&#34;Parch&#34;</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[7]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">Pclass</th>
<th style="text-align:right">Parch</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">54</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">27</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">438</td>
<td style="text-align:right">1</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td style="text-align:right">9</td>
<td style="text-align:right">2</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">98</td>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">43</td>
<td style="text-align:right">2</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">437</td>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">8</td>
<td style="text-align:right">3</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">86</td>
<td style="text-align:right">3</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">167</td>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td style="text-align:right">13</td>
<td style="text-align:right">3</td>
<td style="text-align:right">5</td>
</tr>
<tr>
<td style="text-align:right">678</td>
<td style="text-align:right">3</td>
<td style="text-align:right">6</td>
</tr>
</tbody>
</table>
<p>In [8]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 预测这个数据存活的概率</span>
</span></span><span class="line"><span class="cl"><span class="n">logreg</span><span class="o">.</span><span class="n">predict</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[8]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [9]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">logreg</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[9]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">array</span><span class="p">([[</span><span class="mf">0.35053893</span><span class="p">,</span> <span class="mf">0.64946107</span><span class="p">]])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="26pandas处理分析网站原始访问日志">26、Pandas处理分析网站原始访问日志</h1>
<p>目标：真实项目的实战，探索Pandas的数据处理与分析</p>
<p>实例：
数据来源：某大佬的wordpress博客http://www.crazyant.net/ 的访问日志</p>
<p>实现步骤：
1、读取数据、清理、格式化
2、统计爬虫spider的访问比例，输出柱状图
3、统计http状态码的访问占比，输出饼图
4、统计按小时、按天的PV/UV流量趋势，输出折线图</p>
<h3 id="1读取数据并清理格式化">1、读取数据并清理格式化</h3>
<p>In [1]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyecharts</span> <span class="kn">import</span> <span class="n">options</span> <span class="k">as</span> <span class="n">opts</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyecharts.charts</span> <span class="kn">import</span> <span class="n">Bar</span><span class="p">,</span><span class="n">Pie</span><span class="p">,</span><span class="n">Line</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [2]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 读取整个目录，将所有的文件合并到一个dataframe</span>
</span></span><span class="line"><span class="cl"><span class="n">data_dir</span> <span class="o">=</span> <span class="s2">&#34;./datas/crazyant/blog_access_log&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df_list</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">data_dir</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">data_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">error_bad_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="sa">b</span><span class="s1">&#39;Skipping line 2245: expected 10 fields, saw 16</span><span class="se">\n</span><span class="s1">Skipping line 2889: expected 10 fields, saw 14</span><span class="se">\n</span><span class="s1">Skipping line 2890: expected 10 fields, saw 14</span><span class="se">\n</span><span class="s1">Skipping line 2891: expected 10 fields, saw 13</span><span class="se">\n</span><span class="s1">Skipping line 2892: expected 10 fields, saw 13</span><span class="se">\n</span><span class="s1">Skipping line 2900: expected 10 fields, saw 11</span><span class="se">\n</span><span class="s1">Skipping line 2902: expected 10 fields, saw 11</span><span class="se">\n</span><span class="s1">Skipping line 3790: expected 10 fields, saw 14</span><span class="se">\n</span><span class="s1">Skipping line 3791: expected 10 fields, saw 14</span><span class="se">\n</span><span class="s1">Skipping line 3792: expected 10 fields, saw 13</span><span class="se">\n</span><span class="s1">Skipping line 3793: expected 10 fields, saw 13</span><span class="se">\n</span><span class="s1">Skipping line 3833: expected 10 fields, saw 11</span><span class="se">\n</span><span class="s1">Skipping line 3835: expected 10 fields, saw 11</span><span class="se">\n</span><span class="s1">Skipping line 9936: expected 10 fields, saw 16</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="sa">b</span><span class="s1">&#39;Skipping line 11748: expected 10 fields, saw 11</span><span class="se">\n</span><span class="s1">Skipping line 11750: expected 10 fields, saw 11</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [3]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[3]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">0</th>
<th style="text-align:right">1</th>
<th style="text-align:right">2</th>
<th style="text-align:right">3</th>
<th style="text-align:right">4</th>
<th style="text-align:right">5</th>
<th style="text-align:right">6</th>
<th style="text-align:right">7</th>
<th style="text-align:right">8</th>
<th style="text-align:right">9</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">106.11.153.226</td>
<td style="text-align:right">-</td>
<td style="text-align:right">-</td>
<td style="text-align:right">[02/Dec/2019:22:40:18</td>
<td style="text-align:right">+0800]</td>
<td style="text-align:right">GET /740.html?replytocom=1194 HTTP/1.0</td>
<td style="text-align:right">200</td>
<td style="text-align:right">13446</td>
<td style="text-align:right">-</td>
<td style="text-align:right">YisouSpider</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">42.156.254.60</td>
<td style="text-align:right">-</td>
<td style="text-align:right">-</td>
<td style="text-align:right">[02/Dec/2019:22:40:23</td>
<td style="text-align:right">+0800]</td>
<td style="text-align:right">POST /wp-json/wordpress-popular-posts/v1/popular-posts HTTP/1.0</td>
<td style="text-align:right">201</td>
<td style="text-align:right">55</td>
<td style="text-align:right"><a href="http://www.crazyant.net/740.html?replytocom=1194">http://www.crazyant.net/740.html?replytocom=1194</a></td>
<td style="text-align:right">Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.81 YisouSpider/5.0 Safari/537.36</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">106.11.159.254</td>
<td style="text-align:right">-</td>
<td style="text-align:right">-</td>
<td style="text-align:right">[02/Dec/2019:22:40:27</td>
<td style="text-align:right">+0800]</td>
<td style="text-align:right">GET /576.html HTTP/1.0</td>
<td style="text-align:right">200</td>
<td style="text-align:right">13461</td>
<td style="text-align:right">-</td>
<td style="text-align:right">YisouSpider</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">106.11.157.254</td>
<td style="text-align:right">-</td>
<td style="text-align:right">-</td>
<td style="text-align:right">[02/Dec/2019:22:40:28</td>
<td style="text-align:right">+0800]</td>
<td style="text-align:right">GET /?lwfcdw=t9n2d3&amp;oqzohc=m5e7j1&amp;oubyvq=iab6a3&amp;oudmbg=6osqd3 HTTP/1.0</td>
<td style="text-align:right">200</td>
<td style="text-align:right">10485</td>
<td style="text-align:right">-</td>
<td style="text-align:right">YisouSpider</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">42.156.137.109</td>
<td style="text-align:right">-</td>
<td style="text-align:right">-</td>
<td style="text-align:right">[02/Dec/2019:22:40:30</td>
<td style="text-align:right">+0800]</td>
<td style="text-align:right">POST /wp-json/wordpress-popular-posts/v1/popular-posts HTTP/1.0</td>
<td style="text-align:right">201</td>
<td style="text-align:right">55</td>
<td style="text-align:right"><a href="http://www.crazyant.net/576.html">http://www.crazyant.net/576.html</a></td>
<td style="text-align:right">Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.81 YisouSpider/5.0 Safari/537.36</td>
</tr>
</tbody>
</table>
<p>In [4]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[4]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">0</th>
<th style="text-align:right">3</th>
<th style="text-align:right">6</th>
<th style="text-align:right">9</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">106.11.153.226</td>
<td style="text-align:right">[02/Dec/2019:22:40:18</td>
<td style="text-align:right">200</td>
<td style="text-align:right">YisouSpider</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">42.156.254.60</td>
<td style="text-align:right">[02/Dec/2019:22:40:23</td>
<td style="text-align:right">201</td>
<td style="text-align:right">Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.81 YisouSpider/5.0 Safari/537.36</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">106.11.159.254</td>
<td style="text-align:right">[02/Dec/2019:22:40:27</td>
<td style="text-align:right">200</td>
<td style="text-align:right">YisouSpider</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">106.11.157.254</td>
<td style="text-align:right">[02/Dec/2019:22:40:28</td>
<td style="text-align:right">200</td>
<td style="text-align:right">YisouSpider</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">42.156.137.109</td>
<td style="text-align:right">[02/Dec/2019:22:40:30</td>
<td style="text-align:right">201</td>
<td style="text-align:right">Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.81 YisouSpider/5.0 Safari/537.36</td>
</tr>
</tbody>
</table>
<p>In [5]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;ip&#34;</span><span class="p">,</span> <span class="s2">&#34;stime&#34;</span><span class="p">,</span> <span class="s2">&#34;status&#34;</span><span class="p">,</span> <span class="s2">&#34;client&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[5]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ip</th>
<th style="text-align:right">stime</th>
<th style="text-align:right">status</th>
<th style="text-align:right">client</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">106.11.153.226</td>
<td style="text-align:right">[02/Dec/2019:22:40:18</td>
<td style="text-align:right">200</td>
<td style="text-align:right">YisouSpider</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">42.156.254.60</td>
<td style="text-align:right">[02/Dec/2019:22:40:23</td>
<td style="text-align:right">201</td>
<td style="text-align:right">Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.81 YisouSpider/5.0 Safari/537.36</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">106.11.159.254</td>
<td style="text-align:right">[02/Dec/2019:22:40:27</td>
<td style="text-align:right">200</td>
<td style="text-align:right">YisouSpider</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">106.11.157.254</td>
<td style="text-align:right">[02/Dec/2019:22:40:28</td>
<td style="text-align:right">200</td>
<td style="text-align:right">YisouSpider</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">42.156.137.109</td>
<td style="text-align:right">[02/Dec/2019:22:40:30</td>
<td style="text-align:right">201</td>
<td style="text-align:right">Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.81 YisouSpider/5.0 Safari/537.36</td>
</tr>
</tbody>
</table>
<p>In [6]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[6]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ip</span>        <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">stime</span>     <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">status</span>    <span class="n">int64</span> 
</span></span><span class="line"><span class="cl"><span class="n">client</span>    <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2统计spider的比例">2、统计spider的比例</h3>
<p>In [7]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;is_spider&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;client&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&#34;spider&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[7]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ip</th>
<th style="text-align:right">stime</th>
<th style="text-align:right">status</th>
<th style="text-align:right">client</th>
<th style="text-align:right">is_spider</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">106.11.153.226</td>
<td style="text-align:right">[02/Dec/2019:22:40:18</td>
<td style="text-align:right">200</td>
<td style="text-align:right">YisouSpider</td>
<td style="text-align:right">True</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">42.156.254.60</td>
<td style="text-align:right">[02/Dec/2019:22:40:23</td>
<td style="text-align:right">201</td>
<td style="text-align:right">Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.81 YisouSpider/5.0 Safari/537.36</td>
<td style="text-align:right">True</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">106.11.159.254</td>
<td style="text-align:right">[02/Dec/2019:22:40:27</td>
<td style="text-align:right">200</td>
<td style="text-align:right">YisouSpider</td>
<td style="text-align:right">True</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">106.11.157.254</td>
<td style="text-align:right">[02/Dec/2019:22:40:28</td>
<td style="text-align:right">200</td>
<td style="text-align:right">YisouSpider</td>
<td style="text-align:right">True</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">42.156.137.109</td>
<td style="text-align:right">[02/Dec/2019:22:40:30</td>
<td style="text-align:right">201</td>
<td style="text-align:right">Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.81 YisouSpider/5.0 Safari/537.36</td>
<td style="text-align:right">True</td>
</tr>
</tbody>
</table>
<p>In [8]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_spider</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;is_spider&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">df_spider</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[8]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kc">False</span>    <span class="mi">46641</span>
</span></span><span class="line"><span class="cl"><span class="kc">True</span>     <span class="mi">3637</span> 
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">is_spider</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [9]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">bar</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">Bar</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">add_xaxis</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_spider</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&#34;是否Spider&#34;</span><span class="p">,</span> <span class="n">df_spider</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">set_global_opts</span><span class="p">(</span><span class="n">title_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TitleOpts</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&#34;爬虫访问量占比&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">bar</span><span class="o">.</span><span class="n">render_notebook</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="27pandas怎样找出最影响结果的那些特征">27、Pandas怎样找出最影响结果的那些特征？</h1>
<p>应用场景：</p>
<ul>
<li>机器学习的特征选择，去除无用的特征，可以提升模型效果、降低训练时间等等</li>
<li>数据分析领域，找出收入波动的最大因素！！</li>
</ul>
<h2 id="实例演示泰坦尼克沉船事件中最影响生死的因素有哪些">实例演示：泰坦尼克沉船事件中，最影响生死的因素有哪些？</h2>
<h3 id="1导入相关的包">1、导入相关的包</h3>
<p>In [1]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 特征最影响结果的K个特征</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">SelectKBest</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 卡方检验，作为SelectKBest的参数</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">chi2</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2导入泰坦尼克号的数据">2、导入泰坦尼克号的数据</h3>
<p>In [2]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&#34;./datas/titanic/titanic_train.csv&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[2]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">PassengerId</th>
<th style="text-align:right">Survived</th>
<th style="text-align:right">Pclass</th>
<th style="text-align:right">Name</th>
<th style="text-align:right">Sex</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">SibSp</th>
<th style="text-align:right">Parch</th>
<th style="text-align:right">Ticket</th>
<th style="text-align:right">Fare</th>
<th style="text-align:right">Cabin</th>
<th style="text-align:right">Embarked</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Braund, Mr. Owen Harris</td>
<td style="text-align:right">male</td>
<td style="text-align:right">22.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">A/5 21171</td>
<td style="text-align:right">7.2500</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Cumings, Mrs. John Bradley (Florence Briggs Th&hellip;</td>
<td style="text-align:right">female</td>
<td style="text-align:right">38.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">PC 17599</td>
<td style="text-align:right">71.2833</td>
<td style="text-align:right">C85</td>
<td style="text-align:right">C</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Heikkinen, Miss. Laina</td>
<td style="text-align:right">female</td>
<td style="text-align:right">26.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">STON/O2. 3101282</td>
<td style="text-align:right">7.9250</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Futrelle, Mrs. Jacques Heath (Lily May Peel)</td>
<td style="text-align:right">female</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">113803</td>
<td style="text-align:right">53.1000</td>
<td style="text-align:right">C123</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Allen, Mr. William Henry</td>
<td style="text-align:right">male</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">373450</td>
<td style="text-align:right">8.0500</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">S</td>
</tr>
</tbody>
</table>
<p>In [3]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&#34;PassengerId&#34;</span><span class="p">,</span> <span class="s2">&#34;Survived&#34;</span><span class="p">,</span> <span class="s2">&#34;Pclass&#34;</span><span class="p">,</span> <span class="s2">&#34;Sex&#34;</span><span class="p">,</span> <span class="s2">&#34;Age&#34;</span><span class="p">,</span> <span class="s2">&#34;SibSp&#34;</span><span class="p">,</span> <span class="s2">&#34;Parch&#34;</span><span class="p">,</span> <span class="s2">&#34;Fare&#34;</span><span class="p">,</span> <span class="s2">&#34;Embarked&#34;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[3]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">PassengerId</th>
<th style="text-align:right">Survived</th>
<th style="text-align:right">Pclass</th>
<th style="text-align:right">Sex</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">SibSp</th>
<th style="text-align:right">Parch</th>
<th style="text-align:right">Fare</th>
<th style="text-align:right">Embarked</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">male</td>
<td style="text-align:right">22.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">7.2500</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">female</td>
<td style="text-align:right">38.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">71.2833</td>
<td style="text-align:right">C</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3</td>
<td style="text-align:right">female</td>
<td style="text-align:right">26.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">7.9250</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">female</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">53.1000</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">male</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">8.0500</td>
<td style="text-align:right">S</td>
</tr>
</tbody>
</table>
<h3 id="3数据清理和转换">3、数据清理和转换</h3>
<h4 id="31-查看是否有空值列">3.1 查看是否有空值列</h4>
<p>In [4]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="s1">&#39;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">RangeIndex</span><span class="p">:</span> <span class="mi">891</span> <span class="n">entries</span><span class="p">,</span> <span class="mi">0</span> <span class="n">to</span> <span class="mi">890</span>
</span></span><span class="line"><span class="cl"><span class="n">Data</span> <span class="n">columns</span> <span class="p">(</span><span class="n">total</span> <span class="mi">9</span> <span class="n">columns</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="n">PassengerId</span>    <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Survived</span>       <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Pclass</span>         <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Sex</span>            <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">Age</span>            <span class="mi">714</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl"><span class="n">SibSp</span>          <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Parch</span>          <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Fare</span>           <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl"><span class="n">Embarked</span>       <span class="mi">889</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">dtypes</span><span class="p">:</span> <span class="n">float64</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">int64</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="nb">object</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">memory</span> <span class="n">usage</span><span class="p">:</span> <span class="mf">62.8</span><span class="o">+</span> <span class="n">KB</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="32-给age列填充平均值">3.2 给Age列填充平均值</h4>
<p>In [5]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Age&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;Age&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Age&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [6]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[6]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">PassengerId</th>
<th style="text-align:right">Survived</th>
<th style="text-align:right">Pclass</th>
<th style="text-align:right">Sex</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">SibSp</th>
<th style="text-align:right">Parch</th>
<th style="text-align:right">Fare</th>
<th style="text-align:right">Embarked</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">male</td>
<td style="text-align:right">22.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">7.2500</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">female</td>
<td style="text-align:right">38.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">71.2833</td>
<td style="text-align:right">C</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3</td>
<td style="text-align:right">female</td>
<td style="text-align:right">26.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">7.9250</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">female</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">53.1000</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">male</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">8.0500</td>
<td style="text-align:right">S</td>
</tr>
</tbody>
</table>
<h4 id="32-将性别列变成数字">3.2 将性别列变成数字</h4>
<p>In [7]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 性别</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">Sex</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[7]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">array</span><span class="p">([</span><span class="s1">&#39;male&#39;</span><span class="p">,</span> <span class="s1">&#39;female&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [8]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Sex&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;male&#34;</span><span class="p">,</span> <span class="s2">&#34;Sex&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Sex&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;female&#34;</span><span class="p">,</span> <span class="s2">&#34;Sex&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [9]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[9]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">PassengerId</th>
<th style="text-align:right">Survived</th>
<th style="text-align:right">Pclass</th>
<th style="text-align:right">Sex</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">SibSp</th>
<th style="text-align:right">Parch</th>
<th style="text-align:right">Fare</th>
<th style="text-align:right">Embarked</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">0</td>
<td style="text-align:right">22.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">7.2500</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">38.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">71.2833</td>
<td style="text-align:right">C</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">26.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">7.9250</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">53.1000</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">0</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">8.0500</td>
<td style="text-align:right">S</td>
</tr>
</tbody>
</table>
<h4 id="33-给embarked列填充空值字符串转换成数字">3.3 给Embarked列填充空值，字符串转换成数字</h4>
<p>In [10]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Embarked</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">Embarked</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[10]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">array</span><span class="p">([</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="n">nan</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [11]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 填充空值</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Embarked&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;Embarked&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 字符串变成数字</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Embarked&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;S&#34;</span><span class="p">,</span> <span class="s2">&#34;Embarked&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Embarked&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;C&#34;</span><span class="p">,</span> <span class="s2">&#34;Embarked&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Embarked&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;Q&#34;</span><span class="p">,</span> <span class="s2">&#34;Embarked&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [12]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[12]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">PassengerId</th>
<th style="text-align:right">Survived</th>
<th style="text-align:right">Pclass</th>
<th style="text-align:right">Sex</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">SibSp</th>
<th style="text-align:right">Parch</th>
<th style="text-align:right">Fare</th>
<th style="text-align:right">Embarked</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">0</td>
<td style="text-align:right">22.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">7.2500</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">38.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">71.2833</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">26.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">7.9250</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">53.1000</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">0</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">8.0500</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<h3 id="4将特征列和结果列拆分开">4、将特征列和结果列拆分开</h3>
<p>In [13]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&#34;Survived&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">X</span> <span class="o">=</span> <span class="n">df</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [14]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">X</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[14]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">PassengerId</th>
<th style="text-align:right">Pclass</th>
<th style="text-align:right">Sex</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">SibSp</th>
<th style="text-align:right">Parch</th>
<th style="text-align:right">Fare</th>
<th style="text-align:right">Embarked</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3</td>
<td style="text-align:right">0</td>
<td style="text-align:right">22.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">7.2500</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">38.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">71.2833</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">26.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">7.9250</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">53.1000</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">3</td>
<td style="text-align:right">0</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">8.0500</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<p>In [15]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">y</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[15]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mi">0</span>    <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>    <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">Survived</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="5使用卡方检验选择topk的特征">5、使用卡方检验选择topK的特征</h3>
<p>In [16]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 选择所有的特征，目的是看到特征重要性排序</span>
</span></span><span class="line"><span class="cl"><span class="n">bestfeatures</span> <span class="o">=</span> <span class="n">SelectKBest</span><span class="p">(</span><span class="n">score_func</span><span class="o">=</span><span class="n">chi2</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">fit</span> <span class="o">=</span> <span class="n">bestfeatures</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="6按照重要性顺序打印特征列表">6、按照重要性顺序打印特征列表</h3>
<p>In [17]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">scores_</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_scores</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[17]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">3.312934</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">30.873699</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">170.348127</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">21.649163</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">2.581865</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">10.097499</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">4518.319091</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">2.771019</td>
</tr>
</tbody>
</table>
<p>In [18]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_columns</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[18]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">PassengerId</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">Pclass</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">Sex</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">Age</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">SibSp</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">Parch</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">Fare</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">Embarked</td>
</tr>
</tbody>
</table>
<p>In [19]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 合并两个df</span>
</span></span><span class="line"><span class="cl"><span class="n">df_feature_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_columns</span><span class="p">,</span><span class="n">df_scores</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 列名</span>
</span></span><span class="line"><span class="cl"><span class="n">df_feature_scores</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;feature_name&#39;</span><span class="p">,</span><span class="s1">&#39;Score&#39;</span><span class="p">]</span>  <span class="c1">#naming the dataframe columns</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看</span>
</span></span><span class="line"><span class="cl"><span class="n">df_feature_scores</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[19]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">feature_name</th>
<th style="text-align:right">Score</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">PassengerId</td>
<td style="text-align:right">3.312934</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">Pclass</td>
<td style="text-align:right">30.873699</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">Sex</td>
<td style="text-align:right">170.348127</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">Age</td>
<td style="text-align:right">21.649163</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">SibSp</td>
<td style="text-align:right">2.581865</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">Parch</td>
<td style="text-align:right">10.097499</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">Fare</td>
<td style="text-align:right">4518.319091</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">Embarked</td>
<td style="text-align:right">2.771019</td>
</tr>
</tbody>
</table>
<p>In [20]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_feature_scores</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&#34;Score&#34;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[20]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">feature_name</th>
<th style="text-align:right">Score</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">Fare</td>
<td style="text-align:right">4518.319091</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">Sex</td>
<td style="text-align:right">170.348127</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">Pclass</td>
<td style="text-align:right">30.873699</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">Age</td>
<td style="text-align:right">21.649163</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">Parch</td>
<td style="text-align:right">10.097499</td>
</tr>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">PassengerId</td>
<td style="text-align:right">3.312934</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">Embarked</td>
<td style="text-align:right">2.771019</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">SibSp</td>
<td style="text-align:right">2.581865</td>
</tr>
</tbody>
</table>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">yuanshuai</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        0001-01-01
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/yuanshuai1122.github.io/tags/python/">Python</a>
          <a href="/yuanshuai1122.github.io/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/">数据分析</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="yuanshuai1122.github.io/post/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%8C-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%8C/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Python数据分析之Pandas（二）</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="yuanshuai1122.github.io/post/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E5%9B%9B-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E5%9B%9B/">
            <span class="next-text nav-default">Python数据分析之Pandas（四）</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:your@email.com" class="iconfont icon-email" title="email"></a>
      <a href="http://localhost:1313" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="http://localhost:1313" class="iconfont icon-twitter" title="twitter"></a>
      <a href="http://localhost:1313" class="iconfont icon-facebook" title="facebook"></a>
      <a href="http://localhost:1313" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="http://localhost:1313" class="iconfont icon-google" title="google"></a>
      <a href="http://localhost:1313" class="iconfont icon-github" title="github"></a>
      <a href="http://localhost:1313" class="iconfont icon-weibo" title="weibo"></a>
      <a href="http://localhost:1313" class="iconfont icon-zhihu" title="zhihu"></a>
      <a href="http://localhost:1313" class="iconfont icon-douban" title="douban"></a>
      <a href="http://localhost:1313" class="iconfont icon-pocket" title="pocket"></a>
      <a href="http://localhost:1313" class="iconfont icon-tumblr" title="tumblr"></a>
      <a href="http://localhost:1313" class="iconfont icon-instagram" title="instagram"></a>
      <a href="http://localhost:1313" class="iconfont icon-gitlab" title="gitlab"></a>
      <a href="http://localhost:1313" class="iconfont icon-bilibili" title="bilibili"></a>
  <a href="yuanshuai1122.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2017 - 
    2023<span class="heart"><i class="iconfont icon-heart"></i></span><span>yuanshuai</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.min.js" integrity="sha256-jwCP0NAdCBloaIWTWHmW4i3snUNMHUNO+jr9rYd2iOI=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.locales.min.js" integrity="sha256-ZwofwC1Lf/faQCzN7nZtfijVV6hSwxjQMwXL4gn9qU8=" crossorigin="anonymous"></script>
  <script>
    var languageCode = "zh-cn".replace(/-/g, '_').replace(/_(.*)/, function ($0, $1) {return $0.replace($1, $1.toUpperCase());});
    timeago().render(document.querySelectorAll('.timeago'), languageCode);
    timeago.cancel();  
  </script>



<script type="text/javascript" src="/yuanshuai1122.github.io/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
