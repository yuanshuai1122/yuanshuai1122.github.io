<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Python数据分析之Pandas（五） - 🧀 - 你好</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="yuanshuai" /><meta name="description" content=": | &amp;mdash;: | &amp;mdash;: | &amp;mdash;: | &amp;mdash;: | &amp;mdash;: | | 0 | S001 | 怠涵 | 女 | 23 | 山东 | | 1 | S002 | 婉清 | 女 | 25 | 河南 | | 2 | S003 | 溪榕 | 女 | 23 | 湖北 | | 3 | S004 | 漠涓 | 女 | 19 | 陕" /><meta name="keywords" content="blog, yuanshuai, yyss" />






<meta name="generator" content="Hugo 0.119.0 with theme even" />


<link rel="canonical" href="yuanshuai1122.github.io/post/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%94-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%94/" />
<link rel="apple-touch-icon" sizes="180x180" href="/yuanshuai1122.github.io/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/yuanshuai1122.github.io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/yuanshuai1122.github.io/favicon-16x16.png">
<link rel="manifest" href="/yuanshuai1122.github.io/manifest.json">
<link rel="mask-icon" href="/yuanshuai1122.github.io/safari-pinned-tab.svg" color="#5bbad5">



<link href="/yuanshuai1122.github.io/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Python数据分析之Pandas（五）" />
<meta property="og:description" content=": | &mdash;: | &mdash;: | &mdash;: | &mdash;: | &mdash;: | | 0 | S001 | 怠涵 | 女 | 23 | 山东 | | 1 | S002 | 婉清 | 女 | 25 | 河南 | | 2 | S003 | 溪榕 | 女 | 23 | 湖北 | | 3 | S004 | 漠涓 | 女 | 19 | 陕" />
<meta property="og:type" content="article" />
<meta property="og:url" content="yuanshuai1122.github.io/post/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%94-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%94/" /><meta property="article:section" content="post" />


<meta itemprop="name" content="Python数据分析之Pandas（五）">
<meta itemprop="description" content=": | &mdash;: | &mdash;: | &mdash;: | &mdash;: | &mdash;: | | 0 | S001 | 怠涵 | 女 | 23 | 山东 | | 1 | S002 | 婉清 | 女 | 25 | 河南 | | 2 | S003 | 溪榕 | 女 | 23 | 湖北 | | 3 | S004 | 漠涓 | 女 | 19 | 陕">

<meta itemprop="wordCount" content="14063">
<meta itemprop="keywords" content="Python,数据分析," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Python数据分析之Pandas（五）"/>
<meta name="twitter:description" content=": | &mdash;: | &mdash;: | &mdash;: | &mdash;: | &mdash;: | | 0 | S001 | 怠涵 | 女 | 23 | 山东 | | 1 | S002 | 婉清 | 女 | 25 | 河南 | | 2 | S003 | 溪榕 | 女 | 23 | 湖北 | | 3 | S004 | 漠涓 | 女 | 19 | 陕"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">CNshuaiyuan</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="yuanshuai1122.github.io/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="yuanshuai1122.github.io/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="yuanshuai1122.github.io/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="yuanshuai1122.github.io/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">CNshuaiyuan</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="yuanshuai1122.github.io/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="yuanshuai1122.github.io/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="yuanshuai1122.github.io/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="yuanshuai1122.github.io/categories/">Categories</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Python数据分析之Pandas（五）</h1>

      <div class="post-meta">
        <span class="post-time"> 0001-01-01 </span>
        
          <span class="more-meta"> 约 14063 字 </span>
          <span class="more-meta"> 预计阅读 29 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li>
          <ul>
            <li><a href="#创建sqlalchemy对象连接mysql">创建sqlalchemy对象连接MySQL</a></li>
            <li><a href="#方法1当数据表不存在时每次覆盖整个表">方法1：当数据表不存在时，每次覆盖整个表</a></li>
            <li><a href="#方法2当数据表存在时每次新增数据">方法2：当数据表存在时，每次新增数据</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#38python批量翻译英语单词">38、Python批量翻译英语单词</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-读取英语-汉语翻译词典文件">1. 读取英语-汉语翻译词典文件</a></li>
            <li><a href="#2-下载网页得到网页内容">2. 下载网页，得到网页内容</a></li>
            <li><a href="#3-提取html的正文内容">3. 提取HTML的正文内容</a></li>
            <li><a href="#4-英文分词和数据清洗">4. 英文分词和数据清洗</a></li>
            <li><a href="#5-分词结果构造成一个dataframe">5. 分词结果构造成一个DataFrame</a></li>
            <li><a href="#6-和单词词典实现merge">6. 和单词词典实现merge</a></li>
            <li><a href="#7-存入excel">7. 存入Excel</a></li>
            <li><a href="#后续升级">后续升级：</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#39python自动翻译英语论文pdf">39、Python自动翻译英语论文PDF</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-读取pdf文本内容">1. 读取PDF文本内容</a></li>
            <li><a href="#2-读取英语-汉语翻译词典文件">2. 读取英语-汉语翻译词典文件</a></li>
            <li><a href="#3-英文分词和数据清洗">3. 英文分词和数据清洗</a></li>
            <li><a href="#4-分词结果构造成一个dataframe">4. 分词结果构造成一个DataFrame</a></li>
            <li><a href="#5-和单词词典实现merge">5. 和单词词典实现merge</a></li>
            <li><a href="#6-存入excel">6. 存入Excel</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#40pandas怎样实现groupby聚合后字符串列的合并">40、Pandas怎样实现groupby聚合后字符串列的合并</a>
      <ul>
        <li>
          <ul>
            <li></li>
            <li><a href="#读取数据">读取数据</a></li>
            <li><a href="#方法1">方法1</a></li>
            <li><a href="#方法2">方法2</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#41pandas读取excel绘制直方图">41、Pandas读取Excel绘制直方图</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-读取数据">1. 读取数据</a></li>
            <li><a href="#2-使用matplotlib画直方图">2. 使用matplotlib画直方图</a></li>
            <li><a href="#3-使用pyecharts画直方图">3. 使用pyecharts画直方图</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#42python处理excel一列变多列">42、Python处理Excel一列变多列</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-读取数据-1">1. 读取数据</a></li>
            <li><a href="#2-实现拆分">2. 实现拆分</a></li>
            <li><a href="#3-输出到结果excel">3. 输出到结果Excel</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#43pandas查询数据的简便方法dfquery">43、Pandas查询数据的简便方法df.query</a>
      <ul>
        <li>
          <ul>
            <li><a href="#0读取数据">0、读取数据</a></li>
            <li><a href="#1使用dataframe条件表达式查询">1、使用dataframe条件表达式查询</a></li>
            <li><a href="#2使用dfquery可以简化查询">2、使用df.query可以简化查询</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#44pandas按行遍历dataframe的3种方法">44、Pandas按行遍历DataFrame的3种方法</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-dfiterrows">1. df.iterrows()</a></li>
            <li><a href="#2-dfitertuples">2. df.itertuples()</a></li>
            <li><a href="#3-forzip">3. for+zip</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#45pandas实现模糊匹配merge数据的方法">45、Pandas实现模糊匹配Merge数据的方法</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-两份数据">1. 两份数据</a></li>
            <li><a href="#方法1暴力笛卡尔积--过滤">方法1：暴力笛卡尔积 + 过滤</a></li>
            <li><a href="#方法2小表变字典做merge最后explode">方法2：小表变字典做merge最后explode</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
  <div class="post-outdated">
    <div class="warn">
      <p>【注意】最后更新于 <span class="timeago" datetime="0001-01-01T00:00:00" title="January 1, 0001">January 1, 0001</span>，文中内容可能已过时，请谨慎使用。</p>
    </div>
  </div>
    <div class="post-content">
      <p>: | &mdash;: | &mdash;: | &mdash;: | &mdash;: | &mdash;: |
|    0 | S001 | 怠涵 |   女 |   23 | 山东 |
|    1 | S002 | 婉清 |   女 |   25 | 河南 |
|    2 | S003 | 溪榕 |   女 |   23 | 湖北 |
|    3 | S004 | 漠涓 |   女 |   19 | 陕西 |
|    4 | S005 | 祈博 |   女 |   24 | 山东 |</p>
<p>In [3]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 展示索引的name</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [4]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;id&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[4]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">学号</th>
<th style="text-align:right">姓名</th>
<th style="text-align:right">性别</th>
<th style="text-align:right">年龄</th>
<th style="text-align:right">籍贯</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">id</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">S001</td>
<td style="text-align:right">怠涵</td>
<td style="text-align:right">女</td>
<td style="text-align:right">23</td>
<td style="text-align:right">山东</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">S002</td>
<td style="text-align:right">婉清</td>
<td style="text-align:right">女</td>
<td style="text-align:right">25</td>
<td style="text-align:right">河南</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">S003</td>
<td style="text-align:right">溪榕</td>
<td style="text-align:right">女</td>
<td style="text-align:right">23</td>
<td style="text-align:right">湖北</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">S004</td>
<td style="text-align:right">漠涓</td>
<td style="text-align:right">女</td>
<td style="text-align:right">19</td>
<td style="text-align:right">陕西</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">S005</td>
<td style="text-align:right">祈博</td>
<td style="text-align:right">女</td>
<td style="text-align:right">24</td>
<td style="text-align:right">山东</td>
</tr>
</tbody>
</table>
<h3 id="创建sqlalchemy对象连接mysql">创建sqlalchemy对象连接MySQL</h3>
<p>SQLAlchemy是Python中的ORM框架， Object-Relational Mapping，把关系数据库的表结构映射到对象上。</p>
<ul>
<li>官网：https://www.sqlalchemy.org/</li>
<li>如果sqlalchemy包不存在，用这个命令安装：pip install sqlalchemy</li>
<li>需要安装依赖Python库：pip install mysql-connector-python</li>
</ul>
<p>可以直接执行SQL语句</p>
<p>In [5]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [6]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&#34;mysql+mysqlconnector://root:123456@127.0.0.1:3306/test&#34;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="方法1当数据表不存在时每次覆盖整个表">方法1：当数据表不存在时，每次覆盖整个表</h3>
<p>每次运行会drop table，新建表</p>
<p>In [7]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;student&#39;</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">engine</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&#34;replace&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [11]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&#34;show create table student&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[11]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="s1">&#39;CREATE TABLE `student` (</span><span class="se">\n</span><span class="s1">  `id` bigint(20) DEFAULT NULL,</span><span class="se">\n</span><span class="s1">  `学号` text,</span><span class="se">\n</span><span class="s1">  `姓名` text,</span><span class="se">\n</span><span class="s1">  `性别` text,</span><span class="se">\n</span><span class="s1">  `年龄` bigint(20) DEFAULT NULL,</span><span class="se">\n</span><span class="s1">  `籍贯` text,</span><span class="se">\n</span><span class="s1">  KEY `ix_student_id` (`id`)</span><span class="se">\n</span><span class="s1">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [8]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&#34;show create table student&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">CREATE</span> <span class="n">TABLE</span> <span class="err">`</span><span class="n">student</span><span class="err">`</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="err">`</span><span class="nb">id</span><span class="err">`</span> <span class="n">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">DEFAULT</span> <span class="n">NULL</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="err">`</span><span class="n">学号</span><span class="err">`</span> <span class="n">text</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="err">`</span><span class="n">姓名</span><span class="err">`</span> <span class="n">text</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="err">`</span><span class="n">性别</span><span class="err">`</span> <span class="n">text</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="err">`</span><span class="n">年龄</span><span class="err">`</span> <span class="n">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">DEFAULT</span> <span class="n">NULL</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="err">`</span><span class="n">籍贯</span><span class="err">`</span> <span class="n">text</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">KEY</span> <span class="err">`</span><span class="n">ix_student_id</span><span class="err">`</span> <span class="p">(</span><span class="err">`</span><span class="nb">id</span><span class="err">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="n">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8mb4</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [12]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&#34;select count(1) from student&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[12]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">(</span><span class="mi">24</span><span class="p">,)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [13]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&#34;select * from student limit 5&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[13]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;S001&#39;</span><span class="p">,</span> <span class="s1">&#39;怠涵&#39;</span><span class="p">,</span> <span class="s1">&#39;女&#39;</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="s1">&#39;山东&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;S002&#39;</span><span class="p">,</span> <span class="s1">&#39;婉清&#39;</span><span class="p">,</span> <span class="s1">&#39;女&#39;</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="s1">&#39;河南&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;S003&#39;</span><span class="p">,</span> <span class="s1">&#39;溪榕&#39;</span><span class="p">,</span> <span class="s1">&#39;女&#39;</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="s1">&#39;湖北&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;S004&#39;</span><span class="p">,</span> <span class="s1">&#39;漠涓&#39;</span><span class="p">,</span> <span class="s1">&#39;女&#39;</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="s1">&#39;陕西&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;S005&#39;</span><span class="p">,</span> <span class="s1">&#39;祈博&#39;</span><span class="p">,</span> <span class="s1">&#39;女&#39;</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;山东&#39;</span><span class="p">)]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="方法2当数据表存在时每次新增数据">方法2：当数据表存在时，每次新增数据</h3>
<p>场景：每天会新增一部分数据，要添加到数据表，怎么处理？</p>
<p>In [14]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_new</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="mi">4</span><span class="p">,</span> <span class="p">:]</span>
</span></span><span class="line"><span class="cl"><span class="n">df_new</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[14]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">学号</th>
<th style="text-align:right">姓名</th>
<th style="text-align:right">性别</th>
<th style="text-align:right">年龄</th>
<th style="text-align:right">籍贯</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">id</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">S001</td>
<td style="text-align:right">怠涵</td>
<td style="text-align:right">女</td>
<td style="text-align:right">23</td>
<td style="text-align:right">山东</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">S002</td>
<td style="text-align:right">婉清</td>
<td style="text-align:right">女</td>
<td style="text-align:right">25</td>
<td style="text-align:right">河南</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">S003</td>
<td style="text-align:right">溪榕</td>
<td style="text-align:right">女</td>
<td style="text-align:right">23</td>
<td style="text-align:right">湖北</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">S004</td>
<td style="text-align:right">漠涓</td>
<td style="text-align:right">女</td>
<td style="text-align:right">19</td>
<td style="text-align:right">陕西</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">S005</td>
<td style="text-align:right">祈博</td>
<td style="text-align:right">女</td>
<td style="text-align:right">24</td>
<td style="text-align:right">山东</td>
</tr>
</tbody>
</table>
<p>In [15]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_new</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;student&#39;</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">engine</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&#34;append&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [16]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&#34;SELECT * FROM student where id&lt;5 &#34;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[16]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;S001&#39;</span><span class="p">,</span> <span class="s1">&#39;怠涵&#39;</span><span class="p">,</span> <span class="s1">&#39;女&#39;</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="s1">&#39;山东&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;S002&#39;</span><span class="p">,</span> <span class="s1">&#39;婉清&#39;</span><span class="p">,</span> <span class="s1">&#39;女&#39;</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="s1">&#39;河南&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;S003&#39;</span><span class="p">,</span> <span class="s1">&#39;溪榕&#39;</span><span class="p">,</span> <span class="s1">&#39;女&#39;</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="s1">&#39;湖北&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;S004&#39;</span><span class="p">,</span> <span class="s1">&#39;漠涓&#39;</span><span class="p">,</span> <span class="s1">&#39;女&#39;</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="s1">&#39;陕西&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;S005&#39;</span><span class="p">,</span> <span class="s1">&#39;祈博&#39;</span><span class="p">,</span> <span class="s1">&#39;女&#39;</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;山东&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;S001&#39;</span><span class="p">,</span> <span class="s1">&#39;怠涵&#39;</span><span class="p">,</span> <span class="s1">&#39;女&#39;</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="s1">&#39;山东&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;S002&#39;</span><span class="p">,</span> <span class="s1">&#39;婉清&#39;</span><span class="p">,</span> <span class="s1">&#39;女&#39;</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="s1">&#39;河南&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;S003&#39;</span><span class="p">,</span> <span class="s1">&#39;溪榕&#39;</span><span class="p">,</span> <span class="s1">&#39;女&#39;</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="s1">&#39;湖北&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;S004&#39;</span><span class="p">,</span> <span class="s1">&#39;漠涓&#39;</span><span class="p">,</span> <span class="s1">&#39;女&#39;</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="s1">&#39;陕西&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;S005&#39;</span><span class="p">,</span> <span class="s1">&#39;祈博&#39;</span><span class="p">,</span> <span class="s1">&#39;女&#39;</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;山东&#39;</span><span class="p">)]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="问题解决先根据数据key删除旧数据">问题解决：先根据数据KEY删除旧数据</h4>
<p>In [17]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_new</span><span class="o">.</span><span class="n">index</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[17]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">RangeIndex</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [18]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">df_new</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">## 先删除要新增的数据</span>
</span></span><span class="line"><span class="cl">    <span class="n">delete_sql</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;delete from student where id=</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">delete_sql</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">delete_sql</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">delete</span> <span class="kn">from</span> <span class="nn">student</span> <span class="n">where</span> <span class="nb">id</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">delete</span> <span class="kn">from</span> <span class="nn">student</span> <span class="n">where</span> <span class="nb">id</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">delete</span> <span class="kn">from</span> <span class="nn">student</span> <span class="n">where</span> <span class="nb">id</span><span class="o">=</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">delete</span> <span class="kn">from</span> <span class="nn">student</span> <span class="n">where</span> <span class="nb">id</span><span class="o">=</span><span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">delete</span> <span class="kn">from</span> <span class="nn">student</span> <span class="n">where</span> <span class="nb">id</span><span class="o">=</span><span class="mi">4</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [19]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&#34;SELECT * FROM student where id&lt;5 &#34;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[19]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">[]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [20]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&#34;select count(1) from student&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[20]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">(</span><span class="mi">19</span><span class="p">,)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [21]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 新增数据到表中</span>
</span></span><span class="line"><span class="cl"><span class="n">df_new</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;student&#39;</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">engine</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&#34;append&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [22]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&#34;SELECT * FROM student where id&lt;5 &#34;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[22]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;S001&#39;</span><span class="p">,</span> <span class="s1">&#39;怠涵&#39;</span><span class="p">,</span> <span class="s1">&#39;女&#39;</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="s1">&#39;山东&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;S002&#39;</span><span class="p">,</span> <span class="s1">&#39;婉清&#39;</span><span class="p">,</span> <span class="s1">&#39;女&#39;</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="s1">&#39;河南&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;S003&#39;</span><span class="p">,</span> <span class="s1">&#39;溪榕&#39;</span><span class="p">,</span> <span class="s1">&#39;女&#39;</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="s1">&#39;湖北&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;S004&#39;</span><span class="p">,</span> <span class="s1">&#39;漠涓&#39;</span><span class="p">,</span> <span class="s1">&#39;女&#39;</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="s1">&#39;陕西&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;S005&#39;</span><span class="p">,</span> <span class="s1">&#39;祈博&#39;</span><span class="p">,</span> <span class="s1">&#39;女&#39;</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;山东&#39;</span><span class="p">)]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [23]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&#34;SELECT count(1) FROM student&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[23]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">(</span><span class="mi">24</span><span class="p">,)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="38python批量翻译英语单词">38、Python批量翻译英语单词</h1>
<p>*<strong>用途：*</strong>
对批量的英语文本，生成英语-汉语翻译的单词本，提供Excel下载</p>
<p>*<strong>本代码实现：*</strong></p>
<ol>
<li>
<p>提供一个英文文章URL，自动下载网页；</p>
</li>
<li>
<p>实现网页中所有英语单词的翻译；</p>
</li>
<li>
<p>下载翻译结果的Excel</p>
<p>*<strong>涉及技术：*</strong></p>
</li>
<li>
<p>pandas的读取csv、多数据merge、输出Excel</p>
</li>
<li>
<p>requests库下载HTML网页</p>
</li>
<li>
<p>BeautifulSoup解析HTML网页</p>
</li>
<li>
<p>Python正则表达式实现英文分词</p>
</li>
</ol>
<h3 id="1-读取英语-汉语翻译词典文件">1. 读取英语-汉语翻译词典文件</h3>
<p>词典文件来自：https://github.com/skywind3000/ECDICT 使用步骤：</p>
<ol>
<li>下载代码打包：https://github.com/skywind3000/ECDICT/archive/master.zip</li>
<li>解压master.zip，然后解压其中的‪stardict.csv文件</li>
</ol>
<p>In [1]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [2]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 注意：stardict.csv的地址需要替换成你自己的文件地址</span>
</span></span><span class="line"><span class="cl"><span class="n">df_dict</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&#34;D:/tmp/ECDICT-master/stardict.csv&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span><span class="p">:</span>\<span class="n">Anaconda3</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">IPython</span>\<span class="n">core</span>\<span class="n">interactiveshell</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">3063</span><span class="p">:</span> <span class="n">DtypeWarning</span><span class="p">:</span> <span class="n">Columns</span> <span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="n">have</span> <span class="n">mixed</span> <span class="n">types</span><span class="o">.</span><span class="n">Specify</span> <span class="n">dtype</span> <span class="n">option</span> <span class="n">on</span> <span class="kn">import</span> <span class="nn">or</span> <span class="nb">set</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">  <span class="n">interactivity</span><span class="o">=</span><span class="n">interactivity</span><span class="p">,</span> <span class="n">compiler</span><span class="o">=</span><span class="n">compiler</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [3]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_dict</span><span class="o">.</span><span class="n">shape</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[3]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">(</span><span class="mi">3402564</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [4]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_dict</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[4]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">word</th>
<th style="text-align:right">phonetic</th>
<th style="text-align:right">definition</th>
<th style="text-align:right">translation</th>
<th style="text-align:right">pos</th>
<th style="text-align:right">collins</th>
<th style="text-align:right">oxford</th>
<th style="text-align:right">tag</th>
<th style="text-align:right">bnc</th>
<th style="text-align:right">frq</th>
<th style="text-align:right">exchange</th>
<th style="text-align:right">detail</th>
<th style="text-align:right">audio</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">3370509</td>
<td style="text-align:right">WWDH</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">[网络] 淇楄壋</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">518014</td>
<td style="text-align:right">chauhtan (chotan)</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">卓丹</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">389953</td>
<td style="text-align:right">breviarist</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">[网络] 短笛师</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">951231</td>
<td style="text-align:right">electric-vehicle</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">abbr. “EV”的变体；“electric car”的变体\n[网络] 电动汽车</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">91258</td>
<td style="text-align:right">Albionian</td>
<td style="text-align:right">æl&rsquo;biәniәn</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">[地质]阿尔比翁期</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
</tbody>
</table>
<p>In [5]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 把word、translation之外的列扔掉</span>
</span></span><span class="line"><span class="cl"><span class="n">df_dict</span> <span class="o">=</span> <span class="n">df_dict</span><span class="p">[[</span><span class="s2">&#34;word&#34;</span><span class="p">,</span> <span class="s2">&#34;translation&#34;</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl"><span class="n">df_dict</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[5]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">word</th>
<th style="text-align:right">translation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">&lsquo;a</td>
<td style="text-align:right">na. 一\nn. 英文字母表的第一字母；【乐】A音\nart. 冠以不定冠词主要表示类别...</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">&lsquo;A&rsquo; game</td>
<td style="text-align:right">[网络] 游戏；一个游戏；一局</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">&lsquo;Abbāsīyah</td>
<td style="text-align:right">[地名] 阿巴西耶 ( 埃 )</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">&lsquo;Abd al Kūrī</td>
<td style="text-align:right">[地名] 阿卜杜勒库里岛 ( 也门 )</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">&lsquo;Abd al Mājid</td>
<td style="text-align:right">[地名] 阿卜杜勒马吉德 ( 苏丹 )</td>
</tr>
</tbody>
</table>
<h3 id="2-下载网页得到网页内容">2. 下载网页，得到网页内容</h3>
<p>In [6]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [7]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Pandas官方文档中的一个URL</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;https://pandas.pydata.org/docs/user_guide/indexing.html&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [8]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">html_cont</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [9]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">html_cont</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[9]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#39;\n\n&lt;!DOCTYPE html&gt;\n\n&lt;html xmlns=&#34;http://www.w3.org/1999/xhtml&#34;&gt;\n  &lt;head&gt;\n    &lt;meta charset=&#34;utf-8&#34; /&gt;&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-提取html的正文内容">3. 提取HTML的正文内容</h3>
<p>即：去除HTML标签，获取正文</p>
<p>In [10]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
</span></span><span class="line"><span class="cl"><span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html_cont</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">html_text</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [11]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">html_text</span><span class="p">[:</span><span class="mi">500</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[11]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#39;\n\n\nIndexing and selecting data — pandas 1.0.1 documentation\n\n\n\n\n\n\n\n\n\n\n\n\nMathJax.Hub.Config({&#34;tex2jax&#34;: {&#34;inlineMath&#34;: [[&#34;$&#34;, &#34;$&#34;], [&#34;\\\\(&#34;, &#34;\\\\)&#34;]], &#34;processEscapes&#34;: true, &#34;ignoreClass&#34;: &#34;document&#34;, &#34;processClass&#34;: &#34;math|output_area&#34;}})\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nHome\n\n\nWhat\&#39;s New in 1.0.0\n\n\nGetting started\n\n\nUser Guide\n\n\nAPI reference\n\n\nDevelopment\n\n\nRelease Notes\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nIO tools (text, CSV, HDF5, â\x80¦)\n\n\nIndexing and selecting data\n\n\nMultiIndex / advanced indexing\n\n\nMerge, join, a&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4-英文分词和数据清洗">4. 英文分词和数据清洗</h3>
<p>In [12]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 分词</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="n">word_list</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;[ ,.\(\)/</span><span class="se">\n</span><span class="s2">|\-:=\$\[&#34;&#39;]&#34;&#34;&#34;</span><span class="p">,</span><span class="n">html_text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">word_list</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[12]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Indexing&#39;</span><span class="p">,</span> <span class="s1">&#39;and&#39;</span><span class="p">,</span> <span class="s1">&#39;selecting&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;—&#39;</span><span class="p">,</span> <span class="s1">&#39;pandas&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [13]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 读取停用词表，从网上复制的，位于当前目录下</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;./datas/stop_words/stop_words.txt&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">stop_words</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="n">fin</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">list</span><span class="p">(</span><span class="n">stop_words</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[13]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;itself&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;showed&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;throughout&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;pointed&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;n&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;against&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;none&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;ran&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [14]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 数据清洗</span>
</span></span><span class="line"><span class="cl"><span class="n">word_list_clean</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">word_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">word</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 过滤掉空词、数字、单个字符的词、停用词</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">word</span> <span class="ow">or</span> <span class="n">word</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">stop_words</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">continue</span>
</span></span><span class="line"><span class="cl">    <span class="n">word_list_clean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">word_list_clean</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[14]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">[</span><span class="s1">&#39;indexing&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;selecting&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;data&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;pandas&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;documentation&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;mathjax&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;hub&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;config&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;tex2jax&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;inlinemath&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;]]&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;processescapes&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;true&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;ignoreclass&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;document&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;processclass&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;math&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;output_area&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="5-分词结果构造成一个dataframe">5. 分词结果构造成一个DataFrame</h3>
<p>In [15]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_words</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;word&#34;</span><span class="p">:</span> <span class="n">word_list_clean</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">df_words</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[15]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">word</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">indexing</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">selecting</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">data</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">pandas</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">documentation</td>
</tr>
</tbody>
</table>
<p>In [16]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_words</span><span class="o">.</span><span class="n">shape</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[16]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">(</span><span class="mi">4915</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [17]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 统计词频</span>
</span></span><span class="line"><span class="cl"><span class="n">df_words</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_words</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&#34;word&#34;</span><span class="p">)[</span><span class="s2">&#34;word&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="s2">&#34;size&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&#34;count&#34;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_words</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[17]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">word</th>
<th style="text-align:right">count</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">620</td>
<td style="text-align:right">df</td>
<td style="text-align:right">161</td>
</tr>
<tr>
<td style="text-align:right">659</td>
<td style="text-align:right">dtype</td>
<td style="text-align:right">87</td>
</tr>
<tr>
<td style="text-align:right">1274</td>
<td style="text-align:right">true</td>
<td style="text-align:right">86</td>
</tr>
<tr>
<td style="text-align:right">593</td>
<td style="text-align:right">dataframe</td>
<td style="text-align:right">80</td>
</tr>
<tr>
<td style="text-align:right">1038</td>
<td style="text-align:right">pd</td>
<td style="text-align:right">75</td>
</tr>
<tr>
<td style="text-align:right">917</td>
<td style="text-align:right">loc</td>
<td style="text-align:right">72</td>
</tr>
<tr>
<td style="text-align:right">970</td>
<td style="text-align:right">nan</td>
<td style="text-align:right">72</td>
</tr>
<tr>
<td style="text-align:right">721</td>
<td style="text-align:right">false</td>
<td style="text-align:right">58</td>
</tr>
<tr>
<td style="text-align:right">914</td>
<td style="text-align:right">list</td>
<td style="text-align:right">58</td>
</tr>
<tr>
<td style="text-align:right">835</td>
<td style="text-align:right">indexing</td>
<td style="text-align:right">53</td>
</tr>
</tbody>
</table>
<h3 id="6-和单词词典实现merge">6. 和单词词典实现merge</h3>
<p>In [18]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_merge</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">left</span> <span class="o">=</span> <span class="n">df_dict</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">right</span> <span class="o">=</span> <span class="n">df_words</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">left_on</span> <span class="o">=</span> <span class="s2">&#34;word&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">right_on</span> <span class="o">=</span> <span class="s2">&#34;word&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [19]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_merge</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[19]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">word</th>
<th style="text-align:right">translation</th>
<th style="text-align:right">count</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">658</td>
<td style="text-align:right">team</td>
<td style="text-align:right">n. 队, 组\nvt. 把马(牛)套在同一辆车上, 把&hellip;编成一组\nvi. 驾驶卡车, 协作</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">523</td>
<td style="text-align:right">providing</td>
<td style="text-align:right">conj. 以&hellip;为条件, 假如</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">394</td>
<td style="text-align:right">lines</td>
<td style="text-align:right">n. 台词</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">118</td>
<td style="text-align:right">columns</td>
<td style="text-align:right">塔器</td>
<td style="text-align:right">49</td>
</tr>
<tr>
<td style="text-align:right">136</td>
<td style="text-align:right">conforms</td>
<td style="text-align:right">v. 遵守( conform的第三人称单数 ); 顺应; 相一致; 相符合</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">529</td>
<td style="text-align:right">python</td>
<td style="text-align:right">n. 大蟒, 巨蟒\n[计] Python 程序设计语言；人生苦短，我用 Python</td>
<td style="text-align:right">26</td>
</tr>
<tr>
<td style="text-align:right">185</td>
<td style="text-align:right">determine</td>
<td style="text-align:right">v. 决定, 决心</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">285</td>
<td style="text-align:right">forward</td>
<td style="text-align:right">a. 向前的, 早的, 迅速的, 在前的, 进步的\nvt. 促进&hellip;的生长, 转寄, 运&hellip;</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">49</td>
<td style="text-align:right">arguments</td>
<td style="text-align:right">n. 参数</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">564</td>
<td style="text-align:right">reported</td>
<td style="text-align:right">a. 报告的；据报道的</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<p>In [20]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_merge</span><span class="o">.</span><span class="n">shape</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[20]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">(</span><span class="mi">718</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="7-存入excel">7. 存入Excel</h3>
<p>In [21]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_merge</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s2">&#34;./38. batch_chinese_english.xlsx&#34;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="后续升级">后续升级：</h3>
<ol>
<li>可以提供txt/excel/word/pdf的批量输入，生成单词本；</li>
<li>可以做成网页、微信小程序的形式，在线访问和使用</li>
<li>用户可以标记或上传“已经认识的词语”，每次过滤掉</li>
</ol>
<h1 id="39python自动翻译英语论文pdf">39、Python自动翻译英语论文PDF</h1>
<p>*<strong>涉及技术：*</strong></p>
<ol>
<li>Python读取PDF文本</li>
<li>pandas的读取csv、多数据merge、输出Excel</li>
<li>Python正则表达式实现英文分词</li>
</ol>
<h3 id="1-读取pdf文本内容">1. 读取PDF文本内容</h3>
<p>In [1]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">i</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pypi</span><span class="o">.</span><span class="n">tuna</span><span class="o">.</span><span class="n">tsinghua</span><span class="o">.</span><span class="n">edu</span><span class="o">.</span><span class="n">cn</span><span class="o">/</span><span class="n">simple</span> <span class="n">pdfplumber</span>
</span></span><span class="line"><span class="cl"><span class="n">Looking</span> <span class="ow">in</span> <span class="n">indexes</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pypi</span><span class="o">.</span><span class="n">tuna</span><span class="o">.</span><span class="n">tsinghua</span><span class="o">.</span><span class="n">edu</span><span class="o">.</span><span class="n">cn</span><span class="o">/</span><span class="n">simple</span>
</span></span><span class="line"><span class="cl"><span class="n">Requirement</span> <span class="n">already</span> <span class="n">satisfied</span><span class="p">:</span> <span class="n">pdfplumber</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>\<span class="n">anaconda3</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span> <span class="p">(</span><span class="mf">0.5.16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Requirement</span> <span class="n">already</span> <span class="n">satisfied</span><span class="p">:</span> <span class="n">chardet</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>\<span class="n">anaconda3</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span> <span class="p">(</span><span class="kn">from</span> <span class="nn">pdfplumber</span><span class="p">)</span> <span class="p">(</span><span class="mf">3.0.4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Requirement</span> <span class="n">already</span> <span class="n">satisfied</span><span class="p">:</span> <span class="n">pdfminer</span><span class="o">.</span><span class="n">six</span><span class="o">==</span><span class="mi">20200104</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>\<span class="n">anaconda3</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span> <span class="p">(</span><span class="kn">from</span> <span class="nn">pdfplumber</span><span class="p">)</span> <span class="p">(</span><span class="mi">20200104</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Requirement</span> <span class="n">already</span> <span class="n">satisfied</span><span class="p">:</span> <span class="n">pillow</span><span class="o">&gt;=</span><span class="mf">7.0.0</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>\<span class="n">anaconda3</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span> <span class="p">(</span><span class="kn">from</span> <span class="nn">pdfplumber</span><span class="p">)</span> <span class="p">(</span><span class="mf">7.0.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Requirement</span> <span class="n">already</span> <span class="n">satisfied</span><span class="p">:</span> <span class="n">unicodecsv</span><span class="o">&gt;=</span><span class="mf">0.14.1</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>\<span class="n">anaconda3</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span> <span class="p">(</span><span class="kn">from</span> <span class="nn">pdfplumber</span><span class="p">)</span> <span class="p">(</span><span class="mf">0.14.1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Requirement</span> <span class="n">already</span> <span class="n">satisfied</span><span class="p">:</span> <span class="n">six</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>\<span class="n">anaconda3</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span> <span class="p">(</span><span class="kn">from</span> <span class="nn">pdfplumber</span><span class="p">)</span> <span class="p">(</span><span class="mf">1.14.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Requirement</span> <span class="n">already</span> <span class="n">satisfied</span><span class="p">:</span> <span class="n">wand</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>\<span class="n">anaconda3</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span> <span class="p">(</span><span class="kn">from</span> <span class="nn">pdfplumber</span><span class="p">)</span> <span class="p">(</span><span class="mf">0.5.9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Requirement</span> <span class="n">already</span> <span class="n">satisfied</span><span class="p">:</span> <span class="n">pycryptodome</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>\<span class="n">anaconda3</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span> <span class="p">(</span><span class="kn">from</span> <span class="nn">pdfplumber</span><span class="p">)</span> <span class="p">(</span><span class="mf">3.9.7</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Requirement</span> <span class="n">already</span> <span class="n">satisfied</span><span class="p">:</span> <span class="n">sortedcontainers</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>\<span class="n">anaconda3</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span> <span class="p">(</span><span class="kn">from</span> <span class="nn">pdfminer.six</span><span class="o">==</span><span class="mi">20200104</span><span class="o">-&gt;</span><span class="n">pdfplumber</span><span class="p">)</span> <span class="p">(</span><span class="mf">2.1.0</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [48]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pdfplumber</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">read_pdf</span><span class="p">(</span><span class="n">pdf_fpath</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">pdf</span> <span class="o">=</span> <span class="n">pdfplumber</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">pdf_fpath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">page_conts</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">pdf</span><span class="o">.</span><span class="n">pages</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">page_conts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">extract_text</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">pdf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34; &#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">page_conts</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [49]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pdf_fpath</span> <span class="o">=</span> <span class="s2">&#34;D:/tmp/Wide &amp; Deep Learning for Recommender Systems.pdf&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">pdf_cont</span> <span class="o">=</span> <span class="n">read_pdf</span><span class="p">(</span><span class="n">pdf_fpath</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [50]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">pdf_cont</span><span class="p">[:</span><span class="mi">2000</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Wide</span> <span class="o">&amp;</span> <span class="n">Deep</span> <span class="n">Learning</span> <span class="k">for</span> <span class="n">Recommender</span> <span class="n">Systems</span>
</span></span><span class="line"><span class="cl"><span class="n">Heng</span><span class="o">-</span><span class="n">Tze</span> <span class="n">Cheng</span><span class="p">,</span> <span class="n">Levent</span> <span class="n">Koc</span><span class="p">,</span> <span class="n">Jeremiah</span> <span class="n">Harmsen</span><span class="p">,</span> <span class="n">Tal</span> <span class="n">Shaked</span><span class="p">,</span> <span class="n">Tushar</span> <span class="n">Chandra</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="n">Hrishi</span> <span class="n">Aradhye</span><span class="p">,</span> <span class="n">Glen</span> <span class="n">Anderson</span><span class="p">,</span> <span class="n">Greg</span> <span class="n">Corrado</span><span class="p">,</span> <span class="n">Wei</span> <span class="n">Chai</span><span class="p">,</span> <span class="n">Mustafa</span> <span class="n">Ispir</span><span class="p">,</span> <span class="n">Rohan</span> <span class="n">Anil</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="n">Zakaria</span> <span class="n">Haque</span><span class="p">,</span> <span class="n">Lichan</span> <span class="n">Hong</span><span class="p">,</span> <span class="n">Vihan</span> <span class="n">Jain</span><span class="p">,</span> <span class="n">Xiaobing</span> <span class="n">Liu</span><span class="p">,</span> <span class="n">Hemal</span> <span class="n">Shah</span>
</span></span><span class="line"><span class="cl"><span class="err">∗</span>
</span></span><span class="line"><span class="cl"><span class="n">GoogleInc</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="n">ABSTRACT</span>
</span></span><span class="line"><span class="cl"><span class="n">have</span> <span class="n">never</span> <span class="ow">or</span> <span class="n">rarely</span> <span class="n">occurred</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">past</span><span class="o">.</span> <span class="n">Recommenda</span><span class="o">-</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">tions</span> <span class="n">based</span> <span class="n">on</span> <span class="n">memorization</span> <span class="n">are</span> <span class="n">usually</span> <span class="n">more</span> <span class="n">topical</span> <span class="ow">and</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span> <span class="n">Generalized</span> <span class="n">linear</span> <span class="n">models</span> <span class="k">with</span> <span class="n">nonlinear</span> <span class="n">feature</span> <span class="n">transfor</span><span class="o">-</span>
</span></span><span class="line"><span class="cl"><span class="n">directly</span> <span class="n">relevant</span> <span class="n">to</span> <span class="n">the</span> <span class="n">items</span> <span class="n">on</span> <span class="n">which</span> <span class="n">users</span> <span class="n">have</span> <span class="n">already</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span> <span class="n">mations</span> <span class="n">are</span> <span class="n">widely</span> <span class="n">used</span> <span class="k">for</span> <span class="n">large</span><span class="o">-</span><span class="n">scale</span> <span class="n">regression</span> <span class="ow">and</span> <span class="n">clas</span><span class="o">-</span>
</span></span><span class="line"><span class="cl"><span class="n">performed</span> <span class="n">actions</span><span class="o">.</span> <span class="n">Compared</span> <span class="k">with</span> <span class="n">memorization</span><span class="p">,</span> <span class="n">general</span><span class="o">-</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span> <span class="n">siﬁcationproblemswithsparseinputs</span><span class="o">.</span> <span class="n">Memorizationoffea</span><span class="o">-</span>
</span></span><span class="line"><span class="cl"><span class="n">ization</span> <span class="n">tends</span> <span class="n">to</span> <span class="n">improve</span> <span class="n">the</span> <span class="n">diversity</span> <span class="n">of</span> <span class="n">the</span> <span class="n">recommended</span>
</span></span><span class="line"><span class="cl">  <span class="n">tureinteractionsthroughawide</span> <span class="n">setofcross</span><span class="o">-</span><span class="n">productfeature</span>
</span></span><span class="line"><span class="cl"><span class="n">n</span> <span class="n">items</span><span class="o">.</span> <span class="n">Inthispaper</span><span class="p">,</span><span class="n">wefocusontheappsrecommendation</span>
</span></span><span class="line"><span class="cl"><span class="n">transformationsareeﬀectiveandinterpretable</span><span class="p">,</span><span class="n">whilegener</span><span class="o">-</span>
</span></span><span class="line"><span class="cl"><span class="n">u</span> <span class="n">problemfortheGooglePlaystore</span><span class="p">,</span><span class="n">buttheapproachshould</span>
</span></span><span class="line"><span class="cl"><span class="n">alizationrequiresmorefeatureengineeringeﬀort</span><span class="o">.</span> <span class="n">Withless</span>
</span></span><span class="line"><span class="cl"><span class="n">J</span> <span class="n">apply</span> <span class="n">to</span> <span class="n">generic</span> <span class="n">recommender</span> <span class="n">systems</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">  <span class="n">featureengineering</span><span class="p">,</span><span class="n">deepneuralnetworkscangeneralizebet</span><span class="o">-</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span> <span class="n">Formassive</span><span class="o">-</span><span class="n">scaleonlinerecommendationandrankingsys</span><span class="o">-</span>
</span></span><span class="line"><span class="cl"><span class="n">tertounseenfeaturecombinationsthroughlow</span><span class="o">-</span><span class="n">dimensional</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span> <span class="n">temsinanindustrialsetting</span><span class="p">,</span><span class="n">generalizedlinearmodelssuch</span>
</span></span><span class="line"><span class="cl"><span class="n">denseembeddingslearnedforthesparsefeatures</span><span class="o">.</span> <span class="n">However</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="k">as</span> <span class="n">logistic</span> <span class="n">regression</span> <span class="n">are</span> <span class="n">widely</span> <span class="n">used</span> <span class="n">because</span> <span class="n">they</span> <span class="n">are</span> <span class="n">sim</span><span class="o">-</span>
</span></span><span class="line"><span class="cl">  <span class="n">deep</span> <span class="n">neural</span> <span class="n">networks</span> <span class="k">with</span> <span class="n">embeddings</span> <span class="n">can</span> <span class="n">over</span><span class="o">-</span><span class="n">generalize</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span> <span class="n">ple</span><span class="p">,</span><span class="n">scalableandinterpretable</span><span class="o">.</span> <span class="n">Themodelsareoftentrained</span>
</span></span><span class="line"><span class="cl"><span class="n">G</span> <span class="n">andrecommendlessrelevantitemswhentheuser</span><span class="o">-</span><span class="n">iteminter</span><span class="o">-</span>
</span></span><span class="line"><span class="cl"><span class="n">onbinarizedsparsefeatureswithone</span><span class="o">-</span><span class="n">hotencoding</span><span class="o">.</span> <span class="n">E</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="p">,</span><span class="n">the</span>
</span></span><span class="line"><span class="cl"><span class="n">actions</span> <span class="n">are</span> <span class="n">sparse</span> <span class="ow">and</span> <span class="n">high</span><span class="o">-</span><span class="n">rank</span><span class="o">.</span> <span class="n">In</span> <span class="n">this</span> <span class="n">paper</span><span class="p">,</span> <span class="n">we</span> <span class="n">present</span>
</span></span><span class="line"><span class="cl"><span class="n">L</span> <span class="n">binary</span> <span class="n">feature</span><span class="err">“</span><span class="n">user_installed_app</span><span class="o">=</span><span class="n">netflix</span><span class="err">”</span><span class="n">has</span> <span class="n">value</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">Wide</span> <span class="o">&amp;</span> <span class="n">Deep</span> <span class="n">learning</span><span class="err">—</span><span class="n">jointly</span> <span class="n">trained</span> <span class="n">wide</span> <span class="n">linear</span> <span class="n">models</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span> <span class="k">if</span> <span class="n">the</span> <span class="n">user</span> <span class="n">installed</span> <span class="n">Netﬂix</span><span class="o">.</span> <span class="n">Memorization</span> <span class="n">can</span> <span class="n">be</span> <span class="n">achieved</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span> <span class="n">anddeepneuralnetworks</span><span class="err">—</span><span class="n">tocombinethebeneﬁtsofmem</span><span class="o">-</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span> <span class="n">orization</span> <span class="ow">and</span> <span class="n">generalization</span> <span class="k">for</span> <span class="n">recommender</span> <span class="n">systems</span><span class="o">.</span> <span class="n">We</span> <span class="n">eﬀectively</span> <span class="n">using</span> <span class="n">cross</span><span class="o">-</span><span class="n">product</span> <span class="n">t</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-读取英语-汉语翻译词典文件">2. 读取英语-汉语翻译词典文件</h3>
<p>词典文件来自：https://github.com/skywind3000/ECDICT 使用步骤：</p>
<ol>
<li>下载代码打包：https://github.com/skywind3000/ECDICT/archive/master.zip</li>
<li>解压master.zip，然后解压其中的‪stardict.csv文件</li>
</ol>
<p>In [8]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [9]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 注意：stardict.csv的地址需要替换成你自己的文件地址</span>
</span></span><span class="line"><span class="cl"><span class="n">df_dict</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&#34;D:/tmp/ECDICT-master/stardict.csv&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span><span class="p">:</span>\<span class="n">Anaconda3</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">IPython</span>\<span class="n">core</span>\<span class="n">interactiveshell</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">3063</span><span class="p">:</span> <span class="n">DtypeWarning</span><span class="p">:</span> <span class="n">Columns</span> <span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="n">have</span> <span class="n">mixed</span> <span class="n">types</span><span class="o">.</span><span class="n">Specify</span> <span class="n">dtype</span> <span class="n">option</span> <span class="n">on</span> <span class="kn">import</span> <span class="nn">or</span> <span class="nb">set</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">  <span class="n">interactivity</span><span class="o">=</span><span class="n">interactivity</span><span class="p">,</span> <span class="n">compiler</span><span class="o">=</span><span class="n">compiler</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [10]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_dict</span><span class="o">.</span><span class="n">shape</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[10]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">(</span><span class="mi">3402564</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [11]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_dict</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[11]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">word</th>
<th style="text-align:right">phonetic</th>
<th style="text-align:right">definition</th>
<th style="text-align:right">translation</th>
<th style="text-align:right">pos</th>
<th style="text-align:right">collins</th>
<th style="text-align:right">oxford</th>
<th style="text-align:right">tag</th>
<th style="text-align:right">bnc</th>
<th style="text-align:right">frq</th>
<th style="text-align:right">exchange</th>
<th style="text-align:right">detail</th>
<th style="text-align:right">audio</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">801655</td>
<td style="text-align:right">design height</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">设计高度</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2739800</td>
<td style="text-align:right">shibu</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">[网络] 方回春堂；喊吧</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">1232187</td>
<td style="text-align:right">genus Testudo</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">[网络] Testudo属</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">s:genus testudoes</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2403094</td>
<td style="text-align:right">profit-and-loss statements</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">[会计] 损益表</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">0:profit-and-loss statement/1:s</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">1197174</td>
<td style="text-align:right">gain limited sensitivity</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">极限增益灵敏度</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
</tbody>
</table>
<p>In [12]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 把word、translation之外的列扔掉</span>
</span></span><span class="line"><span class="cl"><span class="n">df_dict</span> <span class="o">=</span> <span class="n">df_dict</span><span class="p">[[</span><span class="s2">&#34;word&#34;</span><span class="p">,</span> <span class="s2">&#34;translation&#34;</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl"><span class="n">df_dict</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[12]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">word</th>
<th style="text-align:right">translation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">&lsquo;a</td>
<td style="text-align:right">na. 一\nn. 英文字母表的第一字母；【乐】A音\nart. 冠以不定冠词主要表示类别...</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">&lsquo;A&rsquo; game</td>
<td style="text-align:right">[网络] 游戏；一个游戏；一局</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">&lsquo;Abbāsīyah</td>
<td style="text-align:right">[地名] 阿巴西耶 ( 埃 )</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">&lsquo;Abd al Kūrī</td>
<td style="text-align:right">[地名] 阿卜杜勒库里岛 ( 也门 )</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">&lsquo;Abd al Mājid</td>
<td style="text-align:right">[地名] 阿卜杜勒马吉德 ( 苏丹 )</td>
</tr>
</tbody>
</table>
<h3 id="3-英文分词和数据清洗">3. 英文分词和数据清洗</h3>
<p>In [13]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 分词</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="n">word_list</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;[ ,.\(\)/</span><span class="se">\n</span><span class="s2">|\-:=\$\[&#34;&#39;]&#34;&#34;&#34;</span><span class="p">,</span> <span class="n">pdf_cont</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">word_list</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[13]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">[</span><span class="s1">&#39;Wide&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;Deep&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;Learning&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;for&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;Recommender&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;Systems&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;Heng&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;Tze&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;Cheng&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [14]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 数据清洗</span>
</span></span><span class="line"><span class="cl"><span class="n">word_list_clean</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">word_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">word</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 过滤掉空词、数字、单个字符的词、停用词</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">word</span> <span class="ow">or</span> <span class="n">word</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">continue</span>
</span></span><span class="line"><span class="cl">    <span class="n">word_list_clean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">word_list_clean</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[14]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">[</span><span class="s1">&#39;wide&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;deep&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;learning&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;for&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;recommender&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;systems&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;heng&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;tze&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;cheng&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;levent&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;koc&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;jeremiah&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;harmsen&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;tal&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;shaked&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;tushar&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;chandra&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;hrishi&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;aradhye&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;glen&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4-分词结果构造成一个dataframe">4. 分词结果构造成一个DataFrame</h3>
<p>In [15]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_words</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;word&#34;</span><span class="p">:</span> <span class="n">word_list_clean</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">df_words</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[15]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">word</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">wide</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">deep</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">learning</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">for</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">recommender</td>
</tr>
</tbody>
</table>
<p>In [16]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_words</span><span class="o">.</span><span class="n">shape</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[16]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">(</span><span class="mi">2322</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [17]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 统计词频</span>
</span></span><span class="line"><span class="cl"><span class="n">df_words</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_words</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&#34;word&#34;</span><span class="p">)[</span><span class="s2">&#34;word&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="s2">&#34;size&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&#34;count&#34;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_words</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[17]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">word</th>
<th style="text-align:right">count</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">804</td>
<td style="text-align:right">the</td>
<td style="text-align:right">128</td>
</tr>
<tr>
<td style="text-align:right">57</td>
<td style="text-align:right">and</td>
<td style="text-align:right">67</td>
</tr>
<tr>
<td style="text-align:right">546</td>
<td style="text-align:right">of</td>
<td style="text-align:right">46</td>
</tr>
<tr>
<td style="text-align:right">503</td>
<td style="text-align:right">model</td>
<td style="text-align:right">41</td>
</tr>
<tr>
<td style="text-align:right">939</td>
<td style="text-align:right">wide</td>
<td style="text-align:right">36</td>
</tr>
<tr>
<td style="text-align:right">374</td>
<td style="text-align:right">in</td>
<td style="text-align:right">36</td>
</tr>
<tr>
<td style="text-align:right">203</td>
<td style="text-align:right">deep</td>
<td style="text-align:right">35</td>
</tr>
<tr>
<td style="text-align:right">405</td>
<td style="text-align:right">is</td>
<td style="text-align:right">31</td>
</tr>
<tr>
<td style="text-align:right">286</td>
<td style="text-align:right">for</td>
<td style="text-align:right">30</td>
</tr>
<tr>
<td style="text-align:right">845</td>
<td style="text-align:right">to</td>
<td style="text-align:right">29</td>
</tr>
</tbody>
</table>
<h3 id="5-和单词词典实现merge">5. 和单词词典实现merge</h3>
<p>In [21]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_merge</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">left</span> <span class="o">=</span> <span class="n">df_dict</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">right</span> <span class="o">=</span> <span class="n">df_words</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">left_on</span> <span class="o">=</span> <span class="s2">&#34;word&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">right_on</span> <span class="o">=</span> <span class="s2">&#34;word&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [32]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_merge</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[32]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">word</th>
<th style="text-align:right">translation</th>
<th style="text-align:right">count</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">account</td>
<td style="text-align:right">n. 报告, 解释, 估价, 理由, 利润, 算账, 帐目\nvi. 报帐, 解释, 导致,&hellip;</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">380</td>
<td style="text-align:right">prediction</td>
<td style="text-align:right">n. 预言, 预报\n[化] 预测</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">185</td>
<td style="text-align:right">generalization</td>
<td style="text-align:right">n. 一般化, 普遍化, 概括\n[化] 推广; 普适化</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td style="text-align:right">56</td>
<td style="text-align:right">burget</td>
<td style="text-align:right">[人名] 伯吉特</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">372</td>
<td style="text-align:right">pipeline</td>
<td style="text-align:right">n. 管道, 传递途径\n[化] 管路; 管线</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">237</td>
<td style="text-align:right">include</td>
<td style="text-align:right">vt. 包括, 把&hellip;算入, 包住\n[计] DOS内部命令:在CONFIG.SYS文件的&hellip;</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">524</td>
<td style="text-align:right">threads</td>
<td style="text-align:right">n. 线；相关串连；线程（thread的复数）</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">208</td>
<td style="text-align:right">heng</td>
<td style="text-align:right">n. 恒; 珩</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">62</td>
<td style="text-align:right">capacity</td>
<td style="text-align:right">n. 容量, 能力, 才能, 资格\n[计] 容量</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">228</td>
<td style="text-align:right">important</td>
<td style="text-align:right">a. 重要的, 有地位的, 大量的, 显要的, 自负的\n[计] 要点</td>
<td style="text-align:right">2</td>
</tr>
</tbody>
</table>
<p>In [33]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_merge</span><span class="o">.</span><span class="n">shape</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[33]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">(</span><span class="mi">607</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="6-存入excel">6. 存入Excel</h3>
<p>In [34]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_merge</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s2">&#34;./39. pdf_chinese_english.xlsx&#34;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="40pandas怎样实现groupby聚合后字符串列的合并">40、Pandas怎样实现groupby聚合后字符串列的合并</h1>
<h4 id="需求">需求：</h4>
<p>计算每个月的最高温度、最低温度、出现的风向列表、出现的空气质量列表</p>
<h4 id="数据输入">数据输入</h4>
<p><img src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/31.png" alt=""></p>
<h4 id="数据输出">数据输出</h4>
<p><img src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/32.png" alt=""></p>
<h3 id="读取数据">读取数据</h3>
<p>In [1]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [2]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">fpath</span> <span class="o">=</span> <span class="s2">&#34;./datas/beijing_tianqi/beijing_tianqi_2018.csv&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[2]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2018-01-01</td>
<td style="text-align:right">3℃</td>
<td style="text-align:right">-6℃</td>
<td style="text-align:right">晴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">59</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01-02</td>
<td style="text-align:right">2℃</td>
<td style="text-align:right">-5℃</td>
<td style="text-align:right">阴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">49</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2018-01-03</td>
<td style="text-align:right">2℃</td>
<td style="text-align:right">-5℃</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">28</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<h4 id="知识使用dfinfo可以查看每列的类型">知识：使用df.info()可以查看每列的类型</h4>
<p>In [3]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="s1">&#39;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">RangeIndex</span><span class="p">:</span> <span class="mi">365</span> <span class="n">entries</span><span class="p">,</span> <span class="mi">0</span> <span class="n">to</span> <span class="mi">364</span>
</span></span><span class="line"><span class="cl"><span class="n">Data</span> <span class="n">columns</span> <span class="p">(</span><span class="n">total</span> <span class="mi">9</span> <span class="n">columns</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"> <span class="c1">#   Column     Non-Null Count  Dtype </span>
</span></span><span class="line"><span class="cl"><span class="o">---</span>  <span class="o">------</span>     <span class="o">--------------</span>  <span class="o">-----</span> 
</span></span><span class="line"><span class="cl"> <span class="mi">0</span>   <span class="n">ymd</span>        <span class="mi">365</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>    <span class="nb">object</span>
</span></span><span class="line"><span class="cl"> <span class="mi">1</span>   <span class="n">bWendu</span>     <span class="mi">365</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>    <span class="nb">object</span>
</span></span><span class="line"><span class="cl"> <span class="mi">2</span>   <span class="n">yWendu</span>     <span class="mi">365</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>    <span class="nb">object</span>
</span></span><span class="line"><span class="cl"> <span class="mi">3</span>   <span class="n">tianqi</span>     <span class="mi">365</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>    <span class="nb">object</span>
</span></span><span class="line"><span class="cl"> <span class="mi">4</span>   <span class="n">fengxiang</span>  <span class="mi">365</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>    <span class="nb">object</span>
</span></span><span class="line"><span class="cl"> <span class="mi">5</span>   <span class="n">fengli</span>     <span class="mi">365</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>    <span class="nb">object</span>
</span></span><span class="line"><span class="cl"> <span class="mi">6</span>   <span class="n">aqi</span>        <span class="mi">365</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>    <span class="n">int64</span> 
</span></span><span class="line"><span class="cl"> <span class="mi">7</span>   <span class="n">aqiInfo</span>    <span class="mi">365</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>    <span class="nb">object</span>
</span></span><span class="line"><span class="cl"> <span class="mi">8</span>   <span class="n">aqiLevel</span>   <span class="mi">365</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>    <span class="n">int64</span> 
</span></span><span class="line"><span class="cl"><span class="n">dtypes</span><span class="p">:</span> <span class="n">int64</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="nb">object</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">memory</span> <span class="n">usage</span><span class="p">:</span> <span class="mf">25.8</span><span class="o">+</span> <span class="n">KB</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="知识series怎样从str类型变成int">知识：series怎样从str类型变成int</h4>
<p>In [4]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;℃&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;yWendu&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;yWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;℃&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[4]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2018-01-01</td>
<td style="text-align:right">3</td>
<td style="text-align:right">-6</td>
<td style="text-align:right">晴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">59</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01-02</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">阴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">49</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2018-01-03</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">28</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<h4 id="知识进行日期列解析可以方便提取月份">知识：进行日期列解析，可以方便提取月份</h4>
<p>In [5]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;ymd&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;ymd&#34;</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [6]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;ymd&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[6]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mi">0</span>       <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>       <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>       <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>       <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>       <span class="mi">1</span>
</span></span><span class="line"><span class="cl">       <span class="o">..</span>
</span></span><span class="line"><span class="cl"><span class="mi">360</span>    <span class="mi">12</span>
</span></span><span class="line"><span class="cl"><span class="mi">361</span>    <span class="mi">12</span>
</span></span><span class="line"><span class="cl"><span class="mi">362</span>    <span class="mi">12</span>
</span></span><span class="line"><span class="cl"><span class="mi">363</span>    <span class="mi">12</span>
</span></span><span class="line"><span class="cl"><span class="mi">364</span>    <span class="mi">12</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">ymd</span><span class="p">,</span> <span class="n">Length</span><span class="p">:</span> <span class="mi">365</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="知识series可以用seriesunique去重">知识：series可以用Series.unique去重</h4>
<p>In [7]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;fengxiang&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[7]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-v" data-lang="v"><span class="line"><span class="cl"><span class="nb">array</span><span class="p">([</span><span class="s1">&#39;东北风&#39;</span><span class="p">,</span> <span class="s1">&#39;北风&#39;</span><span class="p">,</span> <span class="s1">&#39;西北风&#39;</span><span class="p">,</span> <span class="s1">&#39;西南风&#39;</span><span class="p">,</span> <span class="s1">&#39;南风&#39;</span><span class="p">,</span> <span class="s1">&#39;东南风&#39;</span><span class="p">,</span> <span class="s1">&#39;东风&#39;</span><span class="p">,</span> <span class="s1">&#39;西风&#39;</span><span class="p">],</span> <span class="nv">dtype</span><span class="o">=</span><span class="nv">object</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="知识可以用joinseries实现数组合并成大字符串">知识：可以用&quot;,&quot;.join(series)实现数组合并成大字符串</h4>
<p>In [8]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="s2">&#34;,&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;fengxiang&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[8]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="s1">&#39;东北风,北风,西北风,西南风,南风,东南风,东风,西风&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="方法1">方法1</h3>
<p>In [9]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;ymd&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">          <span class="c1"># 新列名 = (原列名，函数)</span>
</span></span><span class="line"><span class="cl">          <span class="n">最高温度</span><span class="o">=</span><span class="p">(</span><span class="s2">&#34;bWendu&#34;</span><span class="p">,</span> <span class="s2">&#34;max&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="n">最低温度</span><span class="o">=</span><span class="p">(</span><span class="s2">&#34;yWendu&#34;</span><span class="p">,</span> <span class="s2">&#34;min&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="n">风向列表</span><span class="o">=</span><span class="p">(</span><span class="s2">&#34;fengxiang&#34;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="s2">&#34;,&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">unique</span><span class="p">())),</span>
</span></span><span class="line"><span class="cl">          <span class="n">空气质量列表</span><span class="o">=</span><span class="p">(</span><span class="s2">&#34;aqiInfo&#34;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="s2">&#34;,&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">      <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;ymd&#34;</span><span class="p">:</span><span class="s2">&#34;月份&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [10]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">result</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[10]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">月份</th>
<th style="text-align:right">最高温度</th>
<th style="text-align:right">最低温度</th>
<th style="text-align:right">风向列表</th>
<th style="text-align:right">空气质量列表</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">7</td>
<td style="text-align:right">-12</td>
<td style="text-align:right">东北风,北风,西北风,西南风,南风,东南风,东风</td>
<td style="text-align:right">良,优,轻度污染,中度污染</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">12</td>
<td style="text-align:right">-10</td>
<td style="text-align:right">北风,西南风,南风,西北风,西风,东北风,东风</td>
<td style="text-align:right">良,优,轻度污染,中度污染,重度污染</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">27</td>
<td style="text-align:right">-4</td>
<td style="text-align:right">西南风,北风,东南风,南风,东北风,东风</td>
<td style="text-align:right">优,良,重度污染,轻度污染,中度污染,严重污染</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">30</td>
<td style="text-align:right">1</td>
<td style="text-align:right">南风,北风,东北风,西南风,西北风,东南风</td>
<td style="text-align:right">重度污染,良,优,轻度污染,中度污染</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">35</td>
<td style="text-align:right">10</td>
<td style="text-align:right">东北风,北风,西南风,南风,东南风,东风,西风,西北风</td>
<td style="text-align:right">轻度污染,优,良,中度污染</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">6</td>
<td style="text-align:right">38</td>
<td style="text-align:right">17</td>
<td style="text-align:right">西南风,南风,北风,东风,东南风,东北风</td>
<td style="text-align:right">良,轻度污染,优,中度污染</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">7</td>
<td style="text-align:right">37</td>
<td style="text-align:right">22</td>
<td style="text-align:right">东南风,西南风,南风,东北风,东风,西风,北风</td>
<td style="text-align:right">良,轻度污染,优</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">8</td>
<td style="text-align:right">36</td>
<td style="text-align:right">20</td>
<td style="text-align:right">东南风,南风,东风,东北风,北风,西南风</td>
<td style="text-align:right">良,轻度污染,优</td>
</tr>
<tr>
<td style="text-align:right">8</td>
<td style="text-align:right">9</td>
<td style="text-align:right">31</td>
<td style="text-align:right">11</td>
<td style="text-align:right">南风,北风,西南风,西北风</td>
<td style="text-align:right">优,良,轻度污染</td>
</tr>
<tr>
<td style="text-align:right">9</td>
<td style="text-align:right">10</td>
<td style="text-align:right">25</td>
<td style="text-align:right">1</td>
<td style="text-align:right">北风,西北风,南风,西风,东北风,西南风</td>
<td style="text-align:right">优,良,轻度污染,中度污染</td>
</tr>
<tr>
<td style="text-align:right">10</td>
<td style="text-align:right">11</td>
<td style="text-align:right">18</td>
<td style="text-align:right">-4</td>
<td style="text-align:right">南风,北风,西南风,东南风,西北风,东北风</td>
<td style="text-align:right">良,轻度污染,重度污染,优,中度污染</td>
</tr>
<tr>
<td style="text-align:right">11</td>
<td style="text-align:right">12</td>
<td style="text-align:right">10</td>
<td style="text-align:right">-12</td>
<td style="text-align:right">东南风,东北风,西北风,西南风</td>
<td style="text-align:right">中度污染,重度污染,良,优,轻度污染</td>
</tr>
</tbody>
</table>
<h3 id="方法2">方法2</h3>
<p>In [11]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">agg_func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;注意，这个x是每个分组的dataframe&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;最高温度&#34;</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;最低温度&#34;</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&#34;yWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;风向列表&#34;</span><span class="p">:</span> <span class="s2">&#34;,&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&#34;fengxiang&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;空气质量列表&#34;</span><span class="p">:</span> <span class="s2">&#34;,&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&#34;aqiInfo&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">df</span> \
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;ymd&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">)</span> \
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">agg_func</span><span class="p">)</span> \
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span> \
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;ymd&#34;</span><span class="p">:</span><span class="s2">&#34;月份&#34;</span><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [12]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">result</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[12]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">月份</th>
<th style="text-align:right">最高温度</th>
<th style="text-align:right">最低温度</th>
<th style="text-align:right">风向列表</th>
<th style="text-align:right">空气质量列表</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">7</td>
<td style="text-align:right">-12</td>
<td style="text-align:right">东北风,北风,西北风,西南风,南风,东南风,东风</td>
<td style="text-align:right">良,优,轻度污染,中度污染</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">12</td>
<td style="text-align:right">-10</td>
<td style="text-align:right">北风,西南风,南风,西北风,西风,东北风,东风</td>
<td style="text-align:right">良,优,轻度污染,中度污染,重度污染</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">27</td>
<td style="text-align:right">-4</td>
<td style="text-align:right">西南风,北风,东南风,南风,东北风,东风</td>
<td style="text-align:right">优,良,重度污染,轻度污染,中度污染,严重污染</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">30</td>
<td style="text-align:right">1</td>
<td style="text-align:right">南风,北风,东北风,西南风,西北风,东南风</td>
<td style="text-align:right">重度污染,良,优,轻度污染,中度污染</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">35</td>
<td style="text-align:right">10</td>
<td style="text-align:right">东北风,北风,西南风,南风,东南风,东风,西风,西北风</td>
<td style="text-align:right">轻度污染,优,良,中度污染</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">6</td>
<td style="text-align:right">38</td>
<td style="text-align:right">17</td>
<td style="text-align:right">西南风,南风,北风,东风,东南风,东北风</td>
<td style="text-align:right">良,轻度污染,优,中度污染</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">7</td>
<td style="text-align:right">37</td>
<td style="text-align:right">22</td>
<td style="text-align:right">东南风,西南风,南风,东北风,东风,西风,北风</td>
<td style="text-align:right">良,轻度污染,优</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">8</td>
<td style="text-align:right">36</td>
<td style="text-align:right">20</td>
<td style="text-align:right">东南风,南风,东风,东北风,北风,西南风</td>
<td style="text-align:right">良,轻度污染,优</td>
</tr>
<tr>
<td style="text-align:right">8</td>
<td style="text-align:right">9</td>
<td style="text-align:right">31</td>
<td style="text-align:right">11</td>
<td style="text-align:right">南风,北风,西南风,西北风</td>
<td style="text-align:right">优,良,轻度污染</td>
</tr>
<tr>
<td style="text-align:right">9</td>
<td style="text-align:right">10</td>
<td style="text-align:right">25</td>
<td style="text-align:right">1</td>
<td style="text-align:right">北风,西北风,南风,西风,东北风,西南风</td>
<td style="text-align:right">优,良,轻度污染,中度污染</td>
</tr>
<tr>
<td style="text-align:right">10</td>
<td style="text-align:right">11</td>
<td style="text-align:right">18</td>
<td style="text-align:right">-4</td>
<td style="text-align:right">南风,北风,西南风,东南风,西北风,东北风</td>
<td style="text-align:right">良,轻度污染,重度污染,优,中度污染</td>
</tr>
<tr>
<td style="text-align:right">11</td>
<td style="text-align:right">12</td>
<td style="text-align:right">10</td>
<td style="text-align:right">-12</td>
<td style="text-align:right">东南风,东北风,西北风,西南风</td>
<td style="text-align:right">中度污染,重度污染,良,优,轻度污染</td>
</tr>
</tbody>
</table>
<h1 id="41pandas读取excel绘制直方图">41、Pandas读取Excel绘制直方图</h1>
<p>*<strong>直方图(Histogram)：*</strong>
直方图是数值数据分布的精确图形表示，是一个连续变量（定量变量）的概率分布的估计，它是一种条形图。
为了构建直方图，第一步是将值的范围分段，即将整个值的范围分成一系列间隔，然后计算每个间隔中有多少值。</p>
<h3 id="1-读取数据">1. 读取数据</h3>
<p>波斯顿房价数据集</p>
<p>In [1]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [2]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&#34;./datas/boston-house-prices/housing.xlsx&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [3]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[3]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">CRIM</th>
<th style="text-align:right">ZN</th>
<th style="text-align:right">INDUS</th>
<th style="text-align:right">CHAS</th>
<th style="text-align:right">NOX</th>
<th style="text-align:right">RM</th>
<th style="text-align:right">AGE</th>
<th style="text-align:right">DIS</th>
<th style="text-align:right">RAD</th>
<th style="text-align:right">TAX</th>
<th style="text-align:right">PTRATIO</th>
<th style="text-align:right">B</th>
<th style="text-align:right">LSTAT</th>
<th style="text-align:right">MEDV</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0.00632</td>
<td style="text-align:right">18.0</td>
<td style="text-align:right">2.31</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.538</td>
<td style="text-align:right">6.575</td>
<td style="text-align:right">65.2</td>
<td style="text-align:right">4.0900</td>
<td style="text-align:right">1</td>
<td style="text-align:right">296</td>
<td style="text-align:right">15.3</td>
<td style="text-align:right">396.90</td>
<td style="text-align:right">4.98</td>
<td style="text-align:right">24.0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">0.02731</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">7.07</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.469</td>
<td style="text-align:right">6.421</td>
<td style="text-align:right">78.9</td>
<td style="text-align:right">4.9671</td>
<td style="text-align:right">2</td>
<td style="text-align:right">242</td>
<td style="text-align:right">17.8</td>
<td style="text-align:right">396.90</td>
<td style="text-align:right">9.14</td>
<td style="text-align:right">21.6</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">0.02729</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">7.07</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.469</td>
<td style="text-align:right">7.185</td>
<td style="text-align:right">61.1</td>
<td style="text-align:right">4.9671</td>
<td style="text-align:right">2</td>
<td style="text-align:right">242</td>
<td style="text-align:right">17.8</td>
<td style="text-align:right">392.83</td>
<td style="text-align:right">4.03</td>
<td style="text-align:right">34.7</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">0.03237</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">2.18</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.458</td>
<td style="text-align:right">6.998</td>
<td style="text-align:right">45.8</td>
<td style="text-align:right">6.0622</td>
<td style="text-align:right">3</td>
<td style="text-align:right">222</td>
<td style="text-align:right">18.7</td>
<td style="text-align:right">394.63</td>
<td style="text-align:right">2.94</td>
<td style="text-align:right">33.4</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">0.06905</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">2.18</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.458</td>
<td style="text-align:right">7.147</td>
<td style="text-align:right">54.2</td>
<td style="text-align:right">6.0622</td>
<td style="text-align:right">3</td>
<td style="text-align:right">222</td>
<td style="text-align:right">18.7</td>
<td style="text-align:right">396.90</td>
<td style="text-align:right">5.33</td>
<td style="text-align:right">36.2</td>
</tr>
<tr>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
</tr>
<tr>
<td style="text-align:right">501</td>
<td style="text-align:right">0.06263</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">11.93</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.573</td>
<td style="text-align:right">6.593</td>
<td style="text-align:right">69.1</td>
<td style="text-align:right">2.4786</td>
<td style="text-align:right">1</td>
<td style="text-align:right">273</td>
<td style="text-align:right">21.0</td>
<td style="text-align:right">391.99</td>
<td style="text-align:right">9.67</td>
<td style="text-align:right">22.4</td>
</tr>
<tr>
<td style="text-align:right">502</td>
<td style="text-align:right">0.04527</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">11.93</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.573</td>
<td style="text-align:right">6.120</td>
<td style="text-align:right">76.7</td>
<td style="text-align:right">2.2875</td>
<td style="text-align:right">1</td>
<td style="text-align:right">273</td>
<td style="text-align:right">21.0</td>
<td style="text-align:right">396.90</td>
<td style="text-align:right">9.08</td>
<td style="text-align:right">20.6</td>
</tr>
<tr>
<td style="text-align:right">503</td>
<td style="text-align:right">0.06076</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">11.93</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.573</td>
<td style="text-align:right">6.976</td>
<td style="text-align:right">91.0</td>
<td style="text-align:right">2.1675</td>
<td style="text-align:right">1</td>
<td style="text-align:right">273</td>
<td style="text-align:right">21.0</td>
<td style="text-align:right">396.90</td>
<td style="text-align:right">5.64</td>
<td style="text-align:right">23.9</td>
</tr>
<tr>
<td style="text-align:right">504</td>
<td style="text-align:right">0.10959</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">11.93</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.573</td>
<td style="text-align:right">6.794</td>
<td style="text-align:right">89.3</td>
<td style="text-align:right">2.3889</td>
<td style="text-align:right">1</td>
<td style="text-align:right">273</td>
<td style="text-align:right">21.0</td>
<td style="text-align:right">393.45</td>
<td style="text-align:right">6.48</td>
<td style="text-align:right">22.0</td>
</tr>
<tr>
<td style="text-align:right">505</td>
<td style="text-align:right">0.04741</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">11.93</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.573</td>
<td style="text-align:right">6.030</td>
<td style="text-align:right">80.8</td>
<td style="text-align:right">2.5050</td>
<td style="text-align:right">1</td>
<td style="text-align:right">273</td>
<td style="text-align:right">21.0</td>
<td style="text-align:right">396.90</td>
<td style="text-align:right">7.88</td>
<td style="text-align:right">11.9</td>
</tr>
</tbody>
</table>
<p>506 rows × 14 columns</p>
<p>In [4]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="s1">&#39;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">RangeIndex</span><span class="p">:</span> <span class="mi">506</span> <span class="n">entries</span><span class="p">,</span> <span class="mi">0</span> <span class="n">to</span> <span class="mi">505</span>
</span></span><span class="line"><span class="cl"><span class="n">Data</span> <span class="n">columns</span> <span class="p">(</span><span class="n">total</span> <span class="mi">14</span> <span class="n">columns</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"> <span class="c1">#   Column   Non-Null Count  Dtype  </span>
</span></span><span class="line"><span class="cl"><span class="o">---</span>  <span class="o">------</span>   <span class="o">--------------</span>  <span class="o">-----</span>  
</span></span><span class="line"><span class="cl"> <span class="mi">0</span>   <span class="n">CRIM</span>     <span class="mi">506</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>    <span class="n">float64</span>
</span></span><span class="line"><span class="cl"> <span class="mi">1</span>   <span class="n">ZN</span>       <span class="mi">506</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>    <span class="n">float64</span>
</span></span><span class="line"><span class="cl"> <span class="mi">2</span>   <span class="n">INDUS</span>    <span class="mi">506</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>    <span class="n">float64</span>
</span></span><span class="line"><span class="cl"> <span class="mi">3</span>   <span class="n">CHAS</span>     <span class="mi">506</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>    <span class="n">int64</span>  
</span></span><span class="line"><span class="cl"> <span class="mi">4</span>   <span class="n">NOX</span>      <span class="mi">506</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>    <span class="n">float64</span>
</span></span><span class="line"><span class="cl"> <span class="mi">5</span>   <span class="n">RM</span>       <span class="mi">506</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>    <span class="n">float64</span>
</span></span><span class="line"><span class="cl"> <span class="mi">6</span>   <span class="n">AGE</span>      <span class="mi">506</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>    <span class="n">float64</span>
</span></span><span class="line"><span class="cl"> <span class="mi">7</span>   <span class="n">DIS</span>      <span class="mi">506</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>    <span class="n">float64</span>
</span></span><span class="line"><span class="cl"> <span class="mi">8</span>   <span class="n">RAD</span>      <span class="mi">506</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>    <span class="n">int64</span>  
</span></span><span class="line"><span class="cl"> <span class="mi">9</span>   <span class="n">TAX</span>      <span class="mi">506</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>    <span class="n">int64</span>  
</span></span><span class="line"><span class="cl"> <span class="mi">10</span>  <span class="n">PTRATIO</span>  <span class="mi">506</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>    <span class="n">float64</span>
</span></span><span class="line"><span class="cl"> <span class="mi">11</span>  <span class="n">B</span>        <span class="mi">506</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>    <span class="n">float64</span>
</span></span><span class="line"><span class="cl"> <span class="mi">12</span>  <span class="n">LSTAT</span>    <span class="mi">506</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>    <span class="n">float64</span>
</span></span><span class="line"><span class="cl"> <span class="mi">13</span>  <span class="n">MEDV</span>     <span class="mi">506</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>    <span class="n">float64</span>
</span></span><span class="line"><span class="cl"><span class="n">dtypes</span><span class="p">:</span> <span class="n">float64</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span> <span class="n">int64</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">memory</span> <span class="n">usage</span><span class="p">:</span> <span class="mf">55.5</span> <span class="n">KB</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [5]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;MEDV&#34;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[5]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mi">0</span>      <span class="mf">24.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="mf">21.6</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="mf">34.7</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>      <span class="mf">33.4</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>      <span class="mf">36.2</span>
</span></span><span class="line"><span class="cl">       <span class="o">...</span> 
</span></span><span class="line"><span class="cl"><span class="mi">501</span>    <span class="mf">22.4</span>
</span></span><span class="line"><span class="cl"><span class="mi">502</span>    <span class="mf">20.6</span>
</span></span><span class="line"><span class="cl"><span class="mi">503</span>    <span class="mf">23.9</span>
</span></span><span class="line"><span class="cl"><span class="mi">504</span>    <span class="mf">22.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">505</span>    <span class="mf">11.9</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">MEDV</span><span class="p">,</span> <span class="n">Length</span><span class="p">:</span> <span class="mi">506</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-使用matplotlib画直方图">2. 使用matplotlib画直方图</h3>
<p>matplotlib直方图文档：https://matplotlib.org/3.2.0/api/_as_gen/matplotlib.pyplot.hist.html</p>
<p>In [6]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [7]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;MEDV&#34;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/33.png" alt=""></p>
<h3 id="3-使用pyecharts画直方图">3. 使用pyecharts画直方图</h3>
<p>pyecharts直方图文档：http://gallery.pyecharts.org/#/Bar/bar_histogram
numpy直方图文档：https://docs.scipy.org/doc/numpy/reference/generated/numpy.histogram.html</p>
<p>In [8]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyecharts</span> <span class="kn">import</span> <span class="n">options</span> <span class="k">as</span> <span class="n">opts</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyecharts.charts</span> <span class="kn">import</span> <span class="n">Bar</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [9]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 需要自己计算有多少个间隔、以及每个间隔有多少个值</span>
</span></span><span class="line"><span class="cl"><span class="n">hist</span><span class="p">,</span><span class="n">bin_edges</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;MEDV&#34;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [10]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 这是每个间隔的分割点</span>
</span></span><span class="line"><span class="cl"><span class="n">bin_edges</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[10]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">array</span><span class="p">([</span> <span class="mf">5.</span>  <span class="p">,</span>  <span class="mf">5.45</span><span class="p">,</span>  <span class="mf">5.9</span> <span class="p">,</span>  <span class="mf">6.35</span><span class="p">,</span>  <span class="mf">6.8</span> <span class="p">,</span>  <span class="mf">7.25</span><span class="p">,</span>  <span class="mf">7.7</span> <span class="p">,</span>  <span class="mf">8.15</span><span class="p">,</span>  <span class="mf">8.6</span> <span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="mf">9.05</span><span class="p">,</span>  <span class="mf">9.5</span> <span class="p">,</span>  <span class="mf">9.95</span><span class="p">,</span> <span class="mf">10.4</span> <span class="p">,</span> <span class="mf">10.85</span><span class="p">,</span> <span class="mf">11.3</span> <span class="p">,</span> <span class="mf">11.75</span><span class="p">,</span> <span class="mf">12.2</span> <span class="p">,</span> <span class="mf">12.65</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="mf">13.1</span> <span class="p">,</span> <span class="mf">13.55</span><span class="p">,</span> <span class="mf">14.</span>  <span class="p">,</span> <span class="mf">14.45</span><span class="p">,</span> <span class="mf">14.9</span> <span class="p">,</span> <span class="mf">15.35</span><span class="p">,</span> <span class="mf">15.8</span> <span class="p">,</span> <span class="mf">16.25</span><span class="p">,</span> <span class="mf">16.7</span> <span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="mf">17.15</span><span class="p">,</span> <span class="mf">17.6</span> <span class="p">,</span> <span class="mf">18.05</span><span class="p">,</span> <span class="mf">18.5</span> <span class="p">,</span> <span class="mf">18.95</span><span class="p">,</span> <span class="mf">19.4</span> <span class="p">,</span> <span class="mf">19.85</span><span class="p">,</span> <span class="mf">20.3</span> <span class="p">,</span> <span class="mf">20.75</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="mf">21.2</span> <span class="p">,</span> <span class="mf">21.65</span><span class="p">,</span> <span class="mf">22.1</span> <span class="p">,</span> <span class="mf">22.55</span><span class="p">,</span> <span class="mf">23.</span>  <span class="p">,</span> <span class="mf">23.45</span><span class="p">,</span> <span class="mf">23.9</span> <span class="p">,</span> <span class="mf">24.35</span><span class="p">,</span> <span class="mf">24.8</span> <span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="mf">25.25</span><span class="p">,</span> <span class="mf">25.7</span> <span class="p">,</span> <span class="mf">26.15</span><span class="p">,</span> <span class="mf">26.6</span> <span class="p">,</span> <span class="mf">27.05</span><span class="p">,</span> <span class="mf">27.5</span> <span class="p">,</span> <span class="mf">27.95</span><span class="p">,</span> <span class="mf">28.4</span> <span class="p">,</span> <span class="mf">28.85</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="mf">29.3</span> <span class="p">,</span> <span class="mf">29.75</span><span class="p">,</span> <span class="mf">30.2</span> <span class="p">,</span> <span class="mf">30.65</span><span class="p">,</span> <span class="mf">31.1</span> <span class="p">,</span> <span class="mf">31.55</span><span class="p">,</span> <span class="mf">32.</span>  <span class="p">,</span> <span class="mf">32.45</span><span class="p">,</span> <span class="mf">32.9</span> <span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="mf">33.35</span><span class="p">,</span> <span class="mf">33.8</span> <span class="p">,</span> <span class="mf">34.25</span><span class="p">,</span> <span class="mf">34.7</span> <span class="p">,</span> <span class="mf">35.15</span><span class="p">,</span> <span class="mf">35.6</span> <span class="p">,</span> <span class="mf">36.05</span><span class="p">,</span> <span class="mf">36.5</span> <span class="p">,</span> <span class="mf">36.95</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="mf">37.4</span> <span class="p">,</span> <span class="mf">37.85</span><span class="p">,</span> <span class="mf">38.3</span> <span class="p">,</span> <span class="mf">38.75</span><span class="p">,</span> <span class="mf">39.2</span> <span class="p">,</span> <span class="mf">39.65</span><span class="p">,</span> <span class="mf">40.1</span> <span class="p">,</span> <span class="mf">40.55</span><span class="p">,</span> <span class="mf">41.</span>  <span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="mf">41.45</span><span class="p">,</span> <span class="mf">41.9</span> <span class="p">,</span> <span class="mf">42.35</span><span class="p">,</span> <span class="mf">42.8</span> <span class="p">,</span> <span class="mf">43.25</span><span class="p">,</span> <span class="mf">43.7</span> <span class="p">,</span> <span class="mf">44.15</span><span class="p">,</span> <span class="mf">44.6</span> <span class="p">,</span> <span class="mf">45.05</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="mf">45.5</span> <span class="p">,</span> <span class="mf">45.95</span><span class="p">,</span> <span class="mf">46.4</span> <span class="p">,</span> <span class="mf">46.85</span><span class="p">,</span> <span class="mf">47.3</span> <span class="p">,</span> <span class="mf">47.75</span><span class="p">,</span> <span class="mf">48.2</span> <span class="p">,</span> <span class="mf">48.65</span><span class="p">,</span> <span class="mf">49.1</span> <span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="mf">49.55</span><span class="p">,</span> <span class="mf">50.</span>  <span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [11]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">len</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[11]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mi">101</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [12]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 这是间隔的计数</span>
</span></span><span class="line"><span class="cl"><span class="n">hist</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[12]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">array</span><span class="p">([</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="mi">5</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="mi">19</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="mi">5</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="mi">1</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [13]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">len</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[13]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mi">100</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="对bin_edges的解释为什么是101个比hist计数多1个">对bin_edges的解释，为什么是101个？比hist计数多1个？</h4>
<p>举例：如果bins是[1, 2, 3, 4]，那么会分成3个区间：[1, 2)、[2, 3)、[3, 4]；
其中bins的第一个值是数组的最小值，bins的最后一个元素是数组的最大值</p>
<p>In [14]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 注意观察，min是bins的第一个值，max是bins的最后一个元素</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;MEDV&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[14]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">count</span>    <span class="mf">506.000000</span>
</span></span><span class="line"><span class="cl"><span class="n">mean</span>      <span class="mf">22.532806</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span>        <span class="mf">9.197104</span>
</span></span><span class="line"><span class="cl"><span class="nb">min</span>        <span class="mf">5.000000</span>
</span></span><span class="line"><span class="cl"><span class="mi">25</span><span class="o">%</span>       <span class="mf">17.025000</span>
</span></span><span class="line"><span class="cl"><span class="mi">50</span><span class="o">%</span>       <span class="mf">21.200000</span>
</span></span><span class="line"><span class="cl"><span class="mi">75</span><span class="o">%</span>       <span class="mf">25.000000</span>
</span></span><span class="line"><span class="cl"><span class="nb">max</span>       <span class="mf">50.000000</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">MEDV</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [15]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 查看bins每一个值和前一个值的差值，可以看到这是等分的数据
</span></span><span class="line"><span class="cl">np.diff(bin_edges)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[15]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">array</span><span class="p">([</span><span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="mf">0.45</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [16]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 这些间隔的数目，刚好等于计数hist的数目</span>
</span></span><span class="line"><span class="cl"><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[16]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mi">100</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [17]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># pyecharts的直方图使用bar实现</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 取bins[:-1]，意思是用每个区间的左边元素作为x轴的值</span>
</span></span><span class="line"><span class="cl"><span class="n">bar</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">Bar</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">add_xaxis</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s2">&#34;价格分布&#34;</span><span class="p">,</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">hist</span><span class="p">],</span> <span class="n">category_gap</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">set_global_opts</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">title_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TitleOpts</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&#34;波斯顿房价-价格分布-直方图&#34;</span><span class="p">,</span> <span class="n">pos_left</span><span class="o">=</span><span class="s2">&#34;center&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">legend_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LegendOpts</span><span class="p">(</span><span class="n">is_show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [18]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">bar</span><span class="o">.</span><span class="n">render_notebook</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="42python处理excel一列变多列">42、Python处理Excel一列变多列</h1>
<h3 id="1-读取数据-1">1. 读取数据</h3>
<p>In [1]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [2]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&#34;./course_datas/c42_split_onecolumn_tomany/学生数据表.xlsx&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [3]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[3]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">学号</th>
<th style="text-align:right">数据</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">S001</td>
<td style="text-align:right">怠涵:女:23:山东</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">S002</td>
<td style="text-align:right">婉清:女:25:河南</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">S003</td>
<td style="text-align:right">溪榕:女:23:湖北</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">S004</td>
<td style="text-align:right">漠涓:女:19:陕西</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">S005</td>
<td style="text-align:right">祈博:女:24:山东</td>
</tr>
</tbody>
</table>
<h3 id="2-实现拆分">2. 实现拆分</h3>
<p>In [4]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">split_func</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">line</span><span class="p">[</span><span class="s2">&#34;姓名&#34;</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="s2">&#34;性别&#34;</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="s2">&#34;年龄&#34;</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="s2">&#34;城市&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="s2">&#34;数据&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">line</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">split_func</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [5]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[5]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">学号</th>
<th style="text-align:right">数据</th>
<th style="text-align:right">姓名</th>
<th style="text-align:right">性别</th>
<th style="text-align:right">年龄</th>
<th style="text-align:right">城市</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">S001</td>
<td style="text-align:right">怠涵:女:23:山东</td>
<td style="text-align:right">怠涵</td>
<td style="text-align:right">女</td>
<td style="text-align:right">23</td>
<td style="text-align:right">山东</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">S002</td>
<td style="text-align:right">婉清:女:25:河南</td>
<td style="text-align:right">婉清</td>
<td style="text-align:right">女</td>
<td style="text-align:right">25</td>
<td style="text-align:right">河南</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">S003</td>
<td style="text-align:right">溪榕:女:23:湖北</td>
<td style="text-align:right">溪榕</td>
<td style="text-align:right">女</td>
<td style="text-align:right">23</td>
<td style="text-align:right">湖北</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">S004</td>
<td style="text-align:right">漠涓:女:19:陕西</td>
<td style="text-align:right">漠涓</td>
<td style="text-align:right">女</td>
<td style="text-align:right">19</td>
<td style="text-align:right">陕西</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">S005</td>
<td style="text-align:right">祈博:女:24:山东</td>
<td style="text-align:right">祈博</td>
<td style="text-align:right">女</td>
<td style="text-align:right">24</td>
<td style="text-align:right">山东</td>
</tr>
</tbody>
</table>
<p>In [6]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&#34;数据&#34;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [7]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[7]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">学号</th>
<th style="text-align:right">姓名</th>
<th style="text-align:right">性别</th>
<th style="text-align:right">年龄</th>
<th style="text-align:right">城市</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">S001</td>
<td style="text-align:right">怠涵</td>
<td style="text-align:right">女</td>
<td style="text-align:right">23</td>
<td style="text-align:right">山东</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">S002</td>
<td style="text-align:right">婉清</td>
<td style="text-align:right">女</td>
<td style="text-align:right">25</td>
<td style="text-align:right">河南</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">S003</td>
<td style="text-align:right">溪榕</td>
<td style="text-align:right">女</td>
<td style="text-align:right">23</td>
<td style="text-align:right">湖北</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">S004</td>
<td style="text-align:right">漠涓</td>
<td style="text-align:right">女</td>
<td style="text-align:right">19</td>
<td style="text-align:right">陕西</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">S005</td>
<td style="text-align:right">祈博</td>
<td style="text-align:right">女</td>
<td style="text-align:right">24</td>
<td style="text-align:right">山东</td>
</tr>
</tbody>
</table>
<h3 id="3-输出到结果excel">3. 输出到结果Excel</h3>
<p>In [8]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s2">&#34;./course_datas/c42_split_onecolumn_tomany/学生数据表_拆分后.xlsx&#34;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="43pandas查询数据的简便方法dfquery">43、Pandas查询数据的简便方法df.query</h1>
<p>怎样进行复杂组合条件对数据查询：</p>
<ul>
<li>方式1. 使用df[(df[&ldquo;a&rdquo;] &gt; 3) &amp; (df[&ldquo;b&rdquo;]&lt;5)]的方式；</li>
<li>方式2. 使用df.query(&ldquo;a&gt;3 &amp; b&lt;5&rdquo;)的方式；</li>
</ul>
<p>方法2的语法更加简洁</p>
<p>性能对比：</p>
<ul>
<li>当数据量小时，方法1更快；</li>
<li>当数据量大时，因为方法2直接用C语言实现，节省方法1临时数组的多次复制，方法2更快；</li>
</ul>
<p>In [1]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mf">1.0.1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="0读取数据">0、读取数据</h3>
<p>数据为北京2018年全年天气预报</p>
<p>In [2]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&#34;./datas/beijing_tianqi/beijing_tianqi_2018.csv&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [3]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[3]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2018-01-01</td>
<td style="text-align:right">3℃</td>
<td style="text-align:right">-6℃</td>
<td style="text-align:right">晴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">59</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01-02</td>
<td style="text-align:right">2℃</td>
<td style="text-align:right">-5℃</td>
<td style="text-align:right">阴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">49</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2018-01-03</td>
<td style="text-align:right">2℃</td>
<td style="text-align:right">-5℃</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">28</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">2018-01-04</td>
<td style="text-align:right">0℃</td>
<td style="text-align:right">-8℃</td>
<td style="text-align:right">阴</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">28</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">2018-01-05</td>
<td style="text-align:right">3℃</td>
<td style="text-align:right">-6℃</td>
<td style="text-align:right">多云~晴</td>
<td style="text-align:right">西北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">50</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<p>In [4]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 替换掉温度的后缀℃</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&#34;bWendu&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;℃&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&#34;yWendu&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;yWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;℃&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="1使用dataframe条件表达式查询">1、使用dataframe条件表达式查询</h3>
<h4 id="最低温度低于-10度的列表">最低温度低于-10度的列表</h4>
<p>In [5]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;yWendu&#34;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[5]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">22</td>
<td style="text-align:right">2018-01-23</td>
<td style="text-align:right">-4</td>
<td style="text-align:right">-12</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">西北风</td>
<td style="text-align:right">3-4级</td>
<td style="text-align:right">31</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">23</td>
<td style="text-align:right">2018-01-24</td>
<td style="text-align:right">-4</td>
<td style="text-align:right">-11</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">西南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">34</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">24</td>
<td style="text-align:right">2018-01-25</td>
<td style="text-align:right">-3</td>
<td style="text-align:right">-11</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">27</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">359</td>
<td style="text-align:right">2018-12-26</td>
<td style="text-align:right">-2</td>
<td style="text-align:right">-11</td>
<td style="text-align:right">晴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">2级</td>
<td style="text-align:right">26</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">360</td>
<td style="text-align:right">2018-12-27</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">-12</td>
<td style="text-align:right">多云~晴</td>
<td style="text-align:right">西北风</td>
<td style="text-align:right">3级</td>
<td style="text-align:right">48</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<h4 id="复杂条件查询">复杂条件查询</h4>
<p>注意，组合条件用&amp;符号合并，每个条件判断都得带括号</p>
<p>In [6]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">## 查询最高温度小于30度，并且最低温度大于15度，并且是晴天，并且天气为优的数据</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">30</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;yWendu&#34;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">15</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;tianqi&#34;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;晴&#39;</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;aqiLevel&#34;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[6]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">235</td>
<td style="text-align:right">2018-08-24</td>
<td style="text-align:right">30</td>
<td style="text-align:right">20</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">40</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">249</td>
<td style="text-align:right">2018-09-07</td>
<td style="text-align:right">27</td>
<td style="text-align:right">16</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">西北风</td>
<td style="text-align:right">3-4级</td>
<td style="text-align:right">22</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<h3 id="2使用dfquery可以简化查询">2、使用df.query可以简化查询</h3>
<p>形式：DataFrame.query(expr, inplace=False, **kwargs)</p>
<p>其中expr为要返回boolean结果的字符串表达式</p>
<p>形如：</p>
<ul>
<li>df.query(&lsquo;a&lt;100&rsquo;)</li>
<li>df.query(&lsquo;a &lt; b &amp; b &lt; c&rsquo;)，或者df.query(&rsquo;(a&lt;b)&amp;(b&lt;c)&rsquo;)</li>
</ul>
<p>df.query可支持的表达式语法：</p>
<ul>
<li>逻辑操作符: &amp;, |, ~</li>
<li>比较操作符: &lt;, &lt;=, ==, !=, &gt;=, &gt;</li>
<li>单变量操作符: -</li>
<li>多变量操作符: +, -, *, /, %</li>
</ul>
<p>df.query中可以使用@var的方式传入外部变量</p>
<p>df.query支持的语法来自NumExpr，地址：
<a href="https://numexpr.readthedocs.io/projects/NumExpr3/en/latest/index.html">https://numexpr.readthedocs.io/projects/NumExpr3/en/latest/index.html</a></p>
<h4 id="查询最低温度低于-10度的列表">查询最低温度低于-10度的列表</h4>
<p>In [7]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;yWendu &lt; 3&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[7]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2018-01-01</td>
<td style="text-align:right">3</td>
<td style="text-align:right">-6</td>
<td style="text-align:right">晴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">59</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01-02</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">阴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">49</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2018-01-03</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">28</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<h4 id="查询最高温度小于30度并且最低温度大于15度并且是晴天并且天气为优的数据">查询最高温度小于30度，并且最低温度大于15度，并且是晴天，并且天气为优的数据</h4>
<p>In [8]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">## 查询最高温度小于30度，并且最低温度大于15度，并且是晴天，并且天气为优的数据</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;bWendu&lt;=30 &amp; yWendu&gt;=15 &amp; tianqi==&#39;晴&#39; &amp; aqiLevel==1&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[8]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">235</td>
<td style="text-align:right">2018-08-24</td>
<td style="text-align:right">30</td>
<td style="text-align:right">20</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">40</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">249</td>
<td style="text-align:right">2018-09-07</td>
<td style="text-align:right">27</td>
<td style="text-align:right">16</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">西北风</td>
<td style="text-align:right">3-4级</td>
<td style="text-align:right">22</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<h4 id="查询温差大于15度的日子">查询温差大于15度的日子</h4>
<p>In [9]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;bWendu-yWendu &gt;= 15&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[9]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">68</td>
<td style="text-align:right">2018-03-10</td>
<td style="text-align:right">14</td>
<td style="text-align:right">-2</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">东南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">171</td>
<td style="text-align:right">中度污染</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td style="text-align:right">82</td>
<td style="text-align:right">2018-03-24</td>
<td style="text-align:right">22</td>
<td style="text-align:right">5</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">西南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">119</td>
<td style="text-align:right">轻度污染</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">83</td>
<td style="text-align:right">2018-03-25</td>
<td style="text-align:right">24</td>
<td style="text-align:right">7</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">78</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">84</td>
<td style="text-align:right">2018-03-26</td>
<td style="text-align:right">25</td>
<td style="text-align:right">7</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">西南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">151</td>
<td style="text-align:right">中度污染</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td style="text-align:right">85</td>
<td style="text-align:right">2018-03-27</td>
<td style="text-align:right">27</td>
<td style="text-align:right">11</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">243</td>
<td style="text-align:right">重度污染</td>
<td style="text-align:right">5</td>
</tr>
</tbody>
</table>
<h4 id="可以使用外部的变量">可以使用外部的变量</h4>
<p>In [10]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 查询温度在这两个温度之间的数据</span>
</span></span><span class="line"><span class="cl"><span class="n">high_temperature</span> <span class="o">=</span> <span class="mi">15</span>
</span></span><span class="line"><span class="cl"><span class="n">low_temperature</span> <span class="o">=</span> <span class="mi">13</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [11]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;yWendu&lt;=@high_temperature &amp; yWendu&gt;=@low_temperature&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[11]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">107</td>
<td style="text-align:right">2018-04-18</td>
<td style="text-align:right">27</td>
<td style="text-align:right">14</td>
<td style="text-align:right">多云~晴</td>
<td style="text-align:right">西南风</td>
<td style="text-align:right">3-4级</td>
<td style="text-align:right">147</td>
<td style="text-align:right">轻度污染</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">108</td>
<td style="text-align:right">2018-04-19</td>
<td style="text-align:right">26</td>
<td style="text-align:right">13</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">东南风</td>
<td style="text-align:right">4-5级</td>
<td style="text-align:right">170</td>
<td style="text-align:right">中度污染</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td style="text-align:right">109</td>
<td style="text-align:right">2018-04-20</td>
<td style="text-align:right">28</td>
<td style="text-align:right">14</td>
<td style="text-align:right">多云~小雨</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">4-5级</td>
<td style="text-align:right">164</td>
<td style="text-align:right">中度污染</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td style="text-align:right">116</td>
<td style="text-align:right">2018-04-27</td>
<td style="text-align:right">25</td>
<td style="text-align:right">13</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">西南风</td>
<td style="text-align:right">3-4级</td>
<td style="text-align:right">112</td>
<td style="text-align:right">轻度污染</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">119</td>
<td style="text-align:right">2018-04-30</td>
<td style="text-align:right">24</td>
<td style="text-align:right">14</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">3-4级</td>
<td style="text-align:right">62</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
</tbody>
</table>
<h1 id="44pandas按行遍历dataframe的3种方法">44、Pandas按行遍历DataFrame的3种方法</h1>
<p>In [1]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">collections</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [2]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100000</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span> 
</span></span><span class="line"><span class="cl">    <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;ABCD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[2]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0.329292</td>
<td style="text-align:right">0.975468</td>
<td style="text-align:right">0.133584</td>
<td style="text-align:right">0.224582</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">0.535746</td>
<td style="text-align:right">0.451585</td>
<td style="text-align:right">0.713250</td>
<td style="text-align:right">0.409770</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">0.735287</td>
<td style="text-align:right">0.667472</td>
<td style="text-align:right">0.950622</td>
<td style="text-align:right">0.245938</td>
</tr>
</tbody>
</table>
<p>In [3]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[3]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">(</span><span class="mi">100000</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="1-dfiterrows">1. df.iterrows()</h3>
<h4 id="使用方式">使用方式</h4>
<p>In [4]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s2">&#34;A&#34;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&#34;B&#34;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&#34;C&#34;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&#34;D&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">break</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span> <span class="n">A</span>    <span class="mf">0.329292</span>
</span></span><span class="line"><span class="cl"><span class="n">B</span>    <span class="mf">0.975468</span>
</span></span><span class="line"><span class="cl"><span class="n">C</span>    <span class="mf">0.133584</span>
</span></span><span class="line"><span class="cl"><span class="n">D</span>    <span class="mf">0.224582</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span> <span class="mf">0.3292915092119043</span> <span class="mf">0.9754683984716609</span> <span class="mf">0.1335841433264423</span> <span class="mf">0.22458227907355865</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="时间耗费">时间耗费</h4>
<p>In [5]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%%</span><span class="n">time</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span><span class="p">[(</span><span class="n">row</span><span class="p">[</span><span class="s2">&#34;A&#34;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&#34;B&#34;</span><span class="p">])]</span> <span class="o">+=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&#34;A&#34;</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&#34;B&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">CPU</span> <span class="n">times</span><span class="p">:</span> <span class="n">user</span> <span class="mf">7.82</span> <span class="n">s</span><span class="p">,</span> <span class="n">sys</span><span class="p">:</span> <span class="mf">35.6</span> <span class="n">ms</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="mf">7.85</span> <span class="n">s</span>
</span></span><span class="line"><span class="cl"><span class="n">Wall</span> <span class="n">time</span><span class="p">:</span> <span class="mf">7.89</span> <span class="n">s</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-dfitertuples">2. df.itertuples()</h3>
<h4 id="使用方式-1">使用方式</h4>
<p>In [6]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Index</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">B</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">C</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">D</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">break</span>
</span></span><span class="line"><span class="cl"><span class="n">Pandas</span><span class="p">(</span><span class="n">Index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="mf">0.3292915092119043</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mf">0.9754683984716609</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mf">0.1335841433264423</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mf">0.22458227907355865</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span> <span class="mf">0.3292915092119043</span> <span class="mf">0.9754683984716609</span> <span class="mf">0.1335841433264423</span> <span class="mf">0.22458227907355865</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="时间耗费-1">时间耗费</h4>
<p>In [7]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%%</span><span class="n">time</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span><span class="p">[(</span><span class="n">row</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">B</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">row</span><span class="o">.</span><span class="n">A</span> <span class="o">+</span> <span class="n">row</span><span class="o">.</span><span class="n">B</span>
</span></span><span class="line"><span class="cl"><span class="n">CPU</span> <span class="n">times</span><span class="p">:</span> <span class="n">user</span> <span class="mi">168</span> <span class="n">ms</span><span class="p">,</span> <span class="n">sys</span><span class="p">:</span> <span class="mf">8.35</span> <span class="n">ms</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="mi">177</span> <span class="n">ms</span>
</span></span><span class="line"><span class="cl"><span class="n">Wall</span> <span class="n">time</span><span class="p">:</span> <span class="mi">178</span> <span class="n">ms</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-forzip">3. for+zip</h3>
<h4 id="使用方式-2">使用方式</h4>
<p>In [8]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 既不需要类型检查，也不需要构建namedtuple</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 缺点是需要挨个指定变量</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;A&#34;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;B&#34;</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">break</span>
</span></span><span class="line"><span class="cl"><span class="mf">0.3292915092119043</span> <span class="mf">0.9754683984716609</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="时间耗费-2">时间耗费</h4>
<p>In [9]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%%</span><span class="n">time</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;A&#34;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;B&#34;</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span><span class="p">[(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span>
</span></span><span class="line"><span class="cl"><span class="n">CPU</span> <span class="n">times</span><span class="p">:</span> <span class="n">user</span> <span class="mf">82.2</span> <span class="n">ms</span><span class="p">,</span> <span class="n">sys</span><span class="p">:</span> <span class="mf">7.05</span> <span class="n">ms</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="mf">89.2</span> <span class="n">ms</span>
</span></span><span class="line"><span class="cl"><span class="n">Wall</span> <span class="n">time</span><span class="p">:</span> <span class="mf">89.9</span> <span class="n">ms</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="45pandas实现模糊匹配merge数据的方法">45、Pandas实现模糊匹配Merge数据的方法</h1>
<p>In [1]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="1-两份数据">1. 两份数据</h3>
<p>In [2]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 关键词数据</span>
</span></span><span class="line"><span class="cl"><span class="n">df_keyword</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;keyid&#34;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;keyword&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;numpy&#34;</span><span class="p">,</span> <span class="s2">&#34;pandas&#34;</span><span class="p">,</span> <span class="s2">&#34;matplotlib&#34;</span><span class="p">,</span> <span class="s2">&#34;sklearn&#34;</span><span class="p">,</span> <span class="s2">&#34;tensorflow&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">df_keyword</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[2]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">keyid</th>
<th style="text-align:right">keyword</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2</td>
<td style="text-align:right">matplotlib</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">3</td>
<td style="text-align:right">sklearn</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
</tr>
</tbody>
</table>
<p>In [3]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 句子数据</span>
</span></span><span class="line"><span class="cl"><span class="n">df_sentence</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;senid&#34;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">17</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;sentence&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;怎样用Pandas实现数据的Merge？&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Python之Numpy详细教程&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;怎样使用Pandas批量拆分与合并Excel文件？&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;怎样使用Pandas的map和apply函数？&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;深度学习及TensorFlow简介&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Tensorflow和Numpy的关系&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;基于sklearn的一些机器学习的代码&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">df_sentence</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[3]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">senid</th>
<th style="text-align:right">sentence</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">10</td>
<td style="text-align:right">怎样用Pandas实现数据的Merge？</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">Python之Numpy详细教程</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">12</td>
<td style="text-align:right">怎样使用Pandas批量拆分与合并Excel文件？</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">13</td>
<td style="text-align:right">怎样使用Pandas的map和apply函数？</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">14</td>
<td style="text-align:right">深度学习及TensorFlow简介</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">16</td>
<td style="text-align:right">基于sklearn的一些机器学习的代码</td>
</tr>
</tbody>
</table>
<h3 id="方法1暴力笛卡尔积--过滤">方法1：暴力笛卡尔积 + 过滤</h3>
<h4 id="新增数字完全一样的列">新增数字完全一样的列</h4>
<p>In [4]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_keyword</span><span class="p">[</span><span class="s2">&#34;match&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">df_sentence</span><span class="p">[</span><span class="s2">&#34;match&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [5]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_keyword</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[5]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">keyid</th>
<th style="text-align:right">keyword</th>
<th style="text-align:right">match</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2</td>
<td style="text-align:right">matplotlib</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">3</td>
<td style="text-align:right">sklearn</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<p>In [6]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_sentence</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[6]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">senid</th>
<th style="text-align:right">sentence</th>
<th style="text-align:right">match</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">10</td>
<td style="text-align:right">怎样用Pandas实现数据的Merge？</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">Python之Numpy详细教程</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">12</td>
<td style="text-align:right">怎样使用Pandas批量拆分与合并Excel文件？</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">13</td>
<td style="text-align:right">怎样使用Pandas的map和apply函数？</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">14</td>
<td style="text-align:right">深度学习及TensorFlow简介</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">16</td>
<td style="text-align:right">基于sklearn的一些机器学习的代码</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<h4 id="实现merge">实现merge</h4>
<p>结果行数 = A表行数 * B表行数</p>
<p>In [7]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_merge</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_keyword</span><span class="p">,</span> <span class="n">df_sentence</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_merge</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[7]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">keyid</th>
<th style="text-align:right">keyword</th>
<th style="text-align:right">match</th>
<th style="text-align:right">senid</th>
<th style="text-align:right">sentence</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
<td style="text-align:right">1</td>
<td style="text-align:right">10</td>
<td style="text-align:right">怎样用Pandas实现数据的Merge？</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">Python之Numpy详细教程</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
<td style="text-align:right">1</td>
<td style="text-align:right">12</td>
<td style="text-align:right">怎样使用Pandas批量拆分与合并Excel文件？</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
<td style="text-align:right">1</td>
<td style="text-align:right">13</td>
<td style="text-align:right">怎样使用Pandas的map和apply函数？</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
<td style="text-align:right">1</td>
<td style="text-align:right">14</td>
<td style="text-align:right">深度学习及TensorFlow简介</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
<td style="text-align:right">1</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
<td style="text-align:right">1</td>
<td style="text-align:right">16</td>
<td style="text-align:right">基于sklearn的一些机器学习的代码</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
<td style="text-align:right">10</td>
<td style="text-align:right">怎样用Pandas实现数据的Merge？</td>
</tr>
<tr>
<td style="text-align:right">8</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">Python之Numpy详细教程</td>
</tr>
<tr>
<td style="text-align:right">9</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
<td style="text-align:right">12</td>
<td style="text-align:right">怎样使用Pandas批量拆分与合并Excel文件？</td>
</tr>
<tr>
<td style="text-align:right">10</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
<td style="text-align:right">13</td>
<td style="text-align:right">怎样使用Pandas的map和apply函数？</td>
</tr>
<tr>
<td style="text-align:right">11</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
<td style="text-align:right">14</td>
<td style="text-align:right">深度学习及TensorFlow简介</td>
</tr>
<tr>
<td style="text-align:right">12</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
</tr>
<tr>
<td style="text-align:right">13</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
<td style="text-align:right">16</td>
<td style="text-align:right">基于sklearn的一些机器学习的代码</td>
</tr>
<tr>
<td style="text-align:right">14</td>
<td style="text-align:right">2</td>
<td style="text-align:right">matplotlib</td>
<td style="text-align:right">1</td>
<td style="text-align:right">10</td>
<td style="text-align:right">怎样用Pandas实现数据的Merge？</td>
</tr>
<tr>
<td style="text-align:right">15</td>
<td style="text-align:right">2</td>
<td style="text-align:right">matplotlib</td>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">Python之Numpy详细教程</td>
</tr>
<tr>
<td style="text-align:right">16</td>
<td style="text-align:right">2</td>
<td style="text-align:right">matplotlib</td>
<td style="text-align:right">1</td>
<td style="text-align:right">12</td>
<td style="text-align:right">怎样使用Pandas批量拆分与合并Excel文件？</td>
</tr>
<tr>
<td style="text-align:right">17</td>
<td style="text-align:right">2</td>
<td style="text-align:right">matplotlib</td>
<td style="text-align:right">1</td>
<td style="text-align:right">13</td>
<td style="text-align:right">怎样使用Pandas的map和apply函数？</td>
</tr>
<tr>
<td style="text-align:right">18</td>
<td style="text-align:right">2</td>
<td style="text-align:right">matplotlib</td>
<td style="text-align:right">1</td>
<td style="text-align:right">14</td>
<td style="text-align:right">深度学习及TensorFlow简介</td>
</tr>
<tr>
<td style="text-align:right">19</td>
<td style="text-align:right">2</td>
<td style="text-align:right">matplotlib</td>
<td style="text-align:right">1</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
</tr>
<tr>
<td style="text-align:right">20</td>
<td style="text-align:right">2</td>
<td style="text-align:right">matplotlib</td>
<td style="text-align:right">1</td>
<td style="text-align:right">16</td>
<td style="text-align:right">基于sklearn的一些机器学习的代码</td>
</tr>
<tr>
<td style="text-align:right">21</td>
<td style="text-align:right">3</td>
<td style="text-align:right">sklearn</td>
<td style="text-align:right">1</td>
<td style="text-align:right">10</td>
<td style="text-align:right">怎样用Pandas实现数据的Merge？</td>
</tr>
<tr>
<td style="text-align:right">22</td>
<td style="text-align:right">3</td>
<td style="text-align:right">sklearn</td>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">Python之Numpy详细教程</td>
</tr>
<tr>
<td style="text-align:right">23</td>
<td style="text-align:right">3</td>
<td style="text-align:right">sklearn</td>
<td style="text-align:right">1</td>
<td style="text-align:right">12</td>
<td style="text-align:right">怎样使用Pandas批量拆分与合并Excel文件？</td>
</tr>
<tr>
<td style="text-align:right">24</td>
<td style="text-align:right">3</td>
<td style="text-align:right">sklearn</td>
<td style="text-align:right">1</td>
<td style="text-align:right">13</td>
<td style="text-align:right">怎样使用Pandas的map和apply函数？</td>
</tr>
<tr>
<td style="text-align:right">25</td>
<td style="text-align:right">3</td>
<td style="text-align:right">sklearn</td>
<td style="text-align:right">1</td>
<td style="text-align:right">14</td>
<td style="text-align:right">深度学习及TensorFlow简介</td>
</tr>
<tr>
<td style="text-align:right">26</td>
<td style="text-align:right">3</td>
<td style="text-align:right">sklearn</td>
<td style="text-align:right">1</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
</tr>
<tr>
<td style="text-align:right">27</td>
<td style="text-align:right">3</td>
<td style="text-align:right">sklearn</td>
<td style="text-align:right">1</td>
<td style="text-align:right">16</td>
<td style="text-align:right">基于sklearn的一些机器学习的代码</td>
</tr>
<tr>
<td style="text-align:right">28</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
<td style="text-align:right">1</td>
<td style="text-align:right">10</td>
<td style="text-align:right">怎样用Pandas实现数据的Merge？</td>
</tr>
<tr>
<td style="text-align:right">29</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">Python之Numpy详细教程</td>
</tr>
<tr>
<td style="text-align:right">30</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
<td style="text-align:right">1</td>
<td style="text-align:right">12</td>
<td style="text-align:right">怎样使用Pandas批量拆分与合并Excel文件？</td>
</tr>
<tr>
<td style="text-align:right">31</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
<td style="text-align:right">1</td>
<td style="text-align:right">13</td>
<td style="text-align:right">怎样使用Pandas的map和apply函数？</td>
</tr>
<tr>
<td style="text-align:right">32</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
<td style="text-align:right">1</td>
<td style="text-align:right">14</td>
<td style="text-align:right">深度学习及TensorFlow简介</td>
</tr>
<tr>
<td style="text-align:right">33</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
<td style="text-align:right">1</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
</tr>
<tr>
<td style="text-align:right">34</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
<td style="text-align:right">1</td>
<td style="text-align:right">16</td>
<td style="text-align:right">基于sklearn的一些机器学习的代码</td>
</tr>
</tbody>
</table>
<h4 id="过滤出结果">过滤出结果</h4>
<p>In [8]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">match_func</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&#34;keyword&#34;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&#34;sentence&#34;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df_merge</span><span class="p">[</span><span class="n">df_merge</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">match_func</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[8]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">keyid</th>
<th style="text-align:right">keyword</th>
<th style="text-align:right">match</th>
<th style="text-align:right">senid</th>
<th style="text-align:right">sentence</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">Python之Numpy详细教程</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
<td style="text-align:right">1</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
<td style="text-align:right">10</td>
<td style="text-align:right">怎样用Pandas实现数据的Merge？</td>
</tr>
<tr>
<td style="text-align:right">9</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
<td style="text-align:right">12</td>
<td style="text-align:right">怎样使用Pandas批量拆分与合并Excel文件？</td>
</tr>
<tr>
<td style="text-align:right">10</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
<td style="text-align:right">13</td>
<td style="text-align:right">怎样使用Pandas的map和apply函数？</td>
</tr>
<tr>
<td style="text-align:right">27</td>
<td style="text-align:right">3</td>
<td style="text-align:right">sklearn</td>
<td style="text-align:right">1</td>
<td style="text-align:right">16</td>
<td style="text-align:right">基于sklearn的一些机器学习的代码</td>
</tr>
<tr>
<td style="text-align:right">32</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
<td style="text-align:right">1</td>
<td style="text-align:right">14</td>
<td style="text-align:right">深度学习及TensorFlow简介</td>
</tr>
<tr>
<td style="text-align:right">33</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
<td style="text-align:right">1</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
</tr>
</tbody>
</table>
<h3 id="方法2小表变字典做merge最后explode">方法2：小表变字典做merge最后explode</h3>
<h4 id="构建要join的keyindex的关系">构建要join的key:index的关系</h4>
<p>In [9]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">key_word_dict</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">row</span><span class="o">.</span><span class="n">keyword</span> <span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">keyid</span> 
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_keyword</span><span class="o">.</span><span class="n">itertuples</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">key_word_dict</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[9]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">{</span><span class="s1">&#39;numpy&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pandas&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;matplotlib&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;sklearn&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;tensorflow&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="大表搜寻小表字典">大表搜寻小表字典</h4>
<p>In [10]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge_func</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 新增一列，表示能匹配的keyids</span>
</span></span><span class="line"><span class="cl">    <span class="n">row</span><span class="p">[</span><span class="s2">&#34;keyids&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="n">keyid</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">key_word</span><span class="p">,</span> <span class="n">keyid</span> <span class="ow">in</span> <span class="n">key_word_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">key_word</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s2">&#34;sentence&#34;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">row</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df_merge</span> <span class="o">=</span> <span class="n">df_sentence</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">merge_func</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In [11]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_merge</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[11]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">senid</th>
<th style="text-align:right">sentence</th>
<th style="text-align:right">match</th>
<th style="text-align:right">keyids</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">10</td>
<td style="text-align:right">怎样用Pandas实现数据的Merge？</td>
<td style="text-align:right">1</td>
<td style="text-align:right">[1]</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">Python之Numpy详细教程</td>
<td style="text-align:right">1</td>
<td style="text-align:right">[0]</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">12</td>
<td style="text-align:right">怎样使用Pandas批量拆分与合并Excel文件？</td>
<td style="text-align:right">1</td>
<td style="text-align:right">[1]</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">13</td>
<td style="text-align:right">怎样使用Pandas的map和apply函数？</td>
<td style="text-align:right">1</td>
<td style="text-align:right">[1]</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">14</td>
<td style="text-align:right">深度学习及TensorFlow简介</td>
<td style="text-align:right">1</td>
<td style="text-align:right">[4]</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
<td style="text-align:right">1</td>
<td style="text-align:right">[0, 4]</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">16</td>
<td style="text-align:right">基于sklearn的一些机器学习的代码</td>
<td style="text-align:right">1</td>
<td style="text-align:right">[3]</td>
</tr>
</tbody>
</table>
<h4 id="展开然后做merge">展开然后做merge</h4>
<p>In [12]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_merge</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s2">&#34;keyids&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[12]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">senid</th>
<th style="text-align:right">sentence</th>
<th style="text-align:right">match</th>
<th style="text-align:right">keyids</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">10</td>
<td style="text-align:right">怎样用Pandas实现数据的Merge？</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">Python之Numpy详细教程</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">12</td>
<td style="text-align:right">怎样使用Pandas批量拆分与合并Excel文件？</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">13</td>
<td style="text-align:right">怎样使用Pandas的map和apply函数？</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">14</td>
<td style="text-align:right">深度学习及TensorFlow简介</td>
<td style="text-align:right">1</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
<td style="text-align:right">1</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">16</td>
<td style="text-align:right">基于sklearn的一些机器学习的代码</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3</td>
</tr>
</tbody>
</table>
<p>In [13]:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">left</span> <span class="o">=</span> <span class="n">df_merge</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s2">&#34;keyids&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">right</span> <span class="o">=</span> <span class="n">df_keyword</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">left_on</span> <span class="o">=</span> <span class="s2">&#34;keyids&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">right_on</span> <span class="o">=</span> <span class="s2">&#34;keyid&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_result</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out[13]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">senid</th>
<th style="text-align:right">sentence</th>
<th style="text-align:right">match_x</th>
<th style="text-align:right">keyids</th>
<th style="text-align:right">keyid</th>
<th style="text-align:right">keyword</th>
<th style="text-align:right">match_y</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">10</td>
<td style="text-align:right">怎样用Pandas实现数据的Merge？</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">12</td>
<td style="text-align:right">怎样使用Pandas批量拆分与合并Excel文件？</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">13</td>
<td style="text-align:right">怎样使用Pandas的map和apply函数？</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">11</td>
<td style="text-align:right">Python之Numpy详细教程</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">14</td>
<td style="text-align:right">深度学习及TensorFlow简介</td>
<td style="text-align:right">1</td>
<td style="text-align:right">4</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
<td style="text-align:right">1</td>
<td style="text-align:right">4</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">16</td>
<td style="text-align:right">基于sklearn的一些机器学习的代码</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3</td>
<td style="text-align:right">3</td>
<td style="text-align:right">sklearn</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">yuanshuai</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        0001-01-01
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/yuanshuai1122.github.io/tags/python/">Python</a>
          <a href="/yuanshuai1122.github.io/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/">数据分析</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="yuanshuai1122.github.io/post/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E5%9B%9B-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E5%9B%9B/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Python数据分析之Pandas（四）</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="yuanshuai1122.github.io/post/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%B8%80-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%B8%80/">
            <span class="next-text nav-default">Python数据分析之Pandas（一）</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:your@email.com" class="iconfont icon-email" title="email"></a>
      <a href="http://localhost:1313" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="http://localhost:1313" class="iconfont icon-twitter" title="twitter"></a>
      <a href="http://localhost:1313" class="iconfont icon-facebook" title="facebook"></a>
      <a href="http://localhost:1313" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="http://localhost:1313" class="iconfont icon-google" title="google"></a>
      <a href="http://localhost:1313" class="iconfont icon-github" title="github"></a>
      <a href="http://localhost:1313" class="iconfont icon-weibo" title="weibo"></a>
      <a href="http://localhost:1313" class="iconfont icon-zhihu" title="zhihu"></a>
      <a href="http://localhost:1313" class="iconfont icon-douban" title="douban"></a>
      <a href="http://localhost:1313" class="iconfont icon-pocket" title="pocket"></a>
      <a href="http://localhost:1313" class="iconfont icon-tumblr" title="tumblr"></a>
      <a href="http://localhost:1313" class="iconfont icon-instagram" title="instagram"></a>
      <a href="http://localhost:1313" class="iconfont icon-gitlab" title="gitlab"></a>
      <a href="http://localhost:1313" class="iconfont icon-bilibili" title="bilibili"></a>
  <a href="yuanshuai1122.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2017 - 
    2023<span class="heart"><i class="iconfont icon-heart"></i></span><span>yuanshuai</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.min.js" integrity="sha256-jwCP0NAdCBloaIWTWHmW4i3snUNMHUNO+jr9rYd2iOI=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.locales.min.js" integrity="sha256-ZwofwC1Lf/faQCzN7nZtfijVV6hSwxjQMwXL4gn9qU8=" crossorigin="anonymous"></script>
  <script>
    var languageCode = "zh-cn".replace(/-/g, '_').replace(/_(.*)/, function ($0, $1) {return $0.replace($1, $1.toUpperCase());});
    timeago().render(document.querySelectorAll('.timeago'), languageCode);
    timeago.cancel();  
  </script>



<script type="text/javascript" src="/yuanshuai1122.github.io/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
