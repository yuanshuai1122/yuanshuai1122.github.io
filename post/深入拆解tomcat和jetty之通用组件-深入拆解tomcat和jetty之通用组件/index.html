<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>æ·±å…¥æ‹†è§£Tomcatå’ŒJettyä¹‹é€šç”¨ç»„ä»¶ - ğŸ§€ - ä½ å¥½</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="yuanshuai" /><meta name="description" content="æœ¬ç³»åˆ—æ–‡ç« è½¬è‡ªæå®¢æ—¶é—´å¤§ä½¬æå·åŒçš„ä¸“æ ã€Šæ·±å…¥æ‹†è§£Tomcat &amp;amp; Jettyã€‹ é“¾æ¥ï¼šhttps://time.geekbang.org/colu" /><meta name="keywords" content="blog, yuanshuai, yyss" />






<meta name="generator" content="Hugo 0.119.0 with theme even" />


<link rel="canonical" href="yuanshuai1122.github.io/post/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3tomcat%E5%92%8Cjetty%E4%B9%8B%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6-%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3tomcat%E5%92%8Cjetty%E4%B9%8B%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6/" />
<link rel="apple-touch-icon" sizes="180x180" href="/yuanshuai1122.github.io/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/yuanshuai1122.github.io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/yuanshuai1122.github.io/favicon-16x16.png">
<link rel="manifest" href="/yuanshuai1122.github.io/manifest.json">
<link rel="mask-icon" href="/yuanshuai1122.github.io/safari-pinned-tab.svg" color="#5bbad5">



<link href="/yuanshuai1122.github.io/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="æ·±å…¥æ‹†è§£Tomcatå’ŒJettyä¹‹é€šç”¨ç»„ä»¶" />
<meta property="og:description" content="æœ¬ç³»åˆ—æ–‡ç« è½¬è‡ªæå®¢æ—¶é—´å¤§ä½¬æå·åŒçš„ä¸“æ ã€Šæ·±å…¥æ‹†è§£Tomcat &amp; Jettyã€‹ é“¾æ¥ï¼šhttps://time.geekbang.org/colu" />
<meta property="og:type" content="article" />
<meta property="og:url" content="yuanshuai1122.github.io/post/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3tomcat%E5%92%8Cjetty%E4%B9%8B%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6-%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3tomcat%E5%92%8Cjetty%E4%B9%8B%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6/" /><meta property="article:section" content="post" />


<meta itemprop="name" content="æ·±å…¥æ‹†è§£Tomcatå’ŒJettyä¹‹é€šç”¨ç»„ä»¶">
<meta itemprop="description" content="æœ¬ç³»åˆ—æ–‡ç« è½¬è‡ªæå®¢æ—¶é—´å¤§ä½¬æå·åŒçš„ä¸“æ ã€Šæ·±å…¥æ‹†è§£Tomcat &amp; Jettyã€‹ é“¾æ¥ï¼šhttps://time.geekbang.org/colu">

<meta itemprop="wordCount" content="12694">
<meta itemprop="keywords" content="Java,Tomcat," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="æ·±å…¥æ‹†è§£Tomcatå’ŒJettyä¹‹é€šç”¨ç»„ä»¶"/>
<meta name="twitter:description" content="æœ¬ç³»åˆ—æ–‡ç« è½¬è‡ªæå®¢æ—¶é—´å¤§ä½¬æå·åŒçš„ä¸“æ ã€Šæ·±å…¥æ‹†è§£Tomcat &amp; Jettyã€‹ é“¾æ¥ï¼šhttps://time.geekbang.org/colu"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">CNshuaiyuan</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="yuanshuai1122.github.io/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="yuanshuai1122.github.io/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="yuanshuai1122.github.io/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="yuanshuai1122.github.io/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">CNshuaiyuan</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="yuanshuai1122.github.io/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="yuanshuai1122.github.io/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="yuanshuai1122.github.io/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="yuanshuai1122.github.io/categories/">Categories</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">æ·±å…¥æ‹†è§£Tomcatå’ŒJettyä¹‹é€šç”¨ç»„ä»¶</h1>

      <div class="post-meta">
        <span class="post-time"> 0001-01-01 </span>
        
          <span class="more-meta"> çº¦ 12694 å­— </span>
          <span class="more-meta"> é¢„è®¡é˜…è¯» 26 åˆ†é’Ÿ </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#31--loggerç»„ä»¶tomcatçš„æ—¥å¿—æ¡†æ¶åŠå®æˆ˜">31 | Loggerç»„ä»¶ï¼šTomcatçš„æ—¥å¿—æ¡†æ¶åŠå®æˆ˜</a>
      <ul>
        <li><a href="#java-æ—¥å¿—ç³»ç»Ÿ">Java æ—¥å¿—ç³»ç»Ÿ</a></li>
        <li><a href="#juli">JULI</a></li>
        <li><a href="#tomcat--slf4j--logback">Tomcat + SLF4J + Logback</a></li>
        <li><a href="#æœ¬æœŸç²¾å">æœ¬æœŸç²¾å</a></li>
      </ul>
    </li>
    <li><a href="#32--managerç»„ä»¶tomcatçš„sessionç®¡ç†æœºåˆ¶è§£æ">32 | Managerç»„ä»¶ï¼šTomcatçš„Sessionç®¡ç†æœºåˆ¶è§£æ</a>
      <ul>
        <li><a href="#session-çš„åˆ›å»º">Session çš„åˆ›å»º</a></li>
        <li><a href="#session-çš„æ¸…ç†">Session çš„æ¸…ç†</a></li>
        <li><a href="#session-äº‹ä»¶é€šçŸ¥">Session äº‹ä»¶é€šçŸ¥</a></li>
        <li><a href="#æœ¬æœŸç²¾å-1">æœ¬æœŸç²¾å</a></li>
      </ul>
    </li>
    <li><a href="#33--clusterç»„ä»¶tomcatçš„é›†ç¾¤é€šä¿¡åŸç†">33 | Clusterç»„ä»¶ï¼šTomcatçš„é›†ç¾¤é€šä¿¡åŸç†</a>
      <ul>
        <li><a href="#é›†ç¾¤é€šä¿¡åŸç†">é›†ç¾¤é€šä¿¡åŸç†</a></li>
        <li><a href="#é›†ç¾¤é€šä¿¡é…ç½®">é›†ç¾¤é€šä¿¡é…ç½®</a></li>
        <li><a href="#é›†ç¾¤å·¥ä½œè¿‡ç¨‹">é›†ç¾¤å·¥ä½œè¿‡ç¨‹</a></li>
        <li><a href="#æœ¬æœŸç²¾å-2">æœ¬æœŸç²¾å</a></li>
      </ul>
    </li>
    <li><a href="#ç‰¹åˆ«æ”¾é€--å¦‚ä½•æŒç»­ä¿æŒå¯¹å­¦ä¹ çš„å…´è¶£">ç‰¹åˆ«æ”¾é€ | å¦‚ä½•æŒç»­ä¿æŒå¯¹å­¦ä¹ çš„å…´è¶£ï¼Ÿ</a></li>
  </ul>
</nav>
  </div>
</div>
  <div class="post-outdated">
    <div class="warn">
      <p>ã€æ³¨æ„ã€‘æœ€åæ›´æ–°äº <span class="timeago" datetime="0001-01-01T00:00:00" title="January 1, 0001">January 1, 0001</span>ï¼Œæ–‡ä¸­å†…å®¹å¯èƒ½å·²è¿‡æ—¶ï¼Œè¯·è°¨æ…ä½¿ç”¨ã€‚</p>
    </div>
  </div>
    <div class="post-content">
      <blockquote>
<p>æœ¬ç³»åˆ—æ–‡ç« è½¬è‡ªæå®¢æ—¶é—´å¤§ä½¬æå·åŒçš„ä¸“æ ã€Šæ·±å…¥æ‹†è§£Tomcat &amp; Jettyã€‹</p>
<p>é“¾æ¥ï¼šhttps://time.geekbang.org/column/intro/100027701</p>
<p>ä»…ä¾›è‡ªå·±å­¦ä¹ ï¼Œè”ç³»æˆ‘ï¼Œä¾µåˆ ã€‚</p>
</blockquote>
<h1 id="31--loggerç»„ä»¶tomcatçš„æ—¥å¿—æ¡†æ¶åŠå®æˆ˜">31 | Loggerç»„ä»¶ï¼šTomcatçš„æ—¥å¿—æ¡†æ¶åŠå®æˆ˜</h1>
<p>æ¯ä¸€ä¸ªç³»ç»Ÿéƒ½æœ‰ä¸€äº›é€šç”¨çš„æ¨¡å—ï¼Œæ¯”å¦‚æ—¥å¿—æ¨¡å—ã€å¼‚å¸¸å¤„ç†æ¨¡å—ã€å·¥å…·ç±»ç­‰ï¼Œå¯¹äº Tomcat æ¥è¯´ï¼Œæ¯”è¾ƒé‡è¦çš„é€šç”¨æ¨¡å—æœ‰æ—¥å¿—ã€Session ç®¡ç†å’Œé›†ç¾¤ç®¡ç†ã€‚ä»ä»Šå¤©å¼€å§‹æˆ‘ä¼šåˆ†ä¸‰æœŸæ¥ä»‹ç»é€šç”¨æ¨¡å—ï¼Œä»Šå¤©è¿™ä¸€æœŸå…ˆæ¥è®²æ—¥å¿—æ¨¡å—ã€‚</p>
<p>æ—¥å¿—æ¨¡å—ä½œä¸ºä¸€ä¸ªé€šç”¨çš„åŠŸèƒ½ï¼Œåœ¨ç³»ç»Ÿé‡Œé€šå¸¸ä¼šä½¿ç”¨ç¬¬ä¸‰æ–¹çš„æ—¥å¿—æ¡†æ¶ã€‚Java çš„æ—¥å¿—æ¡†æ¶æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼šJULï¼ˆJava Util Loggingï¼‰ã€Log4jã€Logbackã€Log4j2ã€Tinylog ç­‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ JCLï¼ˆApache Commons Loggingï¼‰å’Œ SLF4J è¿™æ ·çš„â€œé—¨é¢æ—¥å¿—â€ã€‚ä¸‹é¢æ˜¯ SLF4J ä¸æ—¥å¿—æ¡†æ¶ Logbackã€Log4j çš„å…³ç³»å›¾ï¼š</p>
<p><img src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/tomcat_jetty/69.png" alt=""></p>
<p>æˆ‘å…ˆæ¥è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯â€œé—¨é¢æ—¥å¿—â€ã€‚â€œé—¨é¢æ—¥å¿—â€åˆ©ç”¨äº†è®¾è®¡æ¨¡å¼ä¸­çš„é—¨é¢æ¨¡å¼æ€æƒ³ï¼Œå¯¹å¤–æä¾›ä¸€å¥—é€šç”¨çš„æ—¥å¿—è®°å½•çš„ APIï¼Œè€Œä¸æä¾›å…·ä½“çš„æ—¥å¿—è¾“å‡ºæœåŠ¡ï¼Œå¦‚æœè¦å®ç°æ—¥å¿—è¾“å‡ºï¼Œéœ€è¦é›†æˆå…¶ä»–çš„æ—¥å¿—æ¡†æ¶ï¼Œæ¯”å¦‚ Log4jã€Logbackã€Log4j2 ç­‰ã€‚</p>
<p>è¿™ç§é—¨é¢æ¨¡å¼çš„å¥½å¤„åœ¨äºï¼Œè®°å½•æ—¥å¿—çš„ API å’Œæ—¥å¿—è¾“å‡ºçš„æœåŠ¡åˆ†ç¦»å¼€ï¼Œä»£ç é‡Œé¢åªéœ€è¦å…³æ³¨è®°å½•æ—¥å¿—çš„ APIï¼Œé€šè¿‡ SLF4J æŒ‡å®šçš„æ¥å£è®°å½•æ—¥å¿—ï¼›è€Œæ—¥å¿—è¾“å‡ºé€šè¿‡å¼•å…¥ JAR åŒ…çš„æ–¹å¼å³å¯æŒ‡å®šå…¶ä»–çš„æ—¥å¿—æ¡†æ¶ã€‚å½“æˆ‘ä»¬éœ€è¦æ”¹å˜ç³»ç»Ÿçš„æ—¥å¿—è¾“å‡ºæœåŠ¡æ—¶ï¼Œä¸ç”¨ä¿®æ”¹ä»£ç ï¼Œåªéœ€è¦æ”¹å˜å¼•å…¥æ—¥å¿—è¾“å‡ºæ¡†æ¶ JAR åŒ…ã€‚</p>
<p>ä»Šå¤©æˆ‘ä»¬å°±æ¥çœ‹çœ‹ Tomcat çš„æ—¥å¿—æ¨¡å—æ˜¯å¦‚ä½•å®ç°çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒTomcat ä½¿ç”¨è‡ªèº«çš„ JULI ä½œä¸º Tomcat å†…éƒ¨çš„æ—¥å¿—å¤„ç†ç³»ç»Ÿã€‚JULI çš„æ—¥å¿—é—¨é¢é‡‡ç”¨äº† JCLï¼›è€Œ JULI çš„å…·ä½“å®ç°æ˜¯æ„å»ºåœ¨ Java åŸç”Ÿçš„æ—¥å¿—ç³»ç»Ÿ<code>java.util.logging</code>ä¹‹ä¸Šçš„ï¼Œæ‰€ä»¥åœ¨çœ‹ JULI çš„æ—¥å¿—ç³»ç»Ÿä¹‹å‰ï¼Œæˆ‘å…ˆç®€å•ä»‹ç»ä¸€ä¸‹ Java çš„æ—¥å¿—ç³»ç»Ÿã€‚</p>
<h2 id="java-æ—¥å¿—ç³»ç»Ÿ">Java æ—¥å¿—ç³»ç»Ÿ</h2>
<p>Java çš„æ—¥å¿—åŒ…åœ¨<code>java.util.logging</code>è·¯å¾„ä¸‹ï¼ŒåŒ…å«äº†å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„ç»„ä»¶ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€å¼ å›¾æ¥ç†è§£ä¸€ä¸‹ï¼š</p>
<p><img src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/tomcat_jetty/70.png" alt=""></p>
<p>ä»å›¾ä¸Šæˆ‘ä»¬çœ‹åˆ°è¿™æ ·å‡ ä¸ªé‡è¦çš„ç»„ä»¶ï¼š</p>
<ul>
<li>Loggerï¼šç”¨æ¥è®°å½•æ—¥å¿—çš„ç±»ã€‚</li>
<li>Handlerï¼šè§„å®šäº†æ—¥å¿—çš„è¾“å‡ºæ–¹å¼ï¼Œå¦‚æ§åˆ¶å°è¾“å‡ºã€å†™å…¥æ–‡ä»¶ã€‚</li>
<li>Levelï¼šå®šä¹‰äº†æ—¥å¿—çš„ä¸åŒç­‰çº§ã€‚</li>
<li>Formatterï¼šå°†æ—¥å¿—ä¿¡æ¯æ ¼å¼åŒ–ï¼Œæ¯”å¦‚çº¯æ–‡æœ¬ã€XMLã€‚</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£ç æ¥ä½¿ç”¨è¿™äº›ç»„ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="s">&#34;com.mycompany.myapp&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">logger</span><span class="o">.</span><span class="na">setLevel</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">FINE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">logger</span><span class="o">.</span><span class="na">setUseParentHandlers</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">Handler</span> <span class="n">hd</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConsoleHandler</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">hd</span><span class="o">.</span><span class="na">setLevel</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">FINE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">logger</span><span class="o">.</span><span class="na">addHandler</span><span class="o">(</span><span class="n">hd</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;start log&#34;</span><span class="o">);</span> 
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="juli">JULI</h2>
<p>JULI å¯¹æ—¥å¿—çš„å¤„ç†æ–¹å¼ä¸ Java è‡ªå¸¦çš„åŸºæœ¬ä¸€è‡´ï¼Œä½†æ˜¯ Tomcat ä¸­å¯ä»¥åŒ…å«å¤šä¸ªåº”ç”¨ï¼Œè€Œæ¯ä¸ªåº”ç”¨çš„æ—¥å¿—ç³»ç»Ÿåº”è¯¥ç›¸äº’ç‹¬ç«‹ã€‚Java çš„åŸç”Ÿæ—¥å¿—ç³»ç»Ÿæ˜¯æ¯ä¸ª JVM æœ‰ä¸€ä»½æ—¥å¿—çš„é…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ç¬¦åˆ Tomcat å¤šåº”ç”¨çš„åœºæ™¯ï¼Œæ‰€ä»¥ JULI é‡æ–°å®ç°äº†ä¸€äº›æ—¥å¿—æ¥å£ã€‚</p>
<p><strong>DirectJDKLog</strong></p>
<p>Log çš„åŸºç¡€å®ç°ç±»æ˜¯ DirectJDKLogï¼Œè¿™ä¸ªç±»ç›¸å¯¹ç®€å•ï¼Œå°±åŒ…è£…äº†ä¸€ä¸‹ Java çš„ Logger ç±»ã€‚ä½†æ˜¯å®ƒä¹Ÿåœ¨åŸæ¥çš„åŸºç¡€ä¸Šè¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ï¼Œæ¯”å¦‚ä¿®æ”¹é»˜è®¤çš„æ ¼å¼åŒ–æ–¹å¼ã€‚</p>
<p><strong>LogFactory</strong></p>
<p>Log ä½¿ç”¨äº†å·¥å‚æ¨¡å¼æ¥å‘å¤–æä¾›å®ä¾‹ï¼ŒLogFactory æ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œå¯ä»¥é€šè¿‡ SeviceLoader ä¸º Log æä¾›è‡ªå®šä¹‰çš„å®ç°ç‰ˆæœ¬ï¼Œå¦‚æœæ²¡æœ‰é…ç½®ï¼Œå°±é»˜è®¤ä½¿ç”¨ DirectJDKLogã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span> <span class="nf">LogFactory</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// é€šè¿‡ ServiceLoader å°è¯•åŠ è½½ Log çš„å®ç°ç±»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">ServiceLoader</span><span class="o">&lt;</span><span class="n">Log</span><span class="o">&gt;</span> <span class="n">logLoader</span> <span class="o">=</span> <span class="n">ServiceLoader</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">Log</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Constructor</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Log</span><span class="o">&gt;</span> <span class="n">m</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(</span><span class="n">Log</span> <span class="n">log</span><span class="o">:</span> <span class="n">logLoader</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Log</span><span class="o">&gt;</span> <span class="n">c</span><span class="o">=</span><span class="n">log</span><span class="o">.</span><span class="na">getClass</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">m</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="na">getConstructor</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">catch</span> <span class="o">(</span><span class="n">NoSuchMethodException</span> <span class="o">|</span> <span class="n">SecurityException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="n">Error</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// å¦‚ä½•æ²¡æœ‰å®šä¹‰ Log çš„å®ç°ç±»ï¼ŒdiscoveredLogConstructor ä¸º null
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">discoveredLogConstructor</span> <span class="o">=</span> <span class="n">m</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸‹é¢çš„ä»£ç æ˜¯ LogFactory çš„ getInstance æ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">Log</span> <span class="nf">getInstance</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">LogConfigurationException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å¦‚æœ discoveredLogConstructor ä¸º nullï¼Œä¹Ÿå°±æ²¡æœ‰å®šä¹‰ Log ç±»ï¼Œé»˜è®¤ç”¨ DirectJDKLog
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">discoveredLogConstructor</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">DirectJDKLog</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">discoveredLogConstructor</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ReflectiveOperationException</span> <span class="o">|</span> <span class="n">IllegalArgumentException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="k">new</span> <span class="n">LogConfigurationException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Handler</strong></p>
<p>åœ¨ JULI ä¸­å°±è‡ªå®šä¹‰äº†ä¸¤ä¸ª Handlerï¼šFileHandler å’Œ AsyncFileHandlerã€‚FileHandler å¯ä»¥ç®€å•åœ°ç†è§£ä¸ºä¸€ä¸ªåœ¨ç‰¹å®šä½ç½®å†™æ–‡ä»¶çš„å·¥å…·ç±»ï¼Œæœ‰ä¸€äº›å†™æ“ä½œå¸¸ç”¨çš„æ–¹æ³•ï¼Œå¦‚ openã€write(publish)ã€closeã€flush ç­‰ï¼Œä½¿ç”¨äº†è¯»å†™é”ã€‚å…¶ä¸­çš„æ—¥å¿—ä¿¡æ¯é€šè¿‡ Formatter æ¥æ ¼å¼åŒ–ã€‚</p>
<p>AsyncFileHandler ç»§æ‰¿è‡ª FileHandlerï¼Œå®ç°äº†å¼‚æ­¥çš„å†™æ“ä½œã€‚å…¶ä¸­ç¼“å­˜å­˜å‚¨æ˜¯é€šè¿‡é˜»å¡åŒç«¯é˜Ÿåˆ— LinkedBlockingDeque æ¥å®ç°çš„ã€‚å½“åº”ç”¨è¦é€šè¿‡è¿™ä¸ª Handler æ¥è®°å½•ä¸€æ¡æ¶ˆæ¯æ—¶ï¼Œæ¶ˆæ¯ä¼šå…ˆè¢«å­˜å‚¨åˆ°é˜Ÿåˆ—ä¸­ï¼Œè€Œåœ¨åå°ä¼šæœ‰ä¸€ä¸ªä¸“é—¨çš„çº¿ç¨‹æ¥å¤„ç†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œå–å‡ºçš„æ¶ˆæ¯ä¼šé€šè¿‡çˆ¶ç±»çš„ publish æ–¹æ³•å†™å…¥ç›¸åº”æ–‡ä»¶å†…ã€‚è¿™æ ·å°±å¯ä»¥åœ¨å¤§é‡æ—¥å¿—éœ€è¦å†™å…¥çš„æ—¶å€™èµ·åˆ°ç¼“å†²ä½œç”¨ï¼Œé˜²æ­¢éƒ½é˜»å¡åœ¨å†™æ—¥å¿—è¿™ä¸ªåŠ¨ä½œä¸Šã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºé˜»å¡åŒç«¯é˜Ÿåˆ—è®¾ç½®ä¸åŒçš„æ¨¡å¼ï¼Œåœ¨ä¸åŒæ¨¡å¼ä¸‹ï¼Œå¯¹æ–°è¿›å…¥çš„æ¶ˆæ¯æœ‰ä¸åŒçš„å¤„ç†æ–¹å¼ï¼Œæœ‰äº›æ¨¡å¼ä¸‹ä¼šç›´æ¥ä¸¢å¼ƒä¸€äº›æ—¥å¿—ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">OVERFLOW_DROP_LAST</span><span class="err">ï¼š</span><span class="n">ä¸¢å¼ƒæ ˆé¡¶çš„å…ƒç´ </span> 
</span></span><span class="line"><span class="cl"><span class="n">OVERFLOW_DROP_FIRSH</span><span class="err">ï¼š</span><span class="n">ä¸¢å¼ƒæ ˆåº•çš„å…ƒç´ </span> 
</span></span><span class="line"><span class="cl"><span class="n">OVERFLOW_DROP_FLUSH</span><span class="err">ï¼š</span><span class="n">ç­‰å¾…ä¸€å®šæ—¶é—´å¹¶é‡è¯•</span><span class="err">ï¼Œ</span><span class="n">ä¸ä¼šä¸¢å¤±å…ƒç´ </span> 
</span></span><span class="line"><span class="cl"><span class="n">OVERFLOW_DROP_CURRENT</span><span class="err">ï¼š</span><span class="n">ä¸¢å¼ƒæ”¾å…¥çš„å…ƒç´ </span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Formatter</strong></p>
<p>Formatter é€šè¿‡ä¸€ä¸ª format æ–¹æ³•å°†æ—¥å¿—è®°å½• LogRecord è½¬åŒ–æˆæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ï¼ŒJULI æä¾›äº†ä¸‰ä¸ªæ–°çš„ Formatterã€‚</p>
<ul>
<li>OnlineFormatterï¼šåŸºæœ¬ä¸ Java è‡ªå¸¦çš„ SimpleFormatter æ ¼å¼ç›¸åŒï¼Œä¸è¿‡æŠŠæ‰€æœ‰å†…å®¹éƒ½å†™åˆ°äº†ä¸€è¡Œä¸­ã€‚</li>
<li>VerbatimFormatterï¼šåªè®°å½•äº†æ—¥å¿—ä¿¡æ¯ï¼Œæ²¡æœ‰ä»»ä½•é¢å¤–çš„ä¿¡æ¯ã€‚</li>
<li>JdkLoggerFormatterï¼šæ ¼å¼åŒ–äº†ä¸€ä¸ªè½»é‡çº§çš„æ—¥å¿—ä¿¡æ¯ã€‚</li>
</ul>
<p><strong>æ—¥å¿—é…ç½®</strong></p>
<p>Tomcat çš„æ—¥å¿—é…ç½®æ–‡ä»¶ä¸º Tomcat æ–‡ä»¶å¤¹ä¸‹<code>conf/logging.properties</code>ã€‚æˆ‘æ¥æ‹†è§£ä¸€ä¸‹è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œé¦–å…ˆå¯ä»¥çœ‹åˆ°å„ç§ Handler çš„é…ç½®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">handlers</span> <span class="o">=</span> <span class="mi">1</span><span class="n">catalina</span><span class="o">.</span><span class="na">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">juli</span><span class="o">.</span><span class="na">AsyncFileHandler</span><span class="o">,</span> <span class="mi">2l</span><span class="n">ocalhost</span><span class="o">.</span><span class="na">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">juli</span><span class="o">.</span><span class="na">AsyncFileHandler</span><span class="o">,</span> <span class="mi">3</span><span class="n">manager</span><span class="o">.</span><span class="na">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">juli</span><span class="o">.</span><span class="na">AsyncFileHandler</span><span class="o">,</span> <span class="mi">4</span><span class="n">host</span><span class="o">-</span><span class="n">manager</span><span class="o">.</span><span class="na">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">juli</span><span class="o">.</span><span class="na">AsyncFileHandler</span><span class="o">,</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">logging</span><span class="o">.</span><span class="na">ConsoleHandler</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="na">handlers</span> <span class="o">=</span> <span class="mi">1</span><span class="n">catalina</span><span class="o">.</span><span class="na">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">juli</span><span class="o">.</span><span class="na">AsyncFileHandler</span><span class="o">,</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">logging</span><span class="o">.</span><span class="na">ConsoleHandler</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»¥<code>1catalina.org.apache.juli.AsyncFileHandler</code>ä¸ºä¾‹ï¼Œæ•°å­—æ˜¯ä¸ºäº†åŒºåˆ†åŒä¸€ä¸ªç±»çš„ä¸åŒå®ä¾‹ï¼›catalinaã€localhostã€manager å’Œ host-manager æ˜¯ Tomcat ç”¨æ¥åŒºåˆ†ä¸åŒç³»ç»Ÿæ—¥å¿—çš„æ ‡å¿—ï¼›åé¢çš„å­—ç¬¦ä¸²è¡¨ç¤ºäº† Handler å…·ä½“ç±»å‹ï¼Œå¦‚æœè¦æ·»åŠ  Tomcat æœåŠ¡å™¨çš„è‡ªå®šä¹‰ Handlerï¼Œéœ€è¦åœ¨å­—ç¬¦ä¸²é‡Œæ·»åŠ ã€‚</p>
<p>æ¥ä¸‹æ¥æ˜¯æ¯ä¸ª Handler è®¾ç½®æ—¥å¿—ç­‰çº§ã€ç›®å½•å’Œæ–‡ä»¶å‰ç¼€ï¼Œè‡ªå®šä¹‰çš„ Handler ä¹Ÿè¦åœ¨è¿™é‡Œé…ç½®è¯¦ç»†ä¿¡æ¯:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="mi">1</span><span class="n">catalina</span><span class="o">.</span><span class="na">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">juli</span><span class="o">.</span><span class="na">AsyncFileHandler</span><span class="o">.</span><span class="na">level</span> <span class="o">=</span> <span class="n">FINE</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span><span class="n">catalina</span><span class="o">.</span><span class="na">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">juli</span><span class="o">.</span><span class="na">AsyncFileHandler</span><span class="o">.</span><span class="na">directory</span> <span class="o">=</span> <span class="n">$</span><span class="o">{</span><span class="n">catalina</span><span class="o">.</span><span class="na">base</span><span class="o">}/</span><span class="n">logs</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span><span class="n">catalina</span><span class="o">.</span><span class="na">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">juli</span><span class="o">.</span><span class="na">AsyncFileHandler</span><span class="o">.</span><span class="na">prefix</span> <span class="o">=</span> <span class="n">catalina</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span><span class="n">catalina</span><span class="o">.</span><span class="na">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">juli</span><span class="o">.</span><span class="na">AsyncFileHandler</span><span class="o">.</span><span class="na">maxDays</span> <span class="o">=</span> <span class="mi">90</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span><span class="n">catalina</span><span class="o">.</span><span class="na">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">juli</span><span class="o">.</span><span class="na">AsyncFileHandler</span><span class="o">.</span><span class="na">encoding</span> <span class="o">=</span> <span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="tomcat--slf4j--logback">Tomcat + SLF4J + Logback</h2>
<p>åœ¨ä»Šå¤©æ–‡ç« å¼€å¤´æˆ‘æåˆ°ï¼ŒSLF4J å’Œ JCL éƒ½æ˜¯æ—¥å¿—é—¨é¢ï¼Œé‚£å®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿå®ƒä»¬çš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨æ—¥å¿—æœåŠ¡ç±»çš„ç»‘å®šæœºåˆ¶ä¸Šã€‚JCL é‡‡ç”¨è¿è¡Œæ—¶åŠ¨æ€ç»‘å®šçš„æœºåˆ¶ï¼Œåœ¨è¿è¡Œæ—¶åŠ¨æ€å¯»æ‰¾å’ŒåŠ è½½æ—¥å¿—æ¡†æ¶å®ç°ã€‚</p>
<p>SLF4J æ—¥å¿—è¾“å‡ºæœåŠ¡ç»‘å®šåˆ™ç›¸å¯¹ç®€å•å¾ˆå¤šï¼Œåœ¨ç¼–è¯‘æ—¶å°±é™æ€ç»‘å®šæ—¥å¿—æ¡†æ¶ï¼Œåªéœ€è¦æå‰å¼•å…¥éœ€è¦çš„æ—¥å¿—æ¡†æ¶ã€‚å¦å¤– Logback å¯ä»¥è¯´ Log4j çš„è¿›åŒ–ç‰ˆï¼Œåœ¨æ€§èƒ½å’Œå¯ç”¨æ€§æ–¹é¢éƒ½æœ‰æ‰€æå‡ã€‚ä½ å¯ä»¥å‚è€ƒå®˜ç½‘ä¸Šè¿™ç¯‡<a href="https://logback.qos.ch/reasonsToSwitch.html">æ–‡ç« </a>æ¥äº†è§£ Logback çš„ä¼˜åŠ¿ã€‚</p>
<p>åŸºäºæ­¤æˆ‘ä»¬æ¥å®æˆ˜ä¸€ä¸‹å¦‚ä½•å°† Tomcat é»˜è®¤çš„æ—¥å¿—æ¡†æ¶åˆ‡æ¢æˆä¸ºâ€œSLF4J + Logbackâ€ã€‚å…·ä½“çš„æ­¥éª¤æ˜¯ï¼š</p>
<ol>
<li>æ ¹æ®ä½ çš„ Tomcat ç‰ˆæœ¬ï¼Œä»<a href="https://github.com/tomcat-slf4j-logback/tomcat-slf4j-logback/releases">è¿™é‡Œ</a>ä¸‹è½½æ‰€éœ€è¦æ–‡ä»¶ã€‚è§£å‹åä½ ä¼šçœ‹åˆ°ä¸€ä¸ªç±»ä¼¼äº Tomcat ç›®å½•ç»“æ„çš„æ–‡ä»¶å¤¹ã€‚</li>
<li>æ›¿æ¢æˆ–æ‹·è´ä¸‹åˆ—è¿™äº›æ–‡ä»¶åˆ° Tomcat çš„å®‰è£…ç›®å½•ï¼š</li>
</ol>
<p><img src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/tomcat_jetty/71.jpg" alt=""></p>
<ol start="3">
<li>åˆ é™¤<code>&lt;Tomcat&gt;/conf/logging.properties</code></li>
<li>å¯åŠ¨ Tomcat</li>
</ol>
<h2 id="æœ¬æœŸç²¾å">æœ¬æœŸç²¾å</h2>
<p>ä»Šå¤©æˆ‘ä»¬è°ˆäº†æ—¥å¿—æ¡†æ¶ä¸æ—¥å¿—é—¨é¢çš„åŒºåˆ«ï¼Œä»¥åŠ Tomcat çš„æ—¥å¿—æ¨¡å—æ˜¯å¦‚ä½•å®ç°çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒTomcat çš„æ—¥å¿—æ¨¡æ¿å«ä½œ JULIï¼ŒJULI çš„æ—¥å¿—é—¨é¢é‡‡ç”¨äº† JCLï¼Œè€Œå…·ä½“å®ç°æ˜¯åŸºäº Java é»˜è®¤çš„æ—¥å¿—æ¡†æ¶ Java Util Loggingï¼ŒTomcat åœ¨ Java Util Logging åŸºç¡€ä¸Šè¿›è¡Œäº†æ”¹é€ ï¼Œä½¿å¾—å®ƒè‡ªèº«çš„æ—¥å¿—æ¡†æ¶ä¸ä¼šå½±å“ Web åº”ç”¨ï¼Œå¹¶ä¸”å¯ä»¥åˆ†æ¨¡æ¿é…ç½®æ—¥å¿—çš„è¾“å‡ºæ–‡ä»¶å’Œæ ¼å¼ã€‚æœ€åæˆ‘åˆ†äº«äº†å¦‚ä½•å°† Tomcat çš„æ—¥å¿—æ¨¡å—åˆ‡æ¢åˆ°æ—¶ä¸‹æµè¡Œçš„â€œSLF4J + Logbackâ€ï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚</p>
<h1 id="32--managerç»„ä»¶tomcatçš„sessionç®¡ç†æœºåˆ¶è§£æ">32 | Managerç»„ä»¶ï¼šTomcatçš„Sessionç®¡ç†æœºåˆ¶è§£æ</h1>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ Request å¯¹è±¡çš„ getSession æ–¹æ³•æ¥è·å– Sessionï¼Œå¹¶é€šè¿‡ Session å¯¹è±¡æ¥è¯»å–å’Œå†™å…¥å±æ€§å€¼ã€‚è€Œ Session çš„ç®¡ç†æ˜¯ç”± Web å®¹å™¨æ¥å®Œæˆçš„ï¼Œä¸»è¦æ˜¯å¯¹ Session çš„åˆ›å»ºå’Œé”€æ¯ï¼Œé™¤æ­¤ä¹‹å¤– Web å®¹å™¨è¿˜éœ€è¦å°† Session çŠ¶æ€çš„å˜åŒ–é€šçŸ¥ç»™ç›‘å¬è€…ã€‚</p>
<p>å½“ç„¶ Session ç®¡ç†è¿˜å¯ä»¥äº¤ç»™ Spring æ¥åšï¼Œå¥½å¤„æ˜¯ä¸ç‰¹å®šçš„ Web å®¹å™¨è§£è€¦ï¼ŒSpring Session çš„æ ¸å¿ƒåŸç†æ˜¯é€šè¿‡ Filter æ‹¦æˆª Servlet è¯·æ±‚ï¼Œå°†æ ‡å‡†çš„ ServletRequest åŒ…è£…ä¸€ä¸‹ï¼Œæ¢æˆ Spring çš„ Request å¯¹è±¡ï¼Œè¿™æ ·å½“æˆ‘ä»¬è°ƒç”¨ Request å¯¹è±¡çš„ getSession æ–¹æ³•æ—¶ï¼ŒSpring åœ¨èƒŒåä¸ºæˆ‘ä»¬åˆ›å»ºå’Œç®¡ç† Sessionã€‚</p>
<p>é‚£ä¹ˆ Tomcat çš„ Session ç®¡ç†æœºåˆ¶æˆ‘ä»¬è¿˜éœ€è¦äº†è§£å—ï¼Ÿæˆ‘è§‰å¾—è¿˜æ˜¯æœ‰å¿…è¦ï¼Œå› ä¸ºåªæœ‰äº†è§£è¿™äº›åŸç†ï¼Œæˆ‘ä»¬æ‰èƒ½æ›´å¥½çš„ç†è§£ Spring Sessionï¼Œä»¥åŠ Spring Session ä¸ºä»€ä¹ˆè®¾è®¡æˆè¿™æ ·ã€‚ä»Šå¤©æˆ‘ä»¬å°±ä» Session çš„åˆ›å»ºã€Session çš„æ¸…ç†ä»¥åŠ Session çš„äº‹ä»¶é€šçŸ¥è¿™å‡ ä¸ªæ–¹é¢æ¥äº†è§£ Tomcat çš„ Session ç®¡ç†æœºåˆ¶ã€‚</p>
<h2 id="session-çš„åˆ›å»º">Session çš„åˆ›å»º</h2>
<p>Tomcat ä¸­ä¸»è¦ç”±æ¯ä¸ª Context å®¹å™¨å†…çš„ä¸€ä¸ª Manager å¯¹è±¡æ¥ç®¡ç† Sessionã€‚é»˜è®¤å®ç°ç±»ä¸º StandardManagerã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡å®ƒçš„æ¥å£æ¥äº†è§£ä¸€ä¸‹ StandardManager çš„åŠŸèƒ½ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Manager</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Context</span> <span class="nf">getContext</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContext</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">SessionIdGenerator</span> <span class="nf">getSessionIdGenerator</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSessionIdGenerator</span><span class="o">(</span><span class="n">SessionIdGenerator</span> <span class="n">sessionIdGenerator</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getSessionCounter</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSessionCounter</span><span class="o">(</span><span class="kt">long</span> <span class="n">sessionCounter</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getMaxActive</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMaxActive</span><span class="o">(</span><span class="kt">int</span> <span class="n">maxActive</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getActiveSessions</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getExpiredSessions</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpiredSessions</span><span class="o">(</span><span class="kt">long</span> <span class="n">expiredSessions</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getRejectedSessions</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getSessionMaxAliveTime</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSessionMaxAliveTime</span><span class="o">(</span><span class="kt">int</span> <span class="n">sessionMaxAliveTime</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getSessionAverageAliveTime</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getSessionCreateRate</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getSessionExpireRate</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Session</span> <span class="n">session</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">changeSessionId</span><span class="o">(</span><span class="n">Session</span> <span class="n">session</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">changeSessionId</span><span class="o">(</span><span class="n">Session</span> <span class="n">session</span><span class="o">,</span> <span class="n">String</span> <span class="n">newId</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Session</span> <span class="nf">createEmptySession</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Session</span> <span class="nf">createSession</span><span class="o">(</span><span class="n">String</span> <span class="n">sessionId</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Session</span> <span class="nf">findSession</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Session</span><span class="o">[]</span> <span class="nf">findSessions</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">load</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ClassNotFoundException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(</span><span class="n">Session</span> <span class="n">session</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(</span><span class="n">Session</span> <span class="n">session</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">update</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addPropertyChangeListener</span><span class="o">(</span><span class="n">PropertyChangeListener</span> <span class="n">listener</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removePropertyChangeListener</span><span class="o">(</span><span class="n">PropertyChangeListener</span> <span class="n">listener</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">unload</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">backgroundProcess</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">willAttributeDistribute</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸å‡ºæ„å¤–æˆ‘ä»¬åœ¨æ¥å£ä¸­çœ‹åˆ°äº†æ·»åŠ å’Œåˆ é™¤ Session çš„æ–¹æ³•ï¼›å¦å¤–è¿˜æœ‰ load å’Œ unload æ–¹æ³•ï¼Œå®ƒä»¬çš„ä½œç”¨æ˜¯åˆ†åˆ«æ˜¯å°† Session æŒä¹…åŒ–åˆ°å­˜å‚¨ä»‹è´¨å’Œä»å­˜å‚¨ä»‹è´¨åŠ è½½ Sessionã€‚</p>
<p>å½“æˆ‘ä»¬è°ƒç”¨<code>HttpServletRequest.getSession(true)</code>æ—¶ï¼Œè¿™ä¸ªå‚æ•° true çš„æ„æ€æ˜¯â€œå¦‚æœå½“å‰è¯·æ±‚è¿˜æ²¡æœ‰ Sessionï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°çš„â€ã€‚é‚£ Tomcat åœ¨èƒŒåä¸ºæˆ‘ä»¬åšäº†äº›ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>HttpServletRequest æ˜¯ä¸€ä¸ªæ¥å£ï¼ŒTomcat å®ç°äº†è¿™ä¸ªæ¥å£ï¼Œå…·ä½“å®ç°ç±»æ˜¯ï¼š<code>org.apache.catalina.connector.Request</code>ã€‚</p>
<p>ä½†è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æ‹¿åˆ°çš„ Requestï¼ŒTomcat ä¸ºäº†é¿å…æŠŠä¸€äº›å®ç°ç»†èŠ‚æš´éœ²å‡ºæ¥ï¼Œè¿˜æœ‰åŸºäºå®‰å…¨ä¸Šçš„è€ƒè™‘ï¼Œå®šä¹‰äº† Request çš„åŒ…è£…ç±»ï¼Œå«ä½œ RequestFacadeï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»£ç æ¥ç†è§£ä¸€ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Request</span> <span class="kd">implements</span> <span class="n">HttpServletRequest</span> <span class="o">{}</span>
</span></span><span class="line"><span class="cl"><span class="err">î˜“</span><span class="n">å¤åˆ¶ä»£ç </span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RequestFacade</span> <span class="kd">implements</span> <span class="n">HttpServletRequest</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">protected</span> <span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">HttpSession</span> <span class="nf">getSession</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">create</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">     <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">(</span><span class="n">create</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å› æ­¤æˆ‘ä»¬æ‹¿åˆ°çš„ Request ç±»å…¶å®æ˜¯ RequestFacadeï¼ŒRequestFacade çš„ getSession æ–¹æ³•è°ƒç”¨çš„æ˜¯ Request ç±»çš„ getSession æ–¹æ³•ï¼Œæˆ‘ä»¬ç»§ç»­æ¥çœ‹ Session å…·ä½“æ˜¯å¦‚ä½•åˆ›å»ºçš„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Context</span> <span class="n">context</span> <span class="o">=</span> <span class="n">getContext</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">(</span><span class="n">context</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="n">Manager</span> <span class="n">manager</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getManager</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">(</span><span class="n">manager</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>      
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="n">session</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="na">createSession</span><span class="o">(</span><span class="n">sessionId</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">session</span><span class="o">.</span><span class="na">access</span><span class="o">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼ŒRequest å¯¹è±¡ä¸­æŒæœ‰ Context å®¹å™¨å¯¹è±¡ï¼Œè€Œ Context å®¹å™¨æŒæœ‰ Session ç®¡ç†å™¨ Managerï¼Œè¿™æ ·é€šè¿‡ Context ç»„ä»¶å°±èƒ½æ‹¿åˆ° Manager ç»„ä»¶ï¼Œæœ€åç”± Manager ç»„ä»¶æ¥åˆ›å»º Sessionã€‚</p>
<p>å› æ­¤æœ€åè¿˜æ˜¯åˆ°äº† StandardManagerï¼ŒStandardManager çš„çˆ¶ç±»å« ManagerBaseï¼Œè¿™ä¸ª createSession æ–¹æ³•å®šä¹‰åœ¨ ManagerBase ä¸­ï¼ŒStandardManager ç›´æ¥é‡ç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬æ¥çœ‹ ManagerBase çš„ createSession æ˜¯å¦‚ä½•å®ç°çš„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">Session</span> <span class="nf">createSession</span><span class="o">(</span><span class="n">String</span> <span class="n">sessionId</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// é¦–å…ˆåˆ¤æ–­ Session æ•°é‡æ˜¯ä¸æ˜¯åˆ°äº†æœ€å¤§å€¼ï¼Œæœ€å¤§ Session æ•°å¯ä»¥é€šè¿‡å‚æ•°è®¾ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">((</span><span class="n">maxActiveSessions</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">            <span class="o">(</span><span class="n">getActiveSessions</span><span class="o">()</span> <span class="o">&gt;=</span> <span class="n">maxActiveSessions</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">rejectedSessions</span><span class="o">++;</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="k">new</span> <span class="n">TooManyActiveSessionsException</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">sm</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&#34;managerBase.createSession.ise&#34;</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">                <span class="n">maxActiveSessions</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">// é‡ç”¨æˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°çš„ Session å¯¹è±¡ï¼Œè¯·æ³¨æ„åœ¨ Tomcat ä¸­å°±æ˜¯ StandardSession
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// å®ƒæ˜¯ HttpSession çš„å…·ä½“å®ç°ç±»ï¼Œè€Œ HttpSession æ˜¯ Servlet è§„èŒƒä¸­å®šä¹‰çš„æ¥å£
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">createEmptySession</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆå§‹åŒ–æ–° Session çš„å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">session</span><span class="o">.</span><span class="na">setNew</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">session</span><span class="o">.</span><span class="na">setValid</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">session</span><span class="o">.</span><span class="na">setCreationTime</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">session</span><span class="o">.</span><span class="na">setMaxInactiveInterval</span><span class="o">(</span><span class="n">getContext</span><span class="o">().</span><span class="na">getSessionTimeout</span><span class="o">()</span> <span class="o">*</span> <span class="mi">60</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">id</span> <span class="o">=</span> <span class="n">sessionId</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">id</span> <span class="o">=</span> <span class="n">generateSessionId</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">session</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">id</span><span class="o">);</span><span class="c1">// è¿™é‡Œä¼šå°† Session æ·»åŠ åˆ° ConcurrentHashMap ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">sessionCounter</span><span class="o">++;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// å°†åˆ›å»ºæ—¶é—´æ·»åŠ åˆ° LinkedList ä¸­ï¼Œå¹¶ä¸”æŠŠæœ€å…ˆæ·»åŠ çš„æ—¶é—´ç§»é™¤
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ä¸»è¦è¿˜æ˜¯æ–¹ä¾¿æ¸…ç†è¿‡æœŸ Session
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">SessionTiming</span> <span class="n">timing</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SessionTiming</span><span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">getCreationTime</span><span class="o">(),</span> <span class="mi">0</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">synchronized</span> <span class="o">(</span><span class="n">sessionCreationTiming</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">sessionCreationTiming</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">timing</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">sessionCreationTiming</span><span class="o">.</span><span class="na">poll</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">session</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ°æ­¤æˆ‘ä»¬æ˜ç™½äº† Session æ˜¯å¦‚ä½•åˆ›å»ºå‡ºæ¥çš„ï¼Œåˆ›å»ºå‡ºæ¥å Session ä¼šè¢«ä¿å­˜åˆ°ä¸€ä¸ª ConcurrentHashMap ä¸­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">protected</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Session</span><span class="o">&gt;</span> <span class="n">sessions</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯·æ³¨æ„ Session çš„å…·ä½“å®ç°ç±»æ˜¯ StandardSessionï¼ŒStandardSession åŒæ—¶å®ç°äº†<code>javax.servlet.http.HttpSession</code>å’Œ<code>org.apache.catalina.Session</code>æ¥å£ï¼Œå¹¶ä¸”å¯¹ç¨‹åºå‘˜æš´éœ²çš„æ˜¯ StandardSessionFacade å¤–è§‚ç±»ï¼Œä¿è¯äº† StandardSession çš„å®‰å…¨ï¼Œé¿å…äº†ç¨‹åºå‘˜è°ƒç”¨å…¶å†…éƒ¨æ–¹æ³•è¿›è¡Œä¸å½“æ“ä½œã€‚StandardSession çš„æ ¸å¿ƒæˆå‘˜å˜é‡å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StandardSession</span> <span class="kd">implements</span> <span class="n">HttpSession</span><span class="o">,</span> <span class="n">Session</span><span class="o">,</span> <span class="n">Serializable</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="n">ConcurrentMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">attributes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kt">long</span> <span class="n">creationTime</span> <span class="o">=</span> <span class="mi">0L</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kd">transient</span> <span class="kd">volatile</span> <span class="kt">boolean</span> <span class="n">expiring</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kd">transient</span> <span class="n">StandardSessionFacade</span> <span class="n">facade</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="n">String</span> <span class="n">id</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kd">volatile</span> <span class="kt">long</span> <span class="n">lastAccessedTime</span> <span class="o">=</span> <span class="n">creationTime</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kd">transient</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">SessionListener</span><span class="o">&gt;</span> <span class="n">listeners</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kd">transient</span> <span class="n">Manager</span> <span class="n">manager</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kd">volatile</span> <span class="kt">int</span> <span class="n">maxInactiveInterval</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kd">volatile</span> <span class="kt">boolean</span> <span class="n">isNew</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kd">volatile</span> <span class="kt">boolean</span> <span class="n">isValid</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kd">transient</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">notes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Hashtable</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kd">transient</span> <span class="n">Principal</span> <span class="n">principal</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="session-çš„æ¸…ç†">Session çš„æ¸…ç†</h2>
<p>æˆ‘ä»¬å†æ¥çœ‹çœ‹ Tomcat æ˜¯å¦‚ä½•æ¸…ç†è¿‡æœŸçš„ Sessionã€‚åœ¨ Tomcat<a href="https://time.geekbang.org/column/article/104423">çƒ­åŠ è½½å’Œçƒ­éƒ¨ç½²</a>çš„æ–‡ç« é‡Œï¼Œæˆ‘è®²åˆ°å®¹å™¨ç»„ä»¶ä¼šå¼€å¯ä¸€ä¸ª ContainerBackgroundProcessor åå°çº¿ç¨‹ï¼Œè°ƒç”¨è‡ªå·±ä»¥åŠå­å®¹å™¨çš„ backgroundProcess è¿›è¡Œä¸€äº›åå°é€»è¾‘çš„å¤„ç†ï¼Œå’Œ Lifecycle ä¸€æ ·ï¼Œè¿™ä¸ªåŠ¨ä½œä¹Ÿæ˜¯å…·æœ‰ä¼ é€’æ€§çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å­å®¹å™¨è¿˜ä¼šæŠŠè¿™ä¸ªåŠ¨ä½œä¼ é€’ç»™è‡ªå·±çš„å­å®¹å™¨ã€‚ä½ å¯ä»¥å‚è€ƒä¸‹å›¾æ¥ç†è§£è¿™ä¸ªè¿‡ç¨‹ã€‚</p>
<p><img src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/tomcat_jetty/72.jpg" alt=""></p>
<p>å…¶ä¸­çˆ¶å®¹å™¨ä¼šéå†æ‰€æœ‰çš„å­å®¹å™¨å¹¶è°ƒç”¨å…¶ backgroundProcess æ–¹æ³•ï¼Œè€Œ StandardContext é‡å†™äº†è¯¥æ–¹æ³•ï¼Œå®ƒä¼šè°ƒç”¨ StandardManager çš„ backgroundProcess è¿›è€Œå®Œæˆ Session çš„æ¸…ç†å·¥ä½œï¼Œä¸‹é¢æ˜¯ StandardManager çš„ backgroundProcess æ–¹æ³•çš„ä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">backgroundProcess</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// processExpiresFrequency é»˜è®¤å€¼ä¸º 6ï¼Œè€Œ backgroundProcess é»˜è®¤æ¯éš” 10s è°ƒç”¨ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯è¯´é™¤äº†ä»»åŠ¡æ‰§è¡Œçš„è€—æ—¶ï¼Œæ¯éš” 60s æ‰§è¡Œä¸€æ¬¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">count</span> <span class="o">=</span> <span class="o">(</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">%</span> <span class="n">processExpiresFrequency</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="c1">// é»˜è®¤æ¯éš” 60s æ‰§è¡Œä¸€æ¬¡ Session æ¸…ç†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">processExpires</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * å•çº¿ç¨‹å¤„ç†ï¼Œä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">processExpires</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">// è·å–æ‰€æœ‰çš„ Session
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Session</span> <span class="n">sessions</span><span class="o">[]</span> <span class="o">=</span> <span class="n">findSessions</span><span class="o">();</span>   
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">expireHere</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">sessions</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Session çš„è¿‡æœŸæ˜¯åœ¨ isValid() æ–¹æ³•é‡Œå¤„ç†çš„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">sessions</span><span class="o">[</span><span class="n">i</span><span class="o">]!=</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">sessions</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">isValid</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">expireHere</span><span class="o">++;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>backgroundProcess ç”± Tomcat åå°çº¿ç¨‹è°ƒç”¨ï¼Œé»˜è®¤æ˜¯æ¯éš” 10 ç§’è°ƒç”¨ä¸€æ¬¡ï¼Œä½†æ˜¯ Session çš„æ¸…ç†åŠ¨ä½œä¸èƒ½å¤ªé¢‘ç¹ï¼Œå› ä¸ºéœ€è¦éå† Session åˆ—è¡¨ï¼Œä¼šè€—è´¹ CPU èµ„æºï¼Œæ‰€ä»¥åœ¨ backgroundProcess æ–¹æ³•ä¸­åšäº†å–æ¨¡å¤„ç†ï¼ŒbackgroundProcess è°ƒç”¨ 6 æ¬¡ï¼Œæ‰æ‰§è¡Œä¸€æ¬¡ Session æ¸…ç†ï¼Œä¹Ÿå°±æ˜¯è¯´ Session æ¸…ç†æ¯ 60 ç§’æ‰§è¡Œä¸€æ¬¡ã€‚</p>
<h2 id="session-äº‹ä»¶é€šçŸ¥">Session äº‹ä»¶é€šçŸ¥</h2>
<p>æŒ‰ç…§ Servlet è§„èŒƒï¼Œåœ¨ Session çš„ç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹ä¸­ï¼Œè¦å°†äº‹ä»¶é€šçŸ¥ç›‘å¬è€…ï¼ŒServlet è§„èŒƒå®šä¹‰äº† Session çš„ç›‘å¬å™¨æ¥å£ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">HttpSessionListener</span> <span class="kd">extends</span> <span class="n">EventListener</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//Session åˆ›å»ºæ—¶è°ƒç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">public</span> <span class="k">default</span> <span class="kt">void</span> <span class="nf">sessionCreated</span><span class="o">(</span><span class="n">HttpSessionEvent</span> <span class="n">se</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">//Session é”€æ¯æ—¶è°ƒç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">public</span> <span class="k">default</span> <span class="kt">void</span> <span class="nf">sessionDestroyed</span><span class="o">(</span><span class="n">HttpSessionEvent</span> <span class="n">se</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„åˆ°è¿™ä¸¤ä¸ªæ–¹æ³•çš„å‚æ•°éƒ½æ˜¯ HttpSessionEventï¼Œæ‰€ä»¥ Tomcat éœ€è¦å…ˆåˆ›å»º HttpSessionEvent å¯¹è±¡ï¼Œç„¶åéå† Context å†…éƒ¨çš„ LifecycleListenerï¼Œå¹¶ä¸”åˆ¤æ–­æ˜¯å¦ä¸º HttpSessionListener å®ä¾‹ï¼Œå¦‚æœæ˜¯çš„è¯åˆ™è°ƒç”¨ HttpSessionListener çš„ sessionCreated æ–¹æ³•è¿›è¡Œäº‹ä»¶é€šçŸ¥ã€‚è¿™äº›äº‹æƒ…éƒ½æ˜¯åœ¨ Session çš„ setId æ–¹æ³•ä¸­å®Œæˆçš„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">session</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">notify</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å¦‚æœè¿™ä¸ª id å·²ç»å­˜åœ¨ï¼Œå…ˆä» Manager ä¸­åˆ é™¤
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">((</span><span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">manager</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">manager</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">// æ·»åŠ æ–°çš„ Session
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">manager</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">manager</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">// è¿™é‡Œé¢å®Œæˆäº† HttpSessionListener äº‹ä»¶é€šçŸ¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">notify</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">tellNew</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»ä»£ç æˆ‘ä»¬çœ‹åˆ° setId æ–¹æ³•è°ƒç”¨äº† tellNew æ–¹æ³•ï¼Œé‚£ tellNew åˆæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">tellNew</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">// é€šçŸ¥ org.apache.catalina.SessionListener
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">fireSessionEvent</span><span class="o">(</span><span class="n">Session</span><span class="o">.</span><span class="na">SESSION_CREATED_EVENT</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">// è·å– Context å†…éƒ¨çš„ LifecycleListener å¹¶åˆ¤æ–­æ˜¯å¦ä¸º HttpSessionListener
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Context</span> <span class="n">context</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="na">getContext</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">Object</span> <span class="n">listeners</span><span class="o">[]</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getApplicationLifecycleListeners</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">listeners</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">listeners</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">        <span class="c1">// åˆ›å»º HttpSessionEvent
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">HttpSessionEvent</span> <span class="n">event</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpSessionEvent</span><span class="o">(</span><span class="n">getSession</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">listeners</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// åˆ¤æ–­æ˜¯å¦æ˜¯ HttpSessionListener
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="o">(!(</span><span class="n">listeners</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="k">instanceof</span> <span class="n">HttpSessionListener</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">                <span class="k">continue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">            <span class="n">HttpSessionListener</span> <span class="n">listener</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpSessionListener</span><span class="o">)</span> <span class="n">listeners</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// æ³¨æ„è¿™æ˜¯å®¹å™¨å†…éƒ¨äº‹ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">context</span><span class="o">.</span><span class="na">fireContainerEvent</span><span class="o">(</span><span class="s">&#34;beforeSessionCreated&#34;</span><span class="o">,</span> <span class="n">listener</span><span class="o">);</span>   
</span></span><span class="line"><span class="cl">            <span class="c1">// è§¦å‘ Session Created äº‹ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">listener</span><span class="o">.</span><span class="na">sessionCreated</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1">// æ³¨æ„è¿™ä¹Ÿæ˜¯å®¹å™¨å†…éƒ¨äº‹ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">context</span><span class="o">.</span><span class="na">fireContainerEvent</span><span class="o">(</span><span class="s">&#34;afterSessionCreated&#34;</span><span class="o">,</span> <span class="n">listener</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢ä»£ç çš„é€»è¾‘æ˜¯ï¼Œå…ˆé€šè¿‡ StandardContext å°† HttpSessionListener ç±»å‹çš„ Listener å–å‡ºï¼Œç„¶åä¾æ¬¡è°ƒç”¨å®ƒä»¬çš„ sessionCreated æ–¹æ³•ã€‚</p>
<h2 id="æœ¬æœŸç²¾å-1">æœ¬æœŸç²¾å</h2>
<p>ä»Šå¤©æˆ‘ä»¬ä» Request è°ˆåˆ°äº† Session çš„åˆ›å»ºã€é”€æ¯å’Œäº‹ä»¶é€šçŸ¥ï¼Œé‡Œé¢æ¶‰åŠä¸å°‘ç›¸å…³çš„ç±»ï¼Œä¸‹é¢æˆ‘ç”»äº†ä¸€å¼ å›¾å¸®ä½ ç†è§£å’Œæ¶ˆåŒ–ä¸€ä¸‹è¿™äº›ç±»çš„å…³ç³»ï¼š</p>
<p><img src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/tomcat_jetty/73.jpg" alt=""></p>
<p>Servlet è§„èŒƒä¸­å®šä¹‰äº† HttpServletRequest å’Œ HttpSession æ¥å£ï¼ŒTomcat å®ç°äº†è¿™äº›æ¥å£ï¼Œä½†å…·ä½“å®ç°ç»†èŠ‚å¹¶æ²¡æœ‰æš´éœ²ç»™å¼€å‘è€…ï¼Œå› æ­¤å®šä¹‰äº†ä¸¤ä¸ªåŒ…è£…ç±»ï¼ŒRequestFacade å’Œ StandardSessionFacadeã€‚</p>
<p>Tomcat æ˜¯é€šè¿‡ Manager æ¥ç®¡ç† Session çš„ï¼Œé»˜è®¤å®ç°æ˜¯ StandardManagerã€‚StandardContext æŒæœ‰ StandardManager çš„å®ä¾‹ï¼Œå¹¶å­˜æ”¾äº† HttpSessionListener é›†åˆï¼ŒSession åœ¨åˆ›å»ºå’Œé”€æ¯æ—¶ï¼Œä¼šé€šçŸ¥ç›‘å¬å™¨ã€‚</p>
<h1 id="33--clusterç»„ä»¶tomcatçš„é›†ç¾¤é€šä¿¡åŸç†">33 | Clusterç»„ä»¶ï¼šTomcatçš„é›†ç¾¤é€šä¿¡åŸç†</h1>
<p>ä¸ºäº†æ”¯æŒæ°´å¹³æ‰©å±•å’Œé«˜å¯ç”¨ï¼ŒTomcat æä¾›äº†é›†ç¾¤éƒ¨ç½²çš„èƒ½åŠ›ï¼Œä½†ä¸æ­¤åŒæ—¶ä¹Ÿå¸¦æ¥äº†åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€ä¸ªé€šç”¨é—®é¢˜ï¼Œé‚£å°±æ˜¯å¦‚ä½•åœ¨é›†ç¾¤ä¸­çš„å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ï¼Œæ¯”å¦‚ä¼šè¯ï¼ˆSessionï¼‰ä¿¡æ¯ã€‚</p>
<p>è¦å®ç°è¿™ä¸€ç‚¹ï¼ŒåŸºæœ¬ä¸Šæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯æŠŠæ‰€æœ‰ Session æ•°æ®æ”¾åˆ°ä¸€å°æœåŠ¡å™¨æˆ–è€…ä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œé›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹é€šè¿‡è®¿é—®è¿™å° Session æœåŠ¡å™¨æ¥è·å–æ•°æ®ã€‚å¦ä¸€ç§æ–¹å¼å°±æ˜¯åœ¨é›†ç¾¤ä¸­çš„èŠ‚ç‚¹é—´è¿›è¡Œ Session æ•°æ®çš„åŒæ­¥æ‹·è´ï¼Œè¿™é‡Œåˆåˆ†ä¸ºä¸¤ç§ç­–ç•¥ï¼šç¬¬ä¸€ç§æ˜¯å°†ä¸€ä¸ªèŠ‚ç‚¹çš„ Session æ‹·è´åˆ°é›†ç¾¤ä¸­å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹ï¼›ç¬¬äºŒç§æ˜¯åªå°†ä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„ Session æ•°æ®æ‹·è´åˆ°å¦ä¸€ä¸ªå¤‡ä»½èŠ‚ç‚¹ã€‚</p>
<p>å¯¹äº Tomcat çš„ Session ç®¡ç†æ¥è¯´ï¼Œè¿™ä¸¤ç§æ–¹å¼éƒ½æ”¯æŒã€‚ä»Šå¤©æˆ‘ä»¬å°±æ¥çœ‹çœ‹ç¬¬äºŒç§æ–¹å¼çš„å®ç°åŸç†ï¼Œä¹Ÿå°±æ˜¯ Tomcat é›†ç¾¤é€šä¿¡çš„åŸç†å’Œé…ç½®æ–¹æ³•ï¼Œæœ€åé€šè¿‡å®˜ç½‘ä¸Šçš„ä¸€ä¸ªä¾‹å­æ¥äº†è§£ä¸‹ Tomcat é›†ç¾¤åˆ°åº•æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p>
<h2 id="é›†ç¾¤é€šä¿¡åŸç†">é›†ç¾¤é€šä¿¡åŸç†</h2>
<p>è¦å®ç°é›†ç¾¤é€šä¿¡ï¼Œé¦–å…ˆè¦çŸ¥é“é›†ç¾¤ä¸­éƒ½æœ‰å“ªäº›æˆå‘˜ã€‚Tomcat æ˜¯é€šè¿‡<strong>ç»„æ’­</strong>ï¼ˆMulticastï¼‰æ¥å®ç°çš„ã€‚é‚£ä»€ä¹ˆæ˜¯ç»„æ’­å‘¢ï¼Ÿä¸ºäº†ç†è§£ç»„æ’­ï¼Œæˆ‘å…ˆæ¥è¯´è¯´ä»€ä¹ˆæ˜¯â€œå•æ’­â€ã€‚ç½‘ç»œèŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡å°±å¥½åƒæ˜¯äººä»¬ä¹‹é—´çš„å¯¹è¯ä¸€æ ·ï¼Œä¸€ä¸ªäººå¯¹å¦å¤–ä¸€ä¸ªäººè¯´è¯ï¼Œæ­¤æ—¶ä¿¡æ¯çš„æ¥æ”¶å’Œä¼ é€’åªåœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œï¼Œæ¯”å¦‚ä½ åœ¨æ”¶å‘ç”µå­é‚®ä»¶ã€æµè§ˆç½‘é¡µæ—¶ï¼Œä½¿ç”¨çš„å°±æ˜¯å•æ’­ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„â€œç‚¹å¯¹ç‚¹é€šä¿¡â€ã€‚</p>
<p>å¦‚æœä¸€å°ä¸»æœºéœ€è¦å°†åŒä¸€ä¸ªæ¶ˆæ¯å‘é€å¤šä¸ªä¸»æœºé€ä¸ªä¼ è¾“ï¼Œæ•ˆç‡å°±ä¼šæ¯”è¾ƒä½ï¼Œäºæ˜¯å°±å‡ºç°ç»„æ’­æŠ€æœ¯ã€‚ç»„æ’­æ˜¯<strong>ä¸€å°ä¸»æœºå‘æŒ‡å®šçš„ä¸€ç»„ä¸»æœºå‘é€æ•°æ®æŠ¥åŒ…</strong>ï¼Œç»„æ’­é€šä¿¡çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼šæ¯ä¸€ä¸ª Tomcat èŠ‚ç‚¹åœ¨å¯åŠ¨æ—¶å’Œè¿è¡Œæ—¶éƒ½ä¼šå‘¨æœŸæ€§ï¼ˆé»˜è®¤ 500 æ¯«ç§’ï¼‰å‘é€ç»„æ’­å¿ƒè·³åŒ…ï¼ŒåŒä¸€ä¸ªé›†ç¾¤å†…çš„èŠ‚ç‚¹éƒ½åœ¨ç›¸åŒçš„<strong>ç»„æ’­åœ°å€</strong>å’Œ<strong>ç«¯å£</strong>ç›‘å¬è¿™äº›ä¿¡æ¯ï¼›åœ¨ä¸€å®šçš„æ—¶é—´å†…ï¼ˆé»˜è®¤ 3 ç§’ï¼‰ä¸å‘é€<strong>ç»„æ’­æŠ¥æ–‡</strong>çš„èŠ‚ç‚¹å°±ä¼šè¢«è®¤ä¸ºå·²ç»å´©æºƒäº†ï¼Œä¼šä»é›†ç¾¤ä¸­åˆ å»ã€‚å› æ­¤é€šè¿‡ç»„æ’­ï¼Œé›†ç¾¤ä¸­æ¯ä¸ªæˆå‘˜éƒ½èƒ½ç»´æŠ¤ä¸€ä¸ªé›†ç¾¤æˆå‘˜åˆ—è¡¨ã€‚</p>
<h2 id="é›†ç¾¤é€šä¿¡é…ç½®">é›†ç¾¤é€šä¿¡é…ç½®</h2>
<p>æœ‰äº†é›†ç¾¤æˆå‘˜çš„åˆ—è¡¨ï¼Œé›†ç¾¤ä¸­çš„èŠ‚ç‚¹å°±èƒ½é€šè¿‡ TCP è¿æ¥å‘å…¶ä»–èŠ‚ç‚¹ä¼ è¾“ Session æ•°æ®ã€‚Tomcat é€šè¿‡ SimpleTcpCluster ç±»æ¥è¿›è¡Œä¼šè¯å¤åˆ¶ï¼ˆIn-Memory Replicationï¼‰ã€‚è¦å¼€å¯é›†ç¾¤åŠŸèƒ½ï¼Œåªéœ€è¦å°†<code>server.xml</code>é‡Œçš„è¿™ä¸€è¡Œçš„æ³¨é‡Šå»æ‰å°±è¡Œï¼š</p>
<p><img src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/tomcat_jetty/74.png" alt=""></p>
<p>å˜æˆè¿™æ ·ï¼š</p>
<p><img src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/tomcat_jetty/75.png" alt=""></p>
<p>è™½ç„¶åªæ˜¯ç®€å•çš„ä¸€è¡Œé…ç½®ï¼Œä½†è¿™ä¸€è¡Œé…ç½®ç­‰åŒäºä¸‹é¢è¿™æ ·çš„é…ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´ Tomcat ç»™æˆ‘ä»¬è®¾ç½®äº†å¾ˆå¤šé»˜è®¤å‚æ•°ï¼Œè¿™äº›å‚æ•°éƒ½è·Ÿé›†ç¾¤é€šä¿¡æœ‰å…³ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!-- 
</span></span></span><span class="line"><span class="cl"><span class="c">  SimpleTcpCluster æ˜¯ç”¨æ¥å¤åˆ¶ Session çš„ç»„ä»¶ã€‚å¤åˆ¶ Session æœ‰åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ–¹å¼ï¼š
</span></span></span><span class="line"><span class="cl"><span class="c">  åŒæ­¥æ¨¡å¼ä¸‹ï¼Œå‘æµè§ˆå™¨çš„å‘é€å“åº”æ•°æ®å‰ï¼Œéœ€è¦å…ˆå°† Session æ‹·è´åˆ°å…¶ä»–èŠ‚ç‚¹å®Œï¼›
</span></span></span><span class="line"><span class="cl"><span class="c">  å¼‚æ­¥æ¨¡å¼ä¸‹ï¼Œæ— éœ€ç­‰å¾… Session æ‹·è´å®Œæˆå°±å¯å“åº”ã€‚å¼‚æ­¥æ¨¡å¼æ›´é«˜æ•ˆï¼Œä½†æ˜¯åŒæ­¥æ¨¡å¼
</span></span></span><span class="line"><span class="cl"><span class="c">  å¯é æ€§æ›´é«˜ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c">  åŒæ­¥å¼‚æ­¥æ¨¡å¼ç”± channelSendOptions å‚æ•°æ§åˆ¶ï¼Œé»˜è®¤å€¼æ˜¯ 8ï¼Œä¸ºå¼‚æ­¥æ¨¡å¼ï¼›4 æ˜¯åŒæ­¥æ¨¡å¼ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c">  åœ¨å¼‚æ­¥æ¨¡å¼ä¸‹ï¼Œå¯ä»¥é€šè¿‡åŠ ä¸Š &#34; æ‹·è´ç¡®è®¤ &#34;ï¼ˆAcknowledgeï¼‰æ¥æé«˜å¯é æ€§ï¼Œæ­¤æ—¶
</span></span></span><span class="line"><span class="cl"><span class="c">  channelSendOptions è®¾ä¸º 10
</span></span></span><span class="line"><span class="cl"><span class="c">--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;Cluster</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.ha.tcp.SimpleTcpCluster&#34;</span>
</span></span><span class="line"><span class="cl">                 <span class="na">channelSendOptions=</span><span class="s">&#34;8&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="c">&lt;!--
</span></span></span><span class="line"><span class="cl"><span class="c">    Manager å†³å®šå¦‚ä½•ç®¡ç†é›†ç¾¤çš„ Session ä¿¡æ¯ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c">    Tomcat æä¾›äº†ä¸¤ç§ Managerï¼šBackupManager å’Œ DeltaManagerã€‚
</span></span></span><span class="line"><span class="cl"><span class="c">    BackupManagerï¼é›†ç¾¤ä¸‹çš„æŸä¸€èŠ‚ç‚¹çš„ Sessionï¼Œå°†å¤åˆ¶åˆ°ä¸€ä¸ªå¤‡ä»½èŠ‚ç‚¹ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c">    DeltaManagerï¼ é›†ç¾¤ä¸‹æŸä¸€èŠ‚ç‚¹çš„ Sessionï¼Œå°†å¤åˆ¶åˆ°æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c">    DeltaManager æ˜¯ Tomcat é»˜è®¤çš„é›†ç¾¤ Managerã€‚
</span></span></span><span class="line"><span class="cl"><span class="c">    
</span></span></span><span class="line"><span class="cl"><span class="c">    expireSessionsOnShutdownï¼è®¾ç½®ä¸º true æ—¶ï¼Œä¸€ä¸ªèŠ‚ç‚¹å…³é—­æ—¶ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c">    å°†å¯¼è‡´é›†ç¾¤ä¸‹çš„æ‰€æœ‰ Session å¤±æ•ˆ
</span></span></span><span class="line"><span class="cl"><span class="c">    notifyListenersOnReplicationï¼é›†ç¾¤ä¸‹èŠ‚ç‚¹é—´çš„ Session å¤åˆ¶ã€
</span></span></span><span class="line"><span class="cl"><span class="c">    åˆ é™¤æ“ä½œï¼Œæ˜¯å¦é€šçŸ¥ session listeners
</span></span></span><span class="line"><span class="cl"><span class="c">    
</span></span></span><span class="line"><span class="cl"><span class="c">    maxInactiveIntervalï¼é›†ç¾¤ä¸‹ Session çš„æœ‰æ•ˆæ—¶é—´ (å•ä½:s)ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c">    maxInactiveInterval å†…æœªæ´»åŠ¨çš„ Sessionï¼Œå°†è¢« Tomcat å›æ”¶ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c">    é»˜è®¤å€¼ä¸º 1800(30min)
</span></span></span><span class="line"><span class="cl"><span class="c">  --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Manager</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.ha.session.DeltaManager&#34;</span>
</span></span><span class="line"><span class="cl">                   <span class="na">expireSessionsOnShutdown=</span><span class="s">&#34;false&#34;</span>
</span></span><span class="line"><span class="cl">                   <span class="na">notifyListenersOnReplication=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">   <span class="c">&lt;!--
</span></span></span><span class="line"><span class="cl"><span class="c">    Channel æ˜¯ Tomcat èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œé€šè®¯çš„å·¥å…·ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c">    Channel åŒ…æ‹¬ 5 ä¸ªç»„ä»¶ï¼šMembershipã€Receiverã€Senderã€
</span></span></span><span class="line"><span class="cl"><span class="c">    Transportã€Interceptor
</span></span></span><span class="line"><span class="cl"><span class="c">   --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Channel</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.tribes.group.GroupChannel&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">     <span class="c">&lt;!--
</span></span></span><span class="line"><span class="cl"><span class="c">      Membership ç»´æŠ¤é›†ç¾¤çš„å¯ç”¨èŠ‚ç‚¹åˆ—è¡¨ã€‚å®ƒå¯ä»¥æ£€æŸ¥åˆ°æ–°å¢çš„èŠ‚ç‚¹ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c">      ä¹Ÿå¯ä»¥æ£€æŸ¥æ²¡æœ‰å¿ƒè·³çš„èŠ‚ç‚¹
</span></span></span><span class="line"><span class="cl"><span class="c">      classNameï¼æŒ‡å®š Membership ä½¿ç”¨çš„ç±»
</span></span></span><span class="line"><span class="cl"><span class="c">      addressï¼ç»„æ’­åœ°å€
</span></span></span><span class="line"><span class="cl"><span class="c">      portï¼ç»„æ’­ç«¯å£
</span></span></span><span class="line"><span class="cl"><span class="c">      frequencyï¼å‘é€å¿ƒè·³ (å‘ç»„æ’­åœ°å€å‘é€ UDP æ•°æ®åŒ…) çš„æ—¶é—´é—´éš” (å•ä½:ms)ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c">      dropTimeï¼Membership åœ¨ dropTime(å•ä½:ms) å†…æœªæ”¶åˆ°æŸä¸€èŠ‚ç‚¹çš„å¿ƒè·³ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c">      åˆ™å°†è¯¥èŠ‚ç‚¹ä»å¯ç”¨èŠ‚ç‚¹åˆ—è¡¨åˆ é™¤ã€‚é»˜è®¤å€¼ä¸º 3000ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c">     --&gt;</span>
</span></span><span class="line"><span class="cl">     <span class="nt">&lt;Membership</span>  <span class="na">className=</span><span class="s">&#34;org.apache.catalina.tribes.membership.
</span></span></span><span class="line"><span class="cl"><span class="s">         McastService&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">address=</span><span class="s">&#34;228.0.0.4&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">port=</span><span class="s">&#34;45564&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">frequency=</span><span class="s">&#34;500&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">dropTime=</span><span class="s">&#34;3000&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">     
</span></span><span class="line"><span class="cl">     <span class="c">&lt;!--
</span></span></span><span class="line"><span class="cl"><span class="c">       Receiver ç”¨äºå„ä¸ªèŠ‚ç‚¹æ¥æ”¶å…¶ä»–èŠ‚ç‚¹å‘é€çš„æ•°æ®ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c">       æ¥æ”¶å™¨åˆ†ä¸ºä¸¤ç§ï¼šBioReceiver(é˜»å¡å¼)ã€NioReceiver(éé˜»å¡å¼)
</span></span></span><span class="line"><span class="cl"><span class="c"> 
</span></span></span><span class="line"><span class="cl"><span class="c">       classNameï¼æŒ‡å®š Receiver ä½¿ç”¨çš„ç±»
</span></span></span><span class="line"><span class="cl"><span class="c">       addressï¼æ¥æ”¶æ¶ˆæ¯çš„åœ°å€
</span></span></span><span class="line"><span class="cl"><span class="c">       portï¼æ¥æ”¶æ¶ˆæ¯çš„ç«¯å£
</span></span></span><span class="line"><span class="cl"><span class="c">       autoBindï¼ç«¯å£çš„å˜åŒ–åŒºé—´ï¼Œå¦‚æœ port ä¸º 4000ï¼ŒautoBind ä¸º 100ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c">                 æ¥æ”¶å™¨å°†åœ¨ 4000-4099 é—´å–ä¸€ä¸ªç«¯å£è¿›è¡Œç›‘å¬ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c">       selectorTimeoutï¼NioReceiver å†… Selector è½®è¯¢çš„è¶…æ—¶æ—¶é—´
</span></span></span><span class="line"><span class="cl"><span class="c">       maxThreadsï¼çº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•°
</span></span></span><span class="line"><span class="cl"><span class="c">     --&gt;</span>
</span></span><span class="line"><span class="cl">     <span class="nt">&lt;Receiver</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.tribes.transport.nio.
</span></span></span><span class="line"><span class="cl"><span class="s">         NioReceiver&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">address=</span><span class="s">&#34;auto&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">port=</span><span class="s">&#34;4000&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">autoBind=</span><span class="s">&#34;100&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">selectorTimeout=</span><span class="s">&#34;5000&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">maxThreads=</span><span class="s">&#34;6&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">      <span class="c">&lt;!--
</span></span></span><span class="line"><span class="cl"><span class="c">         Sender ç”¨äºå‘å…¶ä»–èŠ‚ç‚¹å‘é€æ•°æ®ï¼ŒSender å†…åµŒäº† Transport ç»„ä»¶ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c">         Transport çœŸæ­£è´Ÿè´£å‘é€æ¶ˆæ¯ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c">      --&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;Sender</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.tribes.transport.
</span></span></span><span class="line"><span class="cl"><span class="s">          ReplicationTransmitter&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="c">&lt;!--
</span></span></span><span class="line"><span class="cl"><span class="c">            Transport åˆ†ä¸ºä¸¤ç§ï¼šbio.PooledMultiSender(é˜»å¡å¼)
</span></span></span><span class="line"><span class="cl"><span class="c">            å’Œ nio.PooledParallelSender(éé˜»å¡å¼)ï¼ŒPooledParallelSender
</span></span></span><span class="line"><span class="cl"><span class="c">            æ˜¯ä» tcp è¿æ¥æ± ä¸­è·å–è¿æ¥ï¼Œå¯ä»¥å®ç°å¹¶è¡Œå‘é€ï¼Œå³é›†ç¾¤ä¸­çš„èŠ‚ç‚¹å¯ä»¥
</span></span></span><span class="line"><span class="cl"><span class="c">            åŒæ—¶å‘å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹å‘é€æ•°æ®è€Œäº’ä¸å½±å“ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c">           --&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;Transport</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.tribes.
</span></span></span><span class="line"><span class="cl"><span class="s">          transport.nio.PooledParallelSender&#34;</span><span class="nt">/&gt;</span>     
</span></span><span class="line"><span class="cl">       <span class="nt">&lt;/Sender&gt;</span>
</span></span><span class="line"><span class="cl">       
</span></span><span class="line"><span class="cl">       <span class="c">&lt;!--
</span></span></span><span class="line"><span class="cl"><span class="c">         Interceptor : Cluster çš„æ‹¦æˆªå™¨
</span></span></span><span class="line"><span class="cl"><span class="c">         TcpFailureDetectorï¼TcpFailureDetector å¯ä»¥æ‹¦æˆªåˆ°æŸä¸ªèŠ‚ç‚¹å…³é—­
</span></span></span><span class="line"><span class="cl"><span class="c">         çš„ä¿¡æ¯ï¼Œå¹¶å°è¯•é€šè¿‡ TCP è¿æ¥åˆ°æ­¤èŠ‚ç‚¹ï¼Œä»¥ç¡®ä¿æ­¤èŠ‚ç‚¹çœŸæ­£å…³é—­ï¼Œä»è€Œæ›´æ–°é›†
</span></span></span><span class="line"><span class="cl"><span class="c">         ç¾¤å¯ç”¨èŠ‚ç‚¹åˆ—è¡¨                 
</span></span></span><span class="line"><span class="cl"><span class="c">        --&gt;</span>
</span></span><span class="line"><span class="cl">       <span class="nt">&lt;Interceptor</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.tribes.group.
</span></span></span><span class="line"><span class="cl"><span class="s">       interceptors.TcpFailureDetector&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">       
</span></span><span class="line"><span class="cl">       <span class="c">&lt;!--
</span></span></span><span class="line"><span class="cl"><span class="c">         MessageDispatchInterceptorï¼æŸ¥çœ‹ Cluster ç»„ä»¶å‘é€æ¶ˆæ¯çš„
</span></span></span><span class="line"><span class="cl"><span class="c">         æ–¹å¼æ˜¯å¦è®¾ç½®ä¸º Channel.SEND_OPTIONS_ASYNCHRONOUSï¼Œå¦‚æœæ˜¯ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c">         MessageDispatchInterceptor å…ˆå°†ç­‰å¾…å‘é€çš„æ¶ˆæ¯è¿›è¡Œæ’é˜Ÿï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c">         ç„¶åå°†æ’å¥½é˜Ÿçš„æ¶ˆæ¯è½¬ç»™ Senderã€‚
</span></span></span><span class="line"><span class="cl"><span class="c">        --&gt;</span>
</span></span><span class="line"><span class="cl">       <span class="nt">&lt;Interceptor</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.tribes.group.
</span></span></span><span class="line"><span class="cl"><span class="s">       interceptors.MessageDispatchInterceptor&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/Channel&gt;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!--
</span></span></span><span class="line"><span class="cl"><span class="c">    Valve : Tomcat çš„æ‹¦æˆªå™¨ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c">    ReplicationValveï¼åœ¨å¤„ç†è¯·æ±‚å‰åæ‰“æ—¥å¿—ï¼›è¿‡æ»¤ä¸æ¶‰åŠ Session å˜åŒ–çš„è¯·æ±‚ã€‚                 
</span></span></span><span class="line"><span class="cl"><span class="c">    --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Valve</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.ha.tcp.ReplicationValve&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">filter=</span><span class="s">&#34;&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Valve</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.ha.session.
</span></span></span><span class="line"><span class="cl"><span class="s">  JvmRouteBinderValve&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!--
</span></span></span><span class="line"><span class="cl"><span class="c">    Deployer ç”¨äºé›†ç¾¤çš„ farm åŠŸèƒ½ï¼Œç›‘æ§åº”ç”¨ä¸­æ–‡ä»¶çš„æ›´æ–°ï¼Œä»¥ä¿è¯é›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹
</span></span></span><span class="line"><span class="cl"><span class="c">    åº”ç”¨çš„ä¸€è‡´æ€§ï¼Œå¦‚æŸä¸ªç”¨æˆ·ä¸Šä¼ æ–‡ä»¶åˆ°é›†ç¾¤ä¸­æŸä¸ªèŠ‚ç‚¹çš„åº”ç”¨ç¨‹åºç›®å½•ä¸‹ï¼ŒDeployer
</span></span></span><span class="line"><span class="cl"><span class="c">    ä¼šç›‘æµ‹åˆ°è¿™ä¸€æ“ä½œå¹¶æŠŠæ–‡ä»¶æ‹·è´åˆ°é›†ç¾¤ä¸­å…¶ä»–èŠ‚ç‚¹ç›¸åŒåº”ç”¨çš„å¯¹åº”ç›®å½•ä¸‹ä»¥ä¿æŒ
</span></span></span><span class="line"><span class="cl"><span class="c">    æ‰€æœ‰åº”ç”¨çš„ä¸€è‡´ï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å½“å¼ºå¤§çš„åŠŸèƒ½ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c">  --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Deployer</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.ha.deploy.FarmWarDeployer&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="na">tempDir=</span><span class="s">&#34;/tmp/war-temp/&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="na">deployDir=</span><span class="s">&#34;/tmp/war-deploy/&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="na">watchDir=</span><span class="s">&#34;/tmp/war-listen/&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="na">watchEnabled=</span><span class="s">&#34;false&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!--
</span></span></span><span class="line"><span class="cl"><span class="c">    ClusterListener : ç›‘å¬å™¨ï¼Œç›‘å¬ Cluster ç»„ä»¶æ¥æ”¶çš„æ¶ˆæ¯
</span></span></span><span class="line"><span class="cl"><span class="c">    ä½¿ç”¨ DeltaManager æ—¶ï¼ŒCluster æ¥æ”¶çš„ä¿¡æ¯é€šè¿‡ ClusterSessionListener
</span></span></span><span class="line"><span class="cl"><span class="c">    ä¼ é€’ç»™ DeltaManagerï¼Œä»è€Œæ›´æ–°è‡ªå·±çš„ Session åˆ—è¡¨ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c">    --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;ClusterListener</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.ha.session.
</span></span></span><span class="line"><span class="cl"><span class="s">  ClusterSessionListener&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/Cluster&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»ä¸Šé¢çš„çš„å‚æ•°åˆ—è¡¨å¯ä»¥çœ‹åˆ°ï¼Œé»˜è®¤æƒ…å†µä¸‹ Session ç®¡ç†ç»„ä»¶ DeltaManager ä¼šåœ¨èŠ‚ç‚¹ä¹‹é—´æ‹·è´ Sessionï¼ŒDeltaManager é‡‡ç”¨çš„ä¸€ç§ all-to-all çš„å·¥ä½œæ–¹å¼ï¼Œå³é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¼šæŠŠ Session æ•°æ®å‘æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹æ‹·è´ï¼Œè€Œä¸ç®¡å…¶ä»–èŠ‚ç‚¹æ˜¯å¦éƒ¨ç½²äº†å½“å‰åº”ç”¨ã€‚å½“é›†ç¾¤èŠ‚ç‚¹æ•°æ¯”è¾ƒå°‘æ—¶ï¼Œæ¯”å¦‚å°‘äº 4 ä¸ªï¼Œè¿™ç§ all-to-all çš„æ–¹å¼æ˜¯ä¸é”™çš„é€‰æ‹©ï¼›ä½†æ˜¯å½“é›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ•°é‡æ¯”è¾ƒå¤šæ—¶ï¼Œæ•°æ®æ‹·è´çš„å¼€é”€æˆæŒ‡æ•°çº§å¢é•¿ï¼Œè¿™ç§æƒ…å†µä¸‹å¯ä»¥è€ƒè™‘ BackupManagerï¼ŒBackupManager åªå‘ä¸€ä¸ªå¤‡ä»½èŠ‚ç‚¹æ‹·è´æ•°æ®ã€‚</p>
<p>åœ¨å¤§ä½“äº†è§£äº† Tomcat é›†ç¾¤å®ç°æ¨¡å‹åï¼Œå°±å¯ä»¥å¯¹é›†ç¾¤ä½œå‡ºæ›´ä¼˜åŒ–çš„é…ç½®äº†ã€‚Tomcat æ¨èäº†ä¸€å¥—é…ç½®ï¼Œä½¿ç”¨äº†æ¯” DeltaManager æ›´é«˜æ•ˆçš„ BackupManagerï¼Œå¹¶ä¸”é€šè¿‡ ReplicationValve è®¾ç½®äº†è¯·æ±‚è¿‡æ»¤ã€‚</p>
<p>è¿™é‡Œè¿˜è¯·æ³¨æ„åœ¨ä¸€å°æœåŠ¡å™¨éƒ¨ç½²å¤šä¸ªèŠ‚ç‚¹æ—¶éœ€è¦ä¿®æ”¹ Receiver çš„ä¾¦å¬ç«¯å£ï¼Œå¦å¤–ä¸ºäº†åœ¨èŠ‚ç‚¹é—´é«˜æ•ˆåœ°æ‹·è´æ•°æ®ï¼Œæ‰€æœ‰ Tomcat èŠ‚ç‚¹æœ€å¥½é‡‡ç”¨ç›¸åŒçš„é…ç½®ï¼Œå…·ä½“é…ç½®å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;Cluster</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.ha.tcp.SimpleTcpCluster&#34;</span>
</span></span><span class="line"><span class="cl">                 <span class="na">channelSendOptions=</span><span class="s">&#34;6&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;Manager</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.ha.session.BackupManager&#34;</span>
</span></span><span class="line"><span class="cl">                   <span class="na">expireSessionsOnShutdown=</span><span class="s">&#34;false&#34;</span>
</span></span><span class="line"><span class="cl">                   <span class="na">notifyListenersOnReplication=</span><span class="s">&#34;true&#34;</span>
</span></span><span class="line"><span class="cl">                   <span class="na">mapSendOptions=</span><span class="s">&#34;6&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">         
</span></span><span class="line"><span class="cl">     <span class="nt">&lt;Channel</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.tribes.group.
</span></span></span><span class="line"><span class="cl"><span class="s">     GroupChannel&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">     
</span></span><span class="line"><span class="cl">     <span class="nt">&lt;Membership</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.tribes.membership.
</span></span></span><span class="line"><span class="cl"><span class="s">     McastService&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">address=</span><span class="s">&#34;228.0.0.4&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">port=</span><span class="s">&#34;45564&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">frequency=</span><span class="s">&#34;500&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">dropTime=</span><span class="s">&#34;3000&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">       
</span></span><span class="line"><span class="cl">     <span class="nt">&lt;Receiver</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.tribes.transport.nio.
</span></span></span><span class="line"><span class="cl"><span class="s">     NioReceiver&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">address=</span><span class="s">&#34;auto&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">port=</span><span class="s">&#34;5000&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">selectorTimeout=</span><span class="s">&#34;100&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">maxThreads=</span><span class="s">&#34;6&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">     <span class="nt">&lt;Sender</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.tribes.transport.
</span></span></span><span class="line"><span class="cl"><span class="s">     ReplicationTransmitter&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;Transport</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.tribes.transport.
</span></span></span><span class="line"><span class="cl"><span class="s">          nio.PooledParallelSender&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">     <span class="nt">&lt;/Sender&gt;</span>
</span></span><span class="line"><span class="cl">     
</span></span><span class="line"><span class="cl">     <span class="nt">&lt;Interceptor</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.tribes.group.
</span></span></span><span class="line"><span class="cl"><span class="s">     interceptors.TcpFailureDetector&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">     
</span></span><span class="line"><span class="cl">     <span class="nt">&lt;Interceptor</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.tribes.group.
</span></span></span><span class="line"><span class="cl"><span class="s">     interceptors.MessageDispatchInterceptor&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">     
</span></span><span class="line"><span class="cl">     <span class="nt">&lt;Interceptor</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.tribes.group.
</span></span></span><span class="line"><span class="cl"><span class="s">     interceptors.ThroughputInterceptor&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;/Channel&gt;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;Valve</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.ha.tcp.ReplicationValve&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">filter=</span><span class="s">&#34;.*\.gif|.*\.js|.*\.jpeg|.*\.jpg|.*\.png|.*\
</span></span></span><span class="line"><span class="cl"><span class="s">               .htm|.*\.html|.*\.css|.*\.txt&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;Deployer</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.ha.deploy.FarmWarDeployer&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">tempDir=</span><span class="s">&#34;/tmp/war-temp/&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">deployDir=</span><span class="s">&#34;/tmp/war-deploy/&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">watchDir=</span><span class="s">&#34;/tmp/war-listen/&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">watchEnabled=</span><span class="s">&#34;false&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;ClusterListener</span> <span class="na">className=</span><span class="s">&#34;org.apache.catalina.ha.session.
</span></span></span><span class="line"><span class="cl"><span class="s">    ClusterSessionListener&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/Cluster&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="é›†ç¾¤å·¥ä½œè¿‡ç¨‹">é›†ç¾¤å·¥ä½œè¿‡ç¨‹</h2>
<p>Tomcat çš„å®˜ç½‘ç»™å‡ºäº†ä¸€ä¸ªä¾‹å­ï¼Œæ¥è¯´æ˜ Tomcat é›†ç¾¤æ¨¡å¼ä¸‹æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä»¥åŠ Tomcat é›†ç¾¤æ˜¯å¦‚ä½•å®ç°é«˜å¯ç”¨çš„ã€‚æ¯”å¦‚é›†ç¾¤ç”± Tomcat A å’Œ Tomcat B ä¸¤ä¸ª Tomcat å®ä¾‹ç»„æˆï¼ŒæŒ‰ç…§æ—¶é—´å…ˆåé¡ºåºå‘ç”Ÿäº†å¦‚ä¸‹äº‹ä»¶ï¼š</p>
<p><strong>1. Tomcat A å¯åŠ¨</strong></p>
<p>Tomcat A å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œå½“ Host å¯¹è±¡è¢«åˆ›å»ºæ—¶ï¼Œä¸€ä¸ª Cluster ç»„ä»¶ï¼ˆé»˜è®¤æ˜¯ SimpleTcpClusterï¼‰è¢«å…³è”åˆ°è¿™ä¸ª Host å¯¹è±¡ã€‚å½“æŸä¸ªåº”ç”¨åœ¨<code>web.xml</code>ä¸­è®¾ç½®äº† Distributable æ—¶ï¼ŒTomcat å°†ä¸ºæ­¤åº”ç”¨çš„ä¸Šä¸‹æ–‡ç¯å¢ƒåˆ›å»ºä¸€ä¸ª DeltaManagerã€‚SimpleTcpCluster å¯åŠ¨ Membership æœåŠ¡å’Œ Replication æœåŠ¡ã€‚</p>
<p><strong>2. Tomcat B å¯åŠ¨ï¼ˆåœ¨ Tomcat A ä¹‹åå¯åŠ¨ï¼‰</strong></p>
<p>é¦–å…ˆ Tomcat B ä¼šæ‰§è¡Œå’Œ Tomcat A ä¸€æ ·çš„æ“ä½œï¼Œç„¶å SimpleTcpCluster ä¼šå»ºç«‹ä¸€ä¸ªç”± Tomcat A å’Œ Tomcat B ç»„æˆçš„ Membershipã€‚æ¥ç€ Tomcat B å‘é›†ç¾¤ä¸­çš„ Tomcat A è¯·æ±‚ Session æ•°æ®ï¼Œå¦‚æœ Tomcat A æ²¡æœ‰å“åº” Tomcat B çš„æ‹·è´è¯·æ±‚ï¼ŒTomcat B ä¼šåœ¨ 60 ç§’å time outã€‚åœ¨ Session æ•°æ®æ‹·è´å®Œæˆä¹‹å‰ Tomcat B ä¸ä¼šæ¥æ”¶æµè§ˆå™¨çš„è¯·æ±‚ã€‚</p>
<p><strong>3. Tomcat A æ¥æ”¶ HTTP è¯·æ±‚ï¼Œåˆ›å»º Session 1</strong></p>
<p>Tomcat A å“åº”å®¢æˆ·è¯·æ±‚ï¼Œåœ¨æŠŠç»“æœå‘é€å›å®¢æˆ·ç«¯ä¹‹å‰ï¼ŒReplicationValve ä¼šæ‹¦æˆªå½“å‰è¯·æ±‚ï¼ˆå¦‚æœ Filter ä¸­é…ç½®äº†ä¸éœ€æ‹¦æˆªçš„è¯·æ±‚ç±»å‹ï¼Œè¿™ä¸€æ­¥å°±ä¸ä¼šè¿›è¡Œï¼Œé»˜è®¤é…ç½®ä¸‹æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼‰ï¼Œå¦‚æœå‘ç°å½“å‰è¯·æ±‚æ›´æ–°äº† Sessionï¼Œå°±è°ƒç”¨ Replication æœåŠ¡å»ºç«‹ TCP è¿æ¥å°† Session æ‹·è´åˆ° Membership åˆ—è¡¨ä¸­çš„å…¶ä»–èŠ‚ç‚¹å³ Tomcat Bã€‚åœ¨æ‹·è´æ—¶ï¼Œæ‰€æœ‰ä¿å­˜åœ¨å½“å‰ Session ä¸­çš„å¯åºåˆ—åŒ–çš„å¯¹è±¡éƒ½ä¼šè¢«æ‹·è´ï¼Œè€Œä¸ä»…ä»…æ˜¯å‘ç”Ÿæ›´æ–°çš„éƒ¨åˆ†ã€‚</p>
<p><strong>4. Tomcat A å´©æºƒ</strong></p>
<p>å½“ Tomcat A å´©æºƒæ—¶ï¼ŒTomcat B ä¼šè¢«å‘ŠçŸ¥ Tomcat A å·²ä»é›†ç¾¤ä¸­é€€å‡ºï¼Œç„¶å Tomcat B å°±ä¼šæŠŠ Tomcat A ä»è‡ªå·±çš„ Membership åˆ—è¡¨ä¸­åˆ é™¤ã€‚å¹¶ä¸” Tomcat B çš„ Session æ›´æ–°æ—¶ä¸å†å¾€ Tomcat A æ‹·è´ï¼ŒåŒæ—¶è´Ÿè½½å‡è¡¡å™¨ä¼šæŠŠåç»­çš„ HTTP è¯·æ±‚å…¨éƒ¨è½¬å‘ç»™ Tomcat Bã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­æ‰€æœ‰çš„ Session æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚</p>
<p><strong>5. Tomcat B æ¥æ”¶ Tomcat A çš„è¯·æ±‚</strong></p>
<p>Tomcat B æ­£å¸¸å“åº”æœ¬åº”è¯¥å‘å¾€ Tomcat A çš„è¯·æ±‚ï¼Œå› ä¸º Tomcat B ä¿å­˜äº† Tomcat A çš„æ‰€æœ‰ Session æ•°æ®ã€‚</p>
<p><strong>6. Tomcat A é‡æ–°å¯åŠ¨</strong></p>
<p>Tomcat A æŒ‰æ­¥éª¤ 1ã€2 æ“ä½œå¯åŠ¨ï¼ŒåŠ å…¥é›†ç¾¤ï¼Œå¹¶ä» Tomcat B æ‹·è´æ‰€æœ‰ Session æ•°æ®ï¼Œæ‹·è´å®Œæˆåå¼€å§‹æ¥æ”¶è¯·æ±‚ã€‚</p>
<p><strong>7. Tomcat A æ¥æ”¶è¯·æ±‚ï¼ŒSession 1 è¢«ç”¨æˆ·æ³¨é”€</strong></p>
<p>Tomcat ç»§ç»­æ¥æ”¶å‘å¾€ Tomcat A çš„è¯·æ±‚ï¼ŒSession 1 è®¾ç½®ä¸ºå¤±æ•ˆã€‚è¯·æ³¨æ„è¿™é‡Œçš„å¤±æ•ˆå¹¶éå› ä¸º Tomcat A å¤„äºéæ´»åŠ¨çŠ¶æ€è¶…è¿‡è®¾ç½®çš„æ—¶é—´ï¼Œè€Œæ˜¯åº”ç”¨ç¨‹åºæ‰§è¡Œäº†æ³¨é”€çš„æ“ä½œï¼ˆæ¯”å¦‚ç”¨æˆ·ç™»å‡ºï¼‰è€Œå¼•èµ·çš„ Session å¤±æ•ˆã€‚è¿™æ—¶ Tomcat A å‘ Tomcat B å‘é€ä¸€ä¸ª Session 1 Expired çš„æ¶ˆæ¯ï¼ŒTomcat B æ”¶åˆ°æ¶ˆæ¯åä¹Ÿä¼šæŠŠ Session 1 è®¾ç½®ä¸ºå¤±æ•ˆã€‚</p>
<p><strong>8. Tomcat B æ¥æ”¶åˆ°ä¸€ä¸ªæ–°è¯·æ±‚ï¼Œåˆ›å»º Session 2</strong></p>
<p>åŒç†è¿™ä¸ªæ–°çš„ Session ä¹Ÿä¼šè¢«æ‹·è´åˆ° Tomcat Aã€‚</p>
<p><strong>9. Tomcat A ä¸Šçš„ Session 2 è¿‡æœŸ</strong></p>
<p>å› è¶…æ—¶åŸå› å¼•èµ·çš„ Session å¤±æ•ˆ Tomcat A æ— éœ€é€šçŸ¥ Tomcat Bï¼ŒTomcat B åŒæ ·çŸ¥é“ Session 2 å·²ç»è¶…æ—¶ã€‚å› æ­¤å¯¹äº Tomcat é›†ç¾¤æœ‰ä¸€ç‚¹éå¸¸é‡è¦ï¼Œ<strong>æ‰€æœ‰èŠ‚ç‚¹çš„æ“ä½œç³»ç»Ÿæ—¶é—´å¿…é¡»ä¸€è‡´</strong>ã€‚ä¸ç„¶ä¼šå‡ºç°æŸä¸ªèŠ‚ç‚¹ Session å·²è¿‡æœŸè€Œåœ¨å¦ä¸€èŠ‚ç‚¹æ­¤ Session ä»å¤„äºæ´»åŠ¨çŠ¶æ€çš„ç°è±¡ã€‚</p>
<h2 id="æœ¬æœŸç²¾å-2">æœ¬æœŸç²¾å</h2>
<p>ä»Šå¤©æˆ‘è°ˆäº† Tomcat çš„é›†ç¾¤å·¥ä½œåŸç†å’Œé…ç½®æ–¹å¼ï¼Œè¿˜é€šè¿‡å®˜ç½‘ä¸Šçš„ä¸€ä¸ªä¾‹å­è¯´æ˜äº† Tomcat é›†ç¾¤çš„å·¥ä½œè¿‡ç¨‹ã€‚Tomcat é›†ç¾¤å¯¹ Session çš„æ‹·è´æ”¯æŒä¸¤ç§æ–¹å¼ï¼šDeltaManager å’Œ BackupManagerã€‚</p>
<p>å½“é›†ç¾¤ä¸­èŠ‚ç‚¹æ¯”è¾ƒå°‘æ—¶ï¼Œå¯ä»¥é‡‡ç”¨ DeltaManagerï¼Œå› ä¸º Session æ•°æ®åœ¨é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹éƒ½æœ‰å¤‡ä»½ï¼Œä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹å´©æºƒéƒ½ä¸ä¼šå¯¹æ•´ä½“é€ æˆå½±å“ï¼Œå¯é æ€§æ¯”è¾ƒé«˜ã€‚</p>
<p>å½“é›†ç¾¤ä¸­èŠ‚ç‚¹æ•°æ¯”è¾ƒå¤šæ—¶ï¼Œå¯ä»¥é‡‡ç”¨ BackupManagerï¼Œè¿™æ˜¯å› ä¸ºä¸€ä¸ªèŠ‚ç‚¹çš„ Session åªä¼šæ‹·è´åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ•°æ®æ‹·è´çš„å¼€é”€æ¯”è¾ƒå°‘ï¼ŒåŒæ—¶åªè¦è¿™ä¸¤ä¸ªèŠ‚ç‚¹ä¸åŒæ—¶å´©æºƒï¼ŒSession æ•°æ®å°±ä¸ä¼šä¸¢å¤±ã€‚</p>
<h1 id="ç‰¹åˆ«æ”¾é€--å¦‚ä½•æŒç»­ä¿æŒå¯¹å­¦ä¹ çš„å…´è¶£">ç‰¹åˆ«æ”¾é€ | å¦‚ä½•æŒç»­ä¿æŒå¯¹å­¦ä¹ çš„å…´è¶£ï¼Ÿ</h1>
<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æå·åŒã€‚ä»Šå¤©æˆ‘ä»¬æŠ›å¼€æŠ€æœ¯æœ¬èº«çš„å†…å®¹ï¼Œæ¥èŠèŠä¸“æ æˆ–è€…ä¸€é—¨æ–°æŠ€æœ¯çš„å­¦ä¹ æ–¹æ³•ï¼Œæˆ‘ä¹Ÿåˆ†äº«ä¸€ä¸‹è‡ªå·±æ˜¯å¦‚ä½•å•ƒä¸‹ Tomcat å’Œ Jetty æºç çš„ã€‚</p>
<p>ä¸“æ å¦‚ä»Šå·²ç»æ›´æ–°å®Œäº†äº”ä¸ªæ¨¡å—ï¼Œæˆ‘ä»¬å­¦ä¹ äº† Tomcat å’Œ Jetty çš„æ•´ä½“æ¶æ„ã€è¿æ¥å™¨ã€å®¹å™¨å’Œé€šç”¨ç»„ä»¶ï¼Œè¿™äº›å†…å®¹å¯ä»¥è¯´æ˜¯ Tomcat å’Œ Jetty çš„è®¾è®¡æ ¸å¿ƒã€‚åœ¨æ—¥å¸¸å·¥ä½œçš„ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ°äº† Tomcat å’Œ Jetty æä¾›çš„åŠŸèƒ½ï¼Œæˆ‘å¸Œæœ›é€šè¿‡å­¦ä¹ ä¸“æ ï¼Œè¿˜èƒ½å¸®ä½ äº†è§£è¿™äº›åŠŸèƒ½æ˜¯å¦‚ä½•å®ç°çš„ï¼Œä»¥åŠ Tomcat å’Œ Jetty åœ¨è®¾è®¡æ—¶éƒ½è€ƒè™‘äº†å“ªäº›åœ°æ–¹ã€‚</p>
<p>æ‰€ä»¥åœ¨å­¦ä¹ ä¸“æ æ—¶ï¼Œä½ ä¸å¦¨æ€è€ƒè¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œå‡å¦‚è®©ä½ æ¥è®¾è®¡å¹¶å®ç°ä¸€ä¸ª Web å®¹å™¨ï¼Œä½ ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿå¦‚ä½•åˆç†è®¾è®¡é¡¶å±‚æ¨¡å—ï¼Ÿå¦‚ä½•è€ƒè™‘æ–¹æ–¹é¢é¢çš„éœ€æ±‚ï¼Œæ¯”å¦‚æœ€åŸºæœ¬çš„åŠŸèƒ½éœ€æ±‚æ˜¯åŠ è½½å’Œè¿è¡Œ Web ç¨‹åºï¼Œæœ€é‡è¦çš„éåŠŸèƒ½éœ€æ±‚æ˜¯é«˜æ€§èƒ½ã€é«˜å¹¶å‘ã€‚ä½ å¯ä»¥é¡ºç€è¿™ä¸¤æ¡çº¿å…ˆæ€è€ƒä¸‹ä½ ä¼šæ€ä¹ˆåšï¼Œç„¶åå†å›è¿‡å¤´æ¥çœ‹çœ‹ Tomcat å’Œ Jetty æ˜¯å¦‚ä½•åšåˆ°çš„ã€‚è¿™æ ·çš„å­¦ä¹ æ–¹æ³•å…¶å®å°±åœ¨æœ‰æ„è¯†åœ°è®­ç»ƒè‡ªå·±ç‹¬ç«‹è®¾è®¡ä¸€ä¸ªç³»ç»Ÿçš„èƒ½åŠ›ï¼Œä¸ç®¡æ˜¯å¯¹äºå­¦ä¹ è¿™ä¸ªä¸“æ è¿˜æ˜¯å…¶ä»–æŠ€æœ¯ï¼Œå¸¦ç€é—®é¢˜å†å»å­¦ä¹ éƒ½ä¼šæœ‰æ‰€å¸®åŠ©ã€‚</p>
<p>è¯´å®Œå…³äºä¸“æ çš„å­¦ä¹ æ–¹æ³•ï¼Œä¸‹é¢æˆ‘å¿…é¡»è¦é¼“åŠ±ä¸€ä¸‹åšæŒå­¦ä¹ åˆ°ç°åœ¨çš„ä½ ã€‚ä¸“æ ä»ç¬¬ä¸‰æ¨¡å—å¼€å§‹ï¼Œå¼€å§‹è®²è§£è¿æ¥å™¨ã€å®¹å™¨å’Œé€šç”¨ç»„ä»¶çš„è®¾è®¡å’ŒåŸç†ï¼Œæœ‰äº›å†…å®¹å¯èƒ½æ¯”è¾ƒåå‘åº•å±‚ï¼Œç¡®å®éš¾åº¦æ¯”è¾ƒå¤§ï¼Œå¦‚æœå¯¹åº•å±‚æºç ä¸ç†Ÿæ‚‰æˆ–è€…ä¸æ„Ÿå…´è¶£ï¼Œå­¦ä¹ èµ·æ¥ä¼šæœ‰äº›ç—›è‹¦ã€‚ä½†æ˜¯ï¼Œæˆ‘ä¹‹æ‰€ä»¥è®¾è®¡äº†è¿™éƒ¨åˆ†å†…å®¹ï¼Œå°±æ˜¯å¸Œæœ›èƒ½å¤Ÿæ­å¼€ Tomcat å’Œ Jetty çš„å†…éƒ¨ç»†èŠ‚ï¼Œå› ä¸ºä»»ä½•ä¸€ä¸ªä¼˜ç§€çš„ä¸­é—´ä»¶ä¹‹æ‰€ä»¥å¯ä»¥è®©ç”¨æˆ·ä½¿ç”¨æ¯”è¾ƒå®¹æ˜“ï¼Œå…¶å†…éƒ¨ä¸€å®šéƒ½æ˜¯å¾ˆå¤æ‚çš„ã€‚è¿™ä¹Ÿä»ä¾§é¢ä¼ é€’å‡ºä¸€ä¸ªä¿¡å·ï¼šç¾å¥½çš„ä¸œè¥¿éƒ½æ˜¯æœ‰ä»£ä»·çš„ï¼Œéœ€è¦ä¹Ÿå€¼å¾—æˆ‘ä»¬å»ä»˜å‡ºæ—¶é—´å’Œç²¾åŠ›ã€‚</p>
<p>æˆ‘å’Œä½ ä¸€æ ·æˆ‘ä»¬éƒ½èº«å¤„ IT è¡Œä¸šï¼Œè¿™ä¸ªè¡Œä¸šæŠ€æœ¯æ›´æ–°è¿­ä»£éå¸¸å¿«ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä»¥ä¸€ä¸ªå¼€æ”¾çš„å¿ƒæ€æŒç»­å­¦ä¹ ã€‚è€Œå­¦ä¹ æ°æ°åˆæ˜¯ä¸€ä¸ªåäººæ€§çš„è¿‡ç¨‹ï¼Œç”šè‡³æ˜¯æ¯”è¾ƒç—›è‹¦çš„ï¼Œå°¤å…¶æ˜¯æœ‰äº›æŠ€æœ¯æ¡†æ¶æœ¬èº«æ¯”è¾ƒåºå¤§ï¼Œè®¾è®¡å¾—éå¸¸å¤æ‚ï¼Œæˆ‘ä»¬åœ¨å­¦ä¹ åˆæœŸå¾ˆå®¹æ˜“é‡åˆ°â€œæŒ«æŠ˜æ„Ÿâ€ï¼Œä¸€äº›æŠ€æœ¯ç‚¹æ€ä¹ˆæƒ³ä¹Ÿæƒ³ä¸æ˜ç™½ï¼Œå¾€å¾€ä¹Ÿä¼šæœ‰æ”¾å¼ƒçš„æƒ³æ³•ã€‚æˆ‘åŒæ ·ç»å†è¿‡è¿™ä¸ªè¿‡ç¨‹ï¼Œ<strong>æˆ‘çš„ç»éªŒæ˜¯æ‰¾åˆ°é€‚åˆè‡ªå·±çš„å­¦ä¹ æ–¹æ³•éå¸¸é‡è¦ï¼ŒåŒæ ·å…³é”®çš„æ˜¯è¦ä¿æŒå­¦ä¹ çš„å…´è¶£å’ŒåŠ¨åŠ›</strong>ã€‚</p>
<p>ä¸¾ä¸ªæˆ‘å­¦ä¹  Spring æ¡†æ¶çš„ä¾‹å­ï¼Œè®°å¾—å½“æ—¶æˆ‘åœ¨æ¥è§¦ Spring æ¡†æ¶çš„æ—¶å€™ï¼Œä¸€å¼€å§‹å°±é’»è¿›ä¸€ä¸ªæ¨¡å—å¼€å§‹å•ƒèµ·äº†æºä»£ç ã€‚ç”±äº Spring æ¡†æ¶æœ¬èº«æ¯”è¾ƒåºæ‚ï¼Œåˆ†å¾ˆå¤šæ¨¡å—ï¼Œå½“æ—¶ç»™æˆ‘æœ€ç›´è§‚çš„æ„Ÿå—å°±æ˜¯çœ‹ä¸æ‡‚ï¼Œæˆ‘ä¸æ˜ç™½ä»£ç ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå†™ï¼Œä¸ºä»€ä¹ˆè®¾è®¡å¾—è¿™ä¹ˆâ€œç»•â€ã€‚è¿™é‡Œé¢çš„é—®é¢˜æ˜¯ï¼Œé¦–å…ˆ<strong>æˆ‘è¿˜æ²¡å¼„æ¸…æ¥šæ£®æ—é•¿ä»€ä¹ˆæ ·å­ï¼Œå°±ç›¯ç€æ ‘å¶çœ‹</strong>ï¼Œå¾ˆå¯èƒ½æ˜¯ç›²äººæ‘¸è±¡ï¼Œçœ‹ä¸åˆ°å…¨è²Œå’Œæ•´ä½“çš„è®¾è®¡æ€è·¯ã€‚ç¬¬äºŒä¸ªé—®é¢˜æ˜¯æˆ‘è¿˜æ²¡å­¦ä¼šç”¨ Springï¼Œå°±å¼€å§‹ç ”ç©¶å®ƒæ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Œç»“æœå¯æƒ³è€ŒçŸ¥ï¼Œä¹Ÿé‡åˆ°äº†æŒ«æŠ˜ã€‚åæ¥æˆ‘é€æ¸æ€»ç»“å‡ºä¸€äº›å­¦ä¹ æ–°æŠ€æœ¯çš„å°ç»éªŒï¼šåœ¨å­¦ä¹ ä¸€é—¨æŠ€æœ¯çš„æ—¶å€™ï¼Œä¸€å®šè¦å…ˆçœ‹æ¸…å®ƒçš„å…¨è²Œï¼Œæˆ‘æ¨èå…ˆçœ‹å®˜æ–¹æ–‡æ¡£ï¼Œçœ‹çœ‹éƒ½æœ‰å“ªäº›æ¨¡å—ã€æ•´ä½“ä¸Šæ˜¯å¦‚ä½•è®¾è®¡çš„ã€‚æ¥ç€æˆ‘ä»¬å…ˆä¸è¦ç›´æ¥çœ‹æºç ï¼Œè€Œæ˜¯è¦åŠ¨æ‰‹è·‘ä¸€è·‘å®˜ç½‘ä¸Šçš„ä¾‹å­ï¼Œæˆ–è€…ç”¨è¿™ä¸ªæ¡†æ¶å®ç°ä¸€ä¸ªå°ç³»ç»Ÿï¼Œå…³é”®æ˜¯è¦å­¦ä¼šæ€ä¹ˆä½¿ç”¨ã€‚åªæœ‰åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œæ‰èƒ½æ·±å…¥åˆ°ç‰¹å®šæ¨¡å—ï¼Œå»ç ”ç©¶è®¾è®¡æ€è·¯ï¼Œæˆ–è€…æ·±å…¥åˆ°æŸä¸€æ¨¡å—æºç ä¹‹ä¸­ã€‚è¿™æ ·åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼ŒæŒ‰ç…§ä¸€å®šçš„é¡ºåºä¸€æ­¥ä¸€æ­¥æ¥ï¼Œå°±èƒ½å¤Ÿå³æ—¶è·å¾—<strong>æˆå°±æ„Ÿ</strong>ï¼Œæœ‰äº†æˆå°±æ„Ÿä½ æ‰ä¼šæ›´åŠ ä¸“æ³¨ï¼Œæ‰ä¼šæ„¿æ„èŠ±æ›´å¤šæ—¶é—´å’Œç²¾åŠ›å»æ·±å…¥ç ”ç©¶ã€‚å› æ­¤è¦ä¿æŒå­¦ä¹ çš„å…´è¶£ï¼Œæˆ‘è§‰å¾—æœ‰ä¸¤ä¸ªæ–¹é¢æ¯”è¾ƒé‡è¦ï¼š</p>
<p>ç¬¬ä¸€ä¸ªæ˜¯æˆ‘ä»¬éœ€è¦<strong>å¸¦ç€æ˜ç¡®çš„ç›®æ ‡å»å­¦ä¹ </strong>ã€‚æ¯”å¦‚æŸäº›çŸ¥è¯†ç‚¹æ˜¯é¢è¯•çš„çƒ­ç‚¹ï¼Œé‚£å­¦ä¹ ç›®æ ‡å°±æ˜¯å½»åº•ç†è§£å’ŒæŒæ¡å®ƒï¼Œå½“è¢«é—®åˆ°ç›¸å…³é—®é¢˜æ—¶ï¼Œä½ çš„å›ç­”èƒ½å¤Ÿä½¿å¾—é¢è¯•å®˜å¯¹ä½ åˆ®ç›®ç›¸çœ‹ï¼Œæœ‰æ—¶å€™å¾€å¾€å‡­ç€æŸä¸€ä¸ªäº®ç‚¹å°±èƒ½å½±å“æœ€åçš„å½•ç”¨ç»“æœã€‚å†æ¯”å¦‚ä½ æƒ³æŒæ¡ä¸€é—¨æ–°æŠ€æœ¯æ¥è§£å†³å·¥ä½œä¸Šçš„é—®é¢˜ï¼Œé‚£ä½ çš„å­¦ä¹ ç›®æ ‡åº”è¯¥æ˜¯ä¸ä½†è¦æŒæ¡æ¸…æ¥šåŸç†ï¼Œè¿˜è¦èƒ½çœŸæ­£çš„å°†æ–°æŠ€æœ¯åˆç†è¿ç”¨åˆ°å®é™…å·¥ä½œä¸­ï¼Œè§£å†³å®é™…é—®é¢˜ï¼Œäº§ç”Ÿå®é™…æ•ˆæœã€‚æˆ‘ä»¬å­¦ä¹ äº† Tomcat å’Œ Jetty çš„è´£ä»»é“¾æ¨¡å¼ï¼Œæ˜¯ä¸æ˜¯åœ¨å®é™…é¡¹ç›®ä¸­çš„ä¸€äº›åœºæ™¯ä¸‹å°±å¯ä»¥ç”¨åˆ°è¿™ç§è®¾è®¡å‘¢ï¼Ÿå†æ¯”å¦‚å­¦ä¹ äº†è°ƒä¼˜æ–¹æ³•ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒé‡Œè§£å†³æ€§èƒ½é—®é¢˜å‘¢ï¼Ÿæ€»ä¹‹æŠ€æœ¯éœ€è¦å˜ç°æ‰æœ‰å­¦ä¹ åŠ¨åŠ›ã€‚</p>
<p>ç¬¬äºŒä¸ªæ˜¯<strong>ä¸€å®šè¦åŠ¨æ‰‹å®è·µ</strong>ã€‚åªæœ‰åŠ¨æ‰‹å®è·µæ‰ä¼šè®©æˆ‘ä»¬å¯¹æŠ€æœ¯æœ‰æœ€ç›´è§‚çš„æ„Ÿå—ã€‚æœ‰æ—¶å€™æˆ‘ä»¬å¬åˆ«äººè®²ç»éªŒå’Œç†è®ºï¼Œæ„Ÿè§‰ä¼¼ä¹æ‡‚äº†ï¼Œä½†æ˜¯è¿‡ä¸€æ®µæ—¶é—´ä¾¿åˆå¿˜è®°äº†ã€‚å¦‚æœæˆ‘ä»¬åŠ¨æ‰‹å®è·µäº†ï¼Œç‰¹åˆ«æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ç¢°åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œé€šè¿‡ç½‘ä¸ŠæŸ¥æ‰¾èµ„æ–™ï¼Œæˆ–è€…è·ŸåŒäº‹è®¨è®ºè§£å†³äº†é—®é¢˜ï¼Œè¿™ä¾¿æ˜¯ä½ ç§¯ç´¯çš„å®è´µç»éªŒï¼Œæƒ³å¿˜è®°éƒ½éš¾ã€‚å¦å¤–é€‚å½“çš„åŠ¨æ‰‹å®è·µèƒ½å¤Ÿæ ‘ç«‹èµ·ä¿¡å¿ƒï¼ŒåŸ¹å…»èµ·å…´è¶£ï¼Œè¿™è·Ÿç©æ¸¸æˆä¸Šç˜¾æœ‰ç‚¹ç±»ä¼¼ï¼Œé€šè¿‡æ‰“æ€ªå‡çº§ï¼Œä¸€ç‚¹ç‚¹ç§¯ç´¯èµ·æˆå°±æ„Ÿã€‚æ¯”å¦‚å­¦ä¹ äº† Tomcat çš„çº¿ç¨‹æ± å®ç°ï¼Œæˆ‘ä»¬å°±å¯ä»¥è‡ªå·±å†™ä¸€ä¸ªå®šåˆ¶ç‰ˆçš„çº¿ç¨‹æ± ï¼›å­¦ä¹ äº† Tomcat çš„ç±»åŠ è½½å™¨ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±åŠ¨æ‰‹å†™ä¸€ä¸ªç±»åŠ è½½å™¨ã€‚</p>
<p>ä¸“æ æ›´æ–°åˆ°ç°åœ¨ï¼Œå†…å®¹æœ€éš¾çš„éƒ¨åˆ†å·²ç»ç»“æŸï¼Œåœ¨åé¢çš„å®æˆ˜è°ƒä¼˜æ¨¡å—ï¼Œæˆ‘åœ¨è®¾è®¡å†…å®¹æ—¶éƒ½å®‰æ’äº†å®æˆ˜ç¯èŠ‚ã€‚æ¯•ç«Ÿè°ƒä¼˜æœ¬èº«å°±æ˜¯ä¸€ä¸ªå¾ˆè´´è¿‘å®é™…åœºæ™¯çš„è¯é¢˜ï¼Œåº”è¯¥åŸºäºç‰¹å®šåœºæ™¯ï¼Œå»è§£å†³æŸä¸ªæ€§èƒ½é—®é¢˜ï¼Œè€Œä¸æ˜¯ä¸ºäº†è°ƒä¼˜è€Œè°ƒä¼˜ã€‚æ‰€ä»¥è¿™éƒ¨åˆ†å†…å®¹ä¹Ÿæ›´è´´è¿‘å®é™…å·¥ä½œåœºæ™¯ï¼Œä½ å¯ä»¥å°è¯•ç”¨æˆ‘å‰é¢è®²çš„æ–¹æ³•ï¼Œå¸¦ç€é—®é¢˜å­¦ä¹ åé¢çš„ä¸“æ ã€‚</p>
<p>è°ƒä¼˜çš„è¿‡ç¨‹ä¸­éœ€è¦ä¸€äº›çŸ¥è¯†å‚¨å¤‡ï¼Œæ¯”å¦‚æˆ‘ä»¬éœ€è¦æŒæ¡æ“ä½œç³»ç»Ÿã€JVM ä»¥åŠç½‘ç»œé€šä¿¡çš„åŸç†ï¼Œè¿™äº›åŸç†åœ¨ä¸“æ å‰é¢çš„æ–‡ç« ä¹Ÿè®²åˆ°è¿‡ã€‚è™½ç„¶æ¶‰åŠå¾ˆå¤šåŸç†ä¹Ÿå¾ˆå¤æ‚ï¼Œå¹¶ä¸æ˜¯è¯´è¦é¢é¢ä¿±åˆ°ï¼Œæˆ‘ä»¬ä¹Ÿä¸å¤ªå®¹æ˜“æ·±å…¥åˆ°æ¯ä¸ªç»†èŠ‚ï¼Œæ‰€ä»¥æœ€å…³é”®çš„æ˜¯è¦å¼„æ‡‚ç›¸å…³å‚æ•°çš„å«ä¹‰ï¼Œæ¯”å¦‚ JVM å†…å­˜çš„å‚æ•°ã€GC çš„å‚æ•°ã€Linux å†…æ ¸çš„ç›¸å…³å‚æ•°ç­‰ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè°ƒä¼˜çš„è¿‡ç¨‹è¿˜éœ€è¦å€ŸåŠ©å¤§é‡çš„å·¥å…·ï¼ŒåŒ…æ‹¬æ€§èƒ½ç›‘æ§å·¥å…·ã€æ—¥å¿—åˆ†æå·¥å…·ã€ç½‘ç»œæŠ“åŒ…å·¥å…·å’Œæµé‡å‹æµ‹å·¥å…·ç­‰ï¼Œç†Ÿç»ƒä½¿ç”¨è¿™äº›å·¥å…·ä¹Ÿæ˜¯æ¯ä¸€ä¸ªåç«¯ç¨‹åºå‘˜å¿…é¡»æŒæ¡çš„çœ‹å®¶æœ¬é¢†ï¼Œå› æ­¤åœ¨å®æˆ˜ç¯èŠ‚ï¼Œæˆ‘ä¹Ÿè®¾è®¡äº†ä¸€äº›åœºæ™¯æ¥å¸¦ä½ ç†Ÿæ‚‰è¿™äº›å·¥å…·ã€‚</p>
<p>è¯´äº†é‚£ä¹ˆå¤šï¼Œå°±æ˜¯å¸Œæœ›ä½ ä¿æŒå¯¹å­¦ä¹ çš„çƒ­æƒ…ï¼Œæ ‘ç«‹æ˜ç¡®çš„ç›®æ ‡ï¼Œå†åŠ ä¸Šäº²è‡ªåŠ¨æ‰‹å®è·µã€‚ä¸“æ å­¦ä¹ åˆ°ç°åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæ˜¯æ—¶å€™å¼€å§‹åŠ¨æ‰‹å®è·µäº†ï¼Œå¸Œæœ›ä½ æ¯å¤©éƒ½èƒ½ç§¯ç´¯ä¸€ç‚¹ï¼Œæ¯å¤©éƒ½èƒ½æœ‰æ‰€è¿›æ­¥ã€‚</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">æ–‡ç« ä½œè€…</span>
    <span class="item-content">yuanshuai</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">ä¸Šæ¬¡æ›´æ–°</span>
    <span class="item-content">
        0001-01-01
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/yuanshuai1122.github.io/tags/java/">Java</a>
          <a href="/yuanshuai1122.github.io/tags/tomcat/">Tomcat</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="yuanshuai1122.github.io/post/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3tomcat%E5%92%8Cjetty%E4%B9%8B%E5%AE%B9%E5%99%A8-%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3tomcat%E5%92%8Cjetty%E4%B9%8B%E5%AE%B9%E5%99%A8/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">æ·±å…¥æ‹†è§£Tomcatå’ŒJettyä¹‹å®¹å™¨</span>
            <span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span>
          </a>
        <a class="next" href="yuanshuai1122.github.io/post/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3tomcat%E5%92%8Cjetty%E4%B9%8B%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3tomcat%E5%92%8Cjetty%E4%B9%8B%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">
            <span class="next-text nav-default">æ·±å…¥æ‹†è§£Tomcatå’ŒJettyä¹‹æ€§èƒ½ä¼˜åŒ–</span>
            <span class="next-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:your@email.com" class="iconfont icon-email" title="email"></a>
      <a href="http://localhost:1313" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="http://localhost:1313" class="iconfont icon-twitter" title="twitter"></a>
      <a href="http://localhost:1313" class="iconfont icon-facebook" title="facebook"></a>
      <a href="http://localhost:1313" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="http://localhost:1313" class="iconfont icon-google" title="google"></a>
      <a href="http://localhost:1313" class="iconfont icon-github" title="github"></a>
      <a href="http://localhost:1313" class="iconfont icon-weibo" title="weibo"></a>
      <a href="http://localhost:1313" class="iconfont icon-zhihu" title="zhihu"></a>
      <a href="http://localhost:1313" class="iconfont icon-douban" title="douban"></a>
      <a href="http://localhost:1313" class="iconfont icon-pocket" title="pocket"></a>
      <a href="http://localhost:1313" class="iconfont icon-tumblr" title="tumblr"></a>
      <a href="http://localhost:1313" class="iconfont icon-instagram" title="instagram"></a>
      <a href="http://localhost:1313" class="iconfont icon-gitlab" title="gitlab"></a>
      <a href="http://localhost:1313" class="iconfont icon-bilibili" title="bilibili"></a>
  <a href="yuanshuai1122.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    ç”± <a class="hexo-link" href="https://gohugo.io">Hugo</a> å¼ºåŠ›é©±åŠ¨
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    ä¸»é¢˜ - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2017 - 
    2023<span class="heart"><i class="iconfont icon-heart"></i></span><span>yuanshuai</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.min.js" integrity="sha256-jwCP0NAdCBloaIWTWHmW4i3snUNMHUNO+jr9rYd2iOI=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.locales.min.js" integrity="sha256-ZwofwC1Lf/faQCzN7nZtfijVV6hSwxjQMwXL4gn9qU8=" crossorigin="anonymous"></script>
  <script>
    var languageCode = "zh-cn".replace(/-/g, '_').replace(/_(.*)/, function ($0, $1) {return $0.replace($1, $1.toUpperCase());});
    timeago().render(document.querySelectorAll('.timeago'), languageCode);
    timeago.cancel();  
  </script>



<script type="text/javascript" src="/yuanshuai1122.github.io/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
