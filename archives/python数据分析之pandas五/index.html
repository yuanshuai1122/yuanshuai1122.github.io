<!DOCTYPE html>
<html class="js no-touch  progressive-image  no-reduced-motion progressive" lang="en">
  <head>
    <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="icon" href="/img/favicon.ico">

    <meta name="keyword" content=""><meta property="og:title" content="Python数据分析之Pandas（五）" />
<meta property="og:description" content=": | &mdash;: | &mdash;: | &mdash;: | &mdash;: | &mdash;: | | 0 | S001 | 怠涵 | 女 | 23 | 山东 | | 1 | S002 | 婉清 | 女 | 25 | 河南 | | 2 | S003 | 溪榕 | 女 | 23 | 湖北 | | 3 | S004 | 漠涓 | 女 | 19 | 陕" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yuanshuai1122.github.io/archives/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%94/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-26T21:54:21+00:00" />
<meta property="article:modified_time" content="2021-11-26T21:54:21+00:00" />
<title>Python数据分析之Pandas（五）</title>

    <link rel="canonical" href="/archives/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%94/">

    <link rel="stylesheet" href="/css/global.css">

    <link rel="stylesheet" href="/css/custom.css">

    <link rel="stylesheet" href="/css/search.css" />

    
    

    
    

</head>
  </head>
  <body class=" page-article   ">
    <header>
      <nav class="nav">
  <div class="nav-wrapper">
    <div class="nav-content-wrapper">
      <div class="nav-content">
        <a href="/ " class="nav-title">iTheme</a>
        <div class="nav-menu">
          <div class="nav-item-wrapper">
            <a href="/posts " class="nav-item-content">Articles</a>
          </div><div class="nav-item-wrapper">
            <a href="/about" class="nav-item-content">About</a>
          </div><div class="nav-item-wrapper">
            <a href="/index.xml" class="nav-item-content" target="_blank">RSS</a>
          </div></div>
      </div>
    </div>
  </div>
</nav>

<script>
  function toggleSearchModal(){
    const template = `
    <div class="modal-body">
      <div id="autocomplete" onclick="event.stopPropagation();"></div>
    </div>
    `
    const modal = document.querySelector("#modal-wrapper")
    if(!modal){
      const div = document.createElement("div")
      document.body.setAttribute("style","overflow: hidden;")
      div.setAttribute("id", "modal-wrapper")
      div.setAttribute("onclick", "toggleSearchModal()")
      div.innerHTML = template
      const script = document.createElement("script");script.setAttribute("src", "https://yuanshuai1122.github.io/js/algolia.js")
      div.appendChild(script)
      document.body.append(div)
    } else {
      document.body.removeAttribute("style")
      document.body.removeChild(modal)
    }
  }
</script>
    </header>
    
  
  
  <main id="main" class="main">
      <section>
        <article class="article">
          
          <div class=" article-header ">
            <div class="category component">
              <div class="component-content">
                <div class="category-eyebrow">
                  <span class="category-eyebrow__category category_original">
                    
                      
                        Python
                      
                    
                  </span>
                  <span class="category-eyebrow__date">November 26, 2021</span>
                </div>
              </div>
            </div>
            <div class="pagetitle component">
              <div class="component-content">
                <h1 class="hero-headline">Python数据分析之Pandas（五）</h1>
              </div>
            </div>
            <div class="component  article-subhead ">
              <div class="component-content"></div>
            </div>

            <div class="tagssheet component">
              <div class="component-content">
                
                  
                  <a href="/tags/python" class="tag">
                    Python
                  </a>
                
                  
                  <a href="/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90" class="tag">
                    数据分析
                  </a>
                
              </div>
            </div>
          </div>
          
          <div class="pagebody">
            
            
            
            
            
            
            
            
            <p class="component-content component">: | &mdash;: | &mdash;: | &mdash;: | &mdash;: | &mdash;: |
|    0 | S001 | 怠涵 |   女 |   23 | 山东 |
|    1 | S002 | 婉清 |   女 |   25 | 河南 |
|    2 | S003 | 溪榕 |   女 |   23 | 湖北 |
|    3 | S004 | 漠涓 |   女 |   19 | 陕西 |
|    4 | S005 | 祈博 |   女 |   24 | 山东 |</p>
<p class="component-content component">In [3]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 展示索引的name</span>
</span></span><span style="display:flex;"><span>df<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>name</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [4]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;id&#34;</span>
</span></span><span style="display:flex;"><span>df<span style="color:#f92672">.</span>head()</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[4]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">学号</th>
<th style="text-align:right">姓名</th>
<th style="text-align:right">性别</th>
<th style="text-align:right">年龄</th>
<th style="text-align:right">籍贯</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">id</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">S001</td>
<td style="text-align:right">怠涵</td>
<td style="text-align:right">女</td>
<td style="text-align:right">23</td>
<td style="text-align:right">山东</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">S002</td>
<td style="text-align:right">婉清</td>
<td style="text-align:right">女</td>
<td style="text-align:right">25</td>
<td style="text-align:right">河南</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">S003</td>
<td style="text-align:right">溪榕</td>
<td style="text-align:right">女</td>
<td style="text-align:right">23</td>
<td style="text-align:right">湖北</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">S004</td>
<td style="text-align:right">漠涓</td>
<td style="text-align:right">女</td>
<td style="text-align:right">19</td>
<td style="text-align:right">陕西</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">S005</td>
<td style="text-align:right">祈博</td>
<td style="text-align:right">女</td>
<td style="text-align:right">24</td>
<td style="text-align:right">山东</td>
</tr>
</tbody>
</table></div>

<div class="component-content pagebody component">
  <h3 id="创建sqlalchemy对象连接mysql" class="pagebody-header">
    创建sqlalchemy对象连接MySQL
  </h3>
</div><p class="component-content component">SQLAlchemy是Python中的ORM框架， Object-Relational Mapping，把关系数据库的表结构映射到对象上。</p>
<div class="component-content component"><ul>
<li>官网：https://www.sqlalchemy.org/</li>
<li>如果sqlalchemy包不存在，用这个命令安装：pip install sqlalchemy</li>
<li>需要安装依赖Python库：pip install mysql-connector-python</li>
</ul></div>
<p class="component-content component">可以直接执行SQL语句</p>
<p class="component-content component">In [5]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> sqlalchemy <span style="color:#f92672">import</span> create_engine</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [6]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>engine <span style="color:#f92672">=</span> create_engine(<span style="color:#e6db74">&#34;mysql+mysqlconnector://root:123456@127.0.0.1:3306/test&#34;</span>, echo<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="方法1当数据表不存在时每次覆盖整个表" class="pagebody-header">
    方法1：当数据表不存在时，每次覆盖整个表
  </h3>
</div><p class="component-content component">每次运行会drop table，新建表</p>
<p class="component-content component">In [7]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df<span style="color:#f92672">.</span>to_sql(name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;student&#39;</span>, con<span style="color:#f92672">=</span>engine, if_exists<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;replace&#34;</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [11]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>engine<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;show create table student&#34;</span>)<span style="color:#f92672">.</span>first()[<span style="color:#ae81ff">1</span>]</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[11]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e6db74">&#39;CREATE TABLE `student` (</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">  `id` bigint(20) DEFAULT NULL,</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">  `学号` text,</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">  `姓名` text,</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">  `性别` text,</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">  `年龄` bigint(20) DEFAULT NULL,</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">  `籍贯` text,</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">  KEY `ix_student_id` (`id`)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4&#39;</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">In [8]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>print(engine<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;show create table student&#34;</span>)<span style="color:#f92672">.</span>first()[<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>CREATE TABLE <span style="color:#960050;background-color:#1e0010">`</span>student<span style="color:#960050;background-color:#1e0010">`</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">`</span>id<span style="color:#960050;background-color:#1e0010">`</span> bigint(<span style="color:#ae81ff">20</span>) DEFAULT NULL,
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">`</span>学号<span style="color:#960050;background-color:#1e0010">`</span> text,
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">`</span>姓名<span style="color:#960050;background-color:#1e0010">`</span> text,
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">`</span>性别<span style="color:#960050;background-color:#1e0010">`</span> text,
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">`</span>年龄<span style="color:#960050;background-color:#1e0010">`</span> bigint(<span style="color:#ae81ff">20</span>) DEFAULT NULL,
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">`</span>籍贯<span style="color:#960050;background-color:#1e0010">`</span> text,
</span></span><span style="display:flex;"><span>  KEY <span style="color:#960050;background-color:#1e0010">`</span>ix_student_id<span style="color:#960050;background-color:#1e0010">`</span> (<span style="color:#960050;background-color:#1e0010">`</span>id<span style="color:#960050;background-color:#1e0010">`</span>)
</span></span><span style="display:flex;"><span>) ENGINE<span style="color:#f92672">=</span>InnoDB DEFAULT CHARSET<span style="color:#f92672">=</span>utf8mb4</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [12]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>engine<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;select count(1) from student&#34;</span>)<span style="color:#f92672">.</span>first()</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[12]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>(<span style="color:#ae81ff">24</span>,)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [13]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>engine<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;select * from student limit 5&#34;</span>)<span style="color:#f92672">.</span>fetchall()</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[13]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>[(<span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#39;S001&#39;</span>, <span style="color:#e6db74">&#39;怠涵&#39;</span>, <span style="color:#e6db74">&#39;女&#39;</span>, <span style="color:#ae81ff">23</span>, <span style="color:#e6db74">&#39;山东&#39;</span>),
</span></span><span style="display:flex;"><span> (<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;S002&#39;</span>, <span style="color:#e6db74">&#39;婉清&#39;</span>, <span style="color:#e6db74">&#39;女&#39;</span>, <span style="color:#ae81ff">25</span>, <span style="color:#e6db74">&#39;河南&#39;</span>),
</span></span><span style="display:flex;"><span> (<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;S003&#39;</span>, <span style="color:#e6db74">&#39;溪榕&#39;</span>, <span style="color:#e6db74">&#39;女&#39;</span>, <span style="color:#ae81ff">23</span>, <span style="color:#e6db74">&#39;湖北&#39;</span>),
</span></span><span style="display:flex;"><span> (<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;S004&#39;</span>, <span style="color:#e6db74">&#39;漠涓&#39;</span>, <span style="color:#e6db74">&#39;女&#39;</span>, <span style="color:#ae81ff">19</span>, <span style="color:#e6db74">&#39;陕西&#39;</span>),
</span></span><span style="display:flex;"><span> (<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#39;S005&#39;</span>, <span style="color:#e6db74">&#39;祈博&#39;</span>, <span style="color:#e6db74">&#39;女&#39;</span>, <span style="color:#ae81ff">24</span>, <span style="color:#e6db74">&#39;山东&#39;</span>)]</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="方法2当数据表存在时每次新增数据" class="pagebody-header">
    方法2：当数据表存在时，每次新增数据
  </h3>
</div><p class="component-content component">场景：每天会新增一部分数据，要添加到数据表，怎么处理？</p>
<p class="component-content component">In [14]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_new <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>loc[:<span style="color:#ae81ff">4</span>, :]
</span></span><span style="display:flex;"><span>df_new</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[14]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">学号</th>
<th style="text-align:right">姓名</th>
<th style="text-align:right">性别</th>
<th style="text-align:right">年龄</th>
<th style="text-align:right">籍贯</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">id</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">S001</td>
<td style="text-align:right">怠涵</td>
<td style="text-align:right">女</td>
<td style="text-align:right">23</td>
<td style="text-align:right">山东</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">S002</td>
<td style="text-align:right">婉清</td>
<td style="text-align:right">女</td>
<td style="text-align:right">25</td>
<td style="text-align:right">河南</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">S003</td>
<td style="text-align:right">溪榕</td>
<td style="text-align:right">女</td>
<td style="text-align:right">23</td>
<td style="text-align:right">湖北</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">S004</td>
<td style="text-align:right">漠涓</td>
<td style="text-align:right">女</td>
<td style="text-align:right">19</td>
<td style="text-align:right">陕西</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">S005</td>
<td style="text-align:right">祈博</td>
<td style="text-align:right">女</td>
<td style="text-align:right">24</td>
<td style="text-align:right">山东</td>
</tr>
</tbody>
</table></div>
<p class="component-content component">In [15]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_new<span style="color:#f92672">.</span>to_sql(name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;student&#39;</span>, con<span style="color:#f92672">=</span>engine, if_exists<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;append&#34;</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [16]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>engine<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;SELECT * FROM student where id&lt;5 &#34;</span>)<span style="color:#f92672">.</span>fetchall()</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[16]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>[(<span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#39;S001&#39;</span>, <span style="color:#e6db74">&#39;怠涵&#39;</span>, <span style="color:#e6db74">&#39;女&#39;</span>, <span style="color:#ae81ff">23</span>, <span style="color:#e6db74">&#39;山东&#39;</span>),
</span></span><span style="display:flex;"><span> (<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;S002&#39;</span>, <span style="color:#e6db74">&#39;婉清&#39;</span>, <span style="color:#e6db74">&#39;女&#39;</span>, <span style="color:#ae81ff">25</span>, <span style="color:#e6db74">&#39;河南&#39;</span>),
</span></span><span style="display:flex;"><span> (<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;S003&#39;</span>, <span style="color:#e6db74">&#39;溪榕&#39;</span>, <span style="color:#e6db74">&#39;女&#39;</span>, <span style="color:#ae81ff">23</span>, <span style="color:#e6db74">&#39;湖北&#39;</span>),
</span></span><span style="display:flex;"><span> (<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;S004&#39;</span>, <span style="color:#e6db74">&#39;漠涓&#39;</span>, <span style="color:#e6db74">&#39;女&#39;</span>, <span style="color:#ae81ff">19</span>, <span style="color:#e6db74">&#39;陕西&#39;</span>),
</span></span><span style="display:flex;"><span> (<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#39;S005&#39;</span>, <span style="color:#e6db74">&#39;祈博&#39;</span>, <span style="color:#e6db74">&#39;女&#39;</span>, <span style="color:#ae81ff">24</span>, <span style="color:#e6db74">&#39;山东&#39;</span>),
</span></span><span style="display:flex;"><span> (<span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#39;S001&#39;</span>, <span style="color:#e6db74">&#39;怠涵&#39;</span>, <span style="color:#e6db74">&#39;女&#39;</span>, <span style="color:#ae81ff">23</span>, <span style="color:#e6db74">&#39;山东&#39;</span>),
</span></span><span style="display:flex;"><span> (<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;S002&#39;</span>, <span style="color:#e6db74">&#39;婉清&#39;</span>, <span style="color:#e6db74">&#39;女&#39;</span>, <span style="color:#ae81ff">25</span>, <span style="color:#e6db74">&#39;河南&#39;</span>),
</span></span><span style="display:flex;"><span> (<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;S003&#39;</span>, <span style="color:#e6db74">&#39;溪榕&#39;</span>, <span style="color:#e6db74">&#39;女&#39;</span>, <span style="color:#ae81ff">23</span>, <span style="color:#e6db74">&#39;湖北&#39;</span>),
</span></span><span style="display:flex;"><span> (<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;S004&#39;</span>, <span style="color:#e6db74">&#39;漠涓&#39;</span>, <span style="color:#e6db74">&#39;女&#39;</span>, <span style="color:#ae81ff">19</span>, <span style="color:#e6db74">&#39;陕西&#39;</span>),
</span></span><span style="display:flex;"><span> (<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#39;S005&#39;</span>, <span style="color:#e6db74">&#39;祈博&#39;</span>, <span style="color:#e6db74">&#39;女&#39;</span>, <span style="color:#ae81ff">24</span>, <span style="color:#e6db74">&#39;山东&#39;</span>)]</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h4 id="问题解决先根据数据key删除旧数据" class="pagebody-header">
    问题解决：先根据数据KEY删除旧数据
  </h4>
</div><p class="component-content component">In [17]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_new<span style="color:#f92672">.</span>index</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[17]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>RangeIndex(start<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, stop<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>, step<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;id&#39;</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [18]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> id <span style="color:#f92672">in</span> df_new<span style="color:#f92672">.</span>index:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">## 先删除要新增的数据</span>
</span></span><span style="display:flex;"><span>    delete_sql <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;delete from student where id=</span><span style="color:#e6db74">{</span>id<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    print(delete_sql)
</span></span><span style="display:flex;"><span>    engine<span style="color:#f92672">.</span>execute(delete_sql)
</span></span><span style="display:flex;"><span>delete <span style="color:#f92672">from</span> student where id<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>delete <span style="color:#f92672">from</span> student where id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>delete <span style="color:#f92672">from</span> student where id<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>delete <span style="color:#f92672">from</span> student where id<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>delete <span style="color:#f92672">from</span> student where id<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">In [19]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>engine<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;SELECT * FROM student where id&lt;5 &#34;</span>)<span style="color:#f92672">.</span>fetchall()</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[19]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>[]</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [20]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>engine<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;select count(1) from student&#34;</span>)<span style="color:#f92672">.</span>first()</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[20]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>(<span style="color:#ae81ff">19</span>,)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [21]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 新增数据到表中</span>
</span></span><span style="display:flex;"><span>df_new<span style="color:#f92672">.</span>to_sql(name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;student&#39;</span>, con<span style="color:#f92672">=</span>engine, if_exists<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;append&#34;</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [22]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>engine<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;SELECT * FROM student where id&lt;5 &#34;</span>)<span style="color:#f92672">.</span>fetchall()</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[22]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>[(<span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#39;S001&#39;</span>, <span style="color:#e6db74">&#39;怠涵&#39;</span>, <span style="color:#e6db74">&#39;女&#39;</span>, <span style="color:#ae81ff">23</span>, <span style="color:#e6db74">&#39;山东&#39;</span>),
</span></span><span style="display:flex;"><span> (<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;S002&#39;</span>, <span style="color:#e6db74">&#39;婉清&#39;</span>, <span style="color:#e6db74">&#39;女&#39;</span>, <span style="color:#ae81ff">25</span>, <span style="color:#e6db74">&#39;河南&#39;</span>),
</span></span><span style="display:flex;"><span> (<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;S003&#39;</span>, <span style="color:#e6db74">&#39;溪榕&#39;</span>, <span style="color:#e6db74">&#39;女&#39;</span>, <span style="color:#ae81ff">23</span>, <span style="color:#e6db74">&#39;湖北&#39;</span>),
</span></span><span style="display:flex;"><span> (<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;S004&#39;</span>, <span style="color:#e6db74">&#39;漠涓&#39;</span>, <span style="color:#e6db74">&#39;女&#39;</span>, <span style="color:#ae81ff">19</span>, <span style="color:#e6db74">&#39;陕西&#39;</span>),
</span></span><span style="display:flex;"><span> (<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#39;S005&#39;</span>, <span style="color:#e6db74">&#39;祈博&#39;</span>, <span style="color:#e6db74">&#39;女&#39;</span>, <span style="color:#ae81ff">24</span>, <span style="color:#e6db74">&#39;山东&#39;</span>)]</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [23]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>engine<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;SELECT count(1) FROM student&#34;</span>)<span style="color:#f92672">.</span>first()</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[23]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>(<span style="color:#ae81ff">24</span>,)</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h1 id="38python批量翻译英语单词" class="pagebody-header">
    38、Python批量翻译英语单词
  </h1>
</div><p class="component-content component">*<strong>用途：*</strong>
对批量的英语文本，生成英语-汉语翻译的单词本，提供Excel下载</p>
<p class="component-content component">*<strong>本代码实现：*</strong></p>
<div class="component-content component"><ol>
<li>
<p class="component-content component">提供一个英文文章URL，自动下载网页；</p>
</li>
<li>
<p class="component-content component">实现网页中所有英语单词的翻译；</p>
</li>
<li>
<p class="component-content component">下载翻译结果的Excel</p>
<p class="component-content component">*<strong>涉及技术：*</strong></p>
</li>
<li>
<p class="component-content component">pandas的读取csv、多数据merge、输出Excel</p>
</li>
<li>
<p class="component-content component">requests库下载HTML网页</p>
</li>
<li>
<p class="component-content component">BeautifulSoup解析HTML网页</p>
</li>
<li>
<p class="component-content component">Python正则表达式实现英文分词</p>
</li>
</ol></div>

<div class="component-content pagebody component">
  <h3 id="1-读取英语-汉语翻译词典文件" class="pagebody-header">
    1. 读取英语-汉语翻译词典文件
  </h3>
</div><p class="component-content component">词典文件来自：https://github.com/skywind3000/ECDICT 使用步骤：</p>
<div class="component-content component"><ol>
<li>下载代码打包：https://github.com/skywind3000/ECDICT/archive/master.zip</li>
<li>解压master.zip，然后解压其中的‪stardict.csv文件</li>
</ol></div>
<p class="component-content component">In [1]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [2]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 注意：stardict.csv的地址需要替换成你自己的文件地址</span>
</span></span><span style="display:flex;"><span>df_dict <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#34;D:/tmp/ECDICT-master/stardict.csv&#34;</span>)
</span></span><span style="display:flex;"><span>d:\Anaconda3\lib\site<span style="color:#f92672">-</span>packages\IPython\core\interactiveshell<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">3063</span>: DtypeWarning: Columns (<span style="color:#ae81ff">11</span>) have mixed types<span style="color:#f92672">.</span>Specify dtype option on <span style="color:#f92672">import</span> or set low_memory<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span><span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>  interactivity<span style="color:#f92672">=</span>interactivity, compiler<span style="color:#f92672">=</span>compiler, result<span style="color:#f92672">=</span>result)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [3]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_dict<span style="color:#f92672">.</span>shape</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[3]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>(<span style="color:#ae81ff">3402564</span>, <span style="color:#ae81ff">13</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [4]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_dict<span style="color:#f92672">.</span>sample(<span style="color:#ae81ff">10</span>)<span style="color:#f92672">.</span>head()</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[4]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">word</th>
<th style="text-align:right">phonetic</th>
<th style="text-align:right">definition</th>
<th style="text-align:right">translation</th>
<th style="text-align:right">pos</th>
<th style="text-align:right">collins</th>
<th style="text-align:right">oxford</th>
<th style="text-align:right">tag</th>
<th style="text-align:right">bnc</th>
<th style="text-align:right">frq</th>
<th style="text-align:right">exchange</th>
<th style="text-align:right">detail</th>
<th style="text-align:right">audio</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">3370509</td>
<td style="text-align:right">WWDH</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">[网络] 淇楄壋</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">518014</td>
<td style="text-align:right">chauhtan (chotan)</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">卓丹</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">389953</td>
<td style="text-align:right">breviarist</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">[网络] 短笛师</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">951231</td>
<td style="text-align:right">electric-vehicle</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">abbr. “EV”的变体；“electric car”的变体\n[网络] 电动汽车</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">91258</td>
<td style="text-align:right">Albionian</td>
<td style="text-align:right">æl&rsquo;biәniәn</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">[地质]阿尔比翁期</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
</tbody>
</table></div>
<p class="component-content component">In [5]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 把word、translation之外的列扔掉</span>
</span></span><span style="display:flex;"><span>df_dict <span style="color:#f92672">=</span> df_dict[[<span style="color:#e6db74">&#34;word&#34;</span>, <span style="color:#e6db74">&#34;translation&#34;</span>]]
</span></span><span style="display:flex;"><span>df_dict<span style="color:#f92672">.</span>head()</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[5]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">word</th>
<th style="text-align:right">translation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">&lsquo;a</td>
<td style="text-align:right">na. 一\nn. 英文字母表的第一字母；【乐】A音\nart. 冠以不定冠词主要表示类别...</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">&lsquo;A&rsquo; game</td>
<td style="text-align:right">[网络] 游戏；一个游戏；一局</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">&lsquo;Abbāsīyah</td>
<td style="text-align:right">[地名] 阿巴西耶 ( 埃 )</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">&lsquo;Abd al Kūrī</td>
<td style="text-align:right">[地名] 阿卜杜勒库里岛 ( 也门 )</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">&lsquo;Abd al Mājid</td>
<td style="text-align:right">[地名] 阿卜杜勒马吉德 ( 苏丹 )</td>
</tr>
</tbody>
</table></div>

<div class="component-content pagebody component">
  <h3 id="2-下载网页得到网页内容" class="pagebody-header">
    2. 下载网页，得到网页内容
  </h3>
</div><p class="component-content component">In [6]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> requests</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [7]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Pandas官方文档中的一个URL</span>
</span></span><span style="display:flex;"><span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://pandas.pydata.org/docs/user_guide/indexing.html&#34;</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">In [8]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>html_cont <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(url)<span style="color:#f92672">.</span>text</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [9]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>html_cont[:<span style="color:#ae81ff">100</span>]</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[9]:</p>
<div class="component-content pagebody component code">
  
  
  
  <pre><code class="">&#39;\n\n&lt;!DOCTYPE html&gt;\n\n&lt;html xmlns=&#34;http://www.w3.org/1999/xhtml&#34;&gt;\n  &lt;head&gt;\n    &lt;meta charset=&#34;utf-8&#34; /&gt;&#39;</code></pre>
  
</div>
<div class="component-content pagebody component">
  <h3 id="3-提取html的正文内容" class="pagebody-header">
    3. 提取HTML的正文内容
  </h3>
</div><p class="component-content component">即：去除HTML标签，获取正文</p>
<p class="component-content component">In [10]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> bs4 <span style="color:#f92672">import</span> BeautifulSoup
</span></span><span style="display:flex;"><span>soup <span style="color:#f92672">=</span> BeautifulSoup(html_cont)
</span></span><span style="display:flex;"><span>html_text <span style="color:#f92672">=</span> soup<span style="color:#f92672">.</span>get_text()</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [11]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>html_text[:<span style="color:#ae81ff">500</span>]</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[11]:</p>
<div class="component-content pagebody component code">
  
  
  
  <pre><code class="">&#39;\n\n\nIndexing and selecting data — pandas 1.0.1 documentation\n\n\n\n\n\n\n\n\n\n\n\n\nMathJax.Hub.Config({&#34;tex2jax&#34;: {&#34;inlineMath&#34;: [[&#34;$&#34;, &#34;$&#34;], [&#34;\\\\(&#34;, &#34;\\\\)&#34;]], &#34;processEscapes&#34;: true, &#34;ignoreClass&#34;: &#34;document&#34;, &#34;processClass&#34;: &#34;math|output_area&#34;}})\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nHome\n\n\nWhat\&#39;s New in 1.0.0\n\n\nGetting started\n\n\nUser Guide\n\n\nAPI reference\n\n\nDevelopment\n\n\nRelease Notes\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nIO tools (text, CSV, HDF5, â\x80¦)\n\n\nIndexing and selecting data\n\n\nMultiIndex / advanced indexing\n\n\nMerge, join, a&#39;</code></pre>
  
</div>
<div class="component-content pagebody component">
  <h3 id="4-英文分词和数据清洗" class="pagebody-header">
    4. 英文分词和数据清洗
  </h3>
</div><p class="component-content component">In [12]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 分词</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span>word_list <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34;&#34;&#34;[ ,.\(\)/</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">|\-:=\$\[&#34;&#39;]&#34;&#34;&#34;</span>,html_text)
</span></span><span style="display:flex;"><span>word_list[:<span style="color:#ae81ff">10</span>]</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[12]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>[<span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">&#39;Indexing&#39;</span>, <span style="color:#e6db74">&#39;and&#39;</span>, <span style="color:#e6db74">&#39;selecting&#39;</span>, <span style="color:#e6db74">&#39;data&#39;</span>, <span style="color:#e6db74">&#39;—&#39;</span>, <span style="color:#e6db74">&#39;pandas&#39;</span>, <span style="color:#e6db74">&#39;1&#39;</span>]</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [13]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 读取停用词表，从网上复制的，位于当前目录下</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;./datas/stop_words/stop_words.txt&#34;</span>) <span style="color:#66d9ef">as</span> fin:
</span></span><span style="display:flex;"><span>    stop_words<span style="color:#f92672">=</span>set(fin<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>))
</span></span><span style="display:flex;"><span>list(stop_words)[:<span style="color:#ae81ff">10</span>]</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[13]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>[<span style="color:#e6db74">&#39;&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;itself&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;showed&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;throughout&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;pointed&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;n&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;against&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;name&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;none&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;ran&#39;</span>]</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [14]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 数据清洗</span>
</span></span><span style="display:flex;"><span>word_list_clean <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> word <span style="color:#f92672">in</span> word_list:
</span></span><span style="display:flex;"><span>    word <span style="color:#f92672">=</span> str(word)<span style="color:#f92672">.</span>lower()<span style="color:#f92672">.</span>strip()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 过滤掉空词、数字、单个字符的词、停用词</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> word <span style="color:#f92672">or</span> word<span style="color:#f92672">.</span>isnumeric() <span style="color:#f92672">or</span> len(word)<span style="color:#f92672">&lt;=</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">or</span> word <span style="color:#f92672">in</span> stop_words:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>    word_list_clean<span style="color:#f92672">.</span>append(word)
</span></span><span style="display:flex;"><span>word_list_clean[:<span style="color:#ae81ff">20</span>]</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[14]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>[<span style="color:#e6db74">&#39;indexing&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;selecting&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;data&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;pandas&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;documentation&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;mathjax&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;hub&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;config&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;tex2jax&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;inlinemath&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;]]&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;processescapes&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;true&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;ignoreclass&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;document&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;processclass&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;math&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;output_area&#39;</span>]</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="5-分词结果构造成一个dataframe" class="pagebody-header">
    5. 分词结果构造成一个DataFrame
  </h3>
</div><p class="component-content component">In [15]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_words <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame({
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;word&#34;</span>: word_list_clean
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>df_words<span style="color:#f92672">.</span>head()</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[15]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">word</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">indexing</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">selecting</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">data</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">pandas</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">documentation</td>
</tr>
</tbody>
</table></div>
<p class="component-content component">In [16]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_words<span style="color:#f92672">.</span>shape</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[16]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>(<span style="color:#ae81ff">4915</span>, <span style="color:#ae81ff">1</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [17]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 统计词频</span>
</span></span><span style="display:flex;"><span>df_words <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>    df_words
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#34;word&#34;</span>)[<span style="color:#e6db74">&#34;word&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>agg(count<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;size&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>reset_index()
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>sort_values(by<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;count&#34;</span>, ascending<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>df_words<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">10</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[17]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">word</th>
<th style="text-align:right">count</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">620</td>
<td style="text-align:right">df</td>
<td style="text-align:right">161</td>
</tr>
<tr>
<td style="text-align:right">659</td>
<td style="text-align:right">dtype</td>
<td style="text-align:right">87</td>
</tr>
<tr>
<td style="text-align:right">1274</td>
<td style="text-align:right">true</td>
<td style="text-align:right">86</td>
</tr>
<tr>
<td style="text-align:right">593</td>
<td style="text-align:right">dataframe</td>
<td style="text-align:right">80</td>
</tr>
<tr>
<td style="text-align:right">1038</td>
<td style="text-align:right">pd</td>
<td style="text-align:right">75</td>
</tr>
<tr>
<td style="text-align:right">917</td>
<td style="text-align:right">loc</td>
<td style="text-align:right">72</td>
</tr>
<tr>
<td style="text-align:right">970</td>
<td style="text-align:right">nan</td>
<td style="text-align:right">72</td>
</tr>
<tr>
<td style="text-align:right">721</td>
<td style="text-align:right">false</td>
<td style="text-align:right">58</td>
</tr>
<tr>
<td style="text-align:right">914</td>
<td style="text-align:right">list</td>
<td style="text-align:right">58</td>
</tr>
<tr>
<td style="text-align:right">835</td>
<td style="text-align:right">indexing</td>
<td style="text-align:right">53</td>
</tr>
</tbody>
</table></div>

<div class="component-content pagebody component">
  <h3 id="6-和单词词典实现merge" class="pagebody-header">
    6. 和单词词典实现merge
  </h3>
</div><p class="component-content component">In [18]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_merge <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>merge(
</span></span><span style="display:flex;"><span>    left <span style="color:#f92672">=</span> df_dict,
</span></span><span style="display:flex;"><span>    right <span style="color:#f92672">=</span> df_words,
</span></span><span style="display:flex;"><span>    left_on <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;word&#34;</span>,
</span></span><span style="display:flex;"><span>    right_on <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;word&#34;</span>
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [19]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_merge<span style="color:#f92672">.</span>sample(<span style="color:#ae81ff">10</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[19]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">word</th>
<th style="text-align:right">translation</th>
<th style="text-align:right">count</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">658</td>
<td style="text-align:right">team</td>
<td style="text-align:right">n. 队, 组\nvt. 把马(牛)套在同一辆车上, 把&hellip;编成一组\nvi. 驾驶卡车, 协作</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">523</td>
<td style="text-align:right">providing</td>
<td style="text-align:right">conj. 以&hellip;为条件, 假如</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">394</td>
<td style="text-align:right">lines</td>
<td style="text-align:right">n. 台词</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">118</td>
<td style="text-align:right">columns</td>
<td style="text-align:right">塔器</td>
<td style="text-align:right">49</td>
</tr>
<tr>
<td style="text-align:right">136</td>
<td style="text-align:right">conforms</td>
<td style="text-align:right">v. 遵守( conform的第三人称单数 ); 顺应; 相一致; 相符合</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">529</td>
<td style="text-align:right">python</td>
<td style="text-align:right">n. 大蟒, 巨蟒\n[计] Python 程序设计语言；人生苦短，我用 Python</td>
<td style="text-align:right">26</td>
</tr>
<tr>
<td style="text-align:right">185</td>
<td style="text-align:right">determine</td>
<td style="text-align:right">v. 决定, 决心</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">285</td>
<td style="text-align:right">forward</td>
<td style="text-align:right">a. 向前的, 早的, 迅速的, 在前的, 进步的\nvt. 促进&hellip;的生长, 转寄, 运&hellip;</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">49</td>
<td style="text-align:right">arguments</td>
<td style="text-align:right">n. 参数</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">564</td>
<td style="text-align:right">reported</td>
<td style="text-align:right">a. 报告的；据报道的</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table></div>
<p class="component-content component">In [20]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_merge<span style="color:#f92672">.</span>shape</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[20]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>(<span style="color:#ae81ff">718</span>, <span style="color:#ae81ff">3</span>)</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="7-存入excel" class="pagebody-header">
    7. 存入Excel
  </h3>
</div><p class="component-content component">In [21]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_merge<span style="color:#f92672">.</span>to_excel(<span style="color:#e6db74">&#34;./38. batch_chinese_english.xlsx&#34;</span>, index<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="后续升级" class="pagebody-header">
    后续升级：
  </h3>
</div><div class="component-content component"><ol>
<li>可以提供txt/excel/word/pdf的批量输入，生成单词本；</li>
<li>可以做成网页、微信小程序的形式，在线访问和使用</li>
<li>用户可以标记或上传“已经认识的词语”，每次过滤掉</li>
</ol></div>

<div class="component-content pagebody component">
  <h1 id="39python自动翻译英语论文pdf" class="pagebody-header">
    39、Python自动翻译英语论文PDF
  </h1>
</div><p class="component-content component">*<strong>涉及技术：*</strong></p>
<div class="component-content component"><ol>
<li>Python读取PDF文本</li>
<li>pandas的读取csv、多数据merge、输出Excel</li>
<li>Python正则表达式实现英文分词</li>
</ol></div>

<div class="component-content pagebody component">
  <h3 id="1-读取pdf文本内容" class="pagebody-header">
    1. 读取PDF文本内容
  </h3>
</div><p class="component-content component">In [1]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>pip install <span style="color:#f92672">-</span>i https:<span style="color:#f92672">//</span>pypi<span style="color:#f92672">.</span>tuna<span style="color:#f92672">.</span>tsinghua<span style="color:#f92672">.</span>edu<span style="color:#f92672">.</span>cn<span style="color:#f92672">/</span>simple pdfplumber
</span></span><span style="display:flex;"><span>Looking <span style="color:#f92672">in</span> indexes: https:<span style="color:#f92672">//</span>pypi<span style="color:#f92672">.</span>tuna<span style="color:#f92672">.</span>tsinghua<span style="color:#f92672">.</span>edu<span style="color:#f92672">.</span>cn<span style="color:#f92672">/</span>simple
</span></span><span style="display:flex;"><span>Requirement already satisfied: pdfplumber <span style="color:#f92672">in</span> d:\anaconda3\lib\site<span style="color:#f92672">-</span>packages (<span style="color:#ae81ff">0.5.16</span>)
</span></span><span style="display:flex;"><span>Requirement already satisfied: chardet <span style="color:#f92672">in</span> d:\anaconda3\lib\site<span style="color:#f92672">-</span>packages (<span style="color:#f92672">from</span> pdfplumber) (<span style="color:#ae81ff">3.0.4</span>)
</span></span><span style="display:flex;"><span>Requirement already satisfied: pdfminer<span style="color:#f92672">.</span>six<span style="color:#f92672">==</span><span style="color:#ae81ff">20200104</span> <span style="color:#f92672">in</span> d:\anaconda3\lib\site<span style="color:#f92672">-</span>packages (<span style="color:#f92672">from</span> pdfplumber) (<span style="color:#ae81ff">20200104</span>)
</span></span><span style="display:flex;"><span>Requirement already satisfied: pillow<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">7.0.0</span> <span style="color:#f92672">in</span> d:\anaconda3\lib\site<span style="color:#f92672">-</span>packages (<span style="color:#f92672">from</span> pdfplumber) (<span style="color:#ae81ff">7.0.0</span>)
</span></span><span style="display:flex;"><span>Requirement already satisfied: unicodecsv<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">0.14.1</span> <span style="color:#f92672">in</span> d:\anaconda3\lib\site<span style="color:#f92672">-</span>packages (<span style="color:#f92672">from</span> pdfplumber) (<span style="color:#ae81ff">0.14.1</span>)
</span></span><span style="display:flex;"><span>Requirement already satisfied: six <span style="color:#f92672">in</span> d:\anaconda3\lib\site<span style="color:#f92672">-</span>packages (<span style="color:#f92672">from</span> pdfplumber) (<span style="color:#ae81ff">1.14.0</span>)
</span></span><span style="display:flex;"><span>Requirement already satisfied: wand <span style="color:#f92672">in</span> d:\anaconda3\lib\site<span style="color:#f92672">-</span>packages (<span style="color:#f92672">from</span> pdfplumber) (<span style="color:#ae81ff">0.5.9</span>)
</span></span><span style="display:flex;"><span>Requirement already satisfied: pycryptodome <span style="color:#f92672">in</span> d:\anaconda3\lib\site<span style="color:#f92672">-</span>packages (<span style="color:#f92672">from</span> pdfplumber) (<span style="color:#ae81ff">3.9.7</span>)
</span></span><span style="display:flex;"><span>Requirement already satisfied: sortedcontainers <span style="color:#f92672">in</span> d:\anaconda3\lib\site<span style="color:#f92672">-</span>packages (<span style="color:#f92672">from</span> pdfminer.six<span style="color:#f92672">==</span><span style="color:#ae81ff">20200104</span><span style="color:#f92672">-&gt;</span>pdfplumber) (<span style="color:#ae81ff">2.1.0</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [48]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pdfplumber
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">read_pdf</span>(pdf_fpath):
</span></span><span style="display:flex;"><span>    pdf <span style="color:#f92672">=</span> pdfplumber<span style="color:#f92672">.</span>open(pdf_fpath)
</span></span><span style="display:flex;"><span>    page_conts <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> page <span style="color:#f92672">in</span> pdf<span style="color:#f92672">.</span>pages:
</span></span><span style="display:flex;"><span>        page_conts<span style="color:#f92672">.</span>append(page<span style="color:#f92672">.</span>extract_text())
</span></span><span style="display:flex;"><span>    pdf<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34; &#34;</span><span style="color:#f92672">.</span>join(page_conts)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [49]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>pdf_fpath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;D:/tmp/Wide &amp; Deep Learning for Recommender Systems.pdf&#34;</span>
</span></span><span style="display:flex;"><span>pdf_cont <span style="color:#f92672">=</span> read_pdf(pdf_fpath)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [50]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>print(pdf_cont[:<span style="color:#ae81ff">2000</span>])
</span></span><span style="display:flex;"><span>Wide <span style="color:#f92672">&amp;</span> Deep Learning <span style="color:#66d9ef">for</span> Recommender Systems
</span></span><span style="display:flex;"><span>Heng<span style="color:#f92672">-</span>Tze Cheng, Levent Koc, Jeremiah Harmsen, Tal Shaked, Tushar Chandra,
</span></span><span style="display:flex;"><span>Hrishi Aradhye, Glen Anderson, Greg Corrado, Wei Chai, Mustafa Ispir, Rohan Anil,
</span></span><span style="display:flex;"><span>Zakaria Haque, Lichan Hong, Vihan Jain, Xiaobing Liu, Hemal Shah
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">∗</span>
</span></span><span style="display:flex;"><span>GoogleInc<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>ABSTRACT
</span></span><span style="display:flex;"><span>have never <span style="color:#f92672">or</span> rarely occurred <span style="color:#f92672">in</span> the past<span style="color:#f92672">.</span> Recommenda<span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>tions based on memorization are usually more topical <span style="color:#f92672">and</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> Generalized linear models <span style="color:#66d9ef">with</span> nonlinear feature transfor<span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span>directly relevant to the items on which users have already
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span> mations are widely used <span style="color:#66d9ef">for</span> large<span style="color:#f92672">-</span>scale regression <span style="color:#f92672">and</span> clas<span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span>performed actions<span style="color:#f92672">.</span> Compared <span style="color:#66d9ef">with</span> memorization, general<span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span> siﬁcationproblemswithsparseinputs<span style="color:#f92672">.</span> Memorizationoffea<span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span>ization tends to improve the diversity of the recommended
</span></span><span style="display:flex;"><span>  tureinteractionsthroughawide setofcross<span style="color:#f92672">-</span>productfeature
</span></span><span style="display:flex;"><span>n items<span style="color:#f92672">.</span> Inthispaper,wefocusontheappsrecommendation
</span></span><span style="display:flex;"><span>transformationsareeﬀectiveandinterpretable,whilegener<span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span>u problemfortheGooglePlaystore,buttheapproachshould
</span></span><span style="display:flex;"><span>alizationrequiresmorefeatureengineeringeﬀort<span style="color:#f92672">.</span> Withless
</span></span><span style="display:flex;"><span>J apply to generic recommender systems<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>  featureengineering,deepneuralnetworkscangeneralizebet<span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span> Formassive<span style="color:#f92672">-</span>scaleonlinerecommendationandrankingsys<span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span>tertounseenfeaturecombinationsthroughlow<span style="color:#f92672">-</span>dimensional
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span> temsinanindustrialsetting,generalizedlinearmodelssuch
</span></span><span style="display:flex;"><span>denseembeddingslearnedforthesparsefeatures<span style="color:#f92672">.</span> However,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">as</span> logistic regression are widely used because they are sim<span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span>  deep neural networks <span style="color:#66d9ef">with</span> embeddings can over<span style="color:#f92672">-</span>generalize
</span></span><span style="display:flex;"><span>] ple,scalableandinterpretable<span style="color:#f92672">.</span> Themodelsareoftentrained
</span></span><span style="display:flex;"><span>G andrecommendlessrelevantitemswhentheuser<span style="color:#f92672">-</span>iteminter<span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span>onbinarizedsparsefeatureswithone<span style="color:#f92672">-</span>hotencoding<span style="color:#f92672">.</span> E<span style="color:#f92672">.</span>g<span style="color:#f92672">.</span>,the
</span></span><span style="display:flex;"><span>actions are sparse <span style="color:#f92672">and</span> high<span style="color:#f92672">-</span>rank<span style="color:#f92672">.</span> In this paper, we present
</span></span><span style="display:flex;"><span>L binary feature<span style="color:#960050;background-color:#1e0010">“</span>user_installed_app<span style="color:#f92672">=</span>netflix<span style="color:#960050;background-color:#1e0010">”</span>has value <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Wide <span style="color:#f92672">&amp;</span> Deep learning<span style="color:#960050;background-color:#1e0010">—</span>jointly trained wide linear models
</span></span><span style="display:flex;"><span><span style="color:#f92672">.</span> <span style="color:#66d9ef">if</span> the user installed Netﬂix<span style="color:#f92672">.</span> Memorization can be achieved
</span></span><span style="display:flex;"><span>s anddeepneuralnetworks<span style="color:#960050;background-color:#1e0010">—</span>tocombinethebeneﬁtsofmem<span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span>c orization <span style="color:#f92672">and</span> generalization <span style="color:#66d9ef">for</span> recommender systems<span style="color:#f92672">.</span> We eﬀectively using cross<span style="color:#f92672">-</span>product t</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="2-读取英语-汉语翻译词典文件" class="pagebody-header">
    2. 读取英语-汉语翻译词典文件
  </h3>
</div><p class="component-content component">词典文件来自：https://github.com/skywind3000/ECDICT 使用步骤：</p>
<div class="component-content component"><ol>
<li>下载代码打包：https://github.com/skywind3000/ECDICT/archive/master.zip</li>
<li>解压master.zip，然后解压其中的‪stardict.csv文件</li>
</ol></div>
<p class="component-content component">In [8]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [9]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 注意：stardict.csv的地址需要替换成你自己的文件地址</span>
</span></span><span style="display:flex;"><span>df_dict <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#34;D:/tmp/ECDICT-master/stardict.csv&#34;</span>)
</span></span><span style="display:flex;"><span>d:\Anaconda3\lib\site<span style="color:#f92672">-</span>packages\IPython\core\interactiveshell<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">3063</span>: DtypeWarning: Columns (<span style="color:#ae81ff">11</span>) have mixed types<span style="color:#f92672">.</span>Specify dtype option on <span style="color:#f92672">import</span> or set low_memory<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span><span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>  interactivity<span style="color:#f92672">=</span>interactivity, compiler<span style="color:#f92672">=</span>compiler, result<span style="color:#f92672">=</span>result)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [10]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_dict<span style="color:#f92672">.</span>shape</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[10]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>(<span style="color:#ae81ff">3402564</span>, <span style="color:#ae81ff">13</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [11]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_dict<span style="color:#f92672">.</span>sample(<span style="color:#ae81ff">10</span>)<span style="color:#f92672">.</span>head()</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[11]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">word</th>
<th style="text-align:right">phonetic</th>
<th style="text-align:right">definition</th>
<th style="text-align:right">translation</th>
<th style="text-align:right">pos</th>
<th style="text-align:right">collins</th>
<th style="text-align:right">oxford</th>
<th style="text-align:right">tag</th>
<th style="text-align:right">bnc</th>
<th style="text-align:right">frq</th>
<th style="text-align:right">exchange</th>
<th style="text-align:right">detail</th>
<th style="text-align:right">audio</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">801655</td>
<td style="text-align:right">design height</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">设计高度</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2739800</td>
<td style="text-align:right">shibu</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">[网络] 方回春堂；喊吧</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">1232187</td>
<td style="text-align:right">genus Testudo</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">[网络] Testudo属</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">s:genus testudoes</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2403094</td>
<td style="text-align:right">profit-and-loss statements</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">[会计] 损益表</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">0:profit-and-loss statement/1:s</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">1197174</td>
<td style="text-align:right">gain limited sensitivity</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">极限增益灵敏度</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
</tbody>
</table></div>
<p class="component-content component">In [12]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 把word、translation之外的列扔掉</span>
</span></span><span style="display:flex;"><span>df_dict <span style="color:#f92672">=</span> df_dict[[<span style="color:#e6db74">&#34;word&#34;</span>, <span style="color:#e6db74">&#34;translation&#34;</span>]]
</span></span><span style="display:flex;"><span>df_dict<span style="color:#f92672">.</span>head()</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[12]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">word</th>
<th style="text-align:right">translation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">&lsquo;a</td>
<td style="text-align:right">na. 一\nn. 英文字母表的第一字母；【乐】A音\nart. 冠以不定冠词主要表示类别...</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">&lsquo;A&rsquo; game</td>
<td style="text-align:right">[网络] 游戏；一个游戏；一局</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">&lsquo;Abbāsīyah</td>
<td style="text-align:right">[地名] 阿巴西耶 ( 埃 )</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">&lsquo;Abd al Kūrī</td>
<td style="text-align:right">[地名] 阿卜杜勒库里岛 ( 也门 )</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">&lsquo;Abd al Mājid</td>
<td style="text-align:right">[地名] 阿卜杜勒马吉德 ( 苏丹 )</td>
</tr>
</tbody>
</table></div>

<div class="component-content pagebody component">
  <h3 id="3-英文分词和数据清洗" class="pagebody-header">
    3. 英文分词和数据清洗
  </h3>
</div><p class="component-content component">In [13]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 分词</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span>word_list <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34;&#34;&#34;[ ,.\(\)/</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">|\-:=\$\[&#34;&#39;]&#34;&#34;&#34;</span>, pdf_cont)
</span></span><span style="display:flex;"><span>word_list[:<span style="color:#ae81ff">10</span>]</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[13]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>[<span style="color:#e6db74">&#39;Wide&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;&amp;&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;Deep&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;Learning&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;for&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;Recommender&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;Systems&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;Heng&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;Tze&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;Cheng&#39;</span>]</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [14]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 数据清洗</span>
</span></span><span style="display:flex;"><span>word_list_clean <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> word <span style="color:#f92672">in</span> word_list:
</span></span><span style="display:flex;"><span>    word <span style="color:#f92672">=</span> str(word)<span style="color:#f92672">.</span>lower()<span style="color:#f92672">.</span>strip()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 过滤掉空词、数字、单个字符的词、停用词</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> word <span style="color:#f92672">or</span> word<span style="color:#f92672">.</span>isnumeric() <span style="color:#f92672">or</span> len(word)<span style="color:#f92672">&lt;=</span><span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>    word_list_clean<span style="color:#f92672">.</span>append(word)
</span></span><span style="display:flex;"><span>word_list_clean[:<span style="color:#ae81ff">20</span>]</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[14]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>[<span style="color:#e6db74">&#39;wide&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;deep&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;learning&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;for&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;recommender&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;systems&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;heng&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;tze&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;cheng&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;levent&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;koc&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;jeremiah&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;harmsen&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;tal&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;shaked&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;tushar&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;chandra&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;hrishi&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;aradhye&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;glen&#39;</span>]</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="4-分词结果构造成一个dataframe" class="pagebody-header">
    4. 分词结果构造成一个DataFrame
  </h3>
</div><p class="component-content component">In [15]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_words <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame({
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;word&#34;</span>: word_list_clean
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>df_words<span style="color:#f92672">.</span>head()</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[15]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">word</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">wide</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">deep</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">learning</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">for</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">recommender</td>
</tr>
</tbody>
</table></div>
<p class="component-content component">In [16]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_words<span style="color:#f92672">.</span>shape</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[16]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>(<span style="color:#ae81ff">2322</span>, <span style="color:#ae81ff">1</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [17]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 统计词频</span>
</span></span><span style="display:flex;"><span>df_words <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>    df_words
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#34;word&#34;</span>)[<span style="color:#e6db74">&#34;word&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>agg(count<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;size&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>reset_index()
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>sort_values(by<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;count&#34;</span>, ascending<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>df_words<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">10</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[17]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">word</th>
<th style="text-align:right">count</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">804</td>
<td style="text-align:right">the</td>
<td style="text-align:right">128</td>
</tr>
<tr>
<td style="text-align:right">57</td>
<td style="text-align:right">and</td>
<td style="text-align:right">67</td>
</tr>
<tr>
<td style="text-align:right">546</td>
<td style="text-align:right">of</td>
<td style="text-align:right">46</td>
</tr>
<tr>
<td style="text-align:right">503</td>
<td style="text-align:right">model</td>
<td style="text-align:right">41</td>
</tr>
<tr>
<td style="text-align:right">939</td>
<td style="text-align:right">wide</td>
<td style="text-align:right">36</td>
</tr>
<tr>
<td style="text-align:right">374</td>
<td style="text-align:right">in</td>
<td style="text-align:right">36</td>
</tr>
<tr>
<td style="text-align:right">203</td>
<td style="text-align:right">deep</td>
<td style="text-align:right">35</td>
</tr>
<tr>
<td style="text-align:right">405</td>
<td style="text-align:right">is</td>
<td style="text-align:right">31</td>
</tr>
<tr>
<td style="text-align:right">286</td>
<td style="text-align:right">for</td>
<td style="text-align:right">30</td>
</tr>
<tr>
<td style="text-align:right">845</td>
<td style="text-align:right">to</td>
<td style="text-align:right">29</td>
</tr>
</tbody>
</table></div>

<div class="component-content pagebody component">
  <h3 id="5-和单词词典实现merge" class="pagebody-header">
    5. 和单词词典实现merge
  </h3>
</div><p class="component-content component">In [21]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_merge <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>merge(
</span></span><span style="display:flex;"><span>    left <span style="color:#f92672">=</span> df_dict,
</span></span><span style="display:flex;"><span>    right <span style="color:#f92672">=</span> df_words,
</span></span><span style="display:flex;"><span>    left_on <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;word&#34;</span>,
</span></span><span style="display:flex;"><span>    right_on <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;word&#34;</span>
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [32]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_merge<span style="color:#f92672">.</span>sample(<span style="color:#ae81ff">10</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[32]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">word</th>
<th style="text-align:right">translation</th>
<th style="text-align:right">count</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">account</td>
<td style="text-align:right">n. 报告, 解释, 估价, 理由, 利润, 算账, 帐目\nvi. 报帐, 解释, 导致,&hellip;</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">380</td>
<td style="text-align:right">prediction</td>
<td style="text-align:right">n. 预言, 预报\n[化] 预测</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">185</td>
<td style="text-align:right">generalization</td>
<td style="text-align:right">n. 一般化, 普遍化, 概括\n[化] 推广; 普适化</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td style="text-align:right">56</td>
<td style="text-align:right">burget</td>
<td style="text-align:right">[人名] 伯吉特</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">372</td>
<td style="text-align:right">pipeline</td>
<td style="text-align:right">n. 管道, 传递途径\n[化] 管路; 管线</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">237</td>
<td style="text-align:right">include</td>
<td style="text-align:right">vt. 包括, 把&hellip;算入, 包住\n[计] DOS内部命令:在CONFIG.SYS文件的&hellip;</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">524</td>
<td style="text-align:right">threads</td>
<td style="text-align:right">n. 线；相关串连；线程（thread的复数）</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">208</td>
<td style="text-align:right">heng</td>
<td style="text-align:right">n. 恒; 珩</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">62</td>
<td style="text-align:right">capacity</td>
<td style="text-align:right">n. 容量, 能力, 才能, 资格\n[计] 容量</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">228</td>
<td style="text-align:right">important</td>
<td style="text-align:right">a. 重要的, 有地位的, 大量的, 显要的, 自负的\n[计] 要点</td>
<td style="text-align:right">2</td>
</tr>
</tbody>
</table></div>
<p class="component-content component">In [33]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_merge<span style="color:#f92672">.</span>shape</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[33]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>(<span style="color:#ae81ff">607</span>, <span style="color:#ae81ff">3</span>)</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="6-存入excel" class="pagebody-header">
    6. 存入Excel
  </h3>
</div><p class="component-content component">In [34]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_merge<span style="color:#f92672">.</span>to_excel(<span style="color:#e6db74">&#34;./39. pdf_chinese_english.xlsx&#34;</span>, index<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h1 id="40pandas怎样实现groupby聚合后字符串列的合并" class="pagebody-header">
    40、Pandas怎样实现groupby聚合后字符串列的合并
  </h1>
</div>
<div class="component-content pagebody component">
  <h4 id="需求" class="pagebody-header">
    需求：
  </h4>
</div><p class="component-content component">计算每个月的最高温度、最低温度、出现的风向列表、出现的空气质量列表</p>

<div class="component-content pagebody component">
  <h4 id="数据输入" class="pagebody-header">
    数据输入
  </h4>
</div><p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-49f0a1b8342c646fe56c5badfcf59506" id="lht49f0a1b8342c646fe56c5badfcf59506">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/31.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h4 id="数据输出" class="pagebody-header">
    数据输出
  </h4>
</div><p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-107226b55056fefe9c4cce41008440f3" id="lht107226b55056fefe9c4cce41008440f3">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/32.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h3 id="读取数据" class="pagebody-header">
    读取数据
  </h3>
</div><p class="component-content component">In [1]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [2]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>fpath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./datas/beijing_tianqi/beijing_tianqi_2018.csv&#34;</span>
</span></span><span style="display:flex;"><span>df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(fpath)
</span></span><span style="display:flex;"><span>df<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">3</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[2]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2018-01-01</td>
<td style="text-align:right">3℃</td>
<td style="text-align:right">-6℃</td>
<td style="text-align:right">晴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">59</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01-02</td>
<td style="text-align:right">2℃</td>
<td style="text-align:right">-5℃</td>
<td style="text-align:right">阴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">49</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2018-01-03</td>
<td style="text-align:right">2℃</td>
<td style="text-align:right">-5℃</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">28</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table></div>

<div class="component-content pagebody component">
  <h4 id="知识使用dfinfo可以查看每列的类型" class="pagebody-header">
    知识：使用df.info()可以查看每列的类型
  </h4>
</div><p class="component-content component">In [3]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df<span style="color:#f92672">.</span>info()
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">class</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">pandas</span><span style="color:#f92672">.</span>core<span style="color:#f92672">.</span>frame<span style="color:#f92672">.</span>DataFrame<span style="color:#e6db74">&#39;&gt;</span>
</span></span><span style="display:flex;"><span>RangeIndex: <span style="color:#ae81ff">365</span> entries, <span style="color:#ae81ff">0</span> to <span style="color:#ae81ff">364</span>
</span></span><span style="display:flex;"><span>Data columns (total <span style="color:#ae81ff">9</span> columns):
</span></span><span style="display:flex;"><span> <span style="color:#75715e">#   Column     Non-Null Count  Dtype </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">---</span>  <span style="color:#f92672">------</span>     <span style="color:#f92672">--------------</span>  <span style="color:#f92672">-----</span> 
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">0</span>   ymd        <span style="color:#ae81ff">365</span> non<span style="color:#f92672">-</span>null    object
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">1</span>   bWendu     <span style="color:#ae81ff">365</span> non<span style="color:#f92672">-</span>null    object
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">2</span>   yWendu     <span style="color:#ae81ff">365</span> non<span style="color:#f92672">-</span>null    object
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">3</span>   tianqi     <span style="color:#ae81ff">365</span> non<span style="color:#f92672">-</span>null    object
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">4</span>   fengxiang  <span style="color:#ae81ff">365</span> non<span style="color:#f92672">-</span>null    object
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">5</span>   fengli     <span style="color:#ae81ff">365</span> non<span style="color:#f92672">-</span>null    object
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">6</span>   aqi        <span style="color:#ae81ff">365</span> non<span style="color:#f92672">-</span>null    int64 
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">7</span>   aqiInfo    <span style="color:#ae81ff">365</span> non<span style="color:#f92672">-</span>null    object
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">8</span>   aqiLevel   <span style="color:#ae81ff">365</span> non<span style="color:#f92672">-</span>null    int64 
</span></span><span style="display:flex;"><span>dtypes: int64(<span style="color:#ae81ff">2</span>), object(<span style="color:#ae81ff">7</span>)
</span></span><span style="display:flex;"><span>memory usage: <span style="color:#ae81ff">25.8</span><span style="color:#f92672">+</span> KB</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h4 id="知识series怎样从str类型变成int" class="pagebody-header">
    知识：series怎样从str类型变成int
  </h4>
</div><p class="component-content component">In [4]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df[<span style="color:#e6db74">&#34;bWendu&#34;</span>] <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#34;bWendu&#34;</span>]<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;℃&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>)<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;int32&#39;</span>)
</span></span><span style="display:flex;"><span>df[<span style="color:#e6db74">&#34;yWendu&#34;</span>] <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#34;yWendu&#34;</span>]<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;℃&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>)<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;int32&#39;</span>)
</span></span><span style="display:flex;"><span>df<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">3</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[4]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2018-01-01</td>
<td style="text-align:right">3</td>
<td style="text-align:right">-6</td>
<td style="text-align:right">晴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">59</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01-02</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">阴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">49</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2018-01-03</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">28</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table></div>

<div class="component-content pagebody component">
  <h4 id="知识进行日期列解析可以方便提取月份" class="pagebody-header">
    知识：进行日期列解析，可以方便提取月份
  </h4>
</div><p class="component-content component">In [5]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df[<span style="color:#e6db74">&#34;ymd&#34;</span>] <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>to_datetime(df[<span style="color:#e6db74">&#34;ymd&#34;</span>])</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [6]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df[<span style="color:#e6db74">&#34;ymd&#34;</span>]<span style="color:#f92672">.</span>dt<span style="color:#f92672">.</span>month</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[6]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ae81ff">0</span>       <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>       <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>       <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span>       <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span>       <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">360</span>    <span style="color:#ae81ff">12</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">361</span>    <span style="color:#ae81ff">12</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">362</span>    <span style="color:#ae81ff">12</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">363</span>    <span style="color:#ae81ff">12</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">364</span>    <span style="color:#ae81ff">12</span>
</span></span><span style="display:flex;"><span>Name: ymd, Length: <span style="color:#ae81ff">365</span>, dtype: int64</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h4 id="知识series可以用seriesunique去重" class="pagebody-header">
    知识：series可以用Series.unique去重
  </h4>
</div><p class="component-content component">In [7]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df[<span style="color:#e6db74">&#34;fengxiang&#34;</span>]<span style="color:#f92672">.</span>unique()</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[7]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-v" data-lang="v"><span style="display:flex;"><span>array([<span style="color:#e6db74">&#39;东北风&#39;</span>, <span style="color:#e6db74">&#39;北风&#39;</span>, <span style="color:#e6db74">&#39;西北风&#39;</span>, <span style="color:#e6db74">&#39;西南风&#39;</span>, <span style="color:#e6db74">&#39;南风&#39;</span>, <span style="color:#e6db74">&#39;东南风&#39;</span>, <span style="color:#e6db74">&#39;东风&#39;</span>, <span style="color:#e6db74">&#39;西风&#39;</span>], dtype<span style="color:#f92672">=</span>object)</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h4 id="知识可以用joinseries实现数组合并成大字符串" class="pagebody-header">
    知识：可以用&quot;,&quot;.join(series)实现数组合并成大字符串
  </h4>
</div><p class="component-content component">In [8]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e6db74">&#34;,&#34;</span><span style="color:#f92672">.</span>join(df[<span style="color:#e6db74">&#34;fengxiang&#34;</span>]<span style="color:#f92672">.</span>unique())</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[8]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e6db74">&#39;东北风,北风,西北风,西南风,南风,东南风,东风,西风&#39;</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="方法1" class="pagebody-header">
    方法1
  </h3>
</div><p class="component-content component">In [9]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>result <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>    df<span style="color:#f92672">.</span>groupby(df[<span style="color:#e6db74">&#34;ymd&#34;</span>]<span style="color:#f92672">.</span>dt<span style="color:#f92672">.</span>month)
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">.</span>agg(
</span></span><span style="display:flex;"><span>          <span style="color:#75715e"># 新列名 = (原列名，函数)</span>
</span></span><span style="display:flex;"><span>          最高温度<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#34;bWendu&#34;</span>, <span style="color:#e6db74">&#34;max&#34;</span>),
</span></span><span style="display:flex;"><span>          最低温度<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#34;yWendu&#34;</span>, <span style="color:#e6db74">&#34;min&#34;</span>),
</span></span><span style="display:flex;"><span>          风向列表<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#34;fengxiang&#34;</span>, <span style="color:#66d9ef">lambda</span> x : <span style="color:#e6db74">&#34;,&#34;</span><span style="color:#f92672">.</span>join(x<span style="color:#f92672">.</span>unique())),
</span></span><span style="display:flex;"><span>          空气质量列表<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#34;aqiInfo&#34;</span>, <span style="color:#66d9ef">lambda</span> x : <span style="color:#e6db74">&#34;,&#34;</span><span style="color:#f92672">.</span>join(x<span style="color:#f92672">.</span>unique()))
</span></span><span style="display:flex;"><span>      )
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">.</span>reset_index()
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">.</span>rename(columns<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;ymd&#34;</span>:<span style="color:#e6db74">&#34;月份&#34;</span>})
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [10]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>result</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[10]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">月份</th>
<th style="text-align:right">最高温度</th>
<th style="text-align:right">最低温度</th>
<th style="text-align:right">风向列表</th>
<th style="text-align:right">空气质量列表</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">7</td>
<td style="text-align:right">-12</td>
<td style="text-align:right">东北风,北风,西北风,西南风,南风,东南风,东风</td>
<td style="text-align:right">良,优,轻度污染,中度污染</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">12</td>
<td style="text-align:right">-10</td>
<td style="text-align:right">北风,西南风,南风,西北风,西风,东北风,东风</td>
<td style="text-align:right">良,优,轻度污染,中度污染,重度污染</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">27</td>
<td style="text-align:right">-4</td>
<td style="text-align:right">西南风,北风,东南风,南风,东北风,东风</td>
<td style="text-align:right">优,良,重度污染,轻度污染,中度污染,严重污染</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">30</td>
<td style="text-align:right">1</td>
<td style="text-align:right">南风,北风,东北风,西南风,西北风,东南风</td>
<td style="text-align:right">重度污染,良,优,轻度污染,中度污染</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">35</td>
<td style="text-align:right">10</td>
<td style="text-align:right">东北风,北风,西南风,南风,东南风,东风,西风,西北风</td>
<td style="text-align:right">轻度污染,优,良,中度污染</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">6</td>
<td style="text-align:right">38</td>
<td style="text-align:right">17</td>
<td style="text-align:right">西南风,南风,北风,东风,东南风,东北风</td>
<td style="text-align:right">良,轻度污染,优,中度污染</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">7</td>
<td style="text-align:right">37</td>
<td style="text-align:right">22</td>
<td style="text-align:right">东南风,西南风,南风,东北风,东风,西风,北风</td>
<td style="text-align:right">良,轻度污染,优</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">8</td>
<td style="text-align:right">36</td>
<td style="text-align:right">20</td>
<td style="text-align:right">东南风,南风,东风,东北风,北风,西南风</td>
<td style="text-align:right">良,轻度污染,优</td>
</tr>
<tr>
<td style="text-align:right">8</td>
<td style="text-align:right">9</td>
<td style="text-align:right">31</td>
<td style="text-align:right">11</td>
<td style="text-align:right">南风,北风,西南风,西北风</td>
<td style="text-align:right">优,良,轻度污染</td>
</tr>
<tr>
<td style="text-align:right">9</td>
<td style="text-align:right">10</td>
<td style="text-align:right">25</td>
<td style="text-align:right">1</td>
<td style="text-align:right">北风,西北风,南风,西风,东北风,西南风</td>
<td style="text-align:right">优,良,轻度污染,中度污染</td>
</tr>
<tr>
<td style="text-align:right">10</td>
<td style="text-align:right">11</td>
<td style="text-align:right">18</td>
<td style="text-align:right">-4</td>
<td style="text-align:right">南风,北风,西南风,东南风,西北风,东北风</td>
<td style="text-align:right">良,轻度污染,重度污染,优,中度污染</td>
</tr>
<tr>
<td style="text-align:right">11</td>
<td style="text-align:right">12</td>
<td style="text-align:right">10</td>
<td style="text-align:right">-12</td>
<td style="text-align:right">东南风,东北风,西北风,西南风</td>
<td style="text-align:right">中度污染,重度污染,良,优,轻度污染</td>
</tr>
</tbody>
</table></div>

<div class="component-content pagebody component">
  <h3 id="方法2" class="pagebody-header">
    方法2
  </h3>
</div><p class="component-content component">In [11]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">agg_func</span>(x):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;注意，这个x是每个分组的dataframe&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> pd<span style="color:#f92672">.</span>Series({
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;最高温度&#34;</span>: x[<span style="color:#e6db74">&#34;bWendu&#34;</span>]<span style="color:#f92672">.</span>max(),
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;最低温度&#34;</span>: x[<span style="color:#e6db74">&#34;yWendu&#34;</span>]<span style="color:#f92672">.</span>min(),
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;风向列表&#34;</span>: <span style="color:#e6db74">&#34;,&#34;</span><span style="color:#f92672">.</span>join(x[<span style="color:#e6db74">&#34;fengxiang&#34;</span>]<span style="color:#f92672">.</span>unique()),
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;空气质量列表&#34;</span>: <span style="color:#e6db74">&#34;,&#34;</span><span style="color:#f92672">.</span>join(x[<span style="color:#e6db74">&#34;aqiInfo&#34;</span>]<span style="color:#f92672">.</span>unique())
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>result <span style="color:#f92672">=</span> df \
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">.</span>groupby(df[<span style="color:#e6db74">&#34;ymd&#34;</span>]<span style="color:#f92672">.</span>dt<span style="color:#f92672">.</span>month) \
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">.</span>apply(agg_func) \
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">.</span>reset_index() \
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">.</span>rename(columns<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;ymd&#34;</span>:<span style="color:#e6db74">&#34;月份&#34;</span>})</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [12]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>result</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[12]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">月份</th>
<th style="text-align:right">最高温度</th>
<th style="text-align:right">最低温度</th>
<th style="text-align:right">风向列表</th>
<th style="text-align:right">空气质量列表</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">7</td>
<td style="text-align:right">-12</td>
<td style="text-align:right">东北风,北风,西北风,西南风,南风,东南风,东风</td>
<td style="text-align:right">良,优,轻度污染,中度污染</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">12</td>
<td style="text-align:right">-10</td>
<td style="text-align:right">北风,西南风,南风,西北风,西风,东北风,东风</td>
<td style="text-align:right">良,优,轻度污染,中度污染,重度污染</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">27</td>
<td style="text-align:right">-4</td>
<td style="text-align:right">西南风,北风,东南风,南风,东北风,东风</td>
<td style="text-align:right">优,良,重度污染,轻度污染,中度污染,严重污染</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">30</td>
<td style="text-align:right">1</td>
<td style="text-align:right">南风,北风,东北风,西南风,西北风,东南风</td>
<td style="text-align:right">重度污染,良,优,轻度污染,中度污染</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">35</td>
<td style="text-align:right">10</td>
<td style="text-align:right">东北风,北风,西南风,南风,东南风,东风,西风,西北风</td>
<td style="text-align:right">轻度污染,优,良,中度污染</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">6</td>
<td style="text-align:right">38</td>
<td style="text-align:right">17</td>
<td style="text-align:right">西南风,南风,北风,东风,东南风,东北风</td>
<td style="text-align:right">良,轻度污染,优,中度污染</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">7</td>
<td style="text-align:right">37</td>
<td style="text-align:right">22</td>
<td style="text-align:right">东南风,西南风,南风,东北风,东风,西风,北风</td>
<td style="text-align:right">良,轻度污染,优</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">8</td>
<td style="text-align:right">36</td>
<td style="text-align:right">20</td>
<td style="text-align:right">东南风,南风,东风,东北风,北风,西南风</td>
<td style="text-align:right">良,轻度污染,优</td>
</tr>
<tr>
<td style="text-align:right">8</td>
<td style="text-align:right">9</td>
<td style="text-align:right">31</td>
<td style="text-align:right">11</td>
<td style="text-align:right">南风,北风,西南风,西北风</td>
<td style="text-align:right">优,良,轻度污染</td>
</tr>
<tr>
<td style="text-align:right">9</td>
<td style="text-align:right">10</td>
<td style="text-align:right">25</td>
<td style="text-align:right">1</td>
<td style="text-align:right">北风,西北风,南风,西风,东北风,西南风</td>
<td style="text-align:right">优,良,轻度污染,中度污染</td>
</tr>
<tr>
<td style="text-align:right">10</td>
<td style="text-align:right">11</td>
<td style="text-align:right">18</td>
<td style="text-align:right">-4</td>
<td style="text-align:right">南风,北风,西南风,东南风,西北风,东北风</td>
<td style="text-align:right">良,轻度污染,重度污染,优,中度污染</td>
</tr>
<tr>
<td style="text-align:right">11</td>
<td style="text-align:right">12</td>
<td style="text-align:right">10</td>
<td style="text-align:right">-12</td>
<td style="text-align:right">东南风,东北风,西北风,西南风</td>
<td style="text-align:right">中度污染,重度污染,良,优,轻度污染</td>
</tr>
</tbody>
</table></div>

<div class="component-content pagebody component">
  <h1 id="41pandas读取excel绘制直方图" class="pagebody-header">
    41、Pandas读取Excel绘制直方图
  </h1>
</div><p class="component-content component">*<strong>直方图(Histogram)：*</strong>
直方图是数值数据分布的精确图形表示，是一个连续变量（定量变量）的概率分布的估计，它是一种条形图。
为了构建直方图，第一步是将值的范围分段，即将整个值的范围分成一系列间隔，然后计算每个间隔中有多少值。</p>

<div class="component-content pagebody component">
  <h3 id="1-读取数据" class="pagebody-header">
    1. 读取数据
  </h3>
</div><p class="component-content component">波斯顿房价数据集</p>
<p class="component-content component">In [1]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [2]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_excel(<span style="color:#e6db74">&#34;./datas/boston-house-prices/housing.xlsx&#34;</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [3]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[3]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">CRIM</th>
<th style="text-align:right">ZN</th>
<th style="text-align:right">INDUS</th>
<th style="text-align:right">CHAS</th>
<th style="text-align:right">NOX</th>
<th style="text-align:right">RM</th>
<th style="text-align:right">AGE</th>
<th style="text-align:right">DIS</th>
<th style="text-align:right">RAD</th>
<th style="text-align:right">TAX</th>
<th style="text-align:right">PTRATIO</th>
<th style="text-align:right">B</th>
<th style="text-align:right">LSTAT</th>
<th style="text-align:right">MEDV</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0.00632</td>
<td style="text-align:right">18.0</td>
<td style="text-align:right">2.31</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.538</td>
<td style="text-align:right">6.575</td>
<td style="text-align:right">65.2</td>
<td style="text-align:right">4.0900</td>
<td style="text-align:right">1</td>
<td style="text-align:right">296</td>
<td style="text-align:right">15.3</td>
<td style="text-align:right">396.90</td>
<td style="text-align:right">4.98</td>
<td style="text-align:right">24.0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">0.02731</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">7.07</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.469</td>
<td style="text-align:right">6.421</td>
<td style="text-align:right">78.9</td>
<td style="text-align:right">4.9671</td>
<td style="text-align:right">2</td>
<td style="text-align:right">242</td>
<td style="text-align:right">17.8</td>
<td style="text-align:right">396.90</td>
<td style="text-align:right">9.14</td>
<td style="text-align:right">21.6</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">0.02729</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">7.07</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.469</td>
<td style="text-align:right">7.185</td>
<td style="text-align:right">61.1</td>
<td style="text-align:right">4.9671</td>
<td style="text-align:right">2</td>
<td style="text-align:right">242</td>
<td style="text-align:right">17.8</td>
<td style="text-align:right">392.83</td>
<td style="text-align:right">4.03</td>
<td style="text-align:right">34.7</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">0.03237</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">2.18</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.458</td>
<td style="text-align:right">6.998</td>
<td style="text-align:right">45.8</td>
<td style="text-align:right">6.0622</td>
<td style="text-align:right">3</td>
<td style="text-align:right">222</td>
<td style="text-align:right">18.7</td>
<td style="text-align:right">394.63</td>
<td style="text-align:right">2.94</td>
<td style="text-align:right">33.4</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">0.06905</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">2.18</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.458</td>
<td style="text-align:right">7.147</td>
<td style="text-align:right">54.2</td>
<td style="text-align:right">6.0622</td>
<td style="text-align:right">3</td>
<td style="text-align:right">222</td>
<td style="text-align:right">18.7</td>
<td style="text-align:right">396.90</td>
<td style="text-align:right">5.33</td>
<td style="text-align:right">36.2</td>
</tr>
<tr>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
</tr>
<tr>
<td style="text-align:right">501</td>
<td style="text-align:right">0.06263</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">11.93</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.573</td>
<td style="text-align:right">6.593</td>
<td style="text-align:right">69.1</td>
<td style="text-align:right">2.4786</td>
<td style="text-align:right">1</td>
<td style="text-align:right">273</td>
<td style="text-align:right">21.0</td>
<td style="text-align:right">391.99</td>
<td style="text-align:right">9.67</td>
<td style="text-align:right">22.4</td>
</tr>
<tr>
<td style="text-align:right">502</td>
<td style="text-align:right">0.04527</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">11.93</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.573</td>
<td style="text-align:right">6.120</td>
<td style="text-align:right">76.7</td>
<td style="text-align:right">2.2875</td>
<td style="text-align:right">1</td>
<td style="text-align:right">273</td>
<td style="text-align:right">21.0</td>
<td style="text-align:right">396.90</td>
<td style="text-align:right">9.08</td>
<td style="text-align:right">20.6</td>
</tr>
<tr>
<td style="text-align:right">503</td>
<td style="text-align:right">0.06076</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">11.93</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.573</td>
<td style="text-align:right">6.976</td>
<td style="text-align:right">91.0</td>
<td style="text-align:right">2.1675</td>
<td style="text-align:right">1</td>
<td style="text-align:right">273</td>
<td style="text-align:right">21.0</td>
<td style="text-align:right">396.90</td>
<td style="text-align:right">5.64</td>
<td style="text-align:right">23.9</td>
</tr>
<tr>
<td style="text-align:right">504</td>
<td style="text-align:right">0.10959</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">11.93</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.573</td>
<td style="text-align:right">6.794</td>
<td style="text-align:right">89.3</td>
<td style="text-align:right">2.3889</td>
<td style="text-align:right">1</td>
<td style="text-align:right">273</td>
<td style="text-align:right">21.0</td>
<td style="text-align:right">393.45</td>
<td style="text-align:right">6.48</td>
<td style="text-align:right">22.0</td>
</tr>
<tr>
<td style="text-align:right">505</td>
<td style="text-align:right">0.04741</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">11.93</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.573</td>
<td style="text-align:right">6.030</td>
<td style="text-align:right">80.8</td>
<td style="text-align:right">2.5050</td>
<td style="text-align:right">1</td>
<td style="text-align:right">273</td>
<td style="text-align:right">21.0</td>
<td style="text-align:right">396.90</td>
<td style="text-align:right">7.88</td>
<td style="text-align:right">11.9</td>
</tr>
</tbody>
</table></div>
<p class="component-content component">506 rows × 14 columns</p>
<p class="component-content component">In [4]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df<span style="color:#f92672">.</span>info()
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">class</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">pandas</span><span style="color:#f92672">.</span>core<span style="color:#f92672">.</span>frame<span style="color:#f92672">.</span>DataFrame<span style="color:#e6db74">&#39;&gt;</span>
</span></span><span style="display:flex;"><span>RangeIndex: <span style="color:#ae81ff">506</span> entries, <span style="color:#ae81ff">0</span> to <span style="color:#ae81ff">505</span>
</span></span><span style="display:flex;"><span>Data columns (total <span style="color:#ae81ff">14</span> columns):
</span></span><span style="display:flex;"><span> <span style="color:#75715e">#   Column   Non-Null Count  Dtype  </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">---</span>  <span style="color:#f92672">------</span>   <span style="color:#f92672">--------------</span>  <span style="color:#f92672">-----</span>  
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">0</span>   CRIM     <span style="color:#ae81ff">506</span> non<span style="color:#f92672">-</span>null    float64
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">1</span>   ZN       <span style="color:#ae81ff">506</span> non<span style="color:#f92672">-</span>null    float64
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">2</span>   INDUS    <span style="color:#ae81ff">506</span> non<span style="color:#f92672">-</span>null    float64
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">3</span>   CHAS     <span style="color:#ae81ff">506</span> non<span style="color:#f92672">-</span>null    int64  
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">4</span>   NOX      <span style="color:#ae81ff">506</span> non<span style="color:#f92672">-</span>null    float64
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">5</span>   RM       <span style="color:#ae81ff">506</span> non<span style="color:#f92672">-</span>null    float64
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">6</span>   AGE      <span style="color:#ae81ff">506</span> non<span style="color:#f92672">-</span>null    float64
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">7</span>   DIS      <span style="color:#ae81ff">506</span> non<span style="color:#f92672">-</span>null    float64
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">8</span>   RAD      <span style="color:#ae81ff">506</span> non<span style="color:#f92672">-</span>null    int64  
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">9</span>   TAX      <span style="color:#ae81ff">506</span> non<span style="color:#f92672">-</span>null    int64  
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">10</span>  PTRATIO  <span style="color:#ae81ff">506</span> non<span style="color:#f92672">-</span>null    float64
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">11</span>  B        <span style="color:#ae81ff">506</span> non<span style="color:#f92672">-</span>null    float64
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">12</span>  LSTAT    <span style="color:#ae81ff">506</span> non<span style="color:#f92672">-</span>null    float64
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">13</span>  MEDV     <span style="color:#ae81ff">506</span> non<span style="color:#f92672">-</span>null    float64
</span></span><span style="display:flex;"><span>dtypes: float64(<span style="color:#ae81ff">11</span>), int64(<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>memory usage: <span style="color:#ae81ff">55.5</span> KB</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [5]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df[<span style="color:#e6db74">&#34;MEDV&#34;</span>]</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[5]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">24.0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>      <span style="color:#ae81ff">21.6</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>      <span style="color:#ae81ff">34.7</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span>      <span style="color:#ae81ff">33.4</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span>      <span style="color:#ae81ff">36.2</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">...</span> 
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">501</span>    <span style="color:#ae81ff">22.4</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">502</span>    <span style="color:#ae81ff">20.6</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">503</span>    <span style="color:#ae81ff">23.9</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">504</span>    <span style="color:#ae81ff">22.0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">505</span>    <span style="color:#ae81ff">11.9</span>
</span></span><span style="display:flex;"><span>Name: MEDV, Length: <span style="color:#ae81ff">506</span>, dtype: float64</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="2-使用matplotlib画直方图" class="pagebody-header">
    2. 使用matplotlib画直方图
  </h3>
</div><p class="component-content component">matplotlib直方图文档：https://matplotlib.org/3.2.0/api/_as_gen/matplotlib.pyplot.hist.html</p>
<p class="component-content component">In [6]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">%</span>matplotlib inline</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [7]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>hist(df[<span style="color:#e6db74">&#34;MEDV&#34;</span>], bins<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()</span></span></code></pre></div></div>
  
</div><p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-b1a14f63b52df2d11112ab5001d0c1b2" id="lhtb1a14f63b52df2d11112ab5001d0c1b2">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/33.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h3 id="3-使用pyecharts画直方图" class="pagebody-header">
    3. 使用pyecharts画直方图
  </h3>
</div><p class="component-content component">pyecharts直方图文档：http://gallery.pyecharts.org/#/Bar/bar_histogram
numpy直方图文档：https://docs.scipy.org/doc/numpy/reference/generated/numpy.histogram.html</p>
<p class="component-content component">In [8]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pyecharts <span style="color:#f92672">import</span> options <span style="color:#66d9ef">as</span> opts
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> pyecharts.charts <span style="color:#f92672">import</span> Bar</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [9]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 需要自己计算有多少个间隔、以及每个间隔有多少个值</span>
</span></span><span style="display:flex;"><span>hist,bin_edges <span style="color:#f92672">=</span>  np<span style="color:#f92672">.</span>histogram(df[<span style="color:#e6db74">&#34;MEDV&#34;</span>], bins<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [10]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 这是每个间隔的分割点</span>
</span></span><span style="display:flex;"><span>bin_edges</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[10]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>array([ <span style="color:#ae81ff">5.</span>  ,  <span style="color:#ae81ff">5.45</span>,  <span style="color:#ae81ff">5.9</span> ,  <span style="color:#ae81ff">6.35</span>,  <span style="color:#ae81ff">6.8</span> ,  <span style="color:#ae81ff">7.25</span>,  <span style="color:#ae81ff">7.7</span> ,  <span style="color:#ae81ff">8.15</span>,  <span style="color:#ae81ff">8.6</span> ,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">9.05</span>,  <span style="color:#ae81ff">9.5</span> ,  <span style="color:#ae81ff">9.95</span>, <span style="color:#ae81ff">10.4</span> , <span style="color:#ae81ff">10.85</span>, <span style="color:#ae81ff">11.3</span> , <span style="color:#ae81ff">11.75</span>, <span style="color:#ae81ff">12.2</span> , <span style="color:#ae81ff">12.65</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">13.1</span> , <span style="color:#ae81ff">13.55</span>, <span style="color:#ae81ff">14.</span>  , <span style="color:#ae81ff">14.45</span>, <span style="color:#ae81ff">14.9</span> , <span style="color:#ae81ff">15.35</span>, <span style="color:#ae81ff">15.8</span> , <span style="color:#ae81ff">16.25</span>, <span style="color:#ae81ff">16.7</span> ,
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">17.15</span>, <span style="color:#ae81ff">17.6</span> , <span style="color:#ae81ff">18.05</span>, <span style="color:#ae81ff">18.5</span> , <span style="color:#ae81ff">18.95</span>, <span style="color:#ae81ff">19.4</span> , <span style="color:#ae81ff">19.85</span>, <span style="color:#ae81ff">20.3</span> , <span style="color:#ae81ff">20.75</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">21.2</span> , <span style="color:#ae81ff">21.65</span>, <span style="color:#ae81ff">22.1</span> , <span style="color:#ae81ff">22.55</span>, <span style="color:#ae81ff">23.</span>  , <span style="color:#ae81ff">23.45</span>, <span style="color:#ae81ff">23.9</span> , <span style="color:#ae81ff">24.35</span>, <span style="color:#ae81ff">24.8</span> ,
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">25.25</span>, <span style="color:#ae81ff">25.7</span> , <span style="color:#ae81ff">26.15</span>, <span style="color:#ae81ff">26.6</span> , <span style="color:#ae81ff">27.05</span>, <span style="color:#ae81ff">27.5</span> , <span style="color:#ae81ff">27.95</span>, <span style="color:#ae81ff">28.4</span> , <span style="color:#ae81ff">28.85</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">29.3</span> , <span style="color:#ae81ff">29.75</span>, <span style="color:#ae81ff">30.2</span> , <span style="color:#ae81ff">30.65</span>, <span style="color:#ae81ff">31.1</span> , <span style="color:#ae81ff">31.55</span>, <span style="color:#ae81ff">32.</span>  , <span style="color:#ae81ff">32.45</span>, <span style="color:#ae81ff">32.9</span> ,
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">33.35</span>, <span style="color:#ae81ff">33.8</span> , <span style="color:#ae81ff">34.25</span>, <span style="color:#ae81ff">34.7</span> , <span style="color:#ae81ff">35.15</span>, <span style="color:#ae81ff">35.6</span> , <span style="color:#ae81ff">36.05</span>, <span style="color:#ae81ff">36.5</span> , <span style="color:#ae81ff">36.95</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">37.4</span> , <span style="color:#ae81ff">37.85</span>, <span style="color:#ae81ff">38.3</span> , <span style="color:#ae81ff">38.75</span>, <span style="color:#ae81ff">39.2</span> , <span style="color:#ae81ff">39.65</span>, <span style="color:#ae81ff">40.1</span> , <span style="color:#ae81ff">40.55</span>, <span style="color:#ae81ff">41.</span>  ,
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">41.45</span>, <span style="color:#ae81ff">41.9</span> , <span style="color:#ae81ff">42.35</span>, <span style="color:#ae81ff">42.8</span> , <span style="color:#ae81ff">43.25</span>, <span style="color:#ae81ff">43.7</span> , <span style="color:#ae81ff">44.15</span>, <span style="color:#ae81ff">44.6</span> , <span style="color:#ae81ff">45.05</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">45.5</span> , <span style="color:#ae81ff">45.95</span>, <span style="color:#ae81ff">46.4</span> , <span style="color:#ae81ff">46.85</span>, <span style="color:#ae81ff">47.3</span> , <span style="color:#ae81ff">47.75</span>, <span style="color:#ae81ff">48.2</span> , <span style="color:#ae81ff">48.65</span>, <span style="color:#ae81ff">49.1</span> ,
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">49.55</span>, <span style="color:#ae81ff">50.</span>  ])</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [11]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>len(bin_edges)</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[11]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ae81ff">101</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">In [12]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 这是间隔的计数</span>
</span></span><span style="display:flex;"><span>hist</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[12]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>array([ <span style="color:#ae81ff">2</span>,  <span style="color:#ae81ff">1</span>,  <span style="color:#ae81ff">1</span>,  <span style="color:#ae81ff">0</span>,  <span style="color:#ae81ff">5</span>,  <span style="color:#ae81ff">2</span>,  <span style="color:#ae81ff">1</span>,  <span style="color:#ae81ff">6</span>,  <span style="color:#ae81ff">3</span>,  <span style="color:#ae81ff">0</span>,  <span style="color:#ae81ff">3</span>,  <span style="color:#ae81ff">3</span>,  <span style="color:#ae81ff">5</span>,  <span style="color:#ae81ff">3</span>,  <span style="color:#ae81ff">4</span>,  <span style="color:#ae81ff">6</span>,  <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">14</span>,  <span style="color:#ae81ff">9</span>,  <span style="color:#ae81ff">9</span>,  <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">11</span>,  <span style="color:#ae81ff">8</span>,  <span style="color:#ae81ff">6</span>,  <span style="color:#ae81ff">8</span>,  <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">10</span>,  <span style="color:#ae81ff">9</span>,  <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">16</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">19</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">19</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">21</span>, <span style="color:#ae81ff">16</span>,  <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">14</span>,  <span style="color:#ae81ff">1</span>,  <span style="color:#ae81ff">0</span>,  <span style="color:#ae81ff">4</span>,  <span style="color:#ae81ff">5</span>,  <span style="color:#ae81ff">2</span>,  <span style="color:#ae81ff">6</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">5</span>,  <span style="color:#ae81ff">5</span>,  <span style="color:#ae81ff">4</span>,  <span style="color:#ae81ff">3</span>,  <span style="color:#ae81ff">6</span>,  <span style="color:#ae81ff">2</span>,  <span style="color:#ae81ff">3</span>,  <span style="color:#ae81ff">4</span>,  <span style="color:#ae81ff">3</span>,  <span style="color:#ae81ff">4</span>,  <span style="color:#ae81ff">3</span>,  <span style="color:#ae81ff">6</span>,  <span style="color:#ae81ff">2</span>,  <span style="color:#ae81ff">1</span>,  <span style="color:#ae81ff">1</span>,  <span style="color:#ae81ff">5</span>,  <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">1</span>,  <span style="color:#ae81ff">4</span>,  <span style="color:#ae81ff">1</span>,  <span style="color:#ae81ff">3</span>,  <span style="color:#ae81ff">1</span>,  <span style="color:#ae81ff">1</span>,  <span style="color:#ae81ff">1</span>,  <span style="color:#ae81ff">0</span>,  <span style="color:#ae81ff">0</span>,  <span style="color:#ae81ff">1</span>,  <span style="color:#ae81ff">0</span>,  <span style="color:#ae81ff">0</span>,  <span style="color:#ae81ff">1</span>,  <span style="color:#ae81ff">1</span>,  <span style="color:#ae81ff">1</span>,  <span style="color:#ae81ff">1</span>,  <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">1</span>,  <span style="color:#ae81ff">2</span>,  <span style="color:#ae81ff">0</span>,  <span style="color:#ae81ff">1</span>,  <span style="color:#ae81ff">1</span>,  <span style="color:#ae81ff">0</span>,  <span style="color:#ae81ff">1</span>,  <span style="color:#ae81ff">1</span>,  <span style="color:#ae81ff">0</span>,  <span style="color:#ae81ff">0</span>,  <span style="color:#ae81ff">0</span>,  <span style="color:#ae81ff">2</span>,  <span style="color:#ae81ff">1</span>,  <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">16</span>],
</span></span><span style="display:flex;"><span>      dtype<span style="color:#f92672">=</span>int64)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [13]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>len(hist)</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[13]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ae81ff">100</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h4 id="对bin_edges的解释为什么是101个比hist计数多1个" class="pagebody-header">
    对bin_edges的解释，为什么是101个？比hist计数多1个？
  </h4>
</div><p class="component-content component">举例：如果bins是[1, 2, 3, 4]，那么会分成3个区间：[1, 2)、[2, 3)、[3, 4]；
其中bins的第一个值是数组的最小值，bins的最后一个元素是数组的最大值</p>
<p class="component-content component">In [14]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 注意观察，min是bins的第一个值，max是bins的最后一个元素</span>
</span></span><span style="display:flex;"><span>df[<span style="color:#e6db74">&#34;MEDV&#34;</span>]<span style="color:#f92672">.</span>describe()</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[14]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>count    <span style="color:#ae81ff">506.000000</span>
</span></span><span style="display:flex;"><span>mean      <span style="color:#ae81ff">22.532806</span>
</span></span><span style="display:flex;"><span>std        <span style="color:#ae81ff">9.197104</span>
</span></span><span style="display:flex;"><span>min        <span style="color:#ae81ff">5.000000</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">25</span><span style="color:#f92672">%</span>       <span style="color:#ae81ff">17.025000</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">50</span><span style="color:#f92672">%</span>       <span style="color:#ae81ff">21.200000</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">75</span><span style="color:#f92672">%</span>       <span style="color:#ae81ff">25.000000</span>
</span></span><span style="display:flex;"><span>max       <span style="color:#ae81ff">50.000000</span>
</span></span><span style="display:flex;"><span>Name: MEDV, dtype: float64</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [15]:</p>
<div class="component-content pagebody component code">
  
  
  
  <pre><code class=""># 查看bins每一个值和前一个值的差值，可以看到这是等分的数据
np.diff(bin_edges)</code></pre>
  
</div><p class="component-content component">Out[15]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>array([<span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>, <span style="color:#ae81ff">0.45</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">0.45</span>])</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [16]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 这些间隔的数目，刚好等于计数hist的数目</span>
</span></span><span style="display:flex;"><span>len(np<span style="color:#f92672">.</span>diff(bin_edges))</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[16]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ae81ff">100</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">In [17]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># pyecharts的直方图使用bar实现</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 取bins[:-1]，意思是用每个区间的左边元素作为x轴的值</span>
</span></span><span style="display:flex;"><span>bar <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>    Bar()
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>add_xaxis([str(x) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> bin_edges[:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]])
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>add_yaxis(<span style="color:#e6db74">&#34;价格分布&#34;</span>, [float(x) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> hist], category_gap<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>set_global_opts(
</span></span><span style="display:flex;"><span>        title_opts<span style="color:#f92672">=</span>opts<span style="color:#f92672">.</span>TitleOpts(title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;波斯顿房价-价格分布-直方图&#34;</span>, pos_left<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;center&#34;</span>),
</span></span><span style="display:flex;"><span>        legend_opts<span style="color:#f92672">=</span>opts<span style="color:#f92672">.</span>LegendOpts(is_show<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [18]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>bar<span style="color:#f92672">.</span>render_notebook()</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h1 id="42python处理excel一列变多列" class="pagebody-header">
    42、Python处理Excel一列变多列
  </h1>
</div>
<div class="component-content pagebody component">
  <h3 id="1-读取数据-1" class="pagebody-header">
    1. 读取数据
  </h3>
</div><p class="component-content component">In [1]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [2]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_excel(<span style="color:#e6db74">&#34;./course_datas/c42_split_onecolumn_tomany/学生数据表.xlsx&#34;</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [3]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df<span style="color:#f92672">.</span>head()</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[3]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">学号</th>
<th style="text-align:right">数据</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">S001</td>
<td style="text-align:right">怠涵:女:23:山东</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">S002</td>
<td style="text-align:right">婉清:女:25:河南</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">S003</td>
<td style="text-align:right">溪榕:女:23:湖北</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">S004</td>
<td style="text-align:right">漠涓:女:19:陕西</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">S005</td>
<td style="text-align:right">祈博:女:24:山东</td>
</tr>
</tbody>
</table></div>

<div class="component-content pagebody component">
  <h3 id="2-实现拆分" class="pagebody-header">
    2. 实现拆分
  </h3>
</div><p class="component-content component">In [4]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">split_func</span>(line):
</span></span><span style="display:flex;"><span>    line[<span style="color:#e6db74">&#34;姓名&#34;</span>], line[<span style="color:#e6db74">&#34;性别&#34;</span>], line[<span style="color:#e6db74">&#34;年龄&#34;</span>], line[<span style="color:#e6db74">&#34;城市&#34;</span>] <span style="color:#f92672">=</span> line[<span style="color:#e6db74">&#34;数据&#34;</span>]<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34;:&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> line
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>apply(split_func, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [5]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df<span style="color:#f92672">.</span>head()</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[5]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">学号</th>
<th style="text-align:right">数据</th>
<th style="text-align:right">姓名</th>
<th style="text-align:right">性别</th>
<th style="text-align:right">年龄</th>
<th style="text-align:right">城市</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">S001</td>
<td style="text-align:right">怠涵:女:23:山东</td>
<td style="text-align:right">怠涵</td>
<td style="text-align:right">女</td>
<td style="text-align:right">23</td>
<td style="text-align:right">山东</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">S002</td>
<td style="text-align:right">婉清:女:25:河南</td>
<td style="text-align:right">婉清</td>
<td style="text-align:right">女</td>
<td style="text-align:right">25</td>
<td style="text-align:right">河南</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">S003</td>
<td style="text-align:right">溪榕:女:23:湖北</td>
<td style="text-align:right">溪榕</td>
<td style="text-align:right">女</td>
<td style="text-align:right">23</td>
<td style="text-align:right">湖北</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">S004</td>
<td style="text-align:right">漠涓:女:19:陕西</td>
<td style="text-align:right">漠涓</td>
<td style="text-align:right">女</td>
<td style="text-align:right">19</td>
<td style="text-align:right">陕西</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">S005</td>
<td style="text-align:right">祈博:女:24:山东</td>
<td style="text-align:right">祈博</td>
<td style="text-align:right">女</td>
<td style="text-align:right">24</td>
<td style="text-align:right">山东</td>
</tr>
</tbody>
</table></div>
<p class="component-content component">In [6]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df<span style="color:#f92672">.</span>drop([<span style="color:#e6db74">&#34;数据&#34;</span>], axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [7]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df<span style="color:#f92672">.</span>head()</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[7]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">学号</th>
<th style="text-align:right">姓名</th>
<th style="text-align:right">性别</th>
<th style="text-align:right">年龄</th>
<th style="text-align:right">城市</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">S001</td>
<td style="text-align:right">怠涵</td>
<td style="text-align:right">女</td>
<td style="text-align:right">23</td>
<td style="text-align:right">山东</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">S002</td>
<td style="text-align:right">婉清</td>
<td style="text-align:right">女</td>
<td style="text-align:right">25</td>
<td style="text-align:right">河南</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">S003</td>
<td style="text-align:right">溪榕</td>
<td style="text-align:right">女</td>
<td style="text-align:right">23</td>
<td style="text-align:right">湖北</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">S004</td>
<td style="text-align:right">漠涓</td>
<td style="text-align:right">女</td>
<td style="text-align:right">19</td>
<td style="text-align:right">陕西</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">S005</td>
<td style="text-align:right">祈博</td>
<td style="text-align:right">女</td>
<td style="text-align:right">24</td>
<td style="text-align:right">山东</td>
</tr>
</tbody>
</table></div>

<div class="component-content pagebody component">
  <h3 id="3-输出到结果excel" class="pagebody-header">
    3. 输出到结果Excel
  </h3>
</div><p class="component-content component">In [8]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df<span style="color:#f92672">.</span>to_excel(<span style="color:#e6db74">&#34;./course_datas/c42_split_onecolumn_tomany/学生数据表_拆分后.xlsx&#34;</span>, index<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h1 id="43pandas查询数据的简便方法dfquery" class="pagebody-header">
    43、Pandas查询数据的简便方法df.query
  </h1>
</div><p class="component-content component">怎样进行复杂组合条件对数据查询：</p>
<div class="component-content component"><ul>
<li>方式1. 使用df[(df[&ldquo;a&rdquo;] &gt; 3) &amp; (df[&ldquo;b&rdquo;]&lt;5)]的方式；</li>
<li>方式2. 使用df.query(&ldquo;a&gt;3 &amp; b&lt;5&rdquo;)的方式；</li>
</ul></div>
<p class="component-content component">方法2的语法更加简洁</p>
<p class="component-content component">性能对比：</p>
<div class="component-content component"><ul>
<li>当数据量小时，方法1更快；</li>
<li>当数据量大时，因为方法2直接用C语言实现，节省方法1临时数组的多次复制，方法2更快；</li>
</ul></div>
<p class="component-content component">In [1]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span>print(pd<span style="color:#f92672">.</span>__version__)
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1.0.1</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="0读取数据" class="pagebody-header">
    0、读取数据
  </h3>
</div><p class="component-content component">数据为北京2018年全年天气预报</p>
<p class="component-content component">In [2]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#34;./datas/beijing_tianqi/beijing_tianqi_2018.csv&#34;</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [3]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df<span style="color:#f92672">.</span>head()</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[3]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2018-01-01</td>
<td style="text-align:right">3℃</td>
<td style="text-align:right">-6℃</td>
<td style="text-align:right">晴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">59</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01-02</td>
<td style="text-align:right">2℃</td>
<td style="text-align:right">-5℃</td>
<td style="text-align:right">阴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">49</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2018-01-03</td>
<td style="text-align:right">2℃</td>
<td style="text-align:right">-5℃</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">28</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">2018-01-04</td>
<td style="text-align:right">0℃</td>
<td style="text-align:right">-8℃</td>
<td style="text-align:right">阴</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">28</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">2018-01-05</td>
<td style="text-align:right">3℃</td>
<td style="text-align:right">-6℃</td>
<td style="text-align:right">多云~晴</td>
<td style="text-align:right">西北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">50</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table></div>
<p class="component-content component">In [4]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 替换掉温度的后缀℃</span>
</span></span><span style="display:flex;"><span>df<span style="color:#f92672">.</span>loc[:, <span style="color:#e6db74">&#34;bWendu&#34;</span>] <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#34;bWendu&#34;</span>]<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;℃&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>)<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;int32&#39;</span>)
</span></span><span style="display:flex;"><span>df<span style="color:#f92672">.</span>loc[:, <span style="color:#e6db74">&#34;yWendu&#34;</span>] <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#34;yWendu&#34;</span>]<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;℃&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>)<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;int32&#39;</span>)</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="1使用dataframe条件表达式查询" class="pagebody-header">
    1、使用dataframe条件表达式查询
  </h3>
</div>
<div class="component-content pagebody component">
  <h4 id="最低温度低于-10度的列表" class="pagebody-header">
    最低温度低于-10度的列表
  </h4>
</div><p class="component-content component">In [5]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df[df[<span style="color:#e6db74">&#34;yWendu&#34;</span>] <span style="color:#f92672">&lt;</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">10</span>]<span style="color:#f92672">.</span>head()</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[5]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">22</td>
<td style="text-align:right">2018-01-23</td>
<td style="text-align:right">-4</td>
<td style="text-align:right">-12</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">西北风</td>
<td style="text-align:right">3-4级</td>
<td style="text-align:right">31</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">23</td>
<td style="text-align:right">2018-01-24</td>
<td style="text-align:right">-4</td>
<td style="text-align:right">-11</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">西南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">34</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">24</td>
<td style="text-align:right">2018-01-25</td>
<td style="text-align:right">-3</td>
<td style="text-align:right">-11</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">27</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">359</td>
<td style="text-align:right">2018-12-26</td>
<td style="text-align:right">-2</td>
<td style="text-align:right">-11</td>
<td style="text-align:right">晴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">2级</td>
<td style="text-align:right">26</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">360</td>
<td style="text-align:right">2018-12-27</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">-12</td>
<td style="text-align:right">多云~晴</td>
<td style="text-align:right">西北风</td>
<td style="text-align:right">3级</td>
<td style="text-align:right">48</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table></div>

<div class="component-content pagebody component">
  <h4 id="复杂条件查询" class="pagebody-header">
    复杂条件查询
  </h4>
</div><p class="component-content component">注意，组合条件用&amp;符号合并，每个条件判断都得带括号</p>
<p class="component-content component">In [6]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">## 查询最高温度小于30度，并且最低温度大于15度，并且是晴天，并且天气为优的数据</span>
</span></span><span style="display:flex;"><span>df[
</span></span><span style="display:flex;"><span>    (df[<span style="color:#e6db74">&#34;bWendu&#34;</span>]<span style="color:#f92672">&lt;=</span><span style="color:#ae81ff">30</span>) 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&amp;</span> (df[<span style="color:#e6db74">&#34;yWendu&#34;</span>]<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">15</span>) 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&amp;</span> (df[<span style="color:#e6db74">&#34;tianqi&#34;</span>]<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;晴&#39;</span>) 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&amp;</span> (df[<span style="color:#e6db74">&#34;aqiLevel&#34;</span>]<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>)]</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[6]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">235</td>
<td style="text-align:right">2018-08-24</td>
<td style="text-align:right">30</td>
<td style="text-align:right">20</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">40</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">249</td>
<td style="text-align:right">2018-09-07</td>
<td style="text-align:right">27</td>
<td style="text-align:right">16</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">西北风</td>
<td style="text-align:right">3-4级</td>
<td style="text-align:right">22</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table></div>

<div class="component-content pagebody component">
  <h3 id="2使用dfquery可以简化查询" class="pagebody-header">
    2、使用df.query可以简化查询
  </h3>
</div><p class="component-content component">形式：DataFrame.query(expr, inplace=False, **kwargs)</p>
<p class="component-content component">其中expr为要返回boolean结果的字符串表达式</p>
<p class="component-content component">形如：</p>
<div class="component-content component"><ul>
<li>df.query(&lsquo;a&lt;100&rsquo;)</li>
<li>df.query(&lsquo;a &lt; b &amp; b &lt; c&rsquo;)，或者df.query(&rsquo;(a&lt;b)&amp;(b&lt;c)&rsquo;)</li>
</ul></div>
<p class="component-content component">df.query可支持的表达式语法：</p>
<div class="component-content component"><ul>
<li>逻辑操作符: &amp;, |, ~</li>
<li>比较操作符: &lt;, &lt;=, ==, !=, &gt;=, &gt;</li>
<li>单变量操作符: -</li>
<li>多变量操作符: +, -, *, /, %</li>
</ul></div>
<p class="component-content component">df.query中可以使用@var的方式传入外部变量</p>
<p class="component-content component">df.query支持的语法来自NumExpr，地址：
<a href="https://numexpr.readthedocs.io/projects/NumExpr3/en/latest/index.html">https://numexpr.readthedocs.io/projects/NumExpr3/en/latest/index.html</a></p>

<div class="component-content pagebody component">
  <h4 id="查询最低温度低于-10度的列表" class="pagebody-header">
    查询最低温度低于-10度的列表
  </h4>
</div><p class="component-content component">In [7]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df<span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#34;yWendu &lt; 3&#34;</span>)<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">3</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[7]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2018-01-01</td>
<td style="text-align:right">3</td>
<td style="text-align:right">-6</td>
<td style="text-align:right">晴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">59</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01-02</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">阴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">49</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2018-01-03</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">28</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table></div>

<div class="component-content pagebody component">
  <h4 id="查询最高温度小于30度并且最低温度大于15度并且是晴天并且天气为优的数据" class="pagebody-header">
    查询最高温度小于30度，并且最低温度大于15度，并且是晴天，并且天气为优的数据
  </h4>
</div><p class="component-content component">In [8]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">## 查询最高温度小于30度，并且最低温度大于15度，并且是晴天，并且天气为优的数据</span>
</span></span><span style="display:flex;"><span>df<span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#34;bWendu&lt;=30 &amp; yWendu&gt;=15 &amp; tianqi==&#39;晴&#39; &amp; aqiLevel==1&#34;</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[8]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">235</td>
<td style="text-align:right">2018-08-24</td>
<td style="text-align:right">30</td>
<td style="text-align:right">20</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">40</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">249</td>
<td style="text-align:right">2018-09-07</td>
<td style="text-align:right">27</td>
<td style="text-align:right">16</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">西北风</td>
<td style="text-align:right">3-4级</td>
<td style="text-align:right">22</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table></div>

<div class="component-content pagebody component">
  <h4 id="查询温差大于15度的日子" class="pagebody-header">
    查询温差大于15度的日子
  </h4>
</div><p class="component-content component">In [9]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df<span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#34;bWendu-yWendu &gt;= 15&#34;</span>)<span style="color:#f92672">.</span>head()</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[9]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">68</td>
<td style="text-align:right">2018-03-10</td>
<td style="text-align:right">14</td>
<td style="text-align:right">-2</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">东南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">171</td>
<td style="text-align:right">中度污染</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td style="text-align:right">82</td>
<td style="text-align:right">2018-03-24</td>
<td style="text-align:right">22</td>
<td style="text-align:right">5</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">西南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">119</td>
<td style="text-align:right">轻度污染</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">83</td>
<td style="text-align:right">2018-03-25</td>
<td style="text-align:right">24</td>
<td style="text-align:right">7</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">78</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">84</td>
<td style="text-align:right">2018-03-26</td>
<td style="text-align:right">25</td>
<td style="text-align:right">7</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">西南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">151</td>
<td style="text-align:right">中度污染</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td style="text-align:right">85</td>
<td style="text-align:right">2018-03-27</td>
<td style="text-align:right">27</td>
<td style="text-align:right">11</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">243</td>
<td style="text-align:right">重度污染</td>
<td style="text-align:right">5</td>
</tr>
</tbody>
</table></div>

<div class="component-content pagebody component">
  <h4 id="可以使用外部的变量" class="pagebody-header">
    可以使用外部的变量
  </h4>
</div><p class="component-content component">In [10]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 查询温度在这两个温度之间的数据</span>
</span></span><span style="display:flex;"><span>high_temperature <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>
</span></span><span style="display:flex;"><span>low_temperature <span style="color:#f92672">=</span> <span style="color:#ae81ff">13</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">In [11]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df<span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#34;yWendu&lt;=@high_temperature &amp; yWendu&gt;=@low_temperature&#34;</span>)<span style="color:#f92672">.</span>head()</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[11]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">107</td>
<td style="text-align:right">2018-04-18</td>
<td style="text-align:right">27</td>
<td style="text-align:right">14</td>
<td style="text-align:right">多云~晴</td>
<td style="text-align:right">西南风</td>
<td style="text-align:right">3-4级</td>
<td style="text-align:right">147</td>
<td style="text-align:right">轻度污染</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">108</td>
<td style="text-align:right">2018-04-19</td>
<td style="text-align:right">26</td>
<td style="text-align:right">13</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">东南风</td>
<td style="text-align:right">4-5级</td>
<td style="text-align:right">170</td>
<td style="text-align:right">中度污染</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td style="text-align:right">109</td>
<td style="text-align:right">2018-04-20</td>
<td style="text-align:right">28</td>
<td style="text-align:right">14</td>
<td style="text-align:right">多云~小雨</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">4-5级</td>
<td style="text-align:right">164</td>
<td style="text-align:right">中度污染</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td style="text-align:right">116</td>
<td style="text-align:right">2018-04-27</td>
<td style="text-align:right">25</td>
<td style="text-align:right">13</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">西南风</td>
<td style="text-align:right">3-4级</td>
<td style="text-align:right">112</td>
<td style="text-align:right">轻度污染</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">119</td>
<td style="text-align:right">2018-04-30</td>
<td style="text-align:right">24</td>
<td style="text-align:right">14</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">3-4级</td>
<td style="text-align:right">62</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
</tbody>
</table></div>

<div class="component-content pagebody component">
  <h1 id="44pandas按行遍历dataframe的3种方法" class="pagebody-header">
    44、Pandas按行遍历DataFrame的3种方法
  </h1>
</div><p class="component-content component">In [1]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> collections</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [2]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(
</span></span><span style="display:flex;"><span>    np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>random(size<span style="color:#f92672">=</span>(<span style="color:#ae81ff">100000</span>, <span style="color:#ae81ff">4</span>)), 
</span></span><span style="display:flex;"><span>    columns<span style="color:#f92672">=</span>list(<span style="color:#e6db74">&#39;ABCD&#39;</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>df<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">3</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[2]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0.329292</td>
<td style="text-align:right">0.975468</td>
<td style="text-align:right">0.133584</td>
<td style="text-align:right">0.224582</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">0.535746</td>
<td style="text-align:right">0.451585</td>
<td style="text-align:right">0.713250</td>
<td style="text-align:right">0.409770</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">0.735287</td>
<td style="text-align:right">0.667472</td>
<td style="text-align:right">0.950622</td>
<td style="text-align:right">0.245938</td>
</tr>
</tbody>
</table></div>
<p class="component-content component">In [3]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df<span style="color:#f92672">.</span>shape</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[3]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>(<span style="color:#ae81ff">100000</span>, <span style="color:#ae81ff">4</span>)</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="1-dfiterrows" class="pagebody-header">
    1. df.iterrows()
  </h3>
</div>
<div class="component-content pagebody component">
  <h4 id="使用方式" class="pagebody-header">
    使用方式
  </h4>
</div><p class="component-content component">In [4]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> idx, row <span style="color:#f92672">in</span> df<span style="color:#f92672">.</span>iterrows():
</span></span><span style="display:flex;"><span>    print(idx, row)
</span></span><span style="display:flex;"><span>    print(idx, row[<span style="color:#e6db74">&#34;A&#34;</span>], row[<span style="color:#e6db74">&#34;B&#34;</span>], row[<span style="color:#e6db74">&#34;C&#34;</span>], row[<span style="color:#e6db74">&#34;D&#34;</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span> A    <span style="color:#ae81ff">0.329292</span>
</span></span><span style="display:flex;"><span>B    <span style="color:#ae81ff">0.975468</span>
</span></span><span style="display:flex;"><span>C    <span style="color:#ae81ff">0.133584</span>
</span></span><span style="display:flex;"><span>D    <span style="color:#ae81ff">0.224582</span>
</span></span><span style="display:flex;"><span>Name: <span style="color:#ae81ff">0</span>, dtype: float64
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0.3292915092119043</span> <span style="color:#ae81ff">0.9754683984716609</span> <span style="color:#ae81ff">0.1335841433264423</span> <span style="color:#ae81ff">0.22458227907355865</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h4 id="时间耗费" class="pagebody-header">
    时间耗费
  </h4>
</div><p class="component-content component">In [5]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">%%</span>time
</span></span><span style="display:flex;"><span>result <span style="color:#f92672">=</span> collections<span style="color:#f92672">.</span>defaultdict(int)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> idx, row <span style="color:#f92672">in</span> df<span style="color:#f92672">.</span>iterrows():
</span></span><span style="display:flex;"><span>    result[(row[<span style="color:#e6db74">&#34;A&#34;</span>], row[<span style="color:#e6db74">&#34;B&#34;</span>])] <span style="color:#f92672">+=</span> row[<span style="color:#e6db74">&#34;A&#34;</span>] <span style="color:#f92672">+</span> row[<span style="color:#e6db74">&#34;B&#34;</span>]
</span></span><span style="display:flex;"><span>CPU times: user <span style="color:#ae81ff">7.82</span> s, sys: <span style="color:#ae81ff">35.6</span> ms, total: <span style="color:#ae81ff">7.85</span> s
</span></span><span style="display:flex;"><span>Wall time: <span style="color:#ae81ff">7.89</span> s</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="2-dfitertuples" class="pagebody-header">
    2. df.itertuples()
  </h3>
</div>
<div class="component-content pagebody component">
  <h4 id="使用方式-1" class="pagebody-header">
    使用方式
  </h4>
</div><p class="component-content component">In [6]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> row <span style="color:#f92672">in</span> df<span style="color:#f92672">.</span>itertuples():
</span></span><span style="display:flex;"><span>    print(row)
</span></span><span style="display:flex;"><span>    print(row<span style="color:#f92672">.</span>Index, row<span style="color:#f92672">.</span>A, row<span style="color:#f92672">.</span>B, row<span style="color:#f92672">.</span>C, row<span style="color:#f92672">.</span>D)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>Pandas(Index<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, A<span style="color:#f92672">=</span><span style="color:#ae81ff">0.3292915092119043</span>, B<span style="color:#f92672">=</span><span style="color:#ae81ff">0.9754683984716609</span>, C<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1335841433264423</span>, D<span style="color:#f92672">=</span><span style="color:#ae81ff">0.22458227907355865</span>)
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0.3292915092119043</span> <span style="color:#ae81ff">0.9754683984716609</span> <span style="color:#ae81ff">0.1335841433264423</span> <span style="color:#ae81ff">0.22458227907355865</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h4 id="时间耗费-1" class="pagebody-header">
    时间耗费
  </h4>
</div><p class="component-content component">In [7]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">%%</span>time
</span></span><span style="display:flex;"><span>result <span style="color:#f92672">=</span> collections<span style="color:#f92672">.</span>defaultdict(int)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> row <span style="color:#f92672">in</span> df<span style="color:#f92672">.</span>itertuples():
</span></span><span style="display:flex;"><span>    result[(row<span style="color:#f92672">.</span>A, row<span style="color:#f92672">.</span>B)] <span style="color:#f92672">+=</span> row<span style="color:#f92672">.</span>A <span style="color:#f92672">+</span> row<span style="color:#f92672">.</span>B
</span></span><span style="display:flex;"><span>CPU times: user <span style="color:#ae81ff">168</span> ms, sys: <span style="color:#ae81ff">8.35</span> ms, total: <span style="color:#ae81ff">177</span> ms
</span></span><span style="display:flex;"><span>Wall time: <span style="color:#ae81ff">178</span> ms</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="3-forzip" class="pagebody-header">
    3. for+zip
  </h3>
</div>
<div class="component-content pagebody component">
  <h4 id="使用方式-2" class="pagebody-header">
    使用方式
  </h4>
</div><p class="component-content component">In [8]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 既不需要类型检查，也不需要构建namedtuple</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 缺点是需要挨个指定变量</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> A, B <span style="color:#f92672">in</span> zip(df[<span style="color:#e6db74">&#34;A&#34;</span>], df[<span style="color:#e6db74">&#34;B&#34;</span>]):
</span></span><span style="display:flex;"><span>    print(A, B)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0.3292915092119043</span> <span style="color:#ae81ff">0.9754683984716609</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h4 id="时间耗费-2" class="pagebody-header">
    时间耗费
  </h4>
</div><p class="component-content component">In [9]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">%%</span>time
</span></span><span style="display:flex;"><span>result <span style="color:#f92672">=</span> collections<span style="color:#f92672">.</span>defaultdict(int)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> A, B <span style="color:#f92672">in</span> zip(df[<span style="color:#e6db74">&#34;A&#34;</span>], df[<span style="color:#e6db74">&#34;B&#34;</span>]):
</span></span><span style="display:flex;"><span>    result[(A, B)] <span style="color:#f92672">+=</span> A <span style="color:#f92672">+</span> B
</span></span><span style="display:flex;"><span>CPU times: user <span style="color:#ae81ff">82.2</span> ms, sys: <span style="color:#ae81ff">7.05</span> ms, total: <span style="color:#ae81ff">89.2</span> ms
</span></span><span style="display:flex;"><span>Wall time: <span style="color:#ae81ff">89.9</span> ms</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h1 id="45pandas实现模糊匹配merge数据的方法" class="pagebody-header">
    45、Pandas实现模糊匹配Merge数据的方法
  </h1>
</div><p class="component-content component">In [1]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> re</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="1-两份数据" class="pagebody-header">
    1. 两份数据
  </h3>
</div><p class="component-content component">In [2]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 关键词数据</span>
</span></span><span style="display:flex;"><span>df_keyword <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame({
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;keyid&#34;</span>: np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">5</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;keyword&#34;</span>: [<span style="color:#e6db74">&#34;numpy&#34;</span>, <span style="color:#e6db74">&#34;pandas&#34;</span>, <span style="color:#e6db74">&#34;matplotlib&#34;</span>, <span style="color:#e6db74">&#34;sklearn&#34;</span>, <span style="color:#e6db74">&#34;tensorflow&#34;</span>]
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>df_keyword</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[2]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">keyid</th>
<th style="text-align:right">keyword</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2</td>
<td style="text-align:right">matplotlib</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">3</td>
<td style="text-align:right">sklearn</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
</tr>
</tbody>
</table></div>
<p class="component-content component">In [3]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 句子数据</span>
</span></span><span style="display:flex;"><span>df_sentence <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame({
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;senid&#34;</span>: np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">17</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;sentence&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;怎样用Pandas实现数据的Merge？&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Python之Numpy详细教程&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;怎样使用Pandas批量拆分与合并Excel文件？&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;怎样使用Pandas的map和apply函数？&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;深度学习及TensorFlow简介&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Tensorflow和Numpy的关系&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;基于sklearn的一些机器学习的代码&#34;</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>df_sentence</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[3]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">senid</th>
<th style="text-align:right">sentence</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">10</td>
<td style="text-align:right">怎样用Pandas实现数据的Merge？</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">Python之Numpy详细教程</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">12</td>
<td style="text-align:right">怎样使用Pandas批量拆分与合并Excel文件？</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">13</td>
<td style="text-align:right">怎样使用Pandas的map和apply函数？</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">14</td>
<td style="text-align:right">深度学习及TensorFlow简介</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">16</td>
<td style="text-align:right">基于sklearn的一些机器学习的代码</td>
</tr>
</tbody>
</table></div>

<div class="component-content pagebody component">
  <h3 id="方法1暴力笛卡尔积--过滤" class="pagebody-header">
    方法1：暴力笛卡尔积 + 过滤
  </h3>
</div>
<div class="component-content pagebody component">
  <h4 id="新增数字完全一样的列" class="pagebody-header">
    新增数字完全一样的列
  </h4>
</div><p class="component-content component">In [4]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_keyword[<span style="color:#e6db74">&#34;match&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>df_sentence[<span style="color:#e6db74">&#34;match&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">In [5]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_keyword</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[5]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">keyid</th>
<th style="text-align:right">keyword</th>
<th style="text-align:right">match</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2</td>
<td style="text-align:right">matplotlib</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">3</td>
<td style="text-align:right">sklearn</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table></div>
<p class="component-content component">In [6]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_sentence</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[6]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">senid</th>
<th style="text-align:right">sentence</th>
<th style="text-align:right">match</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">10</td>
<td style="text-align:right">怎样用Pandas实现数据的Merge？</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">Python之Numpy详细教程</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">12</td>
<td style="text-align:right">怎样使用Pandas批量拆分与合并Excel文件？</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">13</td>
<td style="text-align:right">怎样使用Pandas的map和apply函数？</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">14</td>
<td style="text-align:right">深度学习及TensorFlow简介</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">16</td>
<td style="text-align:right">基于sklearn的一些机器学习的代码</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table></div>

<div class="component-content pagebody component">
  <h4 id="实现merge" class="pagebody-header">
    实现merge
  </h4>
</div><p class="component-content component">结果行数 = A表行数 * B表行数</p>
<p class="component-content component">In [7]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_merge <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>merge(df_keyword, df_sentence)
</span></span><span style="display:flex;"><span>df_merge</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[7]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">keyid</th>
<th style="text-align:right">keyword</th>
<th style="text-align:right">match</th>
<th style="text-align:right">senid</th>
<th style="text-align:right">sentence</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
<td style="text-align:right">1</td>
<td style="text-align:right">10</td>
<td style="text-align:right">怎样用Pandas实现数据的Merge？</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">Python之Numpy详细教程</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
<td style="text-align:right">1</td>
<td style="text-align:right">12</td>
<td style="text-align:right">怎样使用Pandas批量拆分与合并Excel文件？</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
<td style="text-align:right">1</td>
<td style="text-align:right">13</td>
<td style="text-align:right">怎样使用Pandas的map和apply函数？</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
<td style="text-align:right">1</td>
<td style="text-align:right">14</td>
<td style="text-align:right">深度学习及TensorFlow简介</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
<td style="text-align:right">1</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
<td style="text-align:right">1</td>
<td style="text-align:right">16</td>
<td style="text-align:right">基于sklearn的一些机器学习的代码</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
<td style="text-align:right">10</td>
<td style="text-align:right">怎样用Pandas实现数据的Merge？</td>
</tr>
<tr>
<td style="text-align:right">8</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">Python之Numpy详细教程</td>
</tr>
<tr>
<td style="text-align:right">9</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
<td style="text-align:right">12</td>
<td style="text-align:right">怎样使用Pandas批量拆分与合并Excel文件？</td>
</tr>
<tr>
<td style="text-align:right">10</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
<td style="text-align:right">13</td>
<td style="text-align:right">怎样使用Pandas的map和apply函数？</td>
</tr>
<tr>
<td style="text-align:right">11</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
<td style="text-align:right">14</td>
<td style="text-align:right">深度学习及TensorFlow简介</td>
</tr>
<tr>
<td style="text-align:right">12</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
</tr>
<tr>
<td style="text-align:right">13</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
<td style="text-align:right">16</td>
<td style="text-align:right">基于sklearn的一些机器学习的代码</td>
</tr>
<tr>
<td style="text-align:right">14</td>
<td style="text-align:right">2</td>
<td style="text-align:right">matplotlib</td>
<td style="text-align:right">1</td>
<td style="text-align:right">10</td>
<td style="text-align:right">怎样用Pandas实现数据的Merge？</td>
</tr>
<tr>
<td style="text-align:right">15</td>
<td style="text-align:right">2</td>
<td style="text-align:right">matplotlib</td>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">Python之Numpy详细教程</td>
</tr>
<tr>
<td style="text-align:right">16</td>
<td style="text-align:right">2</td>
<td style="text-align:right">matplotlib</td>
<td style="text-align:right">1</td>
<td style="text-align:right">12</td>
<td style="text-align:right">怎样使用Pandas批量拆分与合并Excel文件？</td>
</tr>
<tr>
<td style="text-align:right">17</td>
<td style="text-align:right">2</td>
<td style="text-align:right">matplotlib</td>
<td style="text-align:right">1</td>
<td style="text-align:right">13</td>
<td style="text-align:right">怎样使用Pandas的map和apply函数？</td>
</tr>
<tr>
<td style="text-align:right">18</td>
<td style="text-align:right">2</td>
<td style="text-align:right">matplotlib</td>
<td style="text-align:right">1</td>
<td style="text-align:right">14</td>
<td style="text-align:right">深度学习及TensorFlow简介</td>
</tr>
<tr>
<td style="text-align:right">19</td>
<td style="text-align:right">2</td>
<td style="text-align:right">matplotlib</td>
<td style="text-align:right">1</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
</tr>
<tr>
<td style="text-align:right">20</td>
<td style="text-align:right">2</td>
<td style="text-align:right">matplotlib</td>
<td style="text-align:right">1</td>
<td style="text-align:right">16</td>
<td style="text-align:right">基于sklearn的一些机器学习的代码</td>
</tr>
<tr>
<td style="text-align:right">21</td>
<td style="text-align:right">3</td>
<td style="text-align:right">sklearn</td>
<td style="text-align:right">1</td>
<td style="text-align:right">10</td>
<td style="text-align:right">怎样用Pandas实现数据的Merge？</td>
</tr>
<tr>
<td style="text-align:right">22</td>
<td style="text-align:right">3</td>
<td style="text-align:right">sklearn</td>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">Python之Numpy详细教程</td>
</tr>
<tr>
<td style="text-align:right">23</td>
<td style="text-align:right">3</td>
<td style="text-align:right">sklearn</td>
<td style="text-align:right">1</td>
<td style="text-align:right">12</td>
<td style="text-align:right">怎样使用Pandas批量拆分与合并Excel文件？</td>
</tr>
<tr>
<td style="text-align:right">24</td>
<td style="text-align:right">3</td>
<td style="text-align:right">sklearn</td>
<td style="text-align:right">1</td>
<td style="text-align:right">13</td>
<td style="text-align:right">怎样使用Pandas的map和apply函数？</td>
</tr>
<tr>
<td style="text-align:right">25</td>
<td style="text-align:right">3</td>
<td style="text-align:right">sklearn</td>
<td style="text-align:right">1</td>
<td style="text-align:right">14</td>
<td style="text-align:right">深度学习及TensorFlow简介</td>
</tr>
<tr>
<td style="text-align:right">26</td>
<td style="text-align:right">3</td>
<td style="text-align:right">sklearn</td>
<td style="text-align:right">1</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
</tr>
<tr>
<td style="text-align:right">27</td>
<td style="text-align:right">3</td>
<td style="text-align:right">sklearn</td>
<td style="text-align:right">1</td>
<td style="text-align:right">16</td>
<td style="text-align:right">基于sklearn的一些机器学习的代码</td>
</tr>
<tr>
<td style="text-align:right">28</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
<td style="text-align:right">1</td>
<td style="text-align:right">10</td>
<td style="text-align:right">怎样用Pandas实现数据的Merge？</td>
</tr>
<tr>
<td style="text-align:right">29</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">Python之Numpy详细教程</td>
</tr>
<tr>
<td style="text-align:right">30</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
<td style="text-align:right">1</td>
<td style="text-align:right">12</td>
<td style="text-align:right">怎样使用Pandas批量拆分与合并Excel文件？</td>
</tr>
<tr>
<td style="text-align:right">31</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
<td style="text-align:right">1</td>
<td style="text-align:right">13</td>
<td style="text-align:right">怎样使用Pandas的map和apply函数？</td>
</tr>
<tr>
<td style="text-align:right">32</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
<td style="text-align:right">1</td>
<td style="text-align:right">14</td>
<td style="text-align:right">深度学习及TensorFlow简介</td>
</tr>
<tr>
<td style="text-align:right">33</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
<td style="text-align:right">1</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
</tr>
<tr>
<td style="text-align:right">34</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
<td style="text-align:right">1</td>
<td style="text-align:right">16</td>
<td style="text-align:right">基于sklearn的一些机器学习的代码</td>
</tr>
</tbody>
</table></div>

<div class="component-content pagebody component">
  <h4 id="过滤出结果" class="pagebody-header">
    过滤出结果
  </h4>
</div><p class="component-content component">In [8]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">match_func</span>(row):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> re<span style="color:#f92672">.</span>search(row[<span style="color:#e6db74">&#34;keyword&#34;</span>], row[<span style="color:#e6db74">&#34;sentence&#34;</span>], re<span style="color:#f92672">.</span>IGNORECASE) <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df_merge[df_merge<span style="color:#f92672">.</span>apply(match_func, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)]</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[8]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">keyid</th>
<th style="text-align:right">keyword</th>
<th style="text-align:right">match</th>
<th style="text-align:right">senid</th>
<th style="text-align:right">sentence</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">Python之Numpy详细教程</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
<td style="text-align:right">1</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
<td style="text-align:right">10</td>
<td style="text-align:right">怎样用Pandas实现数据的Merge？</td>
</tr>
<tr>
<td style="text-align:right">9</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
<td style="text-align:right">12</td>
<td style="text-align:right">怎样使用Pandas批量拆分与合并Excel文件？</td>
</tr>
<tr>
<td style="text-align:right">10</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
<td style="text-align:right">13</td>
<td style="text-align:right">怎样使用Pandas的map和apply函数？</td>
</tr>
<tr>
<td style="text-align:right">27</td>
<td style="text-align:right">3</td>
<td style="text-align:right">sklearn</td>
<td style="text-align:right">1</td>
<td style="text-align:right">16</td>
<td style="text-align:right">基于sklearn的一些机器学习的代码</td>
</tr>
<tr>
<td style="text-align:right">32</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
<td style="text-align:right">1</td>
<td style="text-align:right">14</td>
<td style="text-align:right">深度学习及TensorFlow简介</td>
</tr>
<tr>
<td style="text-align:right">33</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
<td style="text-align:right">1</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
</tr>
</tbody>
</table></div>

<div class="component-content pagebody component">
  <h3 id="方法2小表变字典做merge最后explode" class="pagebody-header">
    方法2：小表变字典做merge最后explode
  </h3>
</div>
<div class="component-content pagebody component">
  <h4 id="构建要join的keyindex的关系" class="pagebody-header">
    构建要join的key:index的关系
  </h4>
</div><p class="component-content component">In [9]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>key_word_dict <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    row<span style="color:#f92672">.</span>keyword : row<span style="color:#f92672">.</span>keyid 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> row <span style="color:#f92672">in</span> df_keyword<span style="color:#f92672">.</span>itertuples()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>key_word_dict</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[9]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{<span style="color:#e6db74">&#39;numpy&#39;</span>: <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#39;pandas&#39;</span>: <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;matplotlib&#39;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;sklearn&#39;</span>: <span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;tensorflow&#39;</span>: <span style="color:#ae81ff">4</span>}</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h4 id="大表搜寻小表字典" class="pagebody-header">
    大表搜寻小表字典
  </h4>
</div><p class="component-content component">In [10]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">merge_func</span>(row):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 新增一列，表示能匹配的keyids</span>
</span></span><span style="display:flex;"><span>    row[<span style="color:#e6db74">&#34;keyids&#34;</span>] <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>        keyid
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> key_word, keyid <span style="color:#f92672">in</span> key_word_dict<span style="color:#f92672">.</span>items()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> re<span style="color:#f92672">.</span>search(key_word, row[<span style="color:#e6db74">&#34;sentence&#34;</span>], re<span style="color:#f92672">.</span>IGNORECASE)
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> row
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df_merge <span style="color:#f92672">=</span> df_sentence<span style="color:#f92672">.</span>apply(merge_func, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">In [11]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_merge</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[11]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">senid</th>
<th style="text-align:right">sentence</th>
<th style="text-align:right">match</th>
<th style="text-align:right">keyids</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">10</td>
<td style="text-align:right">怎样用Pandas实现数据的Merge？</td>
<td style="text-align:right">1</td>
<td style="text-align:right">[1]</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">Python之Numpy详细教程</td>
<td style="text-align:right">1</td>
<td style="text-align:right">[0]</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">12</td>
<td style="text-align:right">怎样使用Pandas批量拆分与合并Excel文件？</td>
<td style="text-align:right">1</td>
<td style="text-align:right">[1]</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">13</td>
<td style="text-align:right">怎样使用Pandas的map和apply函数？</td>
<td style="text-align:right">1</td>
<td style="text-align:right">[1]</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">14</td>
<td style="text-align:right">深度学习及TensorFlow简介</td>
<td style="text-align:right">1</td>
<td style="text-align:right">[4]</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
<td style="text-align:right">1</td>
<td style="text-align:right">[0, 4]</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">16</td>
<td style="text-align:right">基于sklearn的一些机器学习的代码</td>
<td style="text-align:right">1</td>
<td style="text-align:right">[3]</td>
</tr>
</tbody>
</table></div>

<div class="component-content pagebody component">
  <h4 id="展开然后做merge" class="pagebody-header">
    展开然后做merge
  </h4>
</div><p class="component-content component">In [12]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_merge<span style="color:#f92672">.</span>explode(<span style="color:#e6db74">&#34;keyids&#34;</span>)</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[12]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">senid</th>
<th style="text-align:right">sentence</th>
<th style="text-align:right">match</th>
<th style="text-align:right">keyids</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">10</td>
<td style="text-align:right">怎样用Pandas实现数据的Merge？</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">Python之Numpy详细教程</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">12</td>
<td style="text-align:right">怎样使用Pandas批量拆分与合并Excel文件？</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">13</td>
<td style="text-align:right">怎样使用Pandas的map和apply函数？</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">14</td>
<td style="text-align:right">深度学习及TensorFlow简介</td>
<td style="text-align:right">1</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
<td style="text-align:right">1</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">16</td>
<td style="text-align:right">基于sklearn的一些机器学习的代码</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3</td>
</tr>
</tbody>
</table></div>
<p class="component-content component">In [13]:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_result <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>merge(
</span></span><span style="display:flex;"><span>    left <span style="color:#f92672">=</span> df_merge<span style="color:#f92672">.</span>explode(<span style="color:#e6db74">&#34;keyids&#34;</span>),
</span></span><span style="display:flex;"><span>    right <span style="color:#f92672">=</span> df_keyword,
</span></span><span style="display:flex;"><span>    left_on <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;keyids&#34;</span>,
</span></span><span style="display:flex;"><span>    right_on <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;keyid&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>df_result</span></span></code></pre></div></div>
  
</div><p class="component-content component">Out[13]:</p>
<div class="component-content component"><table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">senid</th>
<th style="text-align:right">sentence</th>
<th style="text-align:right">match_x</th>
<th style="text-align:right">keyids</th>
<th style="text-align:right">keyid</th>
<th style="text-align:right">keyword</th>
<th style="text-align:right">match_y</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">10</td>
<td style="text-align:right">怎样用Pandas实现数据的Merge？</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">12</td>
<td style="text-align:right">怎样使用Pandas批量拆分与合并Excel文件？</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">13</td>
<td style="text-align:right">怎样使用Pandas的map和apply函数？</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">pandas</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">11</td>
<td style="text-align:right">Python之Numpy详细教程</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">numpy</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">14</td>
<td style="text-align:right">深度学习及TensorFlow简介</td>
<td style="text-align:right">1</td>
<td style="text-align:right">4</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">15</td>
<td style="text-align:right">Tensorflow和Numpy的关系</td>
<td style="text-align:right">1</td>
<td style="text-align:right">4</td>
<td style="text-align:right">4</td>
<td style="text-align:right">tensorflow</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">16</td>
<td style="text-align:right">基于sklearn的一些机器学习的代码</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3</td>
<td style="text-align:right">3</td>
<td style="text-align:right">sklearn</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table></div>

          </div><div class="component">
            <div class="component-content">
              <div class="article-copyright">
                <p class="content">
                  Copyright: <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed" target="_blank">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0)</a>
                </p>
                <p class="content">Author:   </p>
                <p class="content">Posted on:  November 26, 2021</p>
              </div>
            </div>
          </div></article>
      </section>
  </main>

  <script>
    var script = document.createElement("script");script.src = "https://yuanshuai1122.github.io/js/initPost.js";
    document.head.appendChild(script);
  </script>

    
    <div class="footer-main ">
  <div class="content-body footer-wraper">
    <div class="footer-box">
      <div class="foot-nav">
        <div class="foot-nav-items">
          <div class="item">
            <div class="logo"></div>
            <div class="email">Email: <a href="mailto:floyd.li@outlook.com">floyd.li@outlook.com</a></div>
          </div>

          <div class="item community">
            <div class="item-title">Social Media</div>
            
              <a href="https://github.com/floyd-li" target="_blank">Github</a>
            
          </div>

          <div class="item resources">
            <div class="item-title">Related</div>
            
              <a href="https://yufengbiji.com/" target="_blank">驭风笔记</a>
            
          </div>
        </div>
      </div>
      <div class="bottom">
        <div class="item copyright">
          &copy; 2023
          Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> & <a href="https://github.com/floyd-li/hugo-theme-itheme" target="_blank">iTheme</a>
        </div>
      </div>
    </div>
  </div>
</div>

  </body>
    
    

    
    
</html>
