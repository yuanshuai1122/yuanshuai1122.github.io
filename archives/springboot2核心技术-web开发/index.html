<!DOCTYPE html>
<html class="js no-touch  progressive-image  no-reduced-motion progressive" lang="en">
  <head>
    <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="icon" href="/img/favicon.ico">

    <meta name="keyword" content=""><meta property="og:title" content="SpringBoot2核心技术-web开发" />
<meta property="og:description" content="BindingAwareModelMap 是Model 也是Map mavContainer.getModel(); 获取到值的 1.4、自定义对象参数： 可以自动类型转换与格式化，可以级联封装。 /** * 姓名： &lt;input name=&#34;userName&#34;/&gt; &lt;br/&gt; * 年龄： &lt;input name=&#34;age&#34;/&gt; &lt;br/&gt; * 生日： &lt;input" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yuanshuai1122.github.io/archives/springboot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-web%E5%BC%80%E5%8F%91/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-26T21:32:55+00:00" />
<meta property="article:modified_time" content="2021-11-26T21:32:55+00:00" />
<title>SpringBoot2核心技术-web开发</title>

    <link rel="canonical" href="/archives/springboot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-web%E5%BC%80%E5%8F%91/">

    <link rel="stylesheet" href="/css/global.css">

    <link rel="stylesheet" href="/css/custom.css">

    <link rel="stylesheet" href="/css/search.css" />

    
    

    
    

</head>
  </head>
  <body class=" page-article   ">
    <header>
      <nav class="nav">
  <div class="nav-wrapper">
    <div class="nav-content-wrapper">
      <div class="nav-content">
        <a href="/ " class="nav-title">iTheme</a>
        <div class="nav-menu">
          <div class="nav-item-wrapper">
            <a href="/posts " class="nav-item-content">Articles</a>
          </div><div class="nav-item-wrapper">
            <a href="/about" class="nav-item-content">About</a>
          </div><div class="nav-item-wrapper">
            <a href="/index.xml" class="nav-item-content" target="_blank">RSS</a>
          </div></div>
      </div>
    </div>
  </div>
</nav>

<script>
  function toggleSearchModal(){
    const template = `
    <div class="modal-body">
      <div id="autocomplete" onclick="event.stopPropagation();"></div>
    </div>
    `
    const modal = document.querySelector("#modal-wrapper")
    if(!modal){
      const div = document.createElement("div")
      document.body.setAttribute("style","overflow: hidden;")
      div.setAttribute("id", "modal-wrapper")
      div.setAttribute("onclick", "toggleSearchModal()")
      div.innerHTML = template
      const script = document.createElement("script");script.setAttribute("src", "https://yuanshuai1122.github.io/js/algolia.js")
      div.appendChild(script)
      document.body.append(div)
    } else {
      document.body.removeAttribute("style")
      document.body.removeChild(modal)
    }
  }
</script>
    </header>
    
  
  
  <main id="main" class="main">
      <section>
        <article class="article">
          
          <div class=" article-header ">
            <div class="category component">
              <div class="component-content">
                <div class="category-eyebrow">
                  <span class="category-eyebrow__category category_original">
                    
                      
                        Java
                      
                    
                  </span>
                  <span class="category-eyebrow__date">November 26, 2021</span>
                </div>
              </div>
            </div>
            <div class="pagetitle component">
              <div class="component-content">
                <h1 class="hero-headline">SpringBoot2核心技术-web开发</h1>
              </div>
            </div>
            <div class="component  article-subhead ">
              <div class="component-content"></div>
            </div>

            <div class="tagssheet component">
              <div class="component-content">
                
                  
                  <a href="/tags/java" class="tag">
                    Java
                  </a>
                
                  
                  <a href="/tags/springboot" class="tag">
                    SpringBoot
                  </a>
                
              </div>
            </div>
          </div>
          
          <div class="pagebody">
            
            
            
            
            
            
            
            
            <blockquote>
<p class="component-content component">BindingAwareModelMap 是Model 也是Map</p>
</blockquote>
<p class="component-content component"><strong>mavContainer</strong>.getModel(); 获取到值的</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-64e07339ebc0df57ed01df730347e355" id="lht64e07339ebc0df57ed01df730347e355">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/19.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-76a6601783136b43b5ce845a2a737f89" id="lht76a6601783136b43b5ce845a2a737f89">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/20.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-456313ec9ce0bd3b3cda37251c425281" id="lht456313ec9ce0bd3b3cda37251c425281">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/21.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h3 id="14自定义对象参数" class="pagebody-header">
    1.4、自定义对象参数：
  </h3>
</div><p class="component-content component">可以自动类型转换与格式化，可以级联封装。</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *     姓名： &lt;input name=&#34;userName&#34;/&gt; &lt;br/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *     年龄： &lt;input name=&#34;age&#34;/&gt; &lt;br/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *     生日： &lt;input name=&#34;birth&#34;/&gt; &lt;br/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *     宠物姓名：&lt;input name=&#34;pet.name&#34;/&gt;&lt;br/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *     宠物年龄：&lt;input name=&#34;pet.age&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Data</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String userName<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Integer age<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Date birth<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Pet pet<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Data</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Pet</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String name<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String age<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>result</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h2 id="2pojo封装过程" class="pagebody-header">
    2、POJO封装过程
  </h2>
</div><div class="component-content component"><ul>
<li><strong>ServletModelAttributeMethodProcessor</strong></li>
</ul></div>

<div class="component-content pagebody component">
  <h2 id="3参数处理原理" class="pagebody-header">
    3、参数处理原理
  </h2>
</div><div class="component-content component"><ul>
<li>HandlerMapping中找到能处理请求的Handler（Controller.method()）</li>
<li>为当前Handler 找一个适配器 HandlerAdapter； <strong>RequestMappingHandlerAdapter</strong></li>
<li>适配器执行目标方法并确定方法参数的每一个值</li>
</ul></div>

<div class="component-content pagebody component">
  <h3 id="1handleradapter" class="pagebody-header">
    1、HandlerAdapter
  </h3>
</div><p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-19d6a0d1b79d1030ef4516285a63796a" id="lht19d6a0d1b79d1030ef4516285a63796a">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/22.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">0 - 支持方法上标注@RequestMapping</p>
<p class="component-content component">1 - 支持函数式编程的</p>
<p class="component-content component">xxxxxx</p>

<div class="component-content pagebody component">
  <h3 id="2执行目标方法" class="pagebody-header">
    2、执行目标方法
  </h3>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Actually invoke the handler.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//DispatcherServlet -- doDispatch
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mv <span style="color:#f92672">=</span> ha<span style="color:#f92672">.</span><span style="color:#a6e22e">handle</span><span style="color:#f92672">(</span>processedRequest<span style="color:#f92672">,</span> response<span style="color:#f92672">,</span> mappedHandler<span style="color:#f92672">.</span><span style="color:#a6e22e">getHandler</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>mav <span style="color:#f92672">=</span> invokeHandlerMethod<span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">,</span> handlerMethod<span style="color:#f92672">);</span> <span style="color:#75715e">//执行目标方法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//ServletInvocableHandlerMethod
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Object returnValue <span style="color:#f92672">=</span> invokeForRequest<span style="color:#f92672">(</span>webRequest<span style="color:#f92672">,</span> mavContainer<span style="color:#f92672">,</span> providedArgs<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//获取方法的参数值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Object<span style="color:#f92672">[]</span> args <span style="color:#f92672">=</span> getMethodArgumentValues<span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> mavContainer<span style="color:#f92672">,</span> providedArgs<span style="color:#f92672">);</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="3参数解析器-handlermethodargumentresolver" class="pagebody-header">
    3、参数解析器-HandlerMethodArgumentResolver
  </h3>
</div><p class="component-content component">确定将要执行的目标方法的每一个参数的值是什么;</p>
<p class="component-content component">SpringMVC目标方法能写多少种参数类型。取决于参数解析器。</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-df9f05a3a8b1d8755240bdc26f6821ae" id="lhtdf9f05a3a8b1d8755240bdc26f6821ae">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/23.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-1d648ecf2ce7c1a18ad9e950648a63ad" id="lht1d648ecf2ce7c1a18ad9e950648a63ad">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/24.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<div class="component-content component"><ul>
<li>当前解析器是否支持解析这种参数</li>
<li>支持就调用 resolveArgument</li>
</ul></div>

<div class="component-content pagebody component">
  <h3 id="4返回值处理器" class="pagebody-header">
    4、返回值处理器
  </h3>
</div><p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-4bfdd9b929b1338eee23d56c4ba623fa" id="lht4bfdd9b929b1338eee23d56c4ba623fa">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/25.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h3 id="5如何确定目标方法每一个参数的值" class="pagebody-header">
    5、如何确定目标方法每一个参数的值
  </h3>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">============</span>InvocableHandlerMethod<span style="color:#f92672">==========================</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">protected</span> Object<span style="color:#f92672">[]</span> <span style="color:#a6e22e">getMethodArgumentValues</span><span style="color:#f92672">(</span>NativeWebRequest request<span style="color:#f92672">,</span> <span style="color:#a6e22e">@Nullable</span> ModelAndViewContainer mavContainer<span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>            Object<span style="color:#f92672">...</span> providedArgs<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        MethodParameter<span style="color:#f92672">[]</span> parameters <span style="color:#f92672">=</span> getMethodParameters<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ObjectUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">(</span>parameters<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> EMPTY_ARGS<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Object<span style="color:#f92672">[]</span> args <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Object<span style="color:#f92672">[</span>parameters<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">];</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> parameters<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            MethodParameter parameter <span style="color:#f92672">=</span> parameters<span style="color:#f92672">[</span>i<span style="color:#f92672">];</span>
</span></span><span style="display:flex;"><span>            parameter<span style="color:#f92672">.</span><span style="color:#a6e22e">initParameterNameDiscovery</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">parameterNameDiscoverer</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            args<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> findProvidedArgument<span style="color:#f92672">(</span>parameter<span style="color:#f92672">,</span> providedArgs<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>args<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">continue</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">resolvers</span><span style="color:#f92672">.</span><span style="color:#a6e22e">supportsParameter</span><span style="color:#f92672">(</span>parameter<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalStateException<span style="color:#f92672">(</span>formatArgumentError<span style="color:#f92672">(</span>parameter<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;No suitable resolver&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                args<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">resolvers</span><span style="color:#f92672">.</span><span style="color:#a6e22e">resolveArgument</span><span style="color:#f92672">(</span>parameter<span style="color:#f92672">,</span> mavContainer<span style="color:#f92672">,</span> request<span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">dataBinderFactory</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception ex<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Leave stack trace for later, exception may actually be resolved and handled...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>logger<span style="color:#f92672">.</span><span style="color:#a6e22e">isDebugEnabled</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    String exMsg <span style="color:#f92672">=</span> ex<span style="color:#f92672">.</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>exMsg <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>exMsg<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>parameter<span style="color:#f92672">.</span><span style="color:#a6e22e">getExecutable</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toGenericString</span><span style="color:#f92672">()))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        logger<span style="color:#f92672">.</span><span style="color:#a6e22e">debug</span><span style="color:#f92672">(</span>formatArgumentError<span style="color:#f92672">(</span>parameter<span style="color:#f92672">,</span> exMsg<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> ex<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> args<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h4 id="51挨个判断所有参数解析器那个支持解析这个参数" class="pagebody-header">
    5.1、挨个判断所有参数解析器那个支持解析这个参数
  </h4>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#a6e22e">@Nullable</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> HandlerMethodArgumentResolver <span style="color:#a6e22e">getArgumentResolver</span><span style="color:#f92672">(</span>MethodParameter parameter<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        HandlerMethodArgumentResolver result <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">argumentResolverCache</span><span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>parameter<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>result <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>HandlerMethodArgumentResolver resolver <span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">argumentResolvers</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>resolver<span style="color:#f92672">.</span><span style="color:#a6e22e">supportsParameter</span><span style="color:#f92672">(</span>parameter<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    result <span style="color:#f92672">=</span> resolver<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">argumentResolverCache</span><span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>parameter<span style="color:#f92672">,</span> result<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> result<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h4 id="52解析这个参数的值" class="pagebody-header">
    5.2、解析这个参数的值
  </h4>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>调用各自 HandlerMethodArgumentResolver 的 resolveArgument 方法即可</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h4 id="53自定义类型参数-封装pojo" class="pagebody-header">
    5.3、自定义类型参数 封装POJO
  </h4>
</div><p class="component-content component"><strong>ServletModelAttributeMethodProcessor  这个参数处理器支持</strong></p>
<p class="component-content component"><strong>是否为简单类型。</strong></p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">isSimpleValueType</span><span style="color:#f92672">(</span>Class<span style="color:#f92672">&lt;?&gt;</span> type<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span>Void<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span> <span style="color:#f92672">!=</span> type <span style="color:#f92672">&amp;&amp;</span> <span style="color:#66d9ef">void</span><span style="color:#f92672">.</span><span style="color:#a6e22e">class</span> <span style="color:#f92672">!=</span> type <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">(</span>ClassUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">isPrimitiveOrWrapper</span><span style="color:#f92672">(</span>type<span style="color:#f92672">)</span> <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>                Enum<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">isAssignableFrom</span><span style="color:#f92672">(</span>type<span style="color:#f92672">)</span> <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>                CharSequence<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">isAssignableFrom</span><span style="color:#f92672">(</span>type<span style="color:#f92672">)</span> <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>                Number<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">isAssignableFrom</span><span style="color:#f92672">(</span>type<span style="color:#f92672">)</span> <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>                Date<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">isAssignableFrom</span><span style="color:#f92672">(</span>type<span style="color:#f92672">)</span> <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>                Temporal<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">isAssignableFrom</span><span style="color:#f92672">(</span>type<span style="color:#f92672">)</span> <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>                URI<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span> <span style="color:#f92672">==</span> type <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>                URL<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span> <span style="color:#f92672">==</span> type <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>                Locale<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span> <span style="color:#f92672">==</span> type <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>                Class<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span> <span style="color:#f92672">==</span> type<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Nullable</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">final</span> Object <span style="color:#a6e22e">resolveArgument</span><span style="color:#f92672">(</span>MethodParameter parameter<span style="color:#f92672">,</span> <span style="color:#a6e22e">@Nullable</span> ModelAndViewContainer mavContainer<span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>            NativeWebRequest webRequest<span style="color:#f92672">,</span> <span style="color:#a6e22e">@Nullable</span> WebDataBinderFactory binderFactory<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Assert<span style="color:#f92672">.</span><span style="color:#a6e22e">state</span><span style="color:#f92672">(</span>mavContainer <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;ModelAttributeMethodProcessor requires ModelAndViewContainer&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        Assert<span style="color:#f92672">.</span><span style="color:#a6e22e">state</span><span style="color:#f92672">(</span>binderFactory <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;ModelAttributeMethodProcessor requires WebDataBinderFactory&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        String name <span style="color:#f92672">=</span> ModelFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">getNameForParameter</span><span style="color:#f92672">(</span>parameter<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        ModelAttribute ann <span style="color:#f92672">=</span> parameter<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameterAnnotation</span><span style="color:#f92672">(</span>ModelAttribute<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ann <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            mavContainer<span style="color:#f92672">.</span><span style="color:#a6e22e">setBinding</span><span style="color:#f92672">(</span>name<span style="color:#f92672">,</span> ann<span style="color:#f92672">.</span><span style="color:#a6e22e">binding</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Object attribute <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        BindingResult bindingResult <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mavContainer<span style="color:#f92672">.</span><span style="color:#a6e22e">containsAttribute</span><span style="color:#f92672">(</span>name<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            attribute <span style="color:#f92672">=</span> mavContainer<span style="color:#f92672">.</span><span style="color:#a6e22e">getModel</span><span style="color:#f92672">().</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>name<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Create attribute instance
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                attribute <span style="color:#f92672">=</span> createAttribute<span style="color:#f92672">(</span>name<span style="color:#f92672">,</span> parameter<span style="color:#f92672">,</span> binderFactory<span style="color:#f92672">,</span> webRequest<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>BindException ex<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>isBindExceptionRequired<span style="color:#f92672">(</span>parameter<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// No BindingResult parameter -&gt; fail with BindException
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">throw</span> ex<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Otherwise, expose null/empty value and associated BindingResult
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>parameter<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameterType</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> Optional<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    attribute <span style="color:#f92672">=</span> Optional<span style="color:#f92672">.</span><span style="color:#a6e22e">empty</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                bindingResult <span style="color:#f92672">=</span> ex<span style="color:#f92672">.</span><span style="color:#a6e22e">getBindingResult</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>bindingResult <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Bean property binding and validation;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#75715e">// skipped in case of binding failure on construction.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            WebDataBinder binder <span style="color:#f92672">=</span> binderFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">createBinder</span><span style="color:#f92672">(</span>webRequest<span style="color:#f92672">,</span> attribute<span style="color:#f92672">,</span> name<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>binder<span style="color:#f92672">.</span><span style="color:#a6e22e">getTarget</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>mavContainer<span style="color:#f92672">.</span><span style="color:#a6e22e">isBindingDisabled</span><span style="color:#f92672">(</span>name<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    bindRequestParameters<span style="color:#f92672">(</span>binder<span style="color:#f92672">,</span> webRequest<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                validateIfApplicable<span style="color:#f92672">(</span>binder<span style="color:#f92672">,</span> parameter<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>binder<span style="color:#f92672">.</span><span style="color:#a6e22e">getBindingResult</span><span style="color:#f92672">().</span><span style="color:#a6e22e">hasErrors</span><span style="color:#f92672">()</span> <span style="color:#f92672">&amp;&amp;</span> isBindExceptionRequired<span style="color:#f92672">(</span>binder<span style="color:#f92672">,</span> parameter<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> BindException<span style="color:#f92672">(</span>binder<span style="color:#f92672">.</span><span style="color:#a6e22e">getBindingResult</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Value type adaptation, also covering java.util.Optional
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>parameter<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameterType</span><span style="color:#f92672">().</span><span style="color:#a6e22e">isInstance</span><span style="color:#f92672">(</span>attribute<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                attribute <span style="color:#f92672">=</span> binder<span style="color:#f92672">.</span><span style="color:#a6e22e">convertIfNecessary</span><span style="color:#f92672">(</span>binder<span style="color:#f92672">.</span><span style="color:#a6e22e">getTarget</span><span style="color:#f92672">(),</span> parameter<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameterType</span><span style="color:#f92672">(),</span> parameter<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            bindingResult <span style="color:#f92672">=</span> binder<span style="color:#f92672">.</span><span style="color:#a6e22e">getBindingResult</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Add resolved attribute and BindingResult at the end of the model
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;</span> bindingResultModel <span style="color:#f92672">=</span> bindingResult<span style="color:#f92672">.</span><span style="color:#a6e22e">getModel</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        mavContainer<span style="color:#f92672">.</span><span style="color:#a6e22e">removeAttributes</span><span style="color:#f92672">(</span>bindingResultModel<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        mavContainer<span style="color:#f92672">.</span><span style="color:#a6e22e">addAllAttributes</span><span style="color:#f92672">(</span>bindingResultModel<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> attribute<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="heading" class="pagebody-header">
    
  </h3>
</div><p class="component-content component"><strong>WebDataBinder binder = binderFactory.createBinder(webRequest, attribute, name);</strong></p>
<p class="component-content component"><strong>WebDataBinder :web数据绑定器，将请求参数的值绑定到指定的JavaBean里面</strong></p>
<p class="component-content component"><strong>WebDataBinder 利用它里面的 Converters 将请求数据转成指定的数据类型。再次封装到JavaBean中</strong></p>
<p class="component-content component">**
**</p>
<p class="component-content component"><strong>GenericConversionService：在设置每一个值的时候，找它里面的所有converter那个可以将这个数据类型（request带来参数的字符串）转换到指定的类型（JavaBean &ndash; Integer）</strong></p>
<p class="component-content component"><strong>byte &ndash; &gt; file</strong></p>
<p class="component-content component">**
**</p>
<p class="component-content component">@FunctionalInterface<strong>public interface</strong> Converter&lt;S, T&gt;</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-fe9b35a17d448e51b7e7c030c453fb5e" id="lhtfe9b35a17d448e51b7e7c030c453fb5e">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/26.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-03e9665be3c85db84bf1b64ca22beb86" id="lht03e9665be3c85db84bf1b64ca22beb86">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/27.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">未来我们可以给WebDataBinder里面放自己的Converter；</p>
<p class="component-content component"><strong>private static final class</strong> StringToNumber&lt;T <strong>extends</strong> Number&gt; <strong>implements</strong> Converter&lt;String, T&gt;</p>
<p class="component-content component">自定义 Converter</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#75715e">//1、WebMvcConfigurer定制化SpringMVC的功能
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> WebMvcConfigurer <span style="color:#a6e22e">webMvcConfigurer</span><span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> WebMvcConfigurer<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">configurePathMatch</span><span style="color:#f92672">(</span>PathMatchConfigurer configurer<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                UrlPathHelper urlPathHelper <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> UrlPathHelper<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// 不移除；后面的内容。矩阵变量功能就可以生效
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                urlPathHelper<span style="color:#f92672">.</span><span style="color:#a6e22e">setRemoveSemicolonContent</span><span style="color:#f92672">(</span><span style="color:#66d9ef">false</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                configurer<span style="color:#f92672">.</span><span style="color:#a6e22e">setUrlPathHelper</span><span style="color:#f92672">(</span>urlPathHelper<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">addFormatters</span><span style="color:#f92672">(</span>FormatterRegistry registry<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                registry<span style="color:#f92672">.</span><span style="color:#a6e22e">addConverter</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Converter<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Pet<span style="color:#f92672">&gt;()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">public</span> Pet <span style="color:#a6e22e">convert</span><span style="color:#f92672">(</span>String source<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#75715e">// 啊猫,3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        <span style="color:#66d9ef">if</span><span style="color:#f92672">(!</span>StringUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">(</span>source<span style="color:#f92672">)){</span>
</span></span><span style="display:flex;"><span>                            Pet pet <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Pet<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>                            String<span style="color:#f92672">[]</span> split <span style="color:#f92672">=</span> source<span style="color:#f92672">.</span><span style="color:#a6e22e">split</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;,&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                            pet<span style="color:#f92672">.</span><span style="color:#a6e22e">setName</span><span style="color:#f92672">(</span>split<span style="color:#f92672">[</span><span style="color:#ae81ff">0</span><span style="color:#f92672">]);</span>
</span></span><span style="display:flex;"><span>                            pet<span style="color:#f92672">.</span><span style="color:#a6e22e">setAge</span><span style="color:#f92672">(</span>Integer<span style="color:#f92672">.</span><span style="color:#a6e22e">parseInt</span><span style="color:#f92672">(</span>split<span style="color:#f92672">[</span><span style="color:#ae81ff">1</span><span style="color:#f92672">]));</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#66d9ef">return</span> pet<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">});</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">};</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="6目标方法执行完成" class="pagebody-header">
    6、目标方法执行完成
  </h3>
</div><p class="component-content component">将所有的数据都放在 <strong>ModelAndViewContainer</strong>；包含要去的页面地址View。还包含Model数据。</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-ffe3726cfd4cdc84b0afcc2786c57044" id="lhtffe3726cfd4cdc84b0afcc2786c57044">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/28.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h3 id="7处理派发结果" class="pagebody-header">
    7、处理派发结果
  </h3>
</div><p class="component-content component"><strong>processDispatchResult</strong>(processedRequest, response, mappedHandler, mv, dispatchException);</p>
<p class="component-content component">renderMergedOutputModel(mergedModel, getRequestToExpose(request), response);</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>InternalResourceView<span style="color:#960050;background-color:#1e0010">：</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">renderMergedOutputModel</span><span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>            Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;</span> model<span style="color:#f92672">,</span> HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Expose the model object as request attributes.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        exposeModelAsRequestAttributes<span style="color:#f92672">(</span>model<span style="color:#f92672">,</span> request<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Expose helpers as request attributes, if any.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        exposeHelpers<span style="color:#f92672">(</span>request<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Determine the path for the request dispatcher.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        String dispatcherPath <span style="color:#f92672">=</span> prepareForRendering<span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Obtain a RequestDispatcher for the target resource (typically a JSP).
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        RequestDispatcher rd <span style="color:#f92672">=</span> getRequestDispatcher<span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> dispatcherPath<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>rd <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> ServletException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Could not get RequestDispatcher for [&#34;</span> <span style="color:#f92672">+</span> getUrl<span style="color:#f92672">()</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;]: Check that the corresponding file exists within your web application archive!&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// If already included or response already committed, perform include, else forward.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>useInclude<span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            response<span style="color:#f92672">.</span><span style="color:#a6e22e">setContentType</span><span style="color:#f92672">(</span>getContentType<span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>logger<span style="color:#f92672">.</span><span style="color:#a6e22e">isDebugEnabled</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                logger<span style="color:#f92672">.</span><span style="color:#a6e22e">debug</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Including [&#34;</span> <span style="color:#f92672">+</span> getUrl<span style="color:#f92672">()</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;]&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            rd<span style="color:#f92672">.</span><span style="color:#a6e22e">include</span><span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Note: The forwarded resource is supposed to determine the content type itself.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>logger<span style="color:#f92672">.</span><span style="color:#a6e22e">isDebugEnabled</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                logger<span style="color:#f92672">.</span><span style="color:#a6e22e">debug</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Forwarding to [&#34;</span> <span style="color:#f92672">+</span> getUrl<span style="color:#f92672">()</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;]&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            rd<span style="color:#f92672">.</span><span style="color:#a6e22e">forward</span><span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h1 id="heading-1" class="pagebody-header">
    
  </h1>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>暴露模型作为请求域属性
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Expose the model object as request attributes.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        exposeModelAsRequestAttributes<span style="color:#f92672">(</span>model<span style="color:#f92672">,</span> request<span style="color:#f92672">);</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h1 id="heading-2" class="pagebody-header">
    
  </h1>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">exposeModelAsRequestAttributes</span><span style="color:#f92672">(</span>Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;</span> model<span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>            HttpServletRequest request<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//model中的所有数据遍历挨个放在请求域中
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        model<span style="color:#f92672">.</span><span style="color:#a6e22e">forEach</span><span style="color:#f92672">((</span>name<span style="color:#f92672">,</span> value<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>value <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                request<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span>name<span style="color:#f92672">,</span> value<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                request<span style="color:#f92672">.</span><span style="color:#a6e22e">removeAttribute</span><span style="color:#f92672">(</span>name<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">});</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h1 id="4数据响应与内容协商" class="pagebody-header">
    4、数据响应与内容协商
  </h1>
</div><p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-b5f45be29fcd7421ddc9ab1ad2727012" id="lhtb5f45be29fcd7421ddc9ab1ad2727012">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/29.jpg" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h2 id="1响应json" class="pagebody-header">
    1、响应JSON
  </h2>
</div>
<div class="component-content pagebody component">
  <h3 id="11jacksonjarresponsebody" class="pagebody-header">
    1.1、jackson.jar+@ResponseBody
  </h3>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>        <span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-web<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>web场景自动引入了json场景
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-json<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;version&gt;</span>2.3.4.RELEASE<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;scope&gt;</span>compile<span style="color:#f92672">&lt;/scope&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/dependency&gt;</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-cd27b4021f67721af595f5ec0872245b" id="lhtcd27b4021f67721af595f5ec0872245b">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/30.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">给前端自动返回json数据；</p>

<div class="component-content pagebody component">
  <h4 id="1返回值解析器" class="pagebody-header">
    1、返回值解析器
  </h4>
</div><p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-9e44e29594bc30cb5881179dcbc1636b" id="lht9e44e29594bc30cb5881179dcbc1636b">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/31.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">returnValueHandlers</span><span style="color:#f92672">.</span><span style="color:#a6e22e">handleReturnValue</span><span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>					returnValue<span style="color:#f92672">,</span> getReturnValueType<span style="color:#f92672">(</span>returnValue<span style="color:#f92672">),</span> mavContainer<span style="color:#f92672">,</span> webRequest<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">}</span></span></span></code></pre></div></div>
  
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>	<span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">handleReturnValue</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@Nullable</span> Object returnValue<span style="color:#f92672">,</span> MethodParameter returnType<span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>			ModelAndViewContainer mavContainer<span style="color:#f92672">,</span> NativeWebRequest webRequest<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		HandlerMethodReturnValueHandler handler <span style="color:#f92672">=</span> selectHandler<span style="color:#f92672">(</span>returnValue<span style="color:#f92672">,</span> returnType<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>handler <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalArgumentException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Unknown return value type: &#34;</span> <span style="color:#f92672">+</span> returnType<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameterType</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>		handler<span style="color:#f92672">.</span><span style="color:#a6e22e">handleReturnValue</span><span style="color:#f92672">(</span>returnValue<span style="color:#f92672">,</span> returnType<span style="color:#f92672">,</span> mavContainer<span style="color:#f92672">,</span> webRequest<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">}</span></span></span></code></pre></div></div>
  
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>RequestResponseBodyMethodProcessor  	
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">handleReturnValue</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@Nullable</span> Object returnValue<span style="color:#f92672">,</span> MethodParameter returnType<span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>			ModelAndViewContainer mavContainer<span style="color:#f92672">,</span> NativeWebRequest webRequest<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">,</span> HttpMediaTypeNotAcceptableException<span style="color:#f92672">,</span> HttpMessageNotWritableException <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		mavContainer<span style="color:#f92672">.</span><span style="color:#a6e22e">setRequestHandled</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>		ServletServerHttpRequest inputMessage <span style="color:#f92672">=</span> createInputMessage<span style="color:#f92672">(</span>webRequest<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>		ServletServerHttpResponse outputMessage <span style="color:#f92672">=</span> createOutputMessage<span style="color:#f92672">(</span>webRequest<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// Try even with null return value. ResponseBodyAdvice could get involved.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// 使用消息转换器进行写出操作
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		writeWithMessageConverters<span style="color:#f92672">(</span>returnValue<span style="color:#f92672">,</span> returnType<span style="color:#f92672">,</span> inputMessage<span style="color:#f92672">,</span> outputMessage<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">}</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h4 id="2返回值解析器原理" class="pagebody-header">
    2、返回值解析器原理
  </h4>
</div><p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-b7c8d378d02b719820930307b42fd752" id="lhtb7c8d378d02b719820930307b42fd752">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/32.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<div class="component-content component"><ul>
<li>
<p class="component-content component">1、返回值处理器判断是否支持这种类型返回值 supportsReturnType</p>
</li>
<li>
<p class="component-content component">2、返回值处理器调用 handleReturnValue 进行处理</p>
</li>
<li>
<p class="component-content component">3、RequestResponseBodyMethodProcessor 可以处理返回值标了@ResponseBody 注解的。</p>
</li>
<li>
<div class="component-content component"><ul>
<li>
<div class="component-content component"><ol>
<li>利用 MessageConverters 进行处理 将数据写为json</li>
</ol></div>
</li>
</ul></div>
</li>
<li>
<div class="component-content component"><ul>
<li>
<div class="component-content component"><ul>
<li>1、内容协商（浏览器默认会以请求头的方式告诉服务器他能接受什么样的内容类型）</li>
<li>2、服务器最终根据自己自身的能力，决定服务器能生产出什么样内容类型的数据，</li>
<li>3、SpringMVC会挨个遍历所有容器底层的 HttpMessageConverter ，看谁能处理？</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<div class="component-content component"><ul>
<li>
<div class="component-content component"><ul>
<li>
<div class="component-content component"><ul>
<li>1、得到MappingJackson2HttpMessageConverter可以将对象写为json</li>
<li>2、利用MappingJackson2HttpMessageConverter将对象转为json再写出去。</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-8aac672862a2987bbf33ba14944c2d5e" id="lht8aac672862a2987bbf33ba14944c2d5e">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/33.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h3 id="12springmvc到底支持哪些返回值" class="pagebody-header">
    1.2、SpringMVC到底支持哪些返回值
  </h3>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>ModelAndView
</span></span><span style="display:flex;"><span>Model
</span></span><span style="display:flex;"><span>View
</span></span><span style="display:flex;"><span>ResponseEntity 
</span></span><span style="display:flex;"><span>ResponseBodyEmitter
</span></span><span style="display:flex;"><span>StreamingResponseBody
</span></span><span style="display:flex;"><span>HttpEntity
</span></span><span style="display:flex;"><span>HttpHeaders
</span></span><span style="display:flex;"><span>Callable
</span></span><span style="display:flex;"><span>DeferredResult
</span></span><span style="display:flex;"><span>ListenableFuture
</span></span><span style="display:flex;"><span>CompletionStage
</span></span><span style="display:flex;"><span>WebAsyncTask
</span></span><span style="display:flex;"><span>有 <span style="color:#a6e22e">@ModelAttribute</span> 且为对象类型的
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@ResponseBody</span> 注解 <span style="color:#f92672">---&gt;</span> RequestResponseBodyMethodProcessor<span style="color:#960050;background-color:#1e0010">；</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="13httpmessageconverter原理" class="pagebody-header">
    1.3、HTTPMessageConverter原理
  </h3>
</div>
<div class="component-content pagebody component">
  <h4 id="1messageconverter规范" class="pagebody-header">
    1、MessageConverter规范
  </h4>
</div><p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-2d405bd64255dc148846928036caa9dd" id="lht2d405bd64255dc148846928036caa9dd">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/34.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">HttpMessageConverter: 看是否支持将 此 Class类型的对象，转为MediaType类型的数据。</p>
<p class="component-content component">例子：Person对象转为JSON。或者 JSON转为Person</p>

<div class="component-content pagebody component">
  <h4 id="2默认的messageconverter" class="pagebody-header">
    2、默认的MessageConverter
  </h4>
</div><p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-41c13e48bfef5cf88b52c0aa2139b54f" id="lht41c13e48bfef5cf88b52c0aa2139b54f">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/35.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">0 - 只支持Byte类型的</p>
<p class="component-content component">1 - String</p>
<p class="component-content component">2 - String</p>
<p class="component-content component">3 - Resource</p>
<p class="component-content component">4 - ResourceRegion</p>
<p class="component-content component">5 - DOMSource.*<em>class *</em> SAXSource.<strong>class</strong>) \ StAXSource.**class **StreamSource.**class **Source.<strong>class</strong></p>
<p class="component-content component"><strong>6 -</strong> MultiValueMap</p>
<p class="component-content component">7 - <strong>true</strong></p>
<p class="component-content component"><strong>8 - true</strong></p>
<p class="component-content component"><strong>9 - 支持注解方式xml处理的。</strong></p>
<p class="component-content component">最终 MappingJackson2HttpMessageConverter  把对象转为JSON（利用底层的jackson的objectMapper转换的）</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-0053b26ebce43df74287aac7fe7a13aa" id="lht0053b26ebce43df74287aac7fe7a13aa">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/36.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h2 id="2内容协商" class="pagebody-header">
    2、内容协商
  </h2>
</div><p class="component-content component">根据客户端接收能力不同，返回不同媒体类型的数据。</p>

<div class="component-content pagebody component">
  <h3 id="1引入xml依赖" class="pagebody-header">
    1、引入xml依赖
  </h3>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span> <span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>com.fasterxml.jackson.dataformat<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>jackson-dataformat-xml<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="2postman分别测试返回json和xml" class="pagebody-header">
    2、postman分别测试返回json和xml
  </h3>
</div><p class="component-content component">只需要改变请求头中Accept字段。Http协议中规定的，告诉服务器本客户端可以接收的数据类型。</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-d35e434d0c982db924ece724baa1967c" id="lhtd35e434d0c982db924ece724baa1967c">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/37.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h3 id="3开启浏览器参数方式内容协商功能" class="pagebody-header">
    3、开启浏览器参数方式内容协商功能
  </h3>
</div><p class="component-content component">为了方便内容协商，开启基于请求参数的内容协商功能。</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#f92672">spring</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">contentnegotiation</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">favor-parameter</span>: <span style="color:#66d9ef">true</span>  <span style="color:#75715e">#开启请求参数内容协商模式</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">发请求： http://localhost:8080/test/person?format=json</p>
<p class="component-content component"><a href="http://localhost:8080/test/person?format=json">http://localhost:8080/test/person?format=</a>xml</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-857e8dca5bdf5a4813b36bfc6359cbbb" id="lht857e8dca5bdf5a4813b36bfc6359cbbb">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/38.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">确定客户端接收什么样的内容类型；</p>
<p class="component-content component">1、Parameter策略优先确定是要返回json数据（获取请求头中的format的值）</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-127ef76533ff1bc9ce56bbe7ef0711ef" id="lht127ef76533ff1bc9ce56bbe7ef0711ef">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/39.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">2、最终进行内容协商返回给客户端json即可。</p>

<div class="component-content pagebody component">
  <h3 id="4内容协商原理" class="pagebody-header">
    4、内容协商原理
  </h3>
</div><div class="component-content component"><ul>
<li>
<p class="component-content component">1、判断当前响应头中是否已经有确定的媒体类型。MediaType</p>
</li>
<li>
<p class="component-content component"><strong>2、获取客户端（PostMan、浏览器）支持接收的内容类型。（获取客户端Accept请求头字段）【application/xml】</strong></p>
</li>
<li>
<div class="component-content component"><ul>
<li><strong>contentNegotiationManager 内容协商管理器 默认使用基于请求头的策略</strong></li>
</ul></div>
</li>
</ul></div>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-db0dee89cf94157b6431dfb17c06bcb6" id="lhtdb0dee89cf94157b6431dfb17c06bcb6">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/40.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<div class="component-content component"><ul>
<li></li>
<li><strong>HeaderContentNegotiationStrategy  确定客户端可以接收的内容类型</strong></li>
</ul></div>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-225edaa80e9978e26523799427ad02d9" id="lht225edaa80e9978e26523799427ad02d9">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/41.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">3、遍历循环所有当前系统的 <strong>MessageConverter</strong>，看谁支持操作这个对象（Person）</p>
<p class="component-content component">4、找到支持操作Person的converter，把converter支持的媒体类型统计出来。</p>
<p class="component-content component">5、客户端需要【application/xml】。服务端能力【10种、json、xml】</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-f6bc24f9da7e2ca668d05aef8f06bfa1" id="lhtf6bc24f9da7e2ca668d05aef8f06bfa1">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/42.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-36f944b980a44e0bde08575a7686d51a" id="lht36f944b980a44e0bde08575a7686d51a">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/43.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">6、进行内容协商的最佳匹配媒体类型</p>
<p class="component-content component">7、用 支持 将对象转为 最佳匹配媒体类型 的converter。调用它进行转化 。</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-3ade8ad9674722fc62694712b7d9ae2c" id="lht3ade8ad9674722fc62694712b7d9ae2c">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/44.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">导入了jackson处理xml的包，xml的converter就会自动进来</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>WebMvcConfigurationSupport
</span></span><span style="display:flex;"><span>jackson2XmlPresent <span style="color:#f92672">=</span> ClassUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">isPresent</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;com.fasterxml.jackson.dataformat.xml.XmlMapper&#34;</span><span style="color:#f92672">,</span> classLoader<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>jackson2XmlPresent<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            Jackson2ObjectMapperBuilder builder <span style="color:#f92672">=</span> Jackson2ObjectMapperBuilder<span style="color:#f92672">.</span><span style="color:#a6e22e">xml</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">applicationContext</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                builder<span style="color:#f92672">.</span><span style="color:#a6e22e">applicationContext</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">applicationContext</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            messageConverters<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> MappingJackson2XmlHttpMessageConverter<span style="color:#f92672">(</span>builder<span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">()));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="5自定义-messageconverter" class="pagebody-header">
    5、自定义 MessageConverter
  </h3>
</div><p class="component-content component"><strong>实现多协议数据兼容。json、xml、x-guigu</strong></p>
<p class="component-content component"><strong>0、</strong>@ResponseBody 响应数据出去 调用 <strong>RequestResponseBodyMethodProcessor</strong> 处理</p>
<p class="component-content component">1、Processor 处理方法返回值。通过 <strong>MessageConverter</strong> 处理</p>
<p class="component-content component">2、所有 <strong>MessageConverter</strong> 合起来可以支持各种媒体类型数据的操作（读、写）</p>
<p class="component-content component">3、内容协商找到最终的 <strong>messageConverter</strong>；</p>
<p class="component-content component">SpringMVC的什么功能。一个入口给容器中添加一个  WebMvcConfigurer</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> <span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> WebMvcConfigurer <span style="color:#a6e22e">webMvcConfigurer</span><span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> WebMvcConfigurer<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">extendMessageConverters</span><span style="color:#f92672">(</span>List<span style="color:#f92672">&lt;</span>HttpMessageConverter<span style="color:#f92672">&lt;?&gt;&gt;</span> converters<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-c0eb89f97f6934391133d8a278624f4a" id="lhtc0eb89f97f6934391133d8a278624f4a">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/45.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-cb1fd8e8289385aabdb6eb56607e5907" id="lhtcb1fd8e8289385aabdb6eb56607e5907">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/46.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component"><strong>有可能我们添加的自定义的功能会覆盖默认很多功能，导致一些默认的功能失效。</strong></p>
<p class="component-content component"><strong>大家考虑，上述功能除了我们完全自定义外？SpringBoot有没有为我们提供基于配置文件的快速修改媒体类型功能？怎么配置呢？【提示：参照SpringBoot官方文档web开发内容协商章节】</strong></p>

<div class="component-content pagebody component">
  <h1 id="5视图解析与模板引擎" class="pagebody-header">
    5、视图解析与模板引擎
  </h1>
</div><p class="component-content component">视图解析：<strong>SpringBoot默认不支持 JSP，需要引入第三方模板引擎技术实现页面渲染。</strong></p>

<div class="component-content pagebody component">
  <h2 id="1视图解析" class="pagebody-header">
    1、视图解析
  </h2>
</div><p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-f8698099c47e3ad90b4ebb882a9e7162" id="lhtf8698099c47e3ad90b4ebb882a9e7162">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/47.jpg" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h3 id="1视图解析原理流程" class="pagebody-header">
    1、视图解析原理流程
  </h3>
</div><p class="component-content component">1、目标方法处理的过程中，所有数据都会被放在 <strong>ModelAndViewContainer 里面。包括数据和视图地址</strong></p>
<p class="component-content component"><strong>2、方法的参数是一个自定义类型对象（从请求参数中确定的），把他重新放在</strong> <strong>ModelAndViewContainer</strong></p>
<p class="component-content component"><strong>3、任何目标方法执行完成以后都会返回 ModelAndView（<strong><strong>数据和视图地址</strong></strong>）。</strong></p>
<p class="component-content component">**4、**<strong>processDispatchResult  处理派发结果（页面改如何响应）</strong></p>
<div class="component-content component"><ul>
<li>
<p class="component-content component">1、<strong>render</strong>(<strong>mv</strong>, request, response); 进行页面渲染逻辑</p>
</li>
<li>
<div class="component-content component"><ul>
<li>1、根据方法的String返回值得到 <strong>View</strong> 对象【定义了页面的渲染逻辑】</li>
</ul></div>
</li>
<li>
<div class="component-content component"><ul>
<li>
<div class="component-content component"><ul>
<li>1、所有的视图解析器尝试是否能根据当前返回值得到<strong>View</strong>对象</li>
<li>2、得到了 <strong>redirect:/main.html</strong> &ndash;&gt; Thymeleaf new <strong>RedirectView</strong>()</li>
<li>3、ContentNegotiationViewResolver 里面包含了下面所有的视图解析器，内部还是利用下面所有视图解析器得到视图对象。</li>
<li>4、view.render(mv.getModelInternal(), request, response);  视图对象调用自定义的render进行页面渲染工作</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<div class="component-content component"><ul>
<li>
<div class="component-content component"><ul>
<li>
<div class="component-content component"><ul>
<li><strong>RedirectView 如何渲染【重定向到一个页面】</strong></li>
<li><strong>1、获取目标url地址</strong></li>
<li>**2、**<strong>response.sendRedirect(encodedURL);</strong></li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
<p class="component-content component"><strong>视图解析：</strong></p>
<div class="component-content component"><ul>
<li>
<div class="component-content component"><ul>
<li><strong>返回值以 forward: 开始： new InternalResourceView(forwardUrl); &ndash;&gt;  转发****request.getRequestDispatcher(path).forward(request, response);</strong></li>
<li><strong>返回值以</strong> <strong>redirect: 开始：</strong> <strong>new RedirectView() &ndash;》 render就是重定向</strong></li>
<li><strong>返回值是普通字符串： new ThymeleafView（）&mdash;&gt;</strong></li>
</ul></div>
</li>
</ul></div>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-3211ee2d996d49dfa9341d885e446502" id="lht3211ee2d996d49dfa9341d885e446502">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/48.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-a19f39b3405e7c5a82382c728127eb17" id="lhta19f39b3405e7c5a82382c728127eb17">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/49.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-0755c5318f55edf6319458d3299b4d76" id="lht0755c5318f55edf6319458d3299b4d76">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/50.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-3d069b5db5ce8bcde109c6e0aaf5f138" id="lht3d069b5db5ce8bcde109c6e0aaf5f138">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/51.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h2 id="2模板引擎-thymeleaf" class="pagebody-header">
    2、模板引擎-Thymeleaf
  </h2>
</div>
<div class="component-content pagebody component">
  <h3 id="1thymeleaf简介" class="pagebody-header">
    1、thymeleaf简介
  </h3>
</div><p class="component-content component">Thymeleaf is a modern server-side Java template engine for both web and standalone environments, capable of processing HTML, XML, JavaScript, CSS and even plain text.</p>
<p class="component-content component"><strong>现代化、服务端Java模板引擎</strong></p>

<div class="component-content pagebody component">
  <h3 id="2基本语法" class="pagebody-header">
    2、基本语法
  </h3>
</div>
<div class="component-content pagebody component">
  <h4 id="1表达式" class="pagebody-header">
    1、表达式
  </h4>
</div><div class="component-content component"><table>
<thead>
<tr>
<th>表达式名字</th>
<th>语法</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>变量取值</td>
<td>${&hellip;}</td>
<td>获取请求域、session域、对象等值</td>
</tr>
<tr>
<td>选择变量</td>
<td>*{&hellip;}</td>
<td>获取上下文对象值</td>
</tr>
<tr>
<td>消息</td>
<td>#{&hellip;}</td>
<td>获取国际化等值</td>
</tr>
<tr>
<td>链接</td>
<td>@{&hellip;}</td>
<td>生成链接</td>
</tr>
<tr>
<td>片段表达式</td>
<td>~{&hellip;}</td>
<td>jsp:include 作用，引入公共页面片段</td>
</tr>
</tbody>
</table></div>

<div class="component-content pagebody component">
  <h4 id="2字面量" class="pagebody-header">
    2、字面量
  </h4>
</div><p class="component-content component">文本值: <strong>&lsquo;one text&rsquo;</strong> <strong>,</strong> <strong>&lsquo;Another one!&rsquo;</strong> **,…**数字: <strong>0</strong> <strong>,</strong> <strong>34</strong> <strong>,</strong> <strong>3.0</strong> <strong>,</strong> <strong>12.3</strong> **,…**布尔值: <strong>true</strong> <strong>,</strong> <strong>false</strong></p>
<p class="component-content component">空值: <strong>null</strong></p>
<p class="component-content component">变量： one，two，&hellip;. 变量不能有空格</p>

<div class="component-content pagebody component">
  <h4 id="3文本操作" class="pagebody-header">
    3、文本操作
  </h4>
</div><p class="component-content component">字符串拼接: <strong>+</strong></p>
<p class="component-content component">变量替换: <strong>|The name is ${name}|</strong></p>

<div class="component-content pagebody component">
  <h4 id="4数学运算" class="pagebody-header">
    4、数学运算
  </h4>
</div><p class="component-content component">运算符: + , - , * , / , %</p>

<div class="component-content pagebody component">
  <h4 id="5布尔运算" class="pagebody-header">
    5、布尔运算
  </h4>
</div><p class="component-content component">运算符:  <strong>and</strong> <strong>,</strong> <strong>or</strong></p>
<p class="component-content component">一元运算: <strong>!</strong> <strong>,</strong> <strong>not</strong></p>
<p class="component-content component">**
**</p>

<div class="component-content pagebody component">
  <h4 id="6比较运算" class="pagebody-header">
    6、比较运算
  </h4>
</div><p class="component-content component">比较: <strong>&gt;</strong> <strong>,</strong> <strong>&lt;</strong> <strong>,</strong> <strong>&gt;=</strong> <strong>,</strong> <strong>&lt;=</strong> <strong>(</strong> <strong>gt</strong> <strong>,</strong> <strong>lt</strong> <strong>,</strong> <strong>ge</strong> <strong>,</strong> <strong>le</strong> **)**等式: <strong>==</strong> <strong>,</strong> <strong>!=</strong> <strong>(</strong> <strong>eq</strong> <strong>,</strong> <strong>ne</strong> <strong>)</strong></p>

<div class="component-content pagebody component">
  <h4 id="7条件运算" class="pagebody-header">
    7、条件运算
  </h4>
</div><p class="component-content component">If-then: <strong>(if) ? (then)</strong></p>
<p class="component-content component">If-then-else: <strong>(if) ? (then) : (else)</strong></p>
<p class="component-content component">Default: (value) <strong>?: (defaultvalue)</strong></p>

<div class="component-content pagebody component">
  <h4 id="8特殊操作" class="pagebody-header">
    8、特殊操作
  </h4>
</div><p class="component-content component">无操作： _</p>

<div class="component-content pagebody component">
  <h3 id="3设置属性值-thattr" class="pagebody-header">
    3、设置属性值-th:attr
  </h3>
</div><p class="component-content component">设置单个值</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;subscribe.html&#34;</span> <span style="color:#a6e22e">th:attr</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;action=@{/subscribe}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">fieldset</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;email&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Subscribe!&#34;</span> <span style="color:#a6e22e">th:attr</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;value=#{subscribe.submit}&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">fieldset</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">form</span>&gt;</span></span></code></pre></div></div>
  
</div><p class="component-content component">设置多个值</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">img</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../../images/gtvglogo.png&#34;</span>  <span style="color:#a6e22e">th:attr</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;src=@{/images/gtvglogo.png},title=#{logo},alt=#{logo}&#34;</span> /&gt;</span></span></code></pre></div></div>
  
</div><p class="component-content component">以上两个的代替写法 th:xxxx</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Subscribe!&#34;</span> <span style="color:#a6e22e">th:value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;#{subscribe.submit}&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;subscribe.html&#34;</span> <span style="color:#a6e22e">th:action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/subscribe}&#34;</span>&gt;</span></span></code></pre></div></div>
  
</div><p class="component-content component">所有h5兼容的标签写法</p>
<p class="component-content component"><a href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#setting-value-to-specific-attributes">https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#setting-value-to-specific-attributes</a></p>

<div class="component-content pagebody component">
  <h3 id="4迭代" class="pagebody-header">
    4、迭代
  </h3>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">tr</span> <span style="color:#a6e22e">th:each</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;prod : ${prods}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">td</span> <span style="color:#a6e22e">th:text</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;${prod.name}&#34;</span>&gt;Onions&lt;/<span style="color:#f92672">td</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">td</span> <span style="color:#a6e22e">th:text</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;${prod.price}&#34;</span>&gt;2.41&lt;/<span style="color:#f92672">td</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">td</span> <span style="color:#a6e22e">th:text</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;${prod.inStock}? #{true} : #{false}&#34;</span>&gt;yes&lt;/<span style="color:#f92672">td</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">tr</span>&gt;</span></span></code></pre></div></div>
  
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">tr</span> <span style="color:#a6e22e">th:each</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;prod,iterStat : ${prods}&#34;</span> <span style="color:#a6e22e">th:class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;${iterStat.odd}? &#39;odd&#39;&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">td</span> <span style="color:#a6e22e">th:text</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;${prod.name}&#34;</span>&gt;Onions&lt;/<span style="color:#f92672">td</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">td</span> <span style="color:#a6e22e">th:text</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;${prod.price}&#34;</span>&gt;2.41&lt;/<span style="color:#f92672">td</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">td</span> <span style="color:#a6e22e">th:text</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;${prod.inStock}? #{true} : #{false}&#34;</span>&gt;yes&lt;/<span style="color:#f92672">td</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">tr</span>&gt;</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="5条件运算" class="pagebody-header">
    5、条件运算
  </h3>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;comments.html&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">th:href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/product/comments(prodId=${prod.id})}&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">th:if</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;${not #lists.isEmpty(prod.comments)}&#34;</span>&gt;view&lt;/<span style="color:#f92672">a</span>&gt;</span></span></code></pre></div></div>
  
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">th:switch</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;${user.role}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">p</span> <span style="color:#a6e22e">th:case</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#39;admin&#39;&#34;</span>&gt;User is an administrator&lt;/<span style="color:#f92672">p</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">p</span> <span style="color:#a6e22e">th:case</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;#{roles.manager}&#34;</span>&gt;User is a manager&lt;/<span style="color:#f92672">p</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">p</span> <span style="color:#a6e22e">th:case</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;*&#34;</span>&gt;User is some other thing&lt;/<span style="color:#f92672">p</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">div</span>&gt;</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h1 id="heading-3" class="pagebody-header">
    
  </h1>
</div>
<div class="component-content pagebody component">
  <h3 id="6属性优先级" class="pagebody-header">
    6、属性优先级
  </h3>
</div><p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-f183b51c4c4804a7712113b98f663bd4" id="lhtf183b51c4c4804a7712113b98f663bd4">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/52.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h2 id="3thymeleaf使用" class="pagebody-header">
    3、thymeleaf使用
  </h2>
</div>
<div class="component-content pagebody component">
  <h4 id="1引入starter" class="pagebody-header">
    1、引入Starter
  </h4>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>        <span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-thymeleaf<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/dependency&gt;</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h4 id="2自动配置好了thymeleaf" class="pagebody-header">
    2、自动配置好了thymeleaf
  </h4>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>@Configuration(proxyBeanMethods = false)
</span></span><span style="display:flex;"><span>@EnableConfigurationProperties(ThymeleafProperties.class)
</span></span><span style="display:flex;"><span>@ConditionalOnClass({ TemplateMode.class, SpringTemplateEngine.class })
</span></span><span style="display:flex;"><span>@AutoConfigureAfter({ WebMvcAutoConfiguration.class, WebFluxAutoConfiguration.class })
</span></span><span style="display:flex;"><span>public class ThymeleafAutoConfiguration { }</span></span></code></pre></div></div>
  
</div><p class="component-content component">自动配好的策略</p>
<div class="component-content component"><ul>
<li>1、所有thymeleaf的配置值都在 ThymeleafProperties</li>
<li>2、配置好了 <strong>SpringTemplateEngine</strong></li>
<li><strong>3、配好了</strong> <strong>ThymeleafViewResolver</strong></li>
<li>4、我们只需要直接开发页面</li>
</ul></div>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String DEFAULT_PREFIX <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;classpath:/templates/&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String DEFAULT_SUFFIX <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;.html&#34;</span><span style="color:#f92672">;</span>  <span style="color:#75715e">//xxx.html
</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h4 id="3页面开发" class="pagebody-header">
    3、页面开发
  </h4>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span> <span style="color:#a6e22e">xmlns:th</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://www.thymeleaf.org&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;Title&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">h1</span> <span style="color:#a6e22e">th:text</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;${msg}&#34;</span>&gt;哈哈&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">h2</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;www.atguigu.com&#34;</span> <span style="color:#a6e22e">th:href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;${link}&#34;</span>&gt;去百度&lt;/<span style="color:#f92672">a</span>&gt;  &lt;<span style="color:#f92672">br</span>/&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;www.atguigu.com&#34;</span> <span style="color:#a6e22e">th:href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{link}&#34;</span>&gt;去百度2&lt;/<span style="color:#f92672">a</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">h2</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h2 id="4构建后台管理系统" class="pagebody-header">
    4、构建后台管理系统
  </h2>
</div>
<div class="component-content pagebody component">
  <h3 id="1项目创建" class="pagebody-header">
    1、项目创建
  </h3>
</div><p class="component-content component">thymeleaf、web-starter、devtools、lombok</p>

<div class="component-content pagebody component">
  <h3 id="2静态资源处理" class="pagebody-header">
    2、静态资源处理
  </h3>
</div><p class="component-content component">自动配置好，我们只需要把所有静态资源放到 static 文件夹下</p>

<div class="component-content pagebody component">
  <h3 id="3路径构建" class="pagebody-header">
    3、路径构建
  </h3>
</div><p class="component-content component">th:action=&quot;@{/login}&quot;</p>

<div class="component-content pagebody component">
  <h3 id="4模板抽取" class="pagebody-header">
    4、模板抽取
  </h3>
</div><p class="component-content component">th:insert/replace/include</p>

<div class="component-content pagebody component">
  <h3 id="5页面跳转" class="pagebody-header">
    5、页面跳转
  </h3>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#a6e22e">@PostMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/login&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>User user<span style="color:#f92672">,</span> HttpSession session<span style="color:#f92672">,</span> Model model<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>StringUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">hasLength</span><span style="color:#f92672">(</span>user<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserName</span><span style="color:#f92672">())</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#e6db74">&#34;123456&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>user<span style="color:#f92672">.</span><span style="color:#a6e22e">getPassword</span><span style="color:#f92672">())){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//把登陆成功的用户保存起来
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            session<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;loginUser&#34;</span><span style="color:#f92672">,</span>user<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//登录成功重定向到main.html;  重定向防止表单重复提交
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;redirect:/main.html&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            model<span style="color:#f92672">.</span><span style="color:#a6e22e">addAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;msg&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;账号密码错误&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//回到登录页面
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;login&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="6数据渲染" class="pagebody-header">
    6、数据渲染
  </h3>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#a6e22e">@GetMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/dynamic_table&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">dynamic_table</span><span style="color:#f92672">(</span>Model model<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//表格内容的遍历
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        List<span style="color:#f92672">&lt;</span>User<span style="color:#f92672">&gt;</span> users <span style="color:#f92672">=</span> Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">asList</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> User<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;zhangsan&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;123456&#34;</span><span style="color:#f92672">),</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">new</span> User<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;lisi&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;123444&#34;</span><span style="color:#f92672">),</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">new</span> User<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;haha&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;aaaaa&#34;</span><span style="color:#f92672">),</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">new</span> User<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hehe &#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;aaddd&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>        model<span style="color:#f92672">.</span><span style="color:#a6e22e">addAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;users&#34;</span><span style="color:#f92672">,</span>users<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;table/dynamic_table&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;</span>table class<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;display table table-bordered&#34;</span> id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;hidden-table-info&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;</span>thead<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;</span>tr<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;</span>th<span style="color:#f92672">&gt;</span><span style="color:#960050;background-color:#1e0010">#</span><span style="color:#f92672">&lt;/</span>th<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;</span>th<span style="color:#f92672">&gt;</span>用户名<span style="color:#f92672">&lt;/</span>th<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;</span>th<span style="color:#f92672">&gt;</span>密码<span style="color:#f92672">&lt;/</span>th<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/</span>tr<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/</span>thead<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;</span>tbody<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;</span>tr class<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;gradeX&#34;</span> th<span style="color:#f92672">:</span>each<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;user,stats:${users}&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;</span>td th<span style="color:#f92672">:</span>text<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;${stats.count}&#34;</span><span style="color:#f92672">&gt;</span>Trident<span style="color:#f92672">&lt;/</span>td<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;</span>td th<span style="color:#f92672">:</span>text<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;${user.userName}&#34;</span><span style="color:#f92672">&gt;</span>Internet<span style="color:#f92672">&lt;/</span>td<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;</span>td <span style="color:#f92672">&gt;[[</span>$<span style="color:#f92672">{</span>user<span style="color:#f92672">.</span><span style="color:#a6e22e">password</span><span style="color:#f92672">}]]&lt;/</span>td<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/</span>tr<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/</span>tbody<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/</span>table<span style="color:#f92672">&gt;</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h1 id="6拦截器" class="pagebody-header">
    6、拦截器
  </h1>
</div>
<div class="component-content pagebody component">
  <h2 id="1handlerinterceptor-接口" class="pagebody-header">
    1、HandlerInterceptor 接口
  </h2>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 登录检查
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 1、配置好拦截器要拦截哪些请求
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 2、把这些配置放在容器中
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Slf4j</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LoginInterceptor</span> <span style="color:#66d9ef">implements</span> HandlerInterceptor <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 目标方法执行之前
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param request
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param response
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param handler
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @throws Exception
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">preHandle</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">,</span> Object handler<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        String requestURI <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestURI</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;preHandle拦截的请求路径是{}&#34;</span><span style="color:#f92672">,</span>requestURI<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//登录检查逻辑
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        HttpSession session <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getSession</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Object loginUser <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span><span style="color:#a6e22e">getAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;loginUser&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>loginUser <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//放行
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//拦截住。未登录。跳转到登录页
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        request<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;msg&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;请先登录&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//        re.sendRedirect(&#34;/&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        request<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestDispatcher</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">forward</span><span style="color:#f92672">(</span>request<span style="color:#f92672">,</span>response<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 目标方法执行完成以后
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param request
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param response
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param handler
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param modelAndView
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @throws Exception
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">postHandle</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">,</span> Object handler<span style="color:#f92672">,</span> ModelAndView modelAndView<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;postHandle执行{}&#34;</span><span style="color:#f92672">,</span>modelAndView<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 页面渲染以后
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param request
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param response
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param handler
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param ex
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @throws Exception
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">afterCompletion</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">,</span> Object handler<span style="color:#f92672">,</span> Exception ex<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;afterCompletion执行异常{}&#34;</span><span style="color:#f92672">,</span>ex<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h2 id="2配置拦截器" class="pagebody-header">
    2、配置拦截器
  </h2>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 1、编写一个拦截器实现HandlerInterceptor接口
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 2、拦截器注册到容器中（实现WebMvcConfigurer的addInterceptors）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 3、指定拦截规则【如果是拦截所有，静态资源也会被拦截】
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AdminWebConfig</span> <span style="color:#66d9ef">implements</span> WebMvcConfigurer <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">addInterceptors</span><span style="color:#f92672">(</span>InterceptorRegistry registry<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        registry<span style="color:#f92672">.</span><span style="color:#a6e22e">addInterceptor</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> LoginInterceptor<span style="color:#f92672">())</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">addPathPatterns</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/**&#34;</span><span style="color:#f92672">)</span>  <span style="color:#75715e">//所有请求都被拦截包括静态资源
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">excludePathPatterns</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;/login&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;/css/**&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;/fonts/**&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;/images/**&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;/js/**&#34;</span><span style="color:#f92672">);</span> <span style="color:#75715e">//放行的请求
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h2 id="3拦截器原理" class="pagebody-header">
    3、拦截器原理
  </h2>
</div><p class="component-content component">1、根据当前请求，找到**HandlerExecutionChain【**可以处理请求的handler以及handler的所有 拦截器】</p>
<p class="component-content component">2、先来<strong>顺序执行</strong> 所有拦截器的 preHandle方法</p>
<div class="component-content component"><ul>
<li>1、如果当前拦截器prehandler返回为true。则执行下一个拦截器的preHandle</li>
<li>2、如果当前拦截器返回为false。直接   倒序执行所有已经执行了的拦截器的  afterCompletion；</li>
</ul></div>
<p class="component-content component"><strong>3、如果任何一个拦截器返回false。直接跳出不执行目标方法</strong></p>
<p class="component-content component"><strong>4、所有拦截器都返回True。执行目标方法</strong></p>
<p class="component-content component"><strong>5、倒序执行所有拦截器的postHandle方法。</strong></p>
<p class="component-content component"><strong>6、前面的步骤有任何异常都会直接倒序触发</strong> afterCompletion</p>
<p class="component-content component">7、页面成功渲染完成以后，也会倒序触发 afterCompletion</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-931b9145cbd89c4cbe9428f1b947a9fc" id="lht931b9145cbd89c4cbe9428f1b947a9fc">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/53.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-e0e160b16cc08b513d72a1475d1639d2" id="lhte0e160b16cc08b513d72a1475d1639d2">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/54.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h1 id="7文件上传" class="pagebody-header">
    7、文件上传
  </h1>
</div>
<div class="component-content pagebody component">
  <h2 id="1页面表单" class="pagebody-header">
    1、页面表单
  </h2>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;post&#34;</span> <span style="color:#a6e22e">action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/upload&#34;</span> <span style="color:#a6e22e">enctype</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;multipart/form-data&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;file&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;file&#34;</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;提交&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">form</span>&gt;</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h2 id="2文件上传代码" class="pagebody-header">
    2、文件上传代码
  </h2>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * MultipartFile 自动封装上传过来的文件
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param email
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param username
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param headerImg
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param photos
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@PostMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/upload&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">upload</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@RequestParam</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;email&#34;</span><span style="color:#f92672">)</span> String email<span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                         <span style="color:#a6e22e">@RequestParam</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;username&#34;</span><span style="color:#f92672">)</span> String username<span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                         <span style="color:#a6e22e">@RequestPart</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;headerImg&#34;</span><span style="color:#f92672">)</span> MultipartFile headerImg<span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                         <span style="color:#a6e22e">@RequestPart</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;photos&#34;</span><span style="color:#f92672">)</span> MultipartFile<span style="color:#f92672">[]</span> photos<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> IOException <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;上传的信息：email={}，username={}，headerImg={}，photos={}&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                email<span style="color:#f92672">,</span>username<span style="color:#f92672">,</span>headerImg<span style="color:#f92672">.</span><span style="color:#a6e22e">getSize</span><span style="color:#f92672">(),</span>photos<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span><span style="color:#f92672">(!</span>headerImg<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">()){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//保存到文件服务器，OSS服务器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            String originalFilename <span style="color:#f92672">=</span> headerImg<span style="color:#f92672">.</span><span style="color:#a6e22e">getOriginalFilename</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            headerImg<span style="color:#f92672">.</span><span style="color:#a6e22e">transferTo</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;H:\\cache\\&#34;</span><span style="color:#f92672">+</span>originalFilename<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>photos<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>MultipartFile photo <span style="color:#f92672">:</span> photos<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span><span style="color:#f92672">(!</span>photo<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">()){</span>
</span></span><span style="display:flex;"><span>                    String originalFilename <span style="color:#f92672">=</span> photo<span style="color:#f92672">.</span><span style="color:#a6e22e">getOriginalFilename</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>                    photo<span style="color:#f92672">.</span><span style="color:#a6e22e">transferTo</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;H:\\cache\\&#34;</span><span style="color:#f92672">+</span>originalFilename<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;main&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h2 id="3自动配置原理" class="pagebody-header">
    3、自动配置原理
  </h2>
</div><p class="component-content component">**文件上传自动配置类-MultipartAutoConfiguration-**<strong>MultipartProperties</strong></p>
<div class="component-content component"><ul>
<li>
<p class="component-content component">自动配置好了 <strong>StandardServletMultipartResolver  【文件上传解析器】</strong></p>
</li>
<li>
<p class="component-content component"><strong>原理步骤</strong></p>
</li>
<li>
<div class="component-content component"><ul>
<li><strong>1、请求进来使用文件上传解析器判断（<strong>isMultipart</strong>）并封装（<strong>resolveMultipart，<strong>返回</strong>MultipartHttpServletRequest</strong>）文件上传请求</strong></li>
<li><strong>2、参数解析器来解析请求中的文件内容封装成MultipartFile</strong></li>
<li>**3、将request中文件信息封装为一个Map；**MultiValueMap&lt;String, MultipartFile&gt;</li>
</ul></div>
</li>
</ul></div>
<p class="component-content component"><strong>FileCopyUtils</strong>。实现文件流的拷贝</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#a6e22e">@PostMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/upload&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">upload</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@RequestParam</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;email&#34;</span><span style="color:#f92672">)</span> String email<span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                         <span style="color:#a6e22e">@RequestParam</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;username&#34;</span><span style="color:#f92672">)</span> String username<span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                         <span style="color:#a6e22e">@RequestPart</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;headerImg&#34;</span><span style="color:#f92672">)</span> MultipartFile headerImg<span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                         <span style="color:#a6e22e">@RequestPart</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;photos&#34;</span><span style="color:#f92672">)</span> MultipartFile<span style="color:#f92672">[]</span> photos<span style="color:#f92672">)</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-3861db1255453a184d51f88825896161" id="lht3861db1255453a184d51f88825896161">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/55.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h1 id="8异常处理" class="pagebody-header">
    8、异常处理
  </h1>
</div>
<div class="component-content pagebody component">
  <h2 id="1错误处理" class="pagebody-header">
    1、错误处理
  </h2>
</div>
<div class="component-content pagebody component">
  <h4 id="1默认规则" class="pagebody-header">
    1、默认规则
  </h4>
</div><div class="component-content component"><ul>
<li>默认情况下，Spring Boot提供<code>/error</code>处理所有错误的映射</li>
<li>对于机器客户端，它将生成JSON响应，其中包含错误，HTTP状态和异常消息的详细信息。对于浏览器客户端，响应一个“ whitelabel”错误视图，以HTML格式呈现相同的数据</li>
</ul></div>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-3d139b8d8ad224935864b5029c805305" id="lht3d139b8d8ad224935864b5029c805305">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/56.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-141575508e5f39fb4b05ba49d74813e3" id="lht141575508e5f39fb4b05ba49d74813e3">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/57.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component"><strong>要对其进行自定义，添加</strong>**<code>View</code>**<strong>解析为`error```</strong></p>
<p class="component-content component">要完全替换默认行为，可以实现 <code>ErrorController </code>并注册该类型的Bean定义，或添加<code>ErrorAttributes类型的组件</code>以使用现有机制但替换其内容。</p>
<p class="component-content component">error/下的4xx，5xx页面会被自动解析；</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-f196a32cc0c1c1db356eb553fda974b8" id="lhtf196a32cc0c1c1db356eb553fda974b8">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/58.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h4 id="2定制错误处理逻辑" class="pagebody-header">
    2、定制错误处理逻辑
  </h4>
</div><div class="component-content component"><ul>
<li>
<p class="component-content component">自定义错误页</p>
</li>
<li>
<div class="component-content component"><ul>
<li>error/404.html  error/5xx.html；有精确的错误状态码页面就匹配精确，没有就找 4xx.html；如果都没有就触发白页</li>
</ul></div>
</li>
<li>
<p class="component-content component">@ControllerAdvice+@ExceptionHandler处理全局异常；底层是 <strong>ExceptionHandlerExceptionResolver 支持的</strong></p>
</li>
<li>
<p class="component-content component">@ResponseStatus+自定义异常 ；底层是 <strong>ResponseStatusExceptionResolver ，把responsestatus注解的信息底层调用</strong> <strong>response.sendError(statusCode, resolvedReason)；tomcat发送的/error</strong></p>
</li>
<li>
<p class="component-content component">Spring底层的异常，如 参数类型转换异常；<strong>DefaultHandlerExceptionResolver 处理框架底层的异常。</strong></p>
</li>
<li>
<div class="component-content component"><ul>
<li>response.sendError(HttpServletResponse.<strong>SC_BAD_REQUEST</strong>, ex.getMessage());</li>
</ul></div>
</li>
</ul></div>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-1d780155f3426fe21450ba5e66bb6c8a" id="lht1d780155f3426fe21450ba5e66bb6c8a">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/59.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<div class="component-content component"><ul>
<li>自定义实现 HandlerExceptionResolver 处理异常；可以作为默认的全局异常处理规则</li>
</ul></div>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-b6cdd2fce0b741f6f1a2764536ffb6a4" id="lhtb6cdd2fce0b741f6f1a2764536ffb6a4">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/60.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<div class="component-content component"><ul>
<li>
<p class="component-content component"><strong>ErrorViewResolver</strong> 实现自定义处理异常；</p>
</li>
<li>
<div class="component-content component"><ul>
<li>response.sendError 。error请求就会转给controller</li>
<li>你的异常没有任何人能处理。tomcat底层 response.sendError。error请求就会转给controller</li>
<li><strong>basicErrorController 要去的页面地址是</strong> <strong>ErrorViewResolver</strong> ；</li>
</ul></div>
</li>
</ul></div>

<div class="component-content pagebody component">
  <h4 id="3异常处理自动配置原理" class="pagebody-header">
    3、异常处理自动配置原理
  </h4>
</div><div class="component-content component"><ul>
<li>
<p class="component-content component"><strong>ErrorMvcAutoConfiguration  自动配置异常处理规则</strong></p>
</li>
<li>
<div class="component-content component"><ul>
<li><strong>容器中的组件：类型：DefaultErrorAttributes -&gt;</strong> <strong>id：errorAttributes</strong></li>
</ul></div>
</li>
<li>
<div class="component-content component"><ul>
<li>
<div class="component-content component"><ul>
<li><strong>public class</strong> <strong>DefaultErrorAttributes</strong> <strong>implements</strong> <strong>ErrorAttributes</strong>, <strong>HandlerExceptionResolver</strong></li>
<li><strong>DefaultErrorAttributes</strong>：定义错误页面中可以包含哪些数据。</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-95d0825830af423437d830f243c08dfe" id="lht95d0825830af423437d830f243c08dfe">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/61.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-0c2d4fcbdba13fab3a4b1f8bd349a9f6" id="lht0c2d4fcbdba13fab3a4b1f8bd349a9f6">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/62.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<div class="component-content component"><ul>
<li>
<div class="component-content component"><ul>
<li>**容器中的组件：类型：**<strong>BasicErrorController &ndash;&gt; id：basicErrorController（json+白页 适配响应）</strong></li>
</ul></div>
</li>
<li>
<div class="component-content component"><ul>
<li>
<div class="component-content component"><ul>
<li><strong>处理默认</strong> <strong>/error 路径的请求；页面响应</strong> <strong>new</strong> ModelAndView(<strong>&ldquo;error&rdquo;</strong>, model)；</li>
<li><strong>容器中有组件 View</strong>-&gt;<strong>id是error</strong>；（响应默认错误页）</li>
<li>容器中放组件 <strong>BeanNameViewResolver（视图解析器）；按照返回的视图名作为组件的id去容器中找View对象。</strong></li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<div class="component-content component"><ul>
<li>**容器中的组件：**类型：**DefaultErrorViewResolver -&gt; id：**conventionErrorViewResolver</li>
</ul></div>
</li>
<li>
<div class="component-content component"><ul>
<li>
<div class="component-content component"><ul>
<li>如果发生错误，会以HTTP的状态码 作为视图页地址（viewName），找到真正的页面</li>
<li>error/404、5xx.html</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
<p class="component-content component">如果想要返回页面；就会找error视图【<strong>StaticView</strong>】。(默认是一个白页)</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-beadf9780649c827fcf374c626a1f3ab" id="lhtbeadf9780649c827fcf374c626a1f3ab">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/63.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<div class="component-content component"><ul>
<li>

<div class="component-content pagebody component">
  <h4 id="4异常处理步骤流程" class="pagebody-header">
    4、异常处理步骤流程
  </h4>
</div></li>
<li>
<p class="component-content component">1、执行目标方法，目标方法运行期间有任何异常都会被catch、而且标志当前请求结束；并且用 <strong>dispatchException</strong></p>
</li>
<li>
<p class="component-content component">2、进入视图解析流程（页面渲染？）</p>
</li>
<li>
<p class="component-content component">processDispatchResult(processedRequest, response, mappedHandler, <strong>mv</strong>, <strong>dispatchException</strong>);</p>
</li>
<li>
<p class="component-content component">3、<strong>mv</strong> = <strong>processHandlerException</strong>；处理handler发生的异常，处理完成返回ModelAndView；</p>
</li>
<li>
<div class="component-content component"><ul>
<li>1、遍历所有的 <strong>handlerExceptionResolvers，看谁能处理当前异常【<strong><strong>HandlerExceptionResolver处理器异常解析器</strong></strong>】</strong></li>
</ul></div>
</li>
</ul></div>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-b4b5fe6183d2335302e0543d87288c0f" id="lhtb4b5fe6183d2335302e0543d87288c0f">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/64.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<div class="component-content component"><ul>
<li><strong>2、系统默认的  异常解析器；</strong></li>
</ul></div>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-b9d7120127cafc30c16c9c604acac79d" id="lhtb9d7120127cafc30c16c9c604acac79d">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/65.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<div class="component-content component"><ul>
<li>
<div class="component-content component"><ul>
<li><strong>1、DefaultErrorAttributes先来处理异常。把异常信息保存到rrequest域，并且返回null；</strong></li>
<li><strong>2、默认没有任何人能处理异常，所以异常会被抛出</strong></li>
</ul></div>
</li>
<li>
<div class="component-content component"><ul>
<li>
<div class="component-content component"><ul>
<li><strong>1、如果没有任何人能处理最终底层就会发送 /error 请求。会被底层的BasicErrorController处理</strong></li>
<li><strong>2、解析错误视图；遍历所有的</strong>  <strong>ErrorViewResolver  看谁能解析。</strong></li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-19f6c6a5aa1b8db2a1296ed44ccd4012" id="lht19f6c6a5aa1b8db2a1296ed44ccd4012">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/66.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">​			<strong>3、默认的</strong> <strong>DefaultErrorViewResolver ,作用是把响应状态码作为错误页的地址，error/500.html</strong></p>
<p class="component-content component">​			<strong>4、模板引擎最终响应这个页面</strong> <strong>error/500.html</strong></p>

<div class="component-content pagebody component">
  <h1 id="9web原生组件注入servletfilterlistener" class="pagebody-header">
    9、Web原生组件注入（Servlet、Filter、Listener）
  </h1>
</div>
<div class="component-content pagebody component">
  <h2 id="1使用servlet-api" class="pagebody-header">
    1、使用Servlet API
  </h2>
</div><p class="component-content component">@ServletComponentScan(basePackages = <strong>&ldquo;com.atguigu.admin&rdquo;</strong>) :指定原生Servlet组件都放在那里</p>
<p class="component-content component">@WebServlet(urlPatterns = <strong>&quot;/my&quot;</strong>)：效果：直接响应，<strong>没有经过Spring的拦截器？</strong></p>
<p class="component-content component">@WebFilter(urlPatterns={<strong>&quot;/css/*&quot;</strong>,<strong>&quot;/images/*&quot;</strong>})</p>
<p class="component-content component">@WebListener</p>
<p class="component-content component">推荐可以这种方式；</p>
<p class="component-content component">扩展：DispatchServlet 如何注册进来</p>
<div class="component-content component"><ul>
<li>容器中自动配置了  DispatcherServlet  属性绑定到 WebMvcProperties；对应的配置文件配置项是 <strong>spring.mvc。</strong></li>
<li><strong>通过</strong> <strong>ServletRegistrationBean</strong><!-- raw HTML omitted --> 把 DispatcherServlet  配置进来。</li>
<li>默认映射的是 / 路径。</li>
</ul></div>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-763383f596683880d97e28c77cb2e096" id="lht763383f596683880d97e28c77cb2e096">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/67.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">Tomcat-Servlet；</p>
<p class="component-content component">多个Servlet都能处理到同一层路径，精确优选原则</p>
<p class="component-content component">A： /my/</p>
<p class="component-content component">B： /my/1</p>

<div class="component-content pagebody component">
  <h2 id="2使用registrationbean" class="pagebody-header">
    2、使用RegistrationBean
  </h2>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>ServletRegistrationBean<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">,</span> <span style="color:#960050;background-color:#1e0010">`</span>FilterRegistrationBean<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">,</span> and <span style="color:#960050;background-color:#1e0010">`</span>ServletListenerRegistrationBean
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyRegistConfig</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> ServletRegistrationBean <span style="color:#a6e22e">myServlet</span><span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>        MyServlet myServlet <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MyServlet<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> ServletRegistrationBean<span style="color:#f92672">(</span>myServlet<span style="color:#f92672">,</span><span style="color:#e6db74">&#34;/my&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;/my02&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> FilterRegistrationBean <span style="color:#a6e22e">myFilter</span><span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        MyFilter myFilter <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MyFilter<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//        return new FilterRegistrationBean(myFilter,myServlet());
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        FilterRegistrationBean filterRegistrationBean <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FilterRegistrationBean<span style="color:#f92672">(</span>myFilter<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        filterRegistrationBean<span style="color:#f92672">.</span><span style="color:#a6e22e">setUrlPatterns</span><span style="color:#f92672">(</span>Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">asList</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/my&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;/css/*&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> filterRegistrationBean<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> ServletListenerRegistrationBean <span style="color:#a6e22e">myListener</span><span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>        MySwervletContextListener mySwervletContextListener <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MySwervletContextListener<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> ServletListenerRegistrationBean<span style="color:#f92672">(</span>mySwervletContextListener<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h1 id="10嵌入式servlet容器" class="pagebody-header">
    10、嵌入式Servlet容器
  </h1>
</div>
<div class="component-content pagebody component">
  <h2 id="1切换嵌入式servlet容器" class="pagebody-header">
    1、切换嵌入式Servlet容器
  </h2>
</div><div class="component-content component"><ul>
<li>
<p class="component-content component">默认支持的webServer</p>
</li>
<li>
<div class="component-content component"><ul>
<li><code>Tomcat</code>, <code>Jetty</code>, or <code>Undertow</code></li>
<li><code>ServletWebServerApplicationContext 容器启动寻找ServletWebServerFactory 并引导创建服务器</code></li>
</ul></div>
</li>
<li>
<p class="component-content component">切换服务器</p>
</li>
</ul></div>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-a7d932c9f01cde10f823d2e3d86f1065" id="lhta7d932c9f01cde10f823d2e3d86f1065">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/68.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-web<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;exclusions&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;exclusion&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-tomcat<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/exclusion&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/exclusions&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span></span></span></code></pre></div></div>
  
</div><div class="component-content component"><ul>
<li>
<p class="component-content component">原理</p>
</li>
<li>
<div class="component-content component"><ul>
<li>SpringBoot应用启动发现当前是Web应用。web场景包-导入tomcat</li>
<li>web应用会创建一个web版的ioc容器 <code>ServletWebServerApplicationContext</code></li>
<li><code>ServletWebServerApplicationContext</code> 启动的时候寻找 <strong><code>ServletWebServerFactory</code></strong><code>（Servlet 的web服务器工厂---&gt; Servlet 的web服务器）</code></li>
<li>SpringBoot底层默认有很多的WebServer工厂；<code>TomcatServletWebServerFactory</code>, <code>JettyServletWebServerFactory</code>, or <code>UndertowServletWebServerFactory</code></li>
<li><code>底层直接会有一个自动配置类。ServletWebServerFactoryAutoConfiguration</code></li>
<li><code>ServletWebServerFactoryAutoConfiguration导入了ServletWebServerFactoryConfiguration（配置类）</code></li>
<li><code>ServletWebServerFactoryConfiguration 配置类 根据动态判断系统中到底导入了那个Web服务器的包。（默认是web-starter导入tomcat包），容器中就有 TomcatServletWebServerFactory</code></li>
<li><code>TomcatServletWebServerFactory 创建出Tomcat服务器并启动；TomcatWebServer 的构造器拥有初始化方法initialize---this.tomcat.start();</code></li>
<li><code>内嵌服务器，就是手动把启动服务器的代码调用（tomcat核心jar包存在）</code></li>
</ul></div>
</li>
<li>
<p class="component-content component">``</p>
</li>
</ul></div>

<div class="component-content pagebody component">
  <h2 id="2定制servlet容器" class="pagebody-header">
    2、定制Servlet容器
  </h2>
</div><div class="component-content component"><ul>
<li>
<p class="component-content component">实现 <strong>WebServerFactoryCu</strong>stomizer<!-- raw HTML omitted --></p>
</li>
<li>
<div class="component-content component"><ul>
<li>把配置文件的值和**<code>ServletWebServerFactory 进行绑定</code>**</li>
</ul></div>
</li>
<li>
<p class="component-content component">修改配置文件 <strong>server.xxx</strong></p>
</li>
<li>
<p class="component-content component">直接自定义 <strong>ConfigurableServletWebServerFactory</strong></p>
</li>
</ul></div>
<p class="component-content component"><strong>xxxxx<strong><strong>Customizer</strong></strong>：定制化器，可以改变xxxx的默认规则</strong></p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.boot.web.server.WebServerFactoryCustomizer<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.boot.web.servlet.server.ConfigurableServletWebServerFactory<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.stereotype.Component<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CustomizationBean</span> <span style="color:#66d9ef">implements</span> WebServerFactoryCustomizer<span style="color:#f92672">&lt;</span>ConfigurableServletWebServerFactory<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">customize</span><span style="color:#f92672">(</span>ConfigurableServletWebServerFactory server<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        server<span style="color:#f92672">.</span><span style="color:#a6e22e">setPort</span><span style="color:#f92672">(</span><span style="color:#ae81ff">9000</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h1 id="11定制化原理" class="pagebody-header">
    11、定制化原理
  </h1>
</div>
<div class="component-content pagebody component">
  <h2 id="1定制化的常见方式" class="pagebody-header">
    1、定制化的常见方式
  </h2>
</div><div class="component-content component"><ul>
<li>修改配置文件；</li>
<li><strong>xxxxxCustomizer；</strong></li>
<li><strong>编写自定义的配置类  xxxConfiguration；+</strong> <strong>@Bean替换、增加容器中默认组件；视图解析器</strong></li>
<li><strong>Web应用 编写一个配置类实现 WebMvcConfigurer 即可定制化web功能；+ @Bean给容器中再扩展一些组件</strong></li>
</ul></div>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AdminWebConfig</span> <span style="color:#66d9ef">implements</span> WebMvcConfigurer</span></span></code></pre></div></div>
  
</div><div class="component-content component"><ul>
<li>
<p class="component-content component">@EnableWebMvc + WebMvcConfigurer —— @Bean 可以全面接管SpringMVC，所有规则全部自己重新配置； 实现定制和扩展功能</p>
</li>
<li>
<div class="component-content component"><ul>
<li>原理</li>
<li>1、WebMvcAutoConfiguration  默认的SpringMVC的自动配置功能类。静态资源、欢迎页&hellip;..</li>
<li>2、一旦使用 @EnableWebMvc 、。会 @Import(DelegatingWebMvcConfiguration.<strong>class</strong>)</li>
<li>3、<strong>DelegatingWebMvcConfiguration</strong> 的 作用，只保证SpringMVC最基本的使用</li>
</ul></div>
</li>
<li>
<div class="component-content component"><ul>
<li>
<div class="component-content component"><ul>
<li>把所有系统中的 WebMvcConfigurer 拿过来。所有功能的定制都是这些 WebMvcConfigurer  合起来一起生效</li>
<li>自动配置了一些非常底层的组件。<strong>RequestMappingHandlerMapping</strong>、这些组件依赖的组件都是从容器中获取</li>
<li><strong>public class</strong> DelegatingWebMvcConfiguration <strong>extends</strong> <strong>WebMvcConfigurationSupport</strong></li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<div class="component-content component"><ul>
<li>4、<strong>WebMvcAutoConfiguration</strong> 里面的配置要能生效 必须  @ConditionalOnMissingBean(<strong>WebMvcConfigurationSupport</strong>.<strong>class</strong>)</li>
<li>5、@EnableWebMvc  导致了 <strong>WebMvcAutoConfiguration  没有生效。</strong></li>
</ul></div>
</li>
<li>
<p class="component-content component">&hellip; &hellip;</p>
</li>
</ul></div>

<div class="component-content pagebody component">
  <h2 id="2原理分析套路" class="pagebody-header">
    2、原理分析套路
  </h2>
</div><p class="component-content component"><strong>场景starter</strong> <strong>- xxxxAutoConfiguration - 导入xxx组件 - 绑定xxxProperties &ndash;</strong> <strong>绑定配置文件项</strong></p>

          </div><div class="component">
            <div class="component-content">
              <div class="article-copyright">
                <p class="content">
                  Copyright: <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed" target="_blank">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0)</a>
                </p>
                <p class="content">Author:   </p>
                <p class="content">Posted on:  November 26, 2021</p>
              </div>
            </div>
          </div></article>
      </section>
  </main>

  <script>
    var script = document.createElement("script");script.src = "https://yuanshuai1122.github.io/js/initPost.js";
    document.head.appendChild(script);
  </script>

    
    <div class="footer-main ">
  <div class="content-body footer-wraper">
    <div class="footer-box">
      <div class="foot-nav">
        <div class="foot-nav-items">
          <div class="item">
            <div class="logo"></div>
            <div class="email">Email: <a href="mailto:floyd.li@outlook.com">floyd.li@outlook.com</a></div>
          </div>

          <div class="item community">
            <div class="item-title">Social Media</div>
            
              <a href="https://github.com/floyd-li" target="_blank">Github</a>
            
          </div>

          <div class="item resources">
            <div class="item-title">Related</div>
            
              <a href="https://yufengbiji.com/" target="_blank">驭风笔记</a>
            
          </div>
        </div>
      </div>
      <div class="bottom">
        <div class="item copyright">
          &copy; 2023
          Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> & <a href="https://github.com/floyd-li/hugo-theme-itheme" target="_blank">iTheme</a>
        </div>
      </div>
    </div>
  </div>
</div>

  </body>
    
    

    
    
</html>
