<!DOCTYPE html>
<html class="js no-touch  progressive-image  no-reduced-motion progressive" lang="en">
  <head>
    <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="icon" href="/img/favicon.ico">

    <meta name="keyword" content=""><meta property="og:title" content="SpringMVC之文件上传" />
<meta property="og:description" content="&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;7de1a433602ac 分界符 Content-Disposition: form-data; name=&ldquo;userName&rdquo; 协议头 aaa 协议的正文 &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;7de1a433602ac Content-Disposition: form-data; name=&ldquo;file&rdquo;; filename=&ldquo;C:\Users\zhy\Desktop\fileupload_demofile\b.txt&rdquo; Content-Type: text/plain 协议的类型(MIME类型) bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;7de1a433602ac&ndash; 1.3、借助第三方组件实现文件上传 使用 Commons-fileupload 组件实现文件上传，需要导" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yuanshuai1122.github.io/archives/springmvc%E4%B9%8B%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-26T21:32:30+00:00" />
<meta property="article:modified_time" content="2021-11-26T21:32:30+00:00" />
<title>SpringMVC之文件上传</title>

    <link rel="canonical" href="/archives/springmvc%E4%B9%8B%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/">

    <link rel="stylesheet" href="/css/global.css">

    <link rel="stylesheet" href="/css/custom.css">

    <link rel="stylesheet" href="/css/search.css" />

    
    

    
    

</head>
  </head>
  <body class=" page-article   ">
    <header>
      <nav class="nav">
  <div class="nav-wrapper">
    <div class="nav-content-wrapper">
      <div class="nav-content">
        <a href="/ " class="nav-title">iTheme</a>
        <div class="nav-menu">
          <div class="nav-item-wrapper">
            <a href="/posts " class="nav-item-content">Articles</a>
          </div><div class="nav-item-wrapper">
            <a href="/about" class="nav-item-content">About</a>
          </div><div class="nav-item-wrapper">
            <a href="/index.xml" class="nav-item-content" target="_blank">RSS</a>
          </div></div>
      </div>
    </div>
  </div>
</nav>

<script>
  function toggleSearchModal(){
    const template = `
    <div class="modal-body">
      <div id="autocomplete" onclick="event.stopPropagation();"></div>
    </div>
    `
    const modal = document.querySelector("#modal-wrapper")
    if(!modal){
      const div = document.createElement("div")
      document.body.setAttribute("style","overflow: hidden;")
      div.setAttribute("id", "modal-wrapper")
      div.setAttribute("onclick", "toggleSearchModal()")
      div.innerHTML = template
      const script = document.createElement("script");script.setAttribute("src", "https://yuanshuai1122.github.io/js/algolia.js")
      div.appendChild(script)
      document.body.append(div)
    } else {
      document.body.removeAttribute("style")
      document.body.removeChild(modal)
    }
  }
</script>
    </header>
    
  
  
  <main id="main" class="main">
      <section>
        <article class="article">
          
          <div class=" article-header ">
            <div class="category component">
              <div class="component-content">
                <div class="category-eyebrow">
                  <span class="category-eyebrow__category category_original">
                    
                      
                        Java
                      
                    
                  </span>
                  <span class="category-eyebrow__date">November 26, 2021</span>
                </div>
              </div>
            </div>
            <div class="pagetitle component">
              <div class="component-content">
                <h1 class="hero-headline">SpringMVC之文件上传</h1>
              </div>
            </div>
            <div class="component  article-subhead ">
              <div class="component-content"></div>
            </div>

            <div class="tagssheet component">
              <div class="component-content">
                
                  
                  <a href="/tags/java" class="tag">
                    Java
                  </a>
                
                  
                  <a href="/tags/springmvc" class="tag">
                    SpringMVC
                  </a>
                
              </div>
            </div>
          </div>
          
          <div class="pagebody">
            
            
            
            
            
            
            
            
            <p class="component-content component">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;7de1a433602ac                                                      分界符</p>
<blockquote>
<p class="component-content component">Content-Disposition: form-data; name=&ldquo;userName&rdquo;                          协议头</p>
<p class="component-content component">aaa                                                                                                                协议的正文
&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;7de1a433602ac</p>
<p class="component-content component">Content-Disposition: form-data; name=&ldquo;file&rdquo;;</p>
<p class="component-content component">filename=&ldquo;C:\Users\zhy\Desktop\fileupload_demofile\b.txt&rdquo;</p>
<p class="component-content component">Content-Type: text/plain                                                                        协议的类型(MIME类型)</p>
<p class="component-content component">bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb</p>
<p class="component-content component">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;7de1a433602ac&ndash;</p>
</blockquote>

<div class="component-content pagebody component">
  <h3 id="13借助第三方组件实现文件上传" class="pagebody-header">
    1.3、借助第三方组件实现文件上传
  </h3>
</div><p class="component-content component">使用 Commons-fileupload 组件实现文件上传，需要导入该组件相应的支撑 jar 包:Commons-fileupload 和 commons-io。</p>
<p class="component-content component">commons-io 不属于文件上传组件的开发jar文件，但Commons-fileupload 组件从1.1 版本开始，它</p>
<p class="component-content component">工作时需要 commons-io 包的支持。</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-5bdb09e731ce5cd0d406f409506185d0" id="lht5bdb09e731ce5cd0d406f409506185d0">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springmvc/36.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h2 id="2springmvc-传统方式的文件上传" class="pagebody-header">
    2、springmvc 传统方式的文件上传
  </h2>
</div>
<div class="component-content pagebody component">
  <h3 id="21说明" class="pagebody-header">
    2.1、说明
  </h3>
</div><p class="component-content component">传统方式的文件上传，指的是我们上传的文件和访问的应用存在于同一台服务器上。</p>
<p class="component-content component">并且上传完成之后，浏览器可能跳转。</p>

<div class="component-content pagebody component">
  <h3 id="22实现步骤" class="pagebody-header">
    2.2、实现步骤
  </h3>
</div>
<div class="component-content pagebody component">
  <h4 id="221第一步拷贝文件上传的-jar-包到工程的-lib-目录" class="pagebody-header">
    2.2.1、第一步:拷贝文件上传的 jar 包到工程的 lib 目录
  </h4>
</div><p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-f9d9753f30ac0a72a766ea13d9c2e5ed" id="lhtf9d9753f30ac0a72a766ea13d9c2e5ed">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springmvc/37.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h4 id="222第二步编写-jsp-页面" class="pagebody-header">
    2.2.2、第二步:编写 jsp 页面
  </h4>
</div><div class="component-content pagebody component code">
  
  
  
  <pre><code class="">&lt;form action=&#34;/fileUpload&#34; method=&#34;post&#34; enctype=&#34;multipart/form-data&#34;&gt; 
  名称:&lt;input type=&#34;text&#34; name=&#34;picname&#34;/&gt;&lt;br/&gt;
	图片:&lt;input type=&#34;file&#34; name=&#34;uploadFile&#34;/&gt;&lt;br/&gt;
	&lt;input type=&#34;submit&#34; value=&#34;上传&#34;/&gt; 
&lt;/form&gt;</code></pre>
  
</div>
<div class="component-content pagebody component">
  <h4 id="223第三步编写控制器" class="pagebody-header">
    2.2.3、第三步:编写控制器
  </h4>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 文件上传的的控制器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Controller</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;fileUploadController&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FileUploadController</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 文件上传
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/fileUpload&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">testResponseJson</span><span style="color:#f92672">(</span>String picname<span style="color:#f92672">,</span> MultipartFile uploadFile<span style="color:#f92672">,</span> HttpServletRequest request<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//定义文件名
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        String fileName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//1.获取原始文件名
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        String uploadFileName <span style="color:#f92672">=</span> uploadFile<span style="color:#f92672">.</span><span style="color:#a6e22e">getOriginalFilename</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//2.截取文件扩展名
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        String extendName <span style="color:#f92672">=</span> uploadFileName<span style="color:#f92672">.</span><span style="color:#a6e22e">substring</span><span style="color:#f92672">(</span>uploadFileName<span style="color:#f92672">.</span><span style="color:#a6e22e">lastIndexOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;.&#34;</span><span style="color:#f92672">)+</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span> uploadFileName<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//3.把文件加上随机数，防止文件重复
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        String uuid <span style="color:#f92672">=</span> UUID<span style="color:#f92672">.</span><span style="color:#a6e22e">randomUUID</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">().</span><span style="color:#a6e22e">replace</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;-&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">toUpperCase</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//4.判断是否输入了文件名
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span><span style="color:#f92672">(!</span>StringUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">(</span>picname<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            fileName <span style="color:#f92672">=</span> uuid<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;_&#34;</span><span style="color:#f92672">+</span>picname<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;.&#34;</span><span style="color:#f92672">+</span>extendName<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            fileName <span style="color:#f92672">=</span> uuid<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;_&#34;</span><span style="color:#f92672">+</span>uploadFileName<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>fileName<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//2.获取文件路径
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        ServletContext context <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getServletContext</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        String basePath <span style="color:#f92672">=</span> context<span style="color:#f92672">.</span><span style="color:#a6e22e">getRealPath</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/uploads&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//3.解决同一文件夹中文件过多问题
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        String datePath <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SimpleDateFormat<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;yyyy-MM-dd&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">format</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Date<span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//4.判断路径是否存在
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        File file <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>basePath<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;/&#34;</span><span style="color:#f92672">+</span>datePath<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span><span style="color:#f92672">(!</span>file<span style="color:#f92672">.</span><span style="color:#a6e22e">exists</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            file<span style="color:#f92672">.</span><span style="color:#a6e22e">mkdirs</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//5.使用 MulitpartFile 接口中方法，把上传的文件写到指定位置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        uploadFile<span style="color:#f92672">.</span><span style="color:#a6e22e">transferTo</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>file<span style="color:#f92672">,</span>fileName<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;success&#34;</span><span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h4 id="224第四步配置文件解析器" class="pagebody-header">
    2.2.4、第四步:配置文件解析器
  </h4>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- 配置文件上传解析器 --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;multipartResolver&#34;</span> <span style="color:#960050;background-color:#1e0010">&lt;!--</span> <span style="color:#960050;background-color:#1e0010">id</span> <span style="color:#960050;background-color:#1e0010">的值是固定的--</span><span style="color:#f92672">&gt;</span> 
</span></span><span style="display:flex;"><span>        class=&#34;org.springframework.web.multipart.commons.CommonsMultipartResolver&#34;&gt; 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">&lt;!-- 设置上传文件的最大尺寸为 5MB --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;maxUploadSize&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;value&gt;</span>5242880<span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/bean&gt;</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h2 id="3springmvc-跨服务器方式的文件上传" class="pagebody-header">
    3、springmvc 跨服务器方式的文件上传
  </h2>
</div>
<div class="component-content pagebody component">
  <h3 id="31分服务器的目的" class="pagebody-header">
    3.1、分服务器的目的
  </h3>
</div><p class="component-content component">在实际开发中，我们会有很多处理不同功能的服务器。</p>
<p class="component-content component">例如:</p>
<div class="component-content component"><ul>
<li>应用服务器:负责部署我们的应用</li>
<li>数据库服务器:运行我们的数据库</li>
<li>缓存和消息服务器:负责处理大并发访问的缓存和消息</li>
<li>文件服务器:负责存储用户上传文件的服务器。</li>
<li>(注意:此处说的<strong>不是服务器集群</strong>)</li>
</ul></div>
<p class="component-content component">分服务器处理的目的是让服务器各司其职，从而提高我们项目的运行效率。</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-247c6cbbaf4725654878e67eff87f83c" id="lht247c6cbbaf4725654878e67eff87f83c">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springmvc/38.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h3 id="32准备两个-tomcat-服务器并创建一个用于存放图片的-web-工程" class="pagebody-header">
    3.2、准备两个 tomcat 服务器，并创建一个用于存放图片的 web 工程
  </h3>
</div><p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-3d88189d6765e929f42fc16595f883c5" id="lht3d88189d6765e929f42fc16595f883c5">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springmvc/39.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">加入内容:</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-7947f35d8494595e88f383d798ecc68b" id="lht7947f35d8494595e88f383d798ecc68b">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springmvc/40.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">加入此行的含义是:接收文件的目标服务器可以支持写入操作。</p>

<div class="component-content pagebody component">
  <h3 id="33拷贝jar包" class="pagebody-header">
    3.3、拷贝jar包
  </h3>
</div><p class="component-content component">在我们负责处理文件上传的项目中拷贝文件上传的必备 jar 包</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-268dafe63a28fdc6d2ed9e225853cf9e" id="lht268dafe63a28fdc6d2ed9e225853cf9e">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springmvc/41.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h3 id="34编写控制器实现上传图片" class="pagebody-header">
    3.4、编写控制器实现上传图片
  </h3>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 响应 json 数据的控制器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Controller</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;fileUploadController2&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FileUploadController2</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String FILESERVERURL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://localhost:9090/day06_spring_image/uploads/&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 文件上传，保存文件到不同服务器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/fileUpload2&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">testResponseJson</span><span style="color:#f92672">(</span>String picname<span style="color:#f92672">,</span> MultipartFile uploadFile<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//定义文件名
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        String fileName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//1.获取原始文件名
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        String uploadFileName <span style="color:#f92672">=</span> uploadFile<span style="color:#f92672">.</span><span style="color:#a6e22e">getOriginalFilename</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//2.截取文件扩展名
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        String extendName <span style="color:#f92672">=</span> uploadFileName<span style="color:#f92672">.</span><span style="color:#a6e22e">substring</span><span style="color:#f92672">(</span>uploadFileName<span style="color:#f92672">.</span><span style="color:#a6e22e">lastIndexOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;.&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">,</span> uploadFileName<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//3.把文件加上随机数，防止文件重复
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        String uuid <span style="color:#f92672">=</span> UUID<span style="color:#f92672">.</span><span style="color:#a6e22e">randomUUID</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">().</span><span style="color:#a6e22e">replace</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;-&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">toUpperCase</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//4.判断是否输入了文件名
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>StringUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">(</span>picname<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            fileName <span style="color:#f92672">=</span> uuid <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_&#34;</span> <span style="color:#f92672">+</span> picname <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.&#34;</span> <span style="color:#f92672">+</span> extendName<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            fileName <span style="color:#f92672">=</span> uuid <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_&#34;</span> <span style="color:#f92672">+</span> uploadFileName<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>fileName<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//5.创建 sun 公司提供的 jersey 包中的 Client 对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        Client client <span style="color:#f92672">=</span> Client<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//6.指定上传文件的地址，该地址是 web 路径
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        WebResource resource <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span><span style="color:#a6e22e">resource</span><span style="color:#f92672">(</span>FILESERVERURL <span style="color:#f92672">+</span> fileName<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//7.实现上传
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        String result <span style="color:#f92672">=</span> resource<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>String<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> uploadFile<span style="color:#f92672">.</span><span style="color:#a6e22e">getBytes</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>result<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;success&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="35编写-jsp-页面" class="pagebody-header">
    3.5、编写 jsp 页面
  </h3>
</div><div class="component-content pagebody component code">
  
  
  
  <pre><code class="">&lt;form action=&#34;fileUpload2&#34; method=&#34;post&#34; enctype=&#34;multipart/form-data&#34;&gt; 
  名称:&lt;input type=&#34;text&#34; name=&#34;picname&#34;/&gt;&lt;br/&gt;
	图片:&lt;input type=&#34;file&#34; name=&#34;uploadFile&#34;/&gt;&lt;br/&gt;
	&lt;input type=&#34;submit&#34; value=&#34;上传&#34;/&gt; 
&lt;/form&gt;</code></pre>
  
</div>
<div class="component-content pagebody component">
  <h3 id="36配置解析器" class="pagebody-header">
    3.6、配置解析器
  </h3>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- 配置文件上传解析器 --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;multipartResolver&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;org.springframework.web.multipart.commons.CommonsMultipartResolver&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&lt;!-- 设置上传文件的最大尺寸为 5MB --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;maxUploadSize&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;value&gt;</span>5242880<span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/bean&gt;</span></span></span></code></pre></div></div>
  
</div>
          </div><div class="component">
            <div class="component-content">
              <div class="article-copyright">
                <p class="content">
                  Copyright: <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed" target="_blank">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0)</a>
                </p>
                <p class="content">Author:   </p>
                <p class="content">Posted on:  November 26, 2021</p>
              </div>
            </div>
          </div></article>
      </section>
  </main>

  <script>
    var script = document.createElement("script");script.src = "https://yuanshuai1122.github.io/js/initPost.js";
    document.head.appendChild(script);
  </script>

    
    <div class="footer-main ">
  <div class="content-body footer-wraper">
    <div class="footer-box">
      <div class="foot-nav">
        <div class="foot-nav-items">
          <div class="item">
            <div class="logo"></div>
            <div class="email">Email: <a href="mailto:floyd.li@outlook.com">floyd.li@outlook.com</a></div>
          </div>

          <div class="item community">
            <div class="item-title">Social Media</div>
            
              <a href="https://github.com/floyd-li" target="_blank">Github</a>
            
          </div>

          <div class="item resources">
            <div class="item-title">Related</div>
            
              <a href="https://yufengbiji.com/" target="_blank">驭风笔记</a>
            
          </div>
        </div>
      </div>
      <div class="bottom">
        <div class="item copyright">
          &copy; 2023
          Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> & <a href="https://github.com/floyd-li/hugo-theme-itheme" target="_blank">iTheme</a>
        </div>
      </div>
    </div>
  </div>
</div>

  </body>
    
    

    
    
</html>
