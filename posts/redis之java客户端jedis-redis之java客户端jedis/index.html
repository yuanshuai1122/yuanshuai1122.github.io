<!DOCTYPE html>
<html class="js no-touch  progressive-image  no-reduced-motion progressive" lang="zh-hans">
  <head>
    <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="icon" href="/img/favicon.ico">

    <meta name="keyword" content=""><meta property="og:title" content="Redis之Java客户端Jedis" />
<meta property="og:description" content="&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-&quot; ); jedis.mset( &ldquo;str1&rdquo; , &ldquo;v1&rdquo; , &ldquo;str2&rdquo; , &ldquo;v2&rdquo; , &ldquo;str3&rdquo; , &ldquo;v3&rdquo; ); System. out .println(jedis.mget( &ldquo;str1&rdquo; , &ldquo;str2&rdquo; , &ldquo;str3&rdquo; )); //list System. out .println( &ldquo;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-&rdquo; ); //jedis.lpush(&quot; mylist &ldquo;,&ldquo;v1&rdquo;,&ldquo;v2&rdquo;,&ldquo;v3&rdquo;,&ldquo;v4&rdquo;,&ldquo;v5&rdquo;); List list = jedis.lrange( &ldquo;mylist&rdquo; ,0,-1); for (String element : list) { System. out .println(element); } //set jedis.sadd( &ldquo;orders&rdquo; , &ldquo;jd001&rdquo; ); jedis.sadd( &ldquo;orders&rdquo; , &ldquo;jd002&rdquo; ); jedis.sadd( &ldquo;orders&rdquo; , &ldquo;jd003&rdquo; ); Set set1 = jedis.smembers( &ldquo;orders&rdquo;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yuanshuai1122.github.io/posts/redis%E4%B9%8Bjava%E5%AE%A2%E6%88%B7%E7%AB%AFjedis-redis%E4%B9%8Bjava%E5%AE%A2%E6%88%B7%E7%AB%AFjedis/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-26T21:31:04+00:00" />
<meta property="article:modified_time" content="2021-11-26T21:31:04+00:00" />
<title>Redis之Java客户端Jedis</title>

    <link rel="canonical" href="/posts/redis%E4%B9%8Bjava%E5%AE%A2%E6%88%B7%E7%AB%AFjedis-redis%E4%B9%8Bjava%E5%AE%A2%E6%88%B7%E7%AB%AFjedis/">

    <link rel="stylesheet" href="/css/global.css">

    <link rel="stylesheet" href="/css/custom.css">

    <link rel="stylesheet" href="/css/search.css" />

    
    

    
    

</head>
  </head>
  <body class=" page-article   ">
    <header>
      <nav class="nav">
  <div class="nav-wrapper">
    <div class="nav-content-wrapper">
      <div class="nav-content">
        <a href="/ " class="nav-title">🧀</a>
        <div class="nav-menu">
          <div class="nav-item-wrapper">
            <a href="/posts " class="nav-item-content">目录</a>
          </div><div class="nav-item-wrapper">
            <a href="/about" class="nav-item-content">关于</a>
          </div><div class="nav-item-wrapper">
            <a href="/index.xml" class="nav-item-content" target="_blank">RSS</a>
          </div></div>
      </div>
    </div>
  </div>
</nav>

<script>
  function toggleSearchModal(){
    const template = `
    <div class="modal-body">
      <div id="autocomplete" onclick="event.stopPropagation();"></div>
    </div>
    `
    const modal = document.querySelector("#modal-wrapper")
    if(!modal){
      const div = document.createElement("div")
      document.body.setAttribute("style","overflow: hidden;")
      div.setAttribute("id", "modal-wrapper")
      div.setAttribute("onclick", "toggleSearchModal()")
      div.innerHTML = template
      const script = document.createElement("script");script.setAttribute("src", "https://yuanshuai1122.github.io/js/algolia.js")
      div.appendChild(script)
      document.body.append(div)
    } else {
      document.body.removeAttribute("style")
      document.body.removeChild(modal)
    }
  }
</script>
    </header>
    
  
  
  <main id="main" class="main">
      <section>
        <article class="article">
          
          <div class=" article-header ">
            <div class="category component">
              <div class="component-content">
                <div class="category-eyebrow">
                  <span class="category-eyebrow__category category_original">
                    
                      
                        数据库
                      
                    
                  </span>
                  <span class="category-eyebrow__date">2021年11月26日</span>
                </div>
              </div>
            </div>
            <div class="pagetitle component">
              <div class="component-content">
                <h1 class="hero-headline">Redis之Java客户端Jedis</h1>
              </div>
            </div>
            <div class="component  article-subhead ">
              <div class="component-content"></div>
            </div>

            <div class="tagssheet component">
              <div class="component-content">
                
                  
                  <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93" class="tag">
                    数据库
                  </a>
                
                  
                  <a href="/tags/redis" class="tag">
                    Redis
                  </a>
                
              </div>
            </div>
          </div>
          
          <div class="pagebody">
            
            
            
            
            
            
            
            
            <p class="component-content component">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-&quot; );
     jedis.mset( &ldquo;str1&rdquo; , &ldquo;v1&rdquo; , &ldquo;str2&rdquo; , &ldquo;v2&rdquo; , &ldquo;str3&rdquo; , &ldquo;v3&rdquo; );
     System. out .println(jedis.mget( &ldquo;str1&rdquo; , &ldquo;str2&rdquo; , &ldquo;str3&rdquo; ));
      //list
     System. out .println( &ldquo;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-&rdquo; );
      //jedis.lpush(&quot; mylist &ldquo;,&ldquo;v1&rdquo;,&ldquo;v2&rdquo;,&ldquo;v3&rdquo;,&ldquo;v4&rdquo;,&ldquo;v5&rdquo;);
     List<!-- raw HTML omitted --> list = jedis.lrange( &ldquo;mylist&rdquo; ,0,-1);
      for  (String element : list) {
       System. out .println(element);
     }
      //set
     jedis.sadd( &ldquo;orders&rdquo; , &ldquo;jd001&rdquo; );
     jedis.sadd( &ldquo;orders&rdquo; , &ldquo;jd002&rdquo; );
     jedis.sadd( &ldquo;orders&rdquo; , &ldquo;jd003&rdquo; );
     Set<!-- raw HTML omitted --> set1 = jedis.smembers( &ldquo;orders&rdquo; );
      for  ( Iterator  iterator = set1.iterator(); iterator.hasNext();) {
       String string = (String) iterator.next();
       System. out .println(string);
     }
     jedis.srem( &ldquo;orders&rdquo; , &ldquo;jd002&rdquo; );
     System. out .println(jedis.smembers( &ldquo;orders&rdquo; ).size());
      //hash
     jedis.hset( &ldquo;hash1&rdquo; , &ldquo;userName&rdquo; , &ldquo;lisi&rdquo; );
     System. out .println(jedis.hget( &ldquo;hash1&rdquo; , &ldquo;userName&rdquo; ));
     Map&lt;String,String&gt; map =  new  HashMap&lt;String,String&gt;();
     map.put( &ldquo;telphone&rdquo; , &ldquo;13811814763&rdquo; );
     map.put( &ldquo;address&rdquo; , &ldquo;atguigu&rdquo; );
     map.put( &ldquo;email&rdquo; , &ldquo;<a href="mailto:abc@163.com">abc@163.com</a>&rdquo; );
     jedis.hmset( &ldquo;hash2&rdquo; ,map);
     List<!-- raw HTML omitted --> result = jedis.hmget( &ldquo;hash2&rdquo; ,  &ldquo;telphone&rdquo; , &ldquo;email&rdquo; );
      for  (String element : result) {
       System. out .println(element);
     }
      // zset
     jedis.zadd( &ldquo;zset01&rdquo; ,60d, &ldquo;v1&rdquo; );
     jedis.zadd( &ldquo;zset01&rdquo; ,70d, &ldquo;v2&rdquo; );
     jedis.zadd( &ldquo;zset01&rdquo; ,80d, &ldquo;v3&rdquo; );
     jedis.zadd( &ldquo;zset01&rdquo; ,90d, &ldquo;v4&rdquo; );
     
     Set<!-- raw HTML omitted --> s1 = jedis.zrange( &ldquo;zset01&rdquo; ,0,-1);
      for  ( Iterator  iterator = s1.iterator(); iterator.hasNext();) {
       String string = (String) iterator.next();
       System. out .println(string);
     }</p>
<p class="component-content component">          
  }
}</p>
<div class="component-content pagebody component code">
  
  
  
  <pre><code class="">
### 4.3、事务提交

- 日常

```java
package  com.atguigu.redis.test; 
 
import   redis.clients.jedis.Jedis ; 
import  redis.clients.jedis.Response; 
import  redis.clients.jedis.Transaction; 
 
public   class  Test03  
{ 
   public   static   void  main(String[] args)  
  { 
      Jedis  jedis =  new   Jedis ( &#34;127.0.0.1&#34; ,6379); 
      
      //监控key，如果该动了事务就被放弃 
      /*3 
     jedis.watch(&#34;serialNum&#34;); 
     jedis.set(&#34;serialNum&#34;,&#34;s#####################&#34;); 
     jedis.unwatch();*/ 
      
     Transaction transaction = jedis.multi(); //被当作一个命令进行执行 
     Response&lt;String&gt; response = transaction.get( &#34;serialNum&#34; ); 
     transaction.set( &#34;serialNum&#34; , &#34;s002&#34; ); 
     response = transaction.get( &#34;serialNum&#34; ); 
     transaction.lpush( &#34;list3&#34; , &#34;a&#34; ); 
     transaction.lpush( &#34;list3&#34; , &#34;b&#34; ); 
     transaction.lpush( &#34;list3&#34; , &#34;c&#34; ); 
      
     transaction.exec(); 
      //2 transaction.discard(); 
     System. out .println( &#34;serialNum***********&#34; &#43;response.get()); 
           
  } 
} </code></pre>
  
</div><div class="component-content component"><ul>
<li>加锁</li>
</ul></div>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span>   <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">TestTransaction</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">public</span>   <span style="color:#66d9ef">boolean</span>  <span style="color:#a6e22e">transMethod</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>     Jedis jedis <span style="color:#f92672">=</span>  <span style="color:#66d9ef">new</span>  Jedis<span style="color:#f92672">(</span> <span style="color:#e6db74">&#34;127.0.0.1&#34;</span> <span style="color:#f92672">,</span> <span style="color:#ae81ff">6379</span><span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span>  balance<span style="color:#f92672">;</span> <span style="color:#75715e">// 可用余额 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">int</span>  debt<span style="color:#f92672">;</span> <span style="color:#75715e">// 欠额 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">int</span>  amtToSubtract <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span><span style="color:#f92672">;</span> <span style="color:#75715e">// 实刷额度 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> 
</span></span><span style="display:flex;"><span>     jedis<span style="color:#f92672">.</span><span style="color:#a6e22e">watch</span><span style="color:#f92672">(</span> <span style="color:#e6db74">&#34;balance&#34;</span> <span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//jedis.set(&#34;balance&#34;,&#34;5&#34;);//此句不该出现，讲课方便。模拟其他程序已经修改了该条目 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>     balance <span style="color:#f92672">=</span> Integer<span style="color:#f92672">.</span> <span style="color:#a6e22e">parseInt</span> <span style="color:#f92672">(</span>jedis<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span> <span style="color:#e6db74">&#34;balance&#34;</span> <span style="color:#f92672">));</span> 
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span>  <span style="color:#f92672">(</span>balance <span style="color:#f92672">&lt;</span> amtToSubtract<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>       jedis<span style="color:#f92672">.</span><span style="color:#a6e22e">unwatch</span><span style="color:#f92672">();</span> 
</span></span><span style="display:flex;"><span>       System<span style="color:#f92672">.</span> out <span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span> <span style="color:#e6db74">&#34;modify&#34;</span> <span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>   <span style="color:#66d9ef">false</span> <span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">}</span>  <span style="color:#66d9ef">else</span>  <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>       System<span style="color:#f92672">.</span> out <span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span> <span style="color:#e6db74">&#34;***********transaction&#34;</span> <span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>        Transaction  transaction <span style="color:#f92672">=</span> jedis<span style="color:#f92672">.</span><span style="color:#a6e22e">multi</span><span style="color:#f92672">();</span> 
</span></span><span style="display:flex;"><span>       transaction<span style="color:#f92672">.</span><span style="color:#a6e22e">decrBy</span><span style="color:#f92672">(</span> <span style="color:#e6db74">&#34;balance&#34;</span> <span style="color:#f92672">,</span> amtToSubtract<span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>       transaction<span style="color:#f92672">.</span><span style="color:#a6e22e">incrBy</span><span style="color:#f92672">(</span> <span style="color:#e6db74">&#34;debt&#34;</span> <span style="color:#f92672">,</span> amtToSubtract<span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>       transaction<span style="color:#f92672">.</span><span style="color:#a6e22e">exec</span><span style="color:#f92672">();</span> 
</span></span><span style="display:flex;"><span>       balance <span style="color:#f92672">=</span> Integer<span style="color:#f92672">.</span> <span style="color:#a6e22e">parseInt</span> <span style="color:#f92672">(</span>jedis<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span> <span style="color:#e6db74">&#34;balance&#34;</span> <span style="color:#f92672">));</span> 
</span></span><span style="display:flex;"><span>       debt <span style="color:#f92672">=</span> Integer<span style="color:#f92672">.</span> <span style="color:#a6e22e">parseInt</span> <span style="color:#f92672">(</span>jedis<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span> <span style="color:#e6db74">&#34;debt&#34;</span> <span style="color:#f92672">));</span> 
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>       System<span style="color:#f92672">.</span> out <span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span> <span style="color:#e6db74">&#34;*******&#34;</span>  <span style="color:#f92672">+</span> balance<span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>       System<span style="color:#f92672">.</span> out <span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span> <span style="color:#e6db74">&#34;*******&#34;</span>  <span style="color:#f92672">+</span> debt<span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>   <span style="color:#66d9ef">true</span> <span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">/** 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * 通俗点讲，watch命令就是标记一个键，如果标记了一个键， 在提交事务前如果该键被别人修改过，那事务就会失败，这种情况通常可以在程序中 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * 重新再尝试一次。 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * 首先标记了键balance，然后检查余额是否足够，不足就取消标记，并不做扣减； 足够的话，就启动事务进行更新操作， 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * 如果在此期间键balance被其它人修改， 那在提交事务（执行 exec ）时就会报错， 程序中通常可以捕获这类错误再重新执行一次，直到成功。 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span> 
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">public</span>   <span style="color:#66d9ef">static</span>   <span style="color:#66d9ef">void</span>  <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>     TestTransaction test <span style="color:#f92672">=</span>  <span style="color:#66d9ef">new</span>  TestTransaction<span style="color:#f92672">();</span> 
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">boolean</span>  retValue <span style="color:#f92672">=</span> test<span style="color:#f92672">.</span><span style="color:#a6e22e">transMethod</span><span style="color:#f92672">();</span> 
</span></span><span style="display:flex;"><span>     System<span style="color:#f92672">.</span> out <span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span> <span style="color:#e6db74">&#34;main retValue-------: &#34;</span>  <span style="color:#f92672">+</span> retValue<span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span> </span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="44主从复制" class="pagebody-header">
    4.4、主从复制
  </h3>
</div><div class="component-content component"><ul>
<li>
<p class="component-content component">6379,6380启动，先各自先独立</p>
</li>
<li>
<p class="component-content component">主写</p>
</li>
<li>
<p class="component-content component">从读</p>
</li>
</ul></div>

<div class="component-content pagebody component">
  <h2 id="5jedispool" class="pagebody-header">
    5、JedisPool
  </h2>
</div>
<div class="component-content pagebody component">
  <h3 id="51获取jedis实例需要从jedispool中获取" class="pagebody-header">
    5.1、获取Jedis实例需要从JedisPool中获取
  </h3>
</div>
<div class="component-content pagebody component">
  <h3 id="52用完jedis实例需要返还给jedispool" class="pagebody-header">
    5.2、用完Jedis实例需要返还给JedisPool
  </h3>
</div>
<div class="component-content pagebody component">
  <h3 id="52如果jedis在使用过程中出错则也需要还给jedispool" class="pagebody-header">
    5.2、如果Jedis在使用过程中出错，则也需要还给JedisPool
  </h3>
</div>
<div class="component-content pagebody component">
  <h3 id="54例见代码" class="pagebody-header">
    5.4、例见代码
  </h3>
</div><p class="component-content component">JedisPoolUtil</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span>  com.atguigu.redis.test<span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span>  redis.clients.jedis.Jedis<span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span>  redis.clients.jedis.JedisPool<span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span>  redis.clients.jedis.JedisPoolConfig<span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span>   <span style="color:#66d9ef">class</span>   <span style="color:#a6e22e">JedisPoolUtil</span>  <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span>   <span style="color:#66d9ef">static</span>   <span style="color:#66d9ef">volatile</span>  JedisPool  jedisPool  <span style="color:#f92672">=</span>  <span style="color:#66d9ef">null</span> <span style="color:#f92672">;</span> <span style="color:#75715e">//被volatile修饰的变量不会被本地线程缓存，对该变量的读写都是直接操作共享内存。 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">private</span>  <span style="color:#a6e22e">JedisPoolUtil</span><span style="color:#f92672">()</span> <span style="color:#f92672">{}</span> 
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">public</span>   <span style="color:#66d9ef">static</span>  JedisPool <span style="color:#a6e22e">getJedisPoolInstance</span><span style="color:#f92672">()</span> 
</span></span><span style="display:flex;"><span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span> <span style="color:#66d9ef">null</span>  <span style="color:#f92672">==</span>  jedisPool <span style="color:#f92672">)</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">synchronized</span>  <span style="color:#f92672">(</span> JedisPoolUtil <span style="color:#f92672">.</span> <span style="color:#66d9ef">class</span> <span style="color:#960050;background-color:#1e0010">) </span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>           <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span> <span style="color:#66d9ef">null</span>  <span style="color:#f92672">==</span>  jedisPool <span style="color:#f92672">)</span> 
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>           JedisPoolConfig poolConfig <span style="color:#f92672">=</span>  <span style="color:#66d9ef">new</span>  JedisPoolConfig<span style="color:#f92672">();</span> 
</span></span><span style="display:flex;"><span>           poolConfig<span style="color:#f92672">.</span><span style="color:#a6e22e">setMaxActive</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1000</span><span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>           poolConfig<span style="color:#f92672">.</span><span style="color:#a6e22e">setMaxIdle</span><span style="color:#f92672">(</span><span style="color:#ae81ff">32</span><span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>           poolConfig<span style="color:#f92672">.</span><span style="color:#a6e22e">setMaxWait</span><span style="color:#f92672">(</span><span style="color:#ae81ff">100</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span><span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>           poolConfig<span style="color:#f92672">.</span><span style="color:#a6e22e">setTestOnBorrow</span><span style="color:#f92672">(</span> <span style="color:#66d9ef">true</span> <span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>             
</span></span><span style="display:flex;"><span>             jedisPool  <span style="color:#f92672">=</span>  <span style="color:#66d9ef">new</span>  JedisPool<span style="color:#f92672">(</span>poolConfig<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;127.0.0.1&#34;</span> <span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span>   jedisPool <span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">public</span>   <span style="color:#66d9ef">static</span>   <span style="color:#66d9ef">void</span>  <span style="color:#a6e22e">release</span><span style="color:#f92672">(</span>JedisPool jedisPool<span style="color:#f92672">,</span>Jedis jedis<span style="color:#f92672">)</span> 
</span></span><span style="display:flex;"><span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span> <span style="color:#66d9ef">null</span>  <span style="color:#f92672">!=</span> jedis<span style="color:#f92672">)</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>      jedisPool<span style="color:#f92672">.</span><span style="color:#a6e22e">returnResourceObject</span><span style="color:#f92672">(</span>jedis<span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span> </span></span></code></pre></div></div>
  
</div><p class="component-content component">Demo5:JedisPool.getResource();</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span>  com.atguigu.redis.test<span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span>  redis.clients.jedis.Jedis<span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span>  redis.clients.jedis.JedisPool<span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span>   <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">Test01</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">public</span>   <span style="color:#66d9ef">static</span>   <span style="color:#66d9ef">void</span>  <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>     JedisPool jedisPool <span style="color:#f92672">=</span> JedisPoolUtil<span style="color:#f92672">.</span> <span style="color:#a6e22e">getJedisPoolInstance</span> <span style="color:#f92672">();</span> 
</span></span><span style="display:flex;"><span>     Jedis jedis <span style="color:#f92672">=</span>  <span style="color:#66d9ef">null</span> <span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">try</span>   
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>       jedis <span style="color:#f92672">=</span> jedisPool<span style="color:#f92672">.</span><span style="color:#a6e22e">getResource</span><span style="color:#f92672">();</span> 
</span></span><span style="display:flex;"><span>       jedis<span style="color:#f92672">.</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span> <span style="color:#e6db74">&#34;k18&#34;</span> <span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;v183&#34;</span> <span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">}</span>  <span style="color:#66d9ef">catch</span>  <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>       e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span> 
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>       JedisPoolUtil<span style="color:#f92672">.</span> <span style="color:#a6e22e">release</span> <span style="color:#f92672">(</span>jedisPool<span style="color:#f92672">,</span> jedis<span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span> </span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="55配置总结all" class="pagebody-header">
    5.5、配置总结all
  </h3>
</div><p class="component-content component">JedisPool的配置参数大部分是由JedisPoolConfig的对应项来赋值的。</p>
<p class="component-content component">maxActive ：控制一个pool可分配多少个jedis实例，通过pool.getResource()来获取；如果赋值为-1，则表示不限制；如果pool已经分配了maxActive个jedis实例，则此时pool的状态为exhausted。</p>
<p class="component-content component">maxIdle ：控制一个pool最多有多少个状态为idle(空闲)的jedis实例；</p>
<p class="component-content component">whenExhaustedAction：表示当pool中的jedis实例都被allocated完时，pool要采取的操作；默认有三种。</p>
<p class="component-content component">WHEN_EXHAUSTED_FAIL &ndash;&gt; 表示无jedis实例时，直接抛出NoSuchElementException；</p>
<p class="component-content component">WHEN_EXHAUSTED_BLOCK &ndash;&gt; 则表示阻塞住，或者达到maxWait时抛出JedisConnectionException；</p>
<p class="component-content component">WHEN_EXHAUSTED_GROW &ndash;&gt; 则表示新建一个jedis实例，也就说设置的maxActive无用；</p>
<p class="component-content component">maxWait ：表示当borrow一个jedis实例时，最大的等待时间，如果超过等待时间，则直接抛JedisConnectionException；</p>
<p class="component-content component">testOnBorrow ：获得一个jedis实例的时候是否检查连接可用性（ping()）；如果为true，则得到的jedis实例均是可用的；</p>
<p class="component-content component">testOnReturn：return 一个jedis实例给pool时，是否检查连接可用性（ping()）；</p>
<p class="component-content component">testWhileIdle：如果为true，表示有一个idle object evitor线程对idle object进行扫描，如果validate失败，此object会被从pool中drop掉；这一项只有在timeBetweenEvictionRunsMillis大于0时才有意义；</p>
<p class="component-content component">timeBetweenEvictionRunsMillis：表示idle object evitor两次扫描之间要sleep的毫秒数；</p>
<p class="component-content component">numTestsPerEvictionRun：表示idle object evitor每次扫描的最多的对象数；</p>
<p class="component-content component">minEvictableIdleTimeMillis：表示一个对象至少停留在idle状态的最短时间，然后才能被idle object evitor扫描并驱逐；这一项只有在timeBetweenEvictionRunsMillis大于0时才有意义；</p>
<p class="component-content component">softMinEvictableIdleTimeMillis：在minEvictableIdleTimeMillis基础上，加入了至少minIdle个对象已经在pool里面了。如果为-1，evicted不会根据idle time驱逐任何对象。如果minEvictableIdleTimeMillis&gt;0，则此项设置无意义，且只有在timeBetweenEvictionRunsMillis大于0时才有意义；</p>
<p class="component-content component">lifo：borrowObject返回对象时，是采用DEFAULT_LIFO（last in first out，即类似cache的最频繁使用队列），如果为False，则表示FIFO队列；</p>
<p class="component-content component">其中JedisPoolConfig对一些参数的默认设置如下：</p>
<p class="component-content component">testWhileIdle=true</p>
<p class="component-content component">minEvictableIdleTimeMills=60000</p>
<p class="component-content component">timeBetweenEvictionRunsMillis=30000</p>
<p class="component-content component">numTestsPerEvictionRun=-1</p>

          </div><div class="component">
            <div class="component-content">
              <div class="article-copyright">
                <p class="content">
                  版权声明: <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed" target="_blank">版权声明：署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0)</a>
                </p>
                <p class="content">作者:  yuanshuai </p>
                <p class="content">发表日期:  2021年11月26日</p>
              </div>
            </div>
          </div></article>
      </section>
  </main>

  <script>
    var script = document.createElement("script");script.src = "https://yuanshuai1122.github.io/js/initPost.js";
    document.head.appendChild(script);
  </script>

    
    <div class="footer-main ">
  <div class="content-body footer-wraper">
    <div class="footer-box">
      <div class="foot-nav">
        <div class="foot-nav-items">
          <div class="item">
            <div class="logo"></div>
            <div class="email">Email: <a href="mailto:shuaiyuan@gmail.com">shuaiyuan@gmail.com</a></div>
          </div>

          <div class="item community">
            <div class="item-title">社交媒体</div>
            
              <a href="https://github.com/yuanshuai1122" target="_blank">Github</a>
            
          </div>

          <div class="item resources">
            <div class="item-title">友链</div>
            
              <a href="https://yuanshuaicn.com/" target="_blank">👋</a>
            
          </div>
        </div>
      </div>
      <div class="bottom">
        <div class="item copyright">
          &copy; 2023
          Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> & <a href="https://github.com/floyd-li/hugo-theme-itheme" target="_blank">iTheme</a>
        </div>
      </div>
    </div>
  </div>
</div>

  </body>
    
    

    
    
</html>
