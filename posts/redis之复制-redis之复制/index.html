<!DOCTYPE html>
<html class="js no-touch  progressive-image  no-reduced-motion progressive" lang="zh-hans">
  <head>
    <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="icon" href="/img/favicon.ico">

    <meta name="keyword" content=""><meta property="og:title" content="Redis之复制" />
<meta property="og:description" content="1、是什么 行话：也就是我们所说的主从复制，主机数据更新后根据配置和策略，自动同步到备机的master/slaver机制，Master以写为主" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yuanshuai1122.github.io/posts/redis%E4%B9%8B%E5%A4%8D%E5%88%B6-redis%E4%B9%8B%E5%A4%8D%E5%88%B6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-26T21:30:58+00:00" />
<meta property="article:modified_time" content="2021-11-26T21:30:58+00:00" />
<title>Redis之复制</title>

    <link rel="canonical" href="/posts/redis%E4%B9%8B%E5%A4%8D%E5%88%B6-redis%E4%B9%8B%E5%A4%8D%E5%88%B6/">

    <link rel="stylesheet" href="/css/global.css">

    <link rel="stylesheet" href="/css/custom.css">

    <link rel="stylesheet" href="/css/search.css" />

    
    

    
    

</head>
  </head>
  <body class=" page-article   ">
    <header>
      <nav class="nav">
  <div class="nav-wrapper">
    <div class="nav-content-wrapper">
      <div class="nav-content">
        <a href="/ " class="nav-title">🧀</a>
        <div class="nav-menu">
          <div class="nav-item-wrapper">
            <a href="/posts " class="nav-item-content">目录</a>
          </div><div class="nav-item-wrapper">
            <a href="/about" class="nav-item-content">关于</a>
          </div><div class="nav-item-wrapper">
            <a href="/index.xml" class="nav-item-content" target="_blank">RSS</a>
          </div></div>
      </div>
    </div>
  </div>
</nav>

<script>
  function toggleSearchModal(){
    const template = `
    <div class="modal-body">
      <div id="autocomplete" onclick="event.stopPropagation();"></div>
    </div>
    `
    const modal = document.querySelector("#modal-wrapper")
    if(!modal){
      const div = document.createElement("div")
      document.body.setAttribute("style","overflow: hidden;")
      div.setAttribute("id", "modal-wrapper")
      div.setAttribute("onclick", "toggleSearchModal()")
      div.innerHTML = template
      const script = document.createElement("script");script.setAttribute("src", "https://yuanshuai1122.github.io/js/algolia.js")
      div.appendChild(script)
      document.body.append(div)
    } else {
      document.body.removeAttribute("style")
      document.body.removeChild(modal)
    }
  }
</script>
    </header>
    
  
  
  <main id="main" class="main">
      <section>
        <article class="article">
          
          <div class=" article-header ">
            <div class="category component">
              <div class="component-content">
                <div class="category-eyebrow">
                  <span class="category-eyebrow__category category_original">
                    
                      
                        数据库
                      
                    
                  </span>
                  <span class="category-eyebrow__date">2021年11月26日</span>
                </div>
              </div>
            </div>
            <div class="pagetitle component">
              <div class="component-content">
                <h1 class="hero-headline">Redis之复制</h1>
              </div>
            </div>
            <div class="component  article-subhead ">
              <div class="component-content"></div>
            </div>

            <div class="tagssheet component">
              <div class="component-content">
                
                  
                  <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93" class="tag">
                    数据库
                  </a>
                
                  
                  <a href="/tags/redis" class="tag">
                    Redis
                  </a>
                
              </div>
            </div>
          </div>
          
          <div class="pagebody">
            
            
            
            
            
            
            
            
            
<div class="component-content pagebody component">
  <h2 id="1是什么" class="pagebody-header">
    <strong>1、是什么</strong>
  </h2>
</div><p class="component-content component">行话：也就是我们所说的主从复制，主机数据更新后根据配置和策略，自动同步到备机的master/slaver机制，Master以写为主，Slave以读为主</p>

<div class="component-content pagebody component">
  <h2 id="2能干嘛" class="pagebody-header">
    2、<strong>能干嘛</strong>
  </h2>
</div><p class="component-content component">读写分离</p>
<p class="component-content component">容灾恢复</p>

<div class="component-content pagebody component">
  <h2 id="3怎么玩" class="pagebody-header">
    3、<strong>怎么玩</strong>
  </h2>
</div>
<div class="component-content pagebody component">
  <h3 id="31配从库不配主库" class="pagebody-header">
    3.1、配从(库)不配主(库)
  </h3>
</div>
<div class="component-content pagebody component">
  <h3 id="32从库配置slaveof-主库ip-主库端口" class="pagebody-header">
    3.2、从库配置：slaveof 主库IP 主库端口
  </h3>
</div><div class="component-content component"><ul>
<li>
<p class="component-content component">每次与master断开之后，都需要重新连接，除非你配置进redis.conf文件</p>
</li>
<li>
<p class="component-content component">Info replication</p>
</li>
</ul></div>

<div class="component-content pagebody component">
  <h3 id="33修改配置文件细节操作" class="pagebody-header">
    3.3、修改配置文件细节操作
  </h3>
</div><div class="component-content component"><ul>
<li>拷贝多个redis.conf文件</li>
</ul></div>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-829c09e2f6f4e41c41d456d1b90f8f4f" id="lht829c09e2f6f4e41c41d456d1b90f8f4f">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/redis/107.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<div class="component-content component"><ul>
<li>开启daemonize yes</li>
</ul></div>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-cc1c99635acbcb6ca71e964d8a179663" id="lhtcc1c99635acbcb6ca71e964d8a179663">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/redis/108.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<div class="component-content component"><ul>
<li>Pid文件名字</li>
<li>指定端口</li>
<li>Log文件名字</li>
</ul></div>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-079f4408bb2da93b300f376b925b1fb2" id="lht079f4408bb2da93b300f376b925b1fb2">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/redis/109.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<div class="component-content component"><ul>
<li>Dump.rdb名字</li>
</ul></div>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-7cb164bea8e5a008cd7b6932c46584ee" id="lht7cb164bea8e5a008cd7b6932c46584ee">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/redis/200.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h3 id="34常用3招" class="pagebody-header">
    3.4、常用3招
  </h3>
</div>
<div class="component-content pagebody component">
  <h4 id="341一主二仆" class="pagebody-header">
    3.4.1、一主二仆
  </h4>
</div><div class="component-content component"><ul>
<li>Init</li>
</ul></div>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-612f2803572d143f41381ef5d78bd540" id="lht612f2803572d143f41381ef5d78bd540">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/redis/201.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<div class="component-content component"><ul>
<li>一个Master两个Slave</li>
</ul></div>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-626ef98a5810f9efc6c0ed917a0abad7" id="lht626ef98a5810f9efc6c0ed917a0abad7">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/redis/202.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<div class="component-content component"><ul>
<li>日志查看</li>
</ul></div>
<p class="component-content component">主机日志</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-499c2fa0f12ce1d231e7c5cab25ae505" id="lht499c2fa0f12ce1d231e7c5cab25ae505">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/redis/203.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">备机日志</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-87d80a7c184b94b165f381c2461bfe2d" id="lht87d80a7c184b94b165f381c2461bfe2d">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/redis/204.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">info replication</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-2cbb928684d3c8d6433ead222821ad7a" id="lht2cbb928684d3c8d6433ead222821ad7a">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/redis/205.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h4 id="342薪火相传" class="pagebody-header">
    3.4.2、薪火相传
  </h4>
</div><div class="component-content component"><ul>
<li>
<p class="component-content component">上一个Slave可以是下一个slave的Master，Slave同样可以接收其他Slaves的连接和同步请求，那么该slave作为了链条中下一个的master,可以有效减轻master的写压力</p>
</li>
<li>
<p class="component-content component">中途变更转向:会清除之前的数据，重新建立拷贝最新的</p>
</li>
<li>
<p class="component-content component">Slaveof 新主库IP 新主库端口</p>
</li>
</ul></div>

<div class="component-content pagebody component">
  <h4 id="343反客为主" class="pagebody-header">
    3.4.3、反客为主
  </h4>
</div><p class="component-content component">SLAVEOF no one：使当前数据库停止与其他数据库的同步，转成主数据库</p>

<div class="component-content pagebody component">
  <h2 id="4复制原理" class="pagebody-header">
    4、<strong>复制原理</strong>
  </h2>
</div><div class="component-content component"><ul>
<li>Slave启动成功连接到master后会发送一个sync命令</li>
<li>Master接到命令启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令，在后台进程执行完毕之后，master将传送整个数据文件到slave,以完成一次完全同步</li>
<li>全量复制：而slave服务在接收到数据库文件数据后，将其存盘并加载到内存中。</li>
<li>增量复制：Master继续将新的所有收集到的修改命令依次传给slave,完成同步</li>
<li>但是只要是重新连接master,一次完全同步（全量复制)将被自动执行</li>
</ul></div>

<div class="component-content pagebody component">
  <h2 id="5哨兵模式sentinel" class="pagebody-header">
    5、<strong>哨兵模式</strong>(sentinel)
  </h2>
</div>
<div class="component-content pagebody component">
  <h3 id="51是什么" class="pagebody-header">
    5.1、是什么
  </h3>
</div><p class="component-content component">反客为主的自动版，能够后台监控主机是否故障，如果故障了根据投票数自动将从库转换为主库</p>

<div class="component-content pagebody component">
  <h3 id="52怎么玩使用步骤" class="pagebody-header">
    5.2、怎么玩(使用步骤)
  </h3>
</div>
<div class="component-content pagebody component">
  <h4 id="521调整结构6379带着8081" class="pagebody-header">
    5.2.1、调整结构，6379带着80、81
  </h4>
</div>
<div class="component-content pagebody component">
  <h4 id="522自定义的myredis目录下新建sentinelconf文件名字绝不能错" class="pagebody-header">
    5.2.2、自定义的/myredis目录下新建sentinel.conf文件，名字绝不能错
  </h4>
</div>
<div class="component-content pagebody component">
  <h3 id="523配置哨兵填写内容" class="pagebody-header">
    5.2.3、配置哨兵,填写内容
  </h3>
</div><div class="component-content component"><ul>
<li>sentinel monitor 被监控数据库名字(自己起名字) 127.0.0.1 6379 1</li>
</ul></div>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-48354ccf23a8c80420df222500bf8ddf" id="lht48354ccf23a8c80420df222500bf8ddf">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/redis/206.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<div class="component-content component"><ul>
<li>上面最后一个数字1，表示主机挂掉后salve投票看让谁接替成为主机，得票数多少后成为主机</li>
</ul></div>

<div class="component-content pagebody component">
  <h3 id="524启动哨兵" class="pagebody-header">
    5.2.4、启动哨兵
  </h3>
</div><p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-0d48f792a8b55eb995d9d7b5ec7d5c34" id="lht0d48f792a8b55eb995d9d7b5ec7d5c34">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/redis/207.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<div class="component-content component"><ul>
<li>Redis-sentinel /myredis/sentinel.conf</li>
<li>上述目录依照各自的实际情况配置，可能目录不同</li>
</ul></div>

<div class="component-content pagebody component">
  <h3 id="525原有的master挂了" class="pagebody-header">
    5.2.5、原有的master挂了
  </h3>
</div><p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-419b1aa6f4fd1285c66367c7b4cd6f42" id="lht419b1aa6f4fd1285c66367c7b4cd6f42">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/redis/208.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h3 id="526投票新选" class="pagebody-header">
    5.2.6、投票新选
  </h3>
</div><p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-f0bcef28a0a2eb7ba71d2b54c1073f18" id="lhtf0bcef28a0a2eb7ba71d2b54c1073f18">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/redis/209.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h3 id="527重新主从继续开工info-replication查查看" class="pagebody-header">
    5.2.7、重新主从继续开工,info replication查查看
  </h3>
</div><p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-c7ce0c26c57c3197a3e95c49d801d49c" id="lhtc7ce0c26c57c3197a3e95c49d801d49c">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/redis/210.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h3 id="528问题如果之前的master重启回来会不会双master冲突" class="pagebody-header">
    5.2.8、问题：如果之前的master重启回来，会不会双master冲突？
  </h3>
</div><p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-759913151e285cd99b1e05fe500e1deb" id="lht759913151e285cd99b1e05fe500e1deb">
        <picture  class="picture">
          <img class="picture-image" data-src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/redis/211.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>

<div class="component-content pagebody component">
  <h2 id="53一组sentinel能同时监控多个master" class="pagebody-header">
    5.3、一组sentinel能同时监控多个Master
  </h2>
</div>
<div class="component-content pagebody component">
  <h2 id="6复制的缺点" class="pagebody-header">
    6、复制的缺点
  </h2>
</div><div class="component-content component"><ul>
<li>复制延时</li>
</ul></div>
<p class="component-content component">由于所有的写操作都是先在Master上操作，然后同步更新到Slave上，所以从Master同步到Slave机器有一定的延迟，当系统很繁忙的时候，延迟问题会更加严重，Slave机器数量的增加也会使这个问题更加严重。</p>

          </div><div class="component">
            <div class="component-content">
              <div class="article-copyright">
                <p class="content">
                  版权声明: <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed" target="_blank">版权声明：署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0)</a>
                </p>
                <p class="content">作者:  yuanshuai </p>
                <p class="content">发表日期:  2021年11月26日</p>
              </div>
            </div>
          </div></article>
      </section>
  </main>

  <script>
    var script = document.createElement("script");script.src = "https://yuanshuai1122.github.io/js/initPost.js";
    document.head.appendChild(script);
  </script>

    
    <div class="footer-main ">
  <div class="content-body footer-wraper">
    <div class="footer-box">
      <div class="foot-nav">
        <div class="foot-nav-items">
          <div class="item">
            <div class="logo"></div>
            <div class="email">Email: <a href="mailto:shuaiyuan@gmail.com">shuaiyuan@gmail.com</a></div>
          </div>

          <div class="item community">
            <div class="item-title">社交媒体</div>
            
              <a href="https://github.com/yuanshuai1122" target="_blank">Github</a>
            
          </div>

          <div class="item resources">
            <div class="item-title">友链</div>
            
              <a href="https://yuanshuaicn.com/" target="_blank">👋</a>
            
          </div>
        </div>
      </div>
      <div class="bottom">
        <div class="item copyright">
          &copy; 2023
          Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> & <a href="https://github.com/floyd-li/hugo-theme-itheme" target="_blank">iTheme</a>
        </div>
      </div>
    </div>
  </div>
</div>

  </body>
    
    

    
    
</html>
