<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>Python数据分析之Pandas（二） - CN.yuanshuai</title><meta name="author" content="">
<meta name="author-link" content="">
<meta name="description" content=": | &mdash;&mdash;&mdash;: | &mdash;&ndash;: | &mdash;&ndash;: | &mdash;&mdash;: | &mdash;&mdash;&ndash;: | &mdash;&ndash;: | &mdash;: | &mdash;&mdash;: | &mdash;&mdash;-: | | 0 | 2018-01-01 | 3℃ | -6℃ | 晴~多云 | 东北风 | 1-2级 | 59 | 良 | 2 | | 1 | 2018-01-02 | 2℃ | -5℃ | 阴~多云 | 东" /><meta name="keywords" content='Python, 数据分析' /><meta itemprop="name" content="Python数据分析之Pandas（二）">
<meta itemprop="description" content=": | &mdash;&mdash;&mdash;: | &mdash;&ndash;: | &mdash;&ndash;: | &mdash;&mdash;: | &mdash;&mdash;&ndash;: | &mdash;&ndash;: | &mdash;: | &mdash;&mdash;: | &mdash;&mdash;-: | | 0 | 2018-01-01 | 3℃ | -6℃ | 晴~多云 | 东北风 | 1-2级 | 59 | 良 | 2 | | 1 | 2018-01-02 | 2℃ | -5℃ | 阴~多云 | 东"><meta itemprop="datePublished" content="2021-10-24T18:38:23+00:00" />
<meta itemprop="dateModified" content="2021-10-24T18:38:23+00:00" />
<meta itemprop="wordCount" content="14590">
<meta itemprop="keywords" content="Python,数据分析," /><meta property="og:title" content="Python数据分析之Pandas（二）" />
<meta property="og:description" content=": | &mdash;&mdash;&mdash;: | &mdash;&ndash;: | &mdash;&ndash;: | &mdash;&mdash;: | &mdash;&mdash;&ndash;: | &mdash;&ndash;: | &mdash;: | &mdash;&mdash;: | &mdash;&mdash;-: | | 0 | 2018-01-01 | 3℃ | -6℃ | 晴~多云 | 东北风 | 1-2级 | 59 | 良 | 2 | | 1 | 2018-01-02 | 2℃ | -5℃ | 阴~多云 | 东" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://blog.yuanshuaicn.com/posts/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%8C-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%8C/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-24T18:38:23+00:00" />
<meta property="article:modified_time" content="2021-10-24T18:38:23+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Python数据分析之Pandas（二）"/>
<meta name="twitter:description" content=": | &mdash;&mdash;&mdash;: | &mdash;&ndash;: | &mdash;&ndash;: | &mdash;&mdash;: | &mdash;&mdash;&ndash;: | &mdash;&ndash;: | &mdash;: | &mdash;&mdash;: | &mdash;&mdash;-: | | 0 | 2018-01-01 | 3℃ | -6℃ | 晴~多云 | 东北风 | 1-2级 | 59 | 良 | 2 | | 1 | 2018-01-02 | 2℃ | -5℃ | 阴~多云 | 东"/>
<meta name="application-name" content="CN.yuanshuai">
<meta name="apple-mobile-web-app-title" content="CN.yuanshuai"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="http://blog.yuanshuaicn.com/posts/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%8C-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%8C/" /><link rel="prev" href="http://blog.yuanshuaicn.com/posts/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%B8%89-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%B8%89/" /><link rel="next" href="http://blog.yuanshuaicn.com/posts/python%E7%88%AC%E8%99%AB%E4%B9%8B%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB-python%E7%88%AC%E8%99%AB%E4%B9%8B%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Python数据分析之Pandas（二）",
    "inLanguage": "zh-CN",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "http:\/\/blog.yuanshuaicn.com\/posts\/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%8C-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%8C\/"
    },"genre": "posts","keywords": "Python, 数据分析","wordcount":  14590 ,
    "url": "http:\/\/blog.yuanshuaicn.com\/posts\/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%8C-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%8C\/","datePublished": "2021-10-24T18:38:23+00:00","dateModified": "2021-10-24T18:38:23+00:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "yuanshuai"
      },"description": ""
  }
  </script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="CN.yuanshuai"><img loading="lazy" src="/fixit.min.svg" srcset="/fixit.min.svg, /fixit.min.svg 1.5x, /fixit.min.svg 2x" sizes="auto" data-title="CN.yuanshuai" data-alt="CN.yuanshuai" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span class="header-title-text">CN.yuanshuai</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/posts/"
                
                
              ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 文章</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/categories/"
                
                
              ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/tags/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li class="menu-item delimiter"></li><li class="menu-item theme-switch" title="切换主题">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="CN.yuanshuai"><img loading="lazy" src="/fixit.min.svg" srcset="/fixit.min.svg, /fixit.min.svg 1.5x, /fixit.min.svg 2x" sizes="auto" data-title="/fixit.min.svg" data-alt="/fixit.min.svg" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span class="header-title-text">CN.yuanshuai</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/posts/"
                  
                  
                ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 文章</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="切换主题"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><main class="container"><aside class="toc" id="toc-auto"><h2 class="toc-title">目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside>

  <aside class="aside-custom">
    </aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>Python数据分析之Pandas（二）</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><a href="https://cloud.tencent.com/developer/user/8180692" title="作者"target="_blank" rel="external nofollow noopener noreferrer author" class="author"><img loading="lazy" src="https://aabb-2023.oss-cn-beijing.aliyuncs.com/hjscijg3uw.png" srcset="https://aabb-2023.oss-cn-beijing.aliyuncs.com/hjscijg3uw.png, https://aabb-2023.oss-cn-beijing.aliyuncs.com/hjscijg3uw.png 1.5x, https://aabb-2023.oss-cn-beijing.aliyuncs.com/hjscijg3uw.png 2x" sizes="auto" data-title="yuanshuai" data-alt="yuanshuai" class="avatar" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/>&nbsp;yuanshuai</a></span></div>
      <div class="post-meta-line"><span title="发布于 2021-10-24 18:38:23"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden="true"></i><time datetime="2021-10-24">2021-10-24</time></span>&nbsp;<span title="更新于 2021-10-24 18:38:23"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden="true"></i><time datetime="2021-10-24">2021-10-24</time></span>&nbsp;<span title="14590 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>约 14600 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>预计阅读 30 分钟</span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>目录</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1获取series的str属性使用各种字符串处理函数">1、获取Series的str属性，使用各种字符串处理函数</a></li>
        <li><a href="#2使用str的startswithcontains等得到bool的series可以做条件查询">2、使用str的startswith、contains等得到bool的Series可以做条件查询</a></li>
        <li><a href="#3需要多次str处理的链式操作">3、需要多次str处理的链式操作</a></li>
        <li><a href="#4-使用正则表达式的处理">4. 使用正则表达式的处理</a></li>
      </ul>
    </li>
    <li><a href="#11pandas的axis参数怎么理解">11、Pandas的axis参数怎么理解？</a>
      <ul>
        <li><a href="#1单列drop就是删除某一列">1、单列drop，就是删除某一列</a></li>
        <li><a href="#2单行drop就是删除某一行">2、单行drop，就是删除某一行</a></li>
        <li><a href="#3按axis0index执行mean聚合操作">3、按axis=0/index执行mean聚合操作</a></li>
        <li><a href="#4按axis1columns执行mean聚合操作">4、按axis=1/columns执行mean聚合操作</a></li>
        <li><a href="#5再次举例加深理解">5、再次举例，加深理解</a></li>
      </ul>
    </li>
    <li><a href="#12pandas的索引index的用途">12、Pandas的索引index的用途</a></li>
    <li><a href="#1使用index查询数据">1、使用index查询数据</a></li>
    <li><a href="#2-使用index会提升查询性能">2. 使用index会提升查询性能</a>
      <ul>
        <li><a href="#实验1完全随机的顺序查询">实验1：完全随机的顺序查询</a></li>
        <li><a href="#实验2将index排序后的查询">实验2：将index排序后的查询</a></li>
      </ul>
    </li>
    <li><a href="#3-使用index能自动对齐数据">3. 使用index能自动对齐数据</a></li>
    <li><a href="#4-使用index更多更强大的数据结构支持">4. 使用index更多更强大的数据结构支持</a></li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#merge的语法">merge的语法：</a></li>
        <li><a href="#1电影数据集的join实例">1、电影数据集的join实例</a></li>
        <li><a href="#2理解merge时数量的对齐关系">2、理解merge时数量的对齐关系</a></li>
        <li><a href="#3理解left-joinright-joininner-joinouter-join的区别">3、理解left join、right join、inner join、outer join的区别</a></li>
        <li><a href="#4如果出现非key的字段重名怎么办">4、如果出现非Key的字段重名怎么办</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li></li>
        <li><a href="#一使用pandasconcat合并数据">一、使用pandas.concat合并数据</a></li>
        <li><a href="#二使用dataframeappend按行合并数据">二、使用DataFrame.append按行合并数据</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#0读取源excel到pandas">0、读取源Excel到Pandas</a></li>
        <li><a href="#一将一个大excel等份拆成多个excel">一、将一个大Excel等份拆成多个Excel</a></li>
        <li><a href="#二合并多个小excel到一个大excel">二、合并多个小Excel到一个大Excel</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#一分组使用聚合函数做数据统计">一、分组使用聚合函数做数据统计</a></li>
        <li><a href="#二遍历groupby的结果理解执行流程">二、遍历groupby的结果理解执行流程</a></li>
        <li><a href="#三实例分组探索天气数据">三、实例分组探索天气数据</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#一series的分层索引multiindex">一、Series的分层索引MultiIndex</a></li>
        <li><a href="#二series有多层索引multiindex怎样筛选数据">二、Series有多层索引MultiIndex怎样筛选数据？</a></li>
        <li><a href="#三dataframe的多层索引multiindex">三、DataFrame的多层索引MultiIndex</a></li>
        <li><a href="#四dataframe有多层索引multiindex怎样筛选数据">四、DataFrame有多层索引MultiIndex怎样筛选数据？</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#1-map用于series值的转换">1. map用于Series值的转换</a></li>
        <li><a href="#2-apply用于series和dataframe的转换">2. apply用于Series和DataFrame的转换</a></li>
        <li><a href="#3-applymap用于dataframe所有值的转换">3. applymap用于DataFrame所有值的转换</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><p>: | &mdash;&mdash;&mdash;: | &mdash;&ndash;: | &mdash;&ndash;: | &mdash;&mdash;: | &mdash;&mdash;&ndash;: | &mdash;&ndash;: | &mdash;: | &mdash;&mdash;: | &mdash;&mdash;-: |
|    0 | 2018-01-01 |     3℃ |    -6℃ | 晴~多云 |    东北风 |  1-2级 |   59 |      良 |        2 |
|    1 | 2018-01-02 |     2℃ |    -5℃ | 阴~多云 |    东北风 |  1-2级 |   49 |      优 |        1 |
|    2 | 2018-01-03 |     2℃ |    -5℃ |    多云 |      北风 |  1-2级 |   28 |      优 |        1 |
|    3 | 2018-01-04 |     0℃ |    -8℃ |      阴 |    东北风 |  1-2级 |   28 |      优 |        1 |
|    4 | 2018-01-05 |     3℃ |    -6℃ | 多云~晴 |    西北风 |  1-2级 |   50 |      优 |        1 |</p>
<p>In [4]:</p>
<div class="highlight" id="id-1"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span></span></span></code></pre></div><p>Out[4]:</p>
<div class="highlight" id="id-2"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ymd</span>          <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">bWendu</span>       <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">yWendu</span>       <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">tianqi</span>       <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">fengxiang</span>    <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">fengli</span>       <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">aqi</span>           <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">aqiInfo</span>      <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">aqiLevel</span>      <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span></span></span></code></pre></div><h3 id="1获取series的str属性使用各种字符串处理函数">1、获取Series的str属性，使用各种字符串处理函数</h3>
<p>In [5]:</p>
<div class="highlight" id="id-3"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span></span></span></code></pre></div><p>Out[5]:</p>
<div class="highlight" id="id-4"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">strings</span><span class="o">.</span><span class="n">StringMethods</span> <span class="n">at</span> <span class="mh">0x1af21871808</span><span class="o">&gt;</span></span></span></code></pre></div><p>In [6]:</p>
<div class="highlight" id="id-5"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 字符串替换函数</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;℃&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span></span></span></code></pre></div><p>Out[6]:</p>
<div class="highlight" id="id-6"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mi">0</span>       <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>       <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>       <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>       <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>       <span class="mi">3</span>
</span></span><span class="line"><span class="cl">       <span class="o">..</span>
</span></span><span class="line"><span class="cl"><span class="mi">360</span>    <span class="o">-</span><span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">361</span>    <span class="o">-</span><span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">362</span>    <span class="o">-</span><span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">363</span>    <span class="o">-</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">364</span>    <span class="o">-</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">bWendu</span><span class="p">,</span> <span class="n">Length</span><span class="p">:</span> <span class="mi">365</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span></span></span></code></pre></div><p>In [7]:</p>
<div class="highlight" id="id-7"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 判断是不是数字</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()</span></span></span></code></pre></div><p>Out[7]:</p>
<div class="highlight" id="id-8"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mi">0</span>      <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>      <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>      <span class="kc">False</span>
</span></span><span class="line"><span class="cl">       <span class="o">...</span>  
</span></span><span class="line"><span class="cl"><span class="mi">360</span>    <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="mi">361</span>    <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="mi">362</span>    <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="mi">363</span>    <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="mi">364</span>    <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">bWendu</span><span class="p">,</span> <span class="n">Length</span><span class="p">:</span> <span class="mi">365</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">bool</span></span></span></code></pre></div><p>In [8]:</p>
<div class="highlight" id="id-9"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;aqi&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="o">---------------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="ne">AttributeError</span>                            <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">8</span><span class="o">-</span><span class="mi">12</span><span class="n">cdcbdb6f81</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;aqi&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">d</span><span class="p">:</span>\<span class="n">appdata</span>\<span class="n">python37</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">pandas</span>\<span class="n">core</span>\<span class="n">generic</span><span class="o">.</span><span class="n">py</span> <span class="ow">in</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">5173</span>             <span class="ow">or</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accessors</span>
</span></span><span class="line"><span class="cl">   <span class="mi">5174</span>         <span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">-&gt;</span> <span class="mi">5175</span>             <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">5176</span>         <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="mi">5177</span>             <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_axis</span><span class="o">.</span><span class="n">_can_hold_identifiers_and_holds_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">d</span><span class="p">:</span>\<span class="n">appdata</span>\<span class="n">python37</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">pandas</span>\<span class="n">core</span>\<span class="n">accessor</span><span class="o">.</span><span class="n">py</span> <span class="ow">in</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">173</span>             <span class="c1"># we&#39;re accessing the attribute of the class, i.e., Dataset.geo</span>
</span></span><span class="line"><span class="cl">    <span class="mi">174</span>             <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accessor</span>
</span></span><span class="line"><span class="cl"><span class="o">--&gt;</span> <span class="mi">175</span>         <span class="n">accessor_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accessor</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">176</span>         <span class="c1"># Replace the property with the accessor object. Inspired by:</span>
</span></span><span class="line"><span class="cl">    <span class="mi">177</span>         <span class="c1"># http://www.pydanny.com/cached-property.html</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">d</span><span class="p">:</span>\<span class="n">appdata</span>\<span class="n">python37</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">pandas</span>\<span class="n">core</span>\<span class="n">strings</span><span class="o">.</span><span class="n">py</span> <span class="ow">in</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">1915</span> 
</span></span><span class="line"><span class="cl">   <span class="mi">1916</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">-&gt;</span> <span class="mi">1917</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_inferred_dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">1918</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_is_categorical</span> <span class="o">=</span> <span class="n">is_categorical_dtype</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">1919</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">d</span><span class="p">:</span>\<span class="n">appdata</span>\<span class="n">python37</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">pandas</span>\<span class="n">core</span>\<span class="n">strings</span><span class="o">.</span><span class="n">py</span> <span class="ow">in</span> <span class="n">_validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">1965</span> 
</span></span><span class="line"><span class="cl">   <span class="mi">1966</span>         <span class="k">if</span> <span class="n">inferred_dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_types</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">-&gt;</span> <span class="mi">1967</span>             <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&#34;Can only use .str accessor with string &#34;</span> <span class="s2">&#34;values!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">1968</span>         <span class="k">return</span> <span class="n">inferred_dtype</span>
</span></span><span class="line"><span class="cl">   <span class="mi">1969</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="ne">AttributeError</span><span class="p">:</span> <span class="n">Can</span> <span class="n">only</span> <span class="n">use</span> <span class="o">.</span><span class="n">str</span> <span class="n">accessor</span> <span class="k">with</span> <span class="n">string</span> <span class="n">values</span><span class="err">!</span></span></span></code></pre></div><h3 id="2使用str的startswithcontains等得到bool的series可以做条件查询">2、使用str的startswith、contains等得到bool的Series可以做条件查询</h3>
<p>In [9]:</p>
<div class="highlight" id="id-10"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">condition</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;ymd&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&#34;2018-03&#34;</span><span class="p">)</span></span></span></code></pre></div><p>In [10]:</p>
<div class="highlight" id="id-11"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">condition</span></span></span></code></pre></div><p>Out[10]:</p>
<div class="highlight" id="id-12"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mi">0</span>      <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>      <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>      <span class="kc">False</span>
</span></span><span class="line"><span class="cl">       <span class="o">...</span>  
</span></span><span class="line"><span class="cl"><span class="mi">360</span>    <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="mi">361</span>    <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="mi">362</span>    <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="mi">363</span>    <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="mi">364</span>    <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">ymd</span><span class="p">,</span> <span class="n">Length</span><span class="p">:</span> <span class="mi">365</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">bool</span></span></span></code></pre></div><p>In [11]:</p>
<div class="highlight" id="id-13"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="n">condition</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[11]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">59</td>
<td style="text-align:right">2018-03-01</td>
<td style="text-align:right">8℃</td>
<td style="text-align:right">-3℃</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">西南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">46</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">60</td>
<td style="text-align:right">2018-03-02</td>
<td style="text-align:right">9℃</td>
<td style="text-align:right">-1℃</td>
<td style="text-align:right">晴~多云</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">95</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">61</td>
<td style="text-align:right">2018-03-03</td>
<td style="text-align:right">13℃</td>
<td style="text-align:right">3℃</td>
<td style="text-align:right">多云~阴</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">214</td>
<td style="text-align:right">重度污染</td>
<td style="text-align:right">5</td>
</tr>
<tr>
<td style="text-align:right">62</td>
<td style="text-align:right">2018-03-04</td>
<td style="text-align:right">7℃</td>
<td style="text-align:right">-2℃</td>
<td style="text-align:right">阴~多云</td>
<td style="text-align:right">东南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">144</td>
<td style="text-align:right">轻度污染</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">63</td>
<td style="text-align:right">2018-03-05</td>
<td style="text-align:right">8℃</td>
<td style="text-align:right">-3℃</td>
<td style="text-align:right">晴</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">94</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
</tbody>
</table>
<h3 id="3需要多次str处理的链式操作">3、需要多次str处理的链式操作</h3>
<p>怎样提取201803这样的数字月份？
1、先将日期2018-03-31替换成20180331的形式
2、提取月份字符串201803</p>
<p>In [12]:</p>
<div class="highlight" id="id-14"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;ymd&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;-&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span></span></span></code></pre></div><p>Out[12]:</p>
<div class="highlight" id="id-15"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mi">0</span>      <span class="mi">20180101</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="mi">20180102</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="mi">20180103</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>      <span class="mi">20180104</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>      <span class="mi">20180105</span>
</span></span><span class="line"><span class="cl">         <span class="o">...</span>   
</span></span><span class="line"><span class="cl"><span class="mi">360</span>    <span class="mi">20181227</span>
</span></span><span class="line"><span class="cl"><span class="mi">361</span>    <span class="mi">20181228</span>
</span></span><span class="line"><span class="cl"><span class="mi">362</span>    <span class="mi">20181229</span>
</span></span><span class="line"><span class="cl"><span class="mi">363</span>    <span class="mi">20181230</span>
</span></span><span class="line"><span class="cl"><span class="mi">364</span>    <span class="mi">20181231</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">ymd</span><span class="p">,</span> <span class="n">Length</span><span class="p">:</span> <span class="mi">365</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span></span></span></code></pre></div><p>In [13]:</p>
<div class="highlight" id="id-16"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 每次调用函数，都返回一个新Series</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;ymd&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;-&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">---------------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="ne">AttributeError</span>                            <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">13</span><span class="o">-</span><span class="n">ae278fb12255</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="mi">1</span> <span class="c1"># 每次调用函数，都返回一个新Series</span>
</span></span><span class="line"><span class="cl"><span class="o">----&gt;</span> <span class="mi">2</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;ymd&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;-&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">d</span><span class="p">:</span>\<span class="n">appdata</span>\<span class="n">python37</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">pandas</span>\<span class="n">core</span>\<span class="n">generic</span><span class="o">.</span><span class="n">py</span> <span class="ow">in</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">5177</span>             <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_axis</span><span class="o">.</span><span class="n">_can_hold_identifiers_and_holds_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">   <span class="mi">5178</span>                 <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="o">-&gt;</span> <span class="mi">5179</span>             <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">5180</span> 
</span></span><span class="line"><span class="cl">   <span class="mi">5181</span>     <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="ne">AttributeError</span><span class="p">:</span> <span class="s1">&#39;Series&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s1">&#39;slice&#39;</span></span></span></code></pre></div><p>In [14]:</p>
<div class="highlight" id="id-17"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;ymd&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;-&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span></span></span></code></pre></div><p>Out[14]:</p>
<div class="highlight" id="id-18"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mi">0</span>      <span class="mi">201801</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="mi">201801</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="mi">201801</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>      <span class="mi">201801</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>      <span class="mi">201801</span>
</span></span><span class="line"><span class="cl">        <span class="o">...</span>  
</span></span><span class="line"><span class="cl"><span class="mi">360</span>    <span class="mi">201812</span>
</span></span><span class="line"><span class="cl"><span class="mi">361</span>    <span class="mi">201812</span>
</span></span><span class="line"><span class="cl"><span class="mi">362</span>    <span class="mi">201812</span>
</span></span><span class="line"><span class="cl"><span class="mi">363</span>    <span class="mi">201812</span>
</span></span><span class="line"><span class="cl"><span class="mi">364</span>    <span class="mi">201812</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">ymd</span><span class="p">,</span> <span class="n">Length</span><span class="p">:</span> <span class="mi">365</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span></span></span></code></pre></div><p>In [15]:</p>
<div class="highlight" id="id-19"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># slice就是切片语法，可以直接用</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;ymd&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;-&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span></span></span></code></pre></div><p>Out[15]:</p>
<div class="highlight" id="id-20"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mi">0</span>      <span class="mi">201801</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="mi">201801</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="mi">201801</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>      <span class="mi">201801</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>      <span class="mi">201801</span>
</span></span><span class="line"><span class="cl">        <span class="o">...</span>  
</span></span><span class="line"><span class="cl"><span class="mi">360</span>    <span class="mi">201812</span>
</span></span><span class="line"><span class="cl"><span class="mi">361</span>    <span class="mi">201812</span>
</span></span><span class="line"><span class="cl"><span class="mi">362</span>    <span class="mi">201812</span>
</span></span><span class="line"><span class="cl"><span class="mi">363</span>    <span class="mi">201812</span>
</span></span><span class="line"><span class="cl"><span class="mi">364</span>    <span class="mi">201812</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">ymd</span><span class="p">,</span> <span class="n">Length</span><span class="p">:</span> <span class="mi">365</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span></span></span></code></pre></div><h3 id="4-使用正则表达式的处理">4. 使用正则表达式的处理</h3>
<p>In [16]:</p>
<div class="highlight" id="id-21"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 添加新列</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_nianyueri</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">day</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s2">&#34;ymd&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">年</span><span class="si">{</span><span class="n">month</span><span class="si">}</span><span class="s2">月</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">日&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;中文日期&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_nianyueri</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span></span></code></pre></div><p>In [17]:</p>
<div class="highlight" id="id-22"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;中文日期&#34;</span><span class="p">]</span></span></span></code></pre></div><p>Out[17]:</p>
<div class="highlight" id="id-23"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mi">0</span>      <span class="mi">2018</span><span class="n">年01月01日</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="mi">2018</span><span class="n">年01月02日</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="mi">2018</span><span class="n">年01月03日</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>      <span class="mi">2018</span><span class="n">年01月04日</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>      <span class="mi">2018</span><span class="n">年01月05日</span>
</span></span><span class="line"><span class="cl">          <span class="o">...</span>     
</span></span><span class="line"><span class="cl"><span class="mi">360</span>    <span class="mi">2018</span><span class="n">年12月27日</span>
</span></span><span class="line"><span class="cl"><span class="mi">361</span>    <span class="mi">2018</span><span class="n">年12月28日</span>
</span></span><span class="line"><span class="cl"><span class="mi">362</span>    <span class="mi">2018</span><span class="n">年12月29日</span>
</span></span><span class="line"><span class="cl"><span class="mi">363</span>    <span class="mi">2018</span><span class="n">年12月30日</span>
</span></span><span class="line"><span class="cl"><span class="mi">364</span>    <span class="mi">2018</span><span class="n">年12月31日</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">中文日期</span><span class="p">,</span> <span class="n">Length</span><span class="p">:</span> <span class="mi">365</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span></span></span></code></pre></div><p>问题：怎样将“2018年12月31日”中的年、月、日三个中文字符去除？</p>
<p>In [18]:</p>
<div class="highlight" id="id-24"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 方法1：链式replace</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;中文日期&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;年&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;月&#34;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;日&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span></span></span></code></pre></div><p>Out[18]:</p>
<div class="highlight" id="id-25"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mi">0</span>      <span class="mi">20180101</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="mi">20180102</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="mi">20180103</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>      <span class="mi">20180104</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>      <span class="mi">20180105</span>
</span></span><span class="line"><span class="cl">         <span class="o">...</span>   
</span></span><span class="line"><span class="cl"><span class="mi">360</span>    <span class="mi">20181227</span>
</span></span><span class="line"><span class="cl"><span class="mi">361</span>    <span class="mi">20181228</span>
</span></span><span class="line"><span class="cl"><span class="mi">362</span>    <span class="mi">20181229</span>
</span></span><span class="line"><span class="cl"><span class="mi">363</span>    <span class="mi">20181230</span>
</span></span><span class="line"><span class="cl"><span class="mi">364</span>    <span class="mi">20181231</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">中文日期</span><span class="p">,</span> <span class="n">Length</span><span class="p">:</span> <span class="mi">365</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span></span></span></code></pre></div><p>*<strong>Series.str默认就开启了正则表达式模式*</strong></p>
<p>In [19]:</p>
<div class="highlight" id="id-26"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 方法2：正则表达式替换</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;中文日期&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;[年月日]&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span></span></span></code></pre></div><p>Out[19]:</p>
<div class="highlight" id="id-27"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mi">0</span>      <span class="mi">20180101</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="mi">20180102</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="mi">20180103</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>      <span class="mi">20180104</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>      <span class="mi">20180105</span>
</span></span><span class="line"><span class="cl">         <span class="o">...</span>   
</span></span><span class="line"><span class="cl"><span class="mi">360</span>    <span class="mi">20181227</span>
</span></span><span class="line"><span class="cl"><span class="mi">361</span>    <span class="mi">20181228</span>
</span></span><span class="line"><span class="cl"><span class="mi">362</span>    <span class="mi">20181229</span>
</span></span><span class="line"><span class="cl"><span class="mi">363</span>    <span class="mi">20181230</span>
</span></span><span class="line"><span class="cl"><span class="mi">364</span>    <span class="mi">20181231</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">中文日期</span><span class="p">,</span> <span class="n">Length</span><span class="p">:</span> <span class="mi">365</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span></span></span></code></pre></div><h2 id="11pandas的axis参数怎么理解">11、Pandas的axis参数怎么理解？</h2>
<ul>
<li>
<p>axis=0或者&quot;index&quot;：</p>
<ul>
<li>如果是单行操作，就指的是某一行</li>
<li>如果是聚合操作，指的是跨行cross rows</li>
</ul>
</li>
<li>
<p>axis=1或者&quot;columns&quot;：</p>
<ul>
<li>
<p>如果是单列操作，就指的是某一列</p>
</li>
<li>
<p>如果是聚合操作，指的是跨列cross columns</p>
<p>*<strong>按哪个axis，就是这个axis要动起来(类似被for遍历)，其它的axis保持不动*</strong></p>
</li>
</ul>
</li>
</ul>
<p>In [1]:</p>
<div class="highlight" id="id-28"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></span></span></code></pre></div><p>In [2]:</p>
<div class="highlight" id="id-29"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span></span></span></code></pre></div><p>In [3]:</p>
<pre tabindex="0"><code>df</code></pre><p>Out[3]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">6</td>
<td style="text-align:right">7</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">8</td>
<td style="text-align:right">9</td>
<td style="text-align:right">10</td>
<td style="text-align:right">11</td>
</tr>
</tbody>
</table>
<h3 id="1单列drop就是删除某一列">1、单列drop，就是删除某一列</h3>
<p>In [4]:</p>
<div class="highlight" id="id-31"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 代表的就是删除某列</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&#34;A&#34;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span></span></code></pre></div><p>Out[4]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">5</td>
<td style="text-align:right">6</td>
<td style="text-align:right">7</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">9</td>
<td style="text-align:right">10</td>
<td style="text-align:right">11</td>
</tr>
</tbody>
</table>
<h3 id="2单行drop就是删除某一行">2、单行drop，就是删除某一行</h3>
<p>In [5]:</p>
<div class="highlight" id="id-32"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span></span></span></code></pre></div><p>Out[5]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">6</td>
<td style="text-align:right">7</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">8</td>
<td style="text-align:right">9</td>
<td style="text-align:right">10</td>
<td style="text-align:right">11</td>
</tr>
</tbody>
</table>
<p>In [6]:</p>
<div class="highlight" id="id-33"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 代表的就是删除某行</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></span></span></code></pre></div><p>Out[6]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">8</td>
<td style="text-align:right">9</td>
<td style="text-align:right">10</td>
<td style="text-align:right">11</td>
</tr>
</tbody>
</table>
<h3 id="3按axis0index执行mean聚合操作">3、按axis=0/index执行mean聚合操作</h3>
<p>反直觉：输出的不是每行的结果，而是每列的结果</p>
<p>In [7]:</p>
<div class="highlight" id="id-34"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span></span></span></code></pre></div><p>Out[7]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">6</td>
<td style="text-align:right">7</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">8</td>
<td style="text-align:right">9</td>
<td style="text-align:right">10</td>
<td style="text-align:right">11</td>
</tr>
</tbody>
</table>
<p>In [8]:</p>
<div class="highlight" id="id-35"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># axis=0 or axis=index</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></span></span></code></pre></div><p>Out[8]:</p>
<div class="highlight" id="id-36"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">A</span>    <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl"><span class="n">B</span>    <span class="mf">5.0</span>
</span></span><span class="line"><span class="cl"><span class="n">C</span>    <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl"><span class="n">D</span>    <span class="mf">7.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span></span></span></code></pre></div><p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/1.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/1.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/1.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/1.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/1.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/1.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>*<strong>指定了按哪个axis，就是这个axis要动起来(类似被for遍历)，其它的axis保持不动*</strong></p>
<h3 id="4按axis1columns执行mean聚合操作">4、按axis=1/columns执行mean聚合操作</h3>
<p>反直觉：输出的不是每行的结果，而是每列的结果</p>
<p>In [9]:</p>
<div class="highlight" id="id-37"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span></span></span></code></pre></div><p>Out[9]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">6</td>
<td style="text-align:right">7</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">8</td>
<td style="text-align:right">9</td>
<td style="text-align:right">10</td>
<td style="text-align:right">11</td>
</tr>
</tbody>
</table>
<p>In [10]:</p>
<div class="highlight" id="id-38"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># axis=1 or axis=columns</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span></span></code></pre></div><p>Out[10]:</p>
<div class="highlight" id="id-39"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mi">0</span>    <span class="mf">1.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="mf">5.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="mf">9.5</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span></span></span></code></pre></div><p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/2.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/2.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/2.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/2.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/2.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/2.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>*<strong>指定了按哪个axis，就是这个axis要动起来(类似被for遍历)，其它的axis保持不动*</strong></p>
<h3 id="5再次举例加深理解">5、再次举例，加深理解</h3>
<p>In [11]:</p>
<div class="highlight" id="id-40"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_sum_value</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="s2">&#34;A&#34;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s2">&#34;B&#34;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s2">&#34;C&#34;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s2">&#34;D&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;sum_value&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_sum_value</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span></span></code></pre></div><p>In [12]:</p>
<pre tabindex="0"><code>df</code></pre><p>Out[12]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
<th style="text-align:right">sum_value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">6</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">6</td>
<td style="text-align:right">7</td>
<td style="text-align:right">22</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">8</td>
<td style="text-align:right">9</td>
<td style="text-align:right">10</td>
<td style="text-align:right">11</td>
<td style="text-align:right">38</td>
</tr>
</tbody>
</table>
<p>*<strong>指定了按哪个axis，就是这个axis要动起来(类似被for遍历)，其它的axis保持不动*</strong></p>
<h2 id="12pandas的索引index的用途">12、Pandas的索引index的用途</h2>
<p>把数据存储于普通的column列也能用于数据查询，那使用index有什么好处？</p>
<p>index的用途总结：</p>
<ol>
<li>更方便的数据查询；</li>
<li>使用index可以获得性能提升；</li>
<li>自动的数据对齐功能；</li>
<li>更多更强大的数据结构支持；</li>
</ol>
<p>In [1]:</p>
<div class="highlight" id="id-42"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span></span></span></code></pre></div><p>In [2]:</p>
<div class="highlight" id="id-43"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&#34;./datas/ml-latest-small/ratings.csv&#34;</span><span class="p">)</span></span></span></code></pre></div><p>In [3]:</p>
<div class="highlight" id="id-44"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[3]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">userId</th>
<th style="text-align:right">movieId</th>
<th style="text-align:right">rating</th>
<th style="text-align:right">timestamp</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">4.0</td>
<td style="text-align:right">964982703</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3</td>
<td style="text-align:right">4.0</td>
<td style="text-align:right">964981247</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">6</td>
<td style="text-align:right">4.0</td>
<td style="text-align:right">964982224</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">47</td>
<td style="text-align:right">5.0</td>
<td style="text-align:right">964983815</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
<td style="text-align:right">50</td>
<td style="text-align:right">5.0</td>
<td style="text-align:right">964982931</td>
</tr>
</tbody>
</table>
<p>In [4]:</p>
<div class="highlight" id="id-45"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span></span></span></code></pre></div><p>Out[4]:</p>
<div class="highlight" id="id-46"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">userId</span>       <span class="mi">100836</span>
</span></span><span class="line"><span class="cl"><span class="n">movieId</span>      <span class="mi">100836</span>
</span></span><span class="line"><span class="cl"><span class="n">rating</span>       <span class="mi">100836</span>
</span></span><span class="line"><span class="cl"><span class="n">timestamp</span>    <span class="mi">100836</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span></span></span></code></pre></div><h2 id="1使用index查询数据">1、使用index查询数据</h2>
<p>In [5]:</p>
<div class="highlight" id="id-47"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># drop==False，让索引列还保持在column</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&#34;userId&#34;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span></span></code></pre></div><p>In [6]:</p>
<div class="highlight" id="id-48"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[6]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">userId</th>
<th style="text-align:right">movieId</th>
<th style="text-align:right">rating</th>
<th style="text-align:right">timestamp</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">userId</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">4.0</td>
<td style="text-align:right">964982703</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3</td>
<td style="text-align:right">4.0</td>
<td style="text-align:right">964981247</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">6</td>
<td style="text-align:right">4.0</td>
<td style="text-align:right">964982224</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">47</td>
<td style="text-align:right">5.0</td>
<td style="text-align:right">964983815</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">50</td>
<td style="text-align:right">5.0</td>
<td style="text-align:right">964982931</td>
</tr>
</tbody>
</table>
<p>In [7]:</p>
<div class="highlight" id="id-49"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">index</span></span></span></code></pre></div><p>Out[7]:</p>
<div class="highlight" id="id-50"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">Int64Index</span><span class="p">([</span>  <span class="mi">1</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="o">...</span>
</span></span><span class="line"><span class="cl">            <span class="mi">610</span><span class="p">,</span> <span class="mi">610</span><span class="p">,</span> <span class="mi">610</span><span class="p">,</span> <span class="mi">610</span><span class="p">,</span> <span class="mi">610</span><span class="p">,</span> <span class="mi">610</span><span class="p">,</span> <span class="mi">610</span><span class="p">,</span> <span class="mi">610</span><span class="p">,</span> <span class="mi">610</span><span class="p">,</span> <span class="mi">610</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">           <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int64&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;userId&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">100836</span><span class="p">)</span></span></span></code></pre></div><p>In [9]:</p>
<div class="highlight" id="id-51"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 使用index的查询方法</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">500</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span></span></span></code></pre></div><p>Out[9]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">userId</th>
<th style="text-align:right">movieId</th>
<th style="text-align:right">rating</th>
<th style="text-align:right">timestamp</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">userId</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">500</td>
<td style="text-align:right">500</td>
<td style="text-align:right">1</td>
<td style="text-align:right">4.0</td>
<td style="text-align:right">1005527755</td>
</tr>
<tr>
<td style="text-align:right">500</td>
<td style="text-align:right">500</td>
<td style="text-align:right">11</td>
<td style="text-align:right">1.0</td>
<td style="text-align:right">1005528017</td>
</tr>
<tr>
<td style="text-align:right">500</td>
<td style="text-align:right">500</td>
<td style="text-align:right">39</td>
<td style="text-align:right">1.0</td>
<td style="text-align:right">1005527926</td>
</tr>
<tr>
<td style="text-align:right">500</td>
<td style="text-align:right">500</td>
<td style="text-align:right">101</td>
<td style="text-align:right">1.0</td>
<td style="text-align:right">1005527980</td>
</tr>
<tr>
<td style="text-align:right">500</td>
<td style="text-align:right">500</td>
<td style="text-align:right">104</td>
<td style="text-align:right">4.0</td>
<td style="text-align:right">1005528065</td>
</tr>
</tbody>
</table>
<p>In [8]:</p>
<div class="highlight" id="id-52"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 使用column的condition查询方法</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;userId&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">500</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[8]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">userId</th>
<th style="text-align:right">movieId</th>
<th style="text-align:right">rating</th>
<th style="text-align:right">timestamp</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">userId</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">500</td>
<td style="text-align:right">500</td>
<td style="text-align:right">1</td>
<td style="text-align:right">4.0</td>
<td style="text-align:right">1005527755</td>
</tr>
<tr>
<td style="text-align:right">500</td>
<td style="text-align:right">500</td>
<td style="text-align:right">11</td>
<td style="text-align:right">1.0</td>
<td style="text-align:right">1005528017</td>
</tr>
<tr>
<td style="text-align:right">500</td>
<td style="text-align:right">500</td>
<td style="text-align:right">39</td>
<td style="text-align:right">1.0</td>
<td style="text-align:right">1005527926</td>
</tr>
<tr>
<td style="text-align:right">500</td>
<td style="text-align:right">500</td>
<td style="text-align:right">101</td>
<td style="text-align:right">1.0</td>
<td style="text-align:right">1005527980</td>
</tr>
<tr>
<td style="text-align:right">500</td>
<td style="text-align:right">500</td>
<td style="text-align:right">104</td>
<td style="text-align:right">4.0</td>
<td style="text-align:right">1005528065</td>
</tr>
</tbody>
</table>
<h2 id="2-使用index会提升查询性能">2. 使用index会提升查询性能</h2>
<ul>
<li>如果index是唯一的，Pandas会使用哈希表优化，查询性能为O(1);</li>
<li>如果index不是唯一的，但是有序，Pandas会使用二分查找算法，查询性能为O(logN);</li>
<li>如果index是完全随机的，那么每次查询都要扫描全表，查询性能为O(N);</li>
</ul>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/3.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/3.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/3.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/3.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/3.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/3.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="实验1完全随机的顺序查询">实验1：完全随机的顺序查询</h3>
<p>In [10]:</p>
<div class="highlight" id="id-53"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 将数据随机打散</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">shuffle</span>
</span></span><span class="line"><span class="cl"><span class="n">df_shuffle</span> <span class="o">=</span> <span class="n">shuffle</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></span></span></code></pre></div><p>In [11]:</p>
<div class="highlight" id="id-54"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_shuffle</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[11]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">userId</th>
<th style="text-align:right">movieId</th>
<th style="text-align:right">rating</th>
<th style="text-align:right">timestamp</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">userId</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">160</td>
<td style="text-align:right">160</td>
<td style="text-align:right">2340</td>
<td style="text-align:right">1.0</td>
<td style="text-align:right">985383314</td>
</tr>
<tr>
<td style="text-align:right">129</td>
<td style="text-align:right">129</td>
<td style="text-align:right">1136</td>
<td style="text-align:right">3.5</td>
<td style="text-align:right">1167375403</td>
</tr>
<tr>
<td style="text-align:right">167</td>
<td style="text-align:right">167</td>
<td style="text-align:right">44191</td>
<td style="text-align:right">4.5</td>
<td style="text-align:right">1154718915</td>
</tr>
<tr>
<td style="text-align:right">536</td>
<td style="text-align:right">536</td>
<td style="text-align:right">276</td>
<td style="text-align:right">3.0</td>
<td style="text-align:right">832839990</td>
</tr>
<tr>
<td style="text-align:right">67</td>
<td style="text-align:right">67</td>
<td style="text-align:right">5952</td>
<td style="text-align:right">2.0</td>
<td style="text-align:right">1501274082</td>
</tr>
</tbody>
</table>
<p>In [12]:</p>
<div class="highlight" id="id-55"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 索引是否是递增的</span>
</span></span><span class="line"><span class="cl"><span class="n">df_shuffle</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">is_monotonic_increasing</span></span></span></code></pre></div><p>Out[12]:</p>
<div class="highlight" id="id-56"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kc">False</span></span></span></code></pre></div><p>In [13]:</p>
<div class="highlight" id="id-57"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_shuffle</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">is_unique</span></span></span></code></pre></div><p>Out[13]:</p>
<div class="highlight" id="id-58"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kc">False</span></span></span></code></pre></div><p>In [14]:</p>
<div class="highlight" id="id-59"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 计时，查询id==500数据性能</span>
</span></span><span class="line"><span class="cl"><span class="o">%</span><span class="n">timeit</span> <span class="n">df_shuffle</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">500</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="mi">376</span> <span class="n">µs</span> <span class="err">±</span> <span class="mf">52.4</span> <span class="n">µs</span> <span class="n">per</span> <span class="n">loop</span> <span class="p">(</span><span class="n">mean</span> <span class="err">±</span> <span class="n">std</span><span class="o">.</span> <span class="n">dev</span><span class="o">.</span> <span class="n">of</span> <span class="mi">7</span> <span class="n">runs</span><span class="p">,</span> <span class="mi">1000</span> <span class="n">loops</span> <span class="n">each</span><span class="p">)</span></span></span></code></pre></div><h3 id="实验2将index排序后的查询">实验2：将index排序后的查询</h3>
<p>In [15]:</p>
<div class="highlight" id="id-60"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_sorted</span> <span class="o">=</span> <span class="n">df_shuffle</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span></span></span></code></pre></div><p>In [16]:</p>
<div class="highlight" id="id-61"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_sorted</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[16]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">userId</th>
<th style="text-align:right">movieId</th>
<th style="text-align:right">rating</th>
<th style="text-align:right">timestamp</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">userId</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2985</td>
<td style="text-align:right">4.0</td>
<td style="text-align:right">964983034</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2617</td>
<td style="text-align:right">2.0</td>
<td style="text-align:right">964982588</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3639</td>
<td style="text-align:right">4.0</td>
<td style="text-align:right">964982271</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">6</td>
<td style="text-align:right">4.0</td>
<td style="text-align:right">964982224</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">733</td>
<td style="text-align:right">4.0</td>
<td style="text-align:right">964982400</td>
</tr>
</tbody>
</table>
<p>In [17]:</p>
<div class="highlight" id="id-62"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 索引是否是递增的</span>
</span></span><span class="line"><span class="cl"><span class="n">df_sorted</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">is_monotonic_increasing</span></span></span></code></pre></div><p>Out[17]:</p>
<div class="highlight" id="id-63"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kc">True</span></span></span></code></pre></div><p>In [18]:</p>
<div class="highlight" id="id-64"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_sorted</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">is_unique</span></span></span></code></pre></div><p>Out[18]:</p>
<div class="highlight" id="id-65"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kc">False</span></span></span></code></pre></div><p>In [19]:</p>
<div class="highlight" id="id-66"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%</span><span class="n">timeit</span> <span class="n">df_sorted</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">500</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="mi">203</span> <span class="n">µs</span> <span class="err">±</span> <span class="mf">20.8</span> <span class="n">µs</span> <span class="n">per</span> <span class="n">loop</span> <span class="p">(</span><span class="n">mean</span> <span class="err">±</span> <span class="n">std</span><span class="o">.</span> <span class="n">dev</span><span class="o">.</span> <span class="n">of</span> <span class="mi">7</span> <span class="n">runs</span><span class="p">,</span> <span class="mi">1000</span> <span class="n">loops</span> <span class="n">each</span><span class="p">)</span></span></span></code></pre></div><h2 id="3-使用index能自动对齐数据">3. 使用index能自动对齐数据</h2>
<p>包括series和dataframe</p>
<p>In [20]:</p>
<div class="highlight" id="id-67"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">s1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s2">&#34;abc&#34;</span><span class="p">))</span></span></span></code></pre></div><p>In [21]:</p>
<div class="highlight" id="id-68"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">s1</span></span></span></code></pre></div><p>Out[21]:</p>
<div class="highlight" id="id-69"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">a</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span></span></span></code></pre></div><p>In [22]:</p>
<div class="highlight" id="id-70"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">s2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s2">&#34;bcd&#34;</span><span class="p">))</span></span></span></code></pre></div><p>In [23]:</p>
<div class="highlight" id="id-71"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">s2</span></span></span></code></pre></div><p>Out[23]:</p>
<div class="highlight" id="id-72"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span></span></span></code></pre></div><p>In [24]:</p>
<div class="highlight" id="id-73"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">s1</span><span class="o">+</span><span class="n">s2</span></span></span></code></pre></div><p>Out[24]:</p>
<div class="highlight" id="id-74"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">a</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span></span></span></code></pre></div><h2 id="4-使用index更多更强大的数据结构支持">4. 使用index更多更强大的数据结构支持</h2>
<p>*<strong>很多强大的索引数据结构*</strong></p>
<ul>
<li>CategoricalIndex，基于分类数据的Index，提升性能；</li>
<li>MultiIndex，多维索引，用于groupby多维聚合后结果等；</li>
<li>DatetimeIndex，时间类型索引，强大的日期和时间的方法支持；</li>
</ul>
<h1 id="13pandas怎样实现dataframe的merge">13、Pandas怎样实现DataFrame的Merge</h1>
<p>Pandas的Merge，相当于Sql的Join，将不同的表按key关联到一个表</p>
<h3 id="merge的语法">merge的语法：</h3>
<p>pd.merge(left, right, how=&lsquo;inner&rsquo;, on=None, left_on=None, right_on=None, left_index=False, right_index=False, sort=True, suffixes=(&rsquo;_x&rsquo;, &lsquo;_y&rsquo;), copy=True, indicator=False, validate=None)</p>
<ul>
<li>left，right：要merge的dataframe或者有name的Series</li>
<li>how：join类型，&rsquo;left&rsquo;, &lsquo;right&rsquo;, &lsquo;outer&rsquo;, &lsquo;inner&rsquo;</li>
<li>on：join的key，left和right都需要有这个key</li>
<li>left_on：left的df或者series的key</li>
<li>right_on：right的df或者seires的key</li>
<li>left_index，right_index：使用index而不是普通的column做join</li>
<li>suffixes：两个元素的后缀，如果列有重名，自动添加后缀，默认是(&rsquo;_x&rsquo;, &lsquo;_y&rsquo;)</li>
</ul>
<p>文档地址：https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.merge.html</p>
<p>本次讲解提纲：</p>
<ol>
<li>电影数据集的join实例</li>
<li>理解merge时一对一、一对多、多对多的数量对齐关系</li>
<li>理解left join、right join、inner join、outer join的区别</li>
<li>如果出现非Key的字段重名怎么办</li>
</ol>
<h3 id="1电影数据集的join实例">1、电影数据集的join实例</h3>
<h4 id="电影评分数据集">电影评分数据集</h4>
<p>是推荐系统研究的很好的数据集
位于本代码目录：./datas/movielens-1m</p>
<p>包含三个文件：</p>
<ol>
<li>用户对电影的评分数据 ratings.dat</li>
<li>用户本身的信息数据 users.dat</li>
<li>电影本身的数据 movies.dat</li>
</ol>
<p>可以关联三个表，得到一个完整的大表</p>
<p>数据集官方地址：https://grouplens.org/datasets/movielens/</p>
<p>In [1]:</p>
<div class="highlight" id="id-75"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span></span></span></code></pre></div><p>In [2]:</p>
<div class="highlight" id="id-76"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_ratings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;./datas/movielens-1m/ratings.dat&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">sep</span><span class="o">=</span><span class="s2">&#34;::&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">names</span><span class="o">=</span><span class="s2">&#34;UserID::MovieID::Rating::Timestamp&#34;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;::&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span></span></span></code></pre></div><p>In [3]:</p>
<div class="highlight" id="id-77"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_ratings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[3]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">UserID</th>
<th style="text-align:right">MovieID</th>
<th style="text-align:right">Rating</th>
<th style="text-align:right">Timestamp</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1193</td>
<td style="text-align:right">5</td>
<td style="text-align:right">978300760</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">661</td>
<td style="text-align:right">3</td>
<td style="text-align:right">978302109</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">914</td>
<td style="text-align:right">3</td>
<td style="text-align:right">978301968</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3408</td>
<td style="text-align:right">4</td>
<td style="text-align:right">978300275</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2355</td>
<td style="text-align:right">5</td>
<td style="text-align:right">978824291</td>
</tr>
</tbody>
</table>
<p>In [4]:</p>
<div class="highlight" id="id-78"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_users</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;./datas/movielens-1m/users.dat&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">sep</span><span class="o">=</span><span class="s2">&#34;::&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">names</span><span class="o">=</span><span class="s2">&#34;UserID::Gender::Age::Occupation::Zip-code&#34;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;::&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span></span></span></code></pre></div><p>In [5]:</p>
<div class="highlight" id="id-79"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_users</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[5]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">UserID</th>
<th style="text-align:right">Gender</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">Occupation</th>
<th style="text-align:right">Zip-code</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">F</td>
<td style="text-align:right">1</td>
<td style="text-align:right">10</td>
<td style="text-align:right">48067</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">M</td>
<td style="text-align:right">56</td>
<td style="text-align:right">16</td>
<td style="text-align:right">70072</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">M</td>
<td style="text-align:right">25</td>
<td style="text-align:right">15</td>
<td style="text-align:right">55117</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">M</td>
<td style="text-align:right">45</td>
<td style="text-align:right">7</td>
<td style="text-align:right">02460</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">M</td>
<td style="text-align:right">25</td>
<td style="text-align:right">20</td>
<td style="text-align:right">55455</td>
</tr>
</tbody>
</table>
<p>In [6]:</p>
<div class="highlight" id="id-80"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_movies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;./datas/movielens-1m/movies.dat&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">sep</span><span class="o">=</span><span class="s2">&#34;::&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">names</span><span class="o">=</span><span class="s2">&#34;MovieID::Title::Genres&#34;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;::&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span></span></span></code></pre></div><p>In [7]:</p>
<div class="highlight" id="id-81"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_movies</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[7]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">MovieID</th>
<th style="text-align:right">Title</th>
<th style="text-align:right">Genres</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Toy Story (1995)</td>
<td style="text-align:right">Animation|Children&rsquo;s|Comedy</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">Jumanji (1995)</td>
<td style="text-align:right">Adventure|Children&rsquo;s|Fantasy</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Grumpier Old Men (1995)</td>
<td style="text-align:right">Comedy|Romance</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">Waiting to Exhale (1995)</td>
<td style="text-align:right">Comedy|Drama</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">Father of the Bride Part II (1995)</td>
<td style="text-align:right">Comedy</td>
</tr>
</tbody>
</table>
<p>In [8]:</p>
<div class="highlight" id="id-82"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_ratings_users</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">   <span class="n">df_ratings</span><span class="p">,</span> <span class="n">df_users</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&#34;UserID&#34;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&#34;UserID&#34;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&#34;inner&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span></span></span></code></pre></div><p>In [9]:</p>
<div class="highlight" id="id-83"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_ratings_users</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[9]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">UserID</th>
<th style="text-align:right">MovieID</th>
<th style="text-align:right">Rating</th>
<th style="text-align:right">Timestamp</th>
<th style="text-align:right">Gender</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">Occupation</th>
<th style="text-align:right">Zip-code</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1193</td>
<td style="text-align:right">5</td>
<td style="text-align:right">978300760</td>
<td style="text-align:right">F</td>
<td style="text-align:right">1</td>
<td style="text-align:right">10</td>
<td style="text-align:right">48067</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">661</td>
<td style="text-align:right">3</td>
<td style="text-align:right">978302109</td>
<td style="text-align:right">F</td>
<td style="text-align:right">1</td>
<td style="text-align:right">10</td>
<td style="text-align:right">48067</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">914</td>
<td style="text-align:right">3</td>
<td style="text-align:right">978301968</td>
<td style="text-align:right">F</td>
<td style="text-align:right">1</td>
<td style="text-align:right">10</td>
<td style="text-align:right">48067</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3408</td>
<td style="text-align:right">4</td>
<td style="text-align:right">978300275</td>
<td style="text-align:right">F</td>
<td style="text-align:right">1</td>
<td style="text-align:right">10</td>
<td style="text-align:right">48067</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2355</td>
<td style="text-align:right">5</td>
<td style="text-align:right">978824291</td>
<td style="text-align:right">F</td>
<td style="text-align:right">1</td>
<td style="text-align:right">10</td>
<td style="text-align:right">48067</td>
</tr>
</tbody>
</table>
<p>In [10]:</p>
<div class="highlight" id="id-84"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_ratings_users_movies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_ratings_users</span><span class="p">,</span> <span class="n">df_movies</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&#34;MovieID&#34;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&#34;MovieID&#34;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&#34;inner&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span></span></span></code></pre></div><p>In [11]:</p>
<div class="highlight" id="id-85"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_ratings_users_movies</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span></span></span></code></pre></div><p>Out[11]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">UserID</th>
<th style="text-align:right">MovieID</th>
<th style="text-align:right">Rating</th>
<th style="text-align:right">Timestamp</th>
<th style="text-align:right">Gender</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">Occupation</th>
<th style="text-align:right">Zip-code</th>
<th style="text-align:right">Title</th>
<th style="text-align:right">Genres</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1193</td>
<td style="text-align:right">5</td>
<td style="text-align:right">978300760</td>
<td style="text-align:right">F</td>
<td style="text-align:right">1</td>
<td style="text-align:right">10</td>
<td style="text-align:right">48067</td>
<td style="text-align:right">One Flew Over the Cuckoo&rsquo;s Nest (1975)</td>
<td style="text-align:right">Drama</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">1193</td>
<td style="text-align:right">5</td>
<td style="text-align:right">978298413</td>
<td style="text-align:right">M</td>
<td style="text-align:right">56</td>
<td style="text-align:right">16</td>
<td style="text-align:right">70072</td>
<td style="text-align:right">One Flew Over the Cuckoo&rsquo;s Nest (1975)</td>
<td style="text-align:right">Drama</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">12</td>
<td style="text-align:right">1193</td>
<td style="text-align:right">4</td>
<td style="text-align:right">978220179</td>
<td style="text-align:right">M</td>
<td style="text-align:right">25</td>
<td style="text-align:right">12</td>
<td style="text-align:right">32793</td>
<td style="text-align:right">One Flew Over the Cuckoo&rsquo;s Nest (1975)</td>
<td style="text-align:right">Drama</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">15</td>
<td style="text-align:right">1193</td>
<td style="text-align:right">4</td>
<td style="text-align:right">978199279</td>
<td style="text-align:right">M</td>
<td style="text-align:right">25</td>
<td style="text-align:right">7</td>
<td style="text-align:right">22903</td>
<td style="text-align:right">One Flew Over the Cuckoo&rsquo;s Nest (1975)</td>
<td style="text-align:right">Drama</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">17</td>
<td style="text-align:right">1193</td>
<td style="text-align:right">5</td>
<td style="text-align:right">978158471</td>
<td style="text-align:right">M</td>
<td style="text-align:right">50</td>
<td style="text-align:right">1</td>
<td style="text-align:right">95350</td>
<td style="text-align:right">One Flew Over the Cuckoo&rsquo;s Nest (1975)</td>
<td style="text-align:right">Drama</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">18</td>
<td style="text-align:right">1193</td>
<td style="text-align:right">4</td>
<td style="text-align:right">978156168</td>
<td style="text-align:right">F</td>
<td style="text-align:right">18</td>
<td style="text-align:right">3</td>
<td style="text-align:right">95825</td>
<td style="text-align:right">One Flew Over the Cuckoo&rsquo;s Nest (1975)</td>
<td style="text-align:right">Drama</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">19</td>
<td style="text-align:right">1193</td>
<td style="text-align:right">5</td>
<td style="text-align:right">982730936</td>
<td style="text-align:right">M</td>
<td style="text-align:right">1</td>
<td style="text-align:right">10</td>
<td style="text-align:right">48073</td>
<td style="text-align:right">One Flew Over the Cuckoo&rsquo;s Nest (1975)</td>
<td style="text-align:right">Drama</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">24</td>
<td style="text-align:right">1193</td>
<td style="text-align:right">5</td>
<td style="text-align:right">978136709</td>
<td style="text-align:right">F</td>
<td style="text-align:right">25</td>
<td style="text-align:right">7</td>
<td style="text-align:right">10023</td>
<td style="text-align:right">One Flew Over the Cuckoo&rsquo;s Nest (1975)</td>
<td style="text-align:right">Drama</td>
</tr>
<tr>
<td style="text-align:right">8</td>
<td style="text-align:right">28</td>
<td style="text-align:right">1193</td>
<td style="text-align:right">3</td>
<td style="text-align:right">978125194</td>
<td style="text-align:right">F</td>
<td style="text-align:right">25</td>
<td style="text-align:right">1</td>
<td style="text-align:right">14607</td>
<td style="text-align:right">One Flew Over the Cuckoo&rsquo;s Nest (1975)</td>
<td style="text-align:right">Drama</td>
</tr>
<tr>
<td style="text-align:right">9</td>
<td style="text-align:right">33</td>
<td style="text-align:right">1193</td>
<td style="text-align:right">5</td>
<td style="text-align:right">978557765</td>
<td style="text-align:right">M</td>
<td style="text-align:right">45</td>
<td style="text-align:right">3</td>
<td style="text-align:right">55421</td>
<td style="text-align:right">One Flew Over the Cuckoo&rsquo;s Nest (1975)</td>
<td style="text-align:right">Drama</td>
</tr>
</tbody>
</table>
<h3 id="2理解merge时数量的对齐关系">2、理解merge时数量的对齐关系</h3>
<p>以下关系要正确理解：</p>
<ul>
<li>one-to-one：一对一关系，关联的key都是唯一的
<ul>
<li>比如(学号，姓名) merge (学号，年龄)</li>
<li>结果条数为：1*1</li>
</ul>
</li>
<li>one-to-many：一对多关系，左边唯一key，右边不唯一key
<ul>
<li>比如(学号，姓名) merge (学号，[语文成绩、数学成绩、英语成绩])</li>
<li>结果条数为：1*N</li>
</ul>
</li>
<li>many-to-many：多对多关系，左边右边都不是唯一的
<ul>
<li>比如（学号，[语文成绩、数学成绩、英语成绩]） merge (学号，[篮球、足球、乒乓球])</li>
<li>结果条数为：M*N</li>
</ul>
</li>
</ul>
<h4 id="21-one-to-one-一对一关系的merge">2.1 one-to-one 一对一关系的merge</h4>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/4.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/4.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/4.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/4.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/4.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/4.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>In[12]:</p>
<div class="highlight" id="id-86"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">left</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;sno&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;name_a&#39;</span><span class="p">,</span> <span class="s1">&#39;name_b&#39;</span><span class="p">,</span> <span class="s1">&#39;name_c&#39;</span><span class="p">,</span> <span class="s1">&#39;name_d&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">left</span></span></span></code></pre></div><p>Out[12]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">sno</th>
<th style="text-align:right">name</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">11</td>
<td style="text-align:right">name_a</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">12</td>
<td style="text-align:right">name_b</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">13</td>
<td style="text-align:right">name_c</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">14</td>
<td style="text-align:right">name_d</td>
</tr>
</tbody>
</table>
<p>In [13]:</p>
<div class="highlight" id="id-87"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">right</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;sno&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;21&#39;</span><span class="p">,</span> <span class="s1">&#39;22&#39;</span><span class="p">,</span> <span class="s1">&#39;23&#39;</span><span class="p">,</span> <span class="s1">&#39;24&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">right</span></span></span></code></pre></div><p>Out[13]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">sno</th>
<th style="text-align:right">age</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">11</td>
<td style="text-align:right">21</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">12</td>
<td style="text-align:right">22</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">13</td>
<td style="text-align:right">23</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">14</td>
<td style="text-align:right">24</td>
</tr>
</tbody>
</table>
<p>In [14]:</p>
<div class="highlight" id="id-88"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 一对一关系，结果中有4条</span>
</span></span><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;sno&#39;</span><span class="p">)</span></span></span></code></pre></div><p>Out[14]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">sno</th>
<th style="text-align:right">name</th>
<th style="text-align:right">age</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">11</td>
<td style="text-align:right">name_a</td>
<td style="text-align:right">21</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">12</td>
<td style="text-align:right">name_b</td>
<td style="text-align:right">22</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">13</td>
<td style="text-align:right">name_c</td>
<td style="text-align:right">23</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">14</td>
<td style="text-align:right">name_d</td>
<td style="text-align:right">24</td>
</tr>
</tbody>
</table>
<h4 id="22-one-to-many-一对多关系的merge">2.2 one-to-many 一对多关系的merge</h4>
<p>注意：数据会被复制</p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/5.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/5.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/5.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/5.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/5.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/5.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>In[15]:</p>
<div class="highlight" id="id-89"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">left</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;sno&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;name_a&#39;</span><span class="p">,</span> <span class="s1">&#39;name_b&#39;</span><span class="p">,</span> <span class="s1">&#39;name_c&#39;</span><span class="p">,</span> <span class="s1">&#39;name_d&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">left</span></span></span></code></pre></div><p>Out[15]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">sno</th>
<th style="text-align:right">name</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">11</td>
<td style="text-align:right">name_a</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">12</td>
<td style="text-align:right">name_b</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">13</td>
<td style="text-align:right">name_c</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">14</td>
<td style="text-align:right">name_d</td>
</tr>
</tbody>
</table>
<p>In [16]:</p>
<div class="highlight" id="id-90"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">right</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;sno&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                       <span class="s1">&#39;grade&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;语文88&#39;</span><span class="p">,</span> <span class="s1">&#39;数学90&#39;</span><span class="p">,</span> <span class="s1">&#39;英语75&#39;</span><span class="p">,</span><span class="s1">&#39;语文66&#39;</span><span class="p">,</span> <span class="s1">&#39;数学55&#39;</span><span class="p">,</span> <span class="s1">&#39;英语29&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                     <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">right</span></span></span></code></pre></div><p>Out[16]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">sno</th>
<th style="text-align:right">grade</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">11</td>
<td style="text-align:right">语文88</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">数学90</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">11</td>
<td style="text-align:right">英语75</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">12</td>
<td style="text-align:right">语文66</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">12</td>
<td style="text-align:right">数学55</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">13</td>
<td style="text-align:right">英语29</td>
</tr>
</tbody>
</table>
<p>In [17]:</p>
<div class="highlight" id="id-91"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 数目以多的一边为准</span>
</span></span><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;sno&#39;</span><span class="p">)</span></span></span></code></pre></div><p>Out[17]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">sno</th>
<th style="text-align:right">name</th>
<th style="text-align:right">grade</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">11</td>
<td style="text-align:right">name_a</td>
<td style="text-align:right">语文88</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">name_a</td>
<td style="text-align:right">数学90</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">11</td>
<td style="text-align:right">name_a</td>
<td style="text-align:right">英语75</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">12</td>
<td style="text-align:right">name_b</td>
<td style="text-align:right">语文66</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">12</td>
<td style="text-align:right">name_b</td>
<td style="text-align:right">数学55</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">13</td>
<td style="text-align:right">name_c</td>
<td style="text-align:right">英语29</td>
</tr>
</tbody>
</table>
<h4 id="23-many-to-many-多对多关系的merge">2.3 many-to-many 多对多关系的merge</h4>
<p>注意：结果数量会出现乘法</p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/6.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/6.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/6.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/6.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/6.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/6.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>In [18]:</p>
<div class="highlight" id="id-92"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">left</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;sno&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;爱好&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;篮球&#39;</span><span class="p">,</span> <span class="s1">&#39;羽毛球&#39;</span><span class="p">,</span> <span class="s1">&#39;乒乓球&#39;</span><span class="p">,</span> <span class="s1">&#39;篮球&#39;</span><span class="p">,</span> <span class="s2">&#34;足球&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">left</span></span></span></code></pre></div><p>Out[18]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">sno</th>
<th style="text-align:right">爱好</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">11</td>
<td style="text-align:right">篮球</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">羽毛球</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">12</td>
<td style="text-align:right">乒乓球</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">12</td>
<td style="text-align:right">篮球</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">12</td>
<td style="text-align:right">足球</td>
</tr>
</tbody>
</table>
<p>In [19]:</p>
<div class="highlight" id="id-93"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">right</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;sno&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                       <span class="s1">&#39;grade&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;语文88&#39;</span><span class="p">,</span> <span class="s1">&#39;数学90&#39;</span><span class="p">,</span> <span class="s1">&#39;英语75&#39;</span><span class="p">,</span><span class="s1">&#39;语文66&#39;</span><span class="p">,</span> <span class="s1">&#39;数学55&#39;</span><span class="p">,</span> <span class="s1">&#39;英语29&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                     <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">right</span></span></span></code></pre></div><p>Out[19]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">sno</th>
<th style="text-align:right">grade</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">11</td>
<td style="text-align:right">语文88</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">数学90</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">11</td>
<td style="text-align:right">英语75</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">12</td>
<td style="text-align:right">语文66</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">12</td>
<td style="text-align:right">数学55</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">13</td>
<td style="text-align:right">英语29</td>
</tr>
</tbody>
</table>
<p>In [20]:</p>
<div class="highlight" id="id-94"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;sno&#39;</span><span class="p">)</span></span></span></code></pre></div><p>Out[20]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">sno</th>
<th style="text-align:right">爱好</th>
<th style="text-align:right">grade</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">11</td>
<td style="text-align:right">篮球</td>
<td style="text-align:right">语文88</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">11</td>
<td style="text-align:right">篮球</td>
<td style="text-align:right">数学90</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">11</td>
<td style="text-align:right">篮球</td>
<td style="text-align:right">英语75</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">11</td>
<td style="text-align:right">羽毛球</td>
<td style="text-align:right">语文88</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">11</td>
<td style="text-align:right">羽毛球</td>
<td style="text-align:right">数学90</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">11</td>
<td style="text-align:right">羽毛球</td>
<td style="text-align:right">英语75</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">12</td>
<td style="text-align:right">乒乓球</td>
<td style="text-align:right">语文66</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">12</td>
<td style="text-align:right">乒乓球</td>
<td style="text-align:right">数学55</td>
</tr>
<tr>
<td style="text-align:right">8</td>
<td style="text-align:right">12</td>
<td style="text-align:right">篮球</td>
<td style="text-align:right">语文66</td>
</tr>
<tr>
<td style="text-align:right">9</td>
<td style="text-align:right">12</td>
<td style="text-align:right">篮球</td>
<td style="text-align:right">数学55</td>
</tr>
<tr>
<td style="text-align:right">10</td>
<td style="text-align:right">12</td>
<td style="text-align:right">足球</td>
<td style="text-align:right">语文66</td>
</tr>
<tr>
<td style="text-align:right">11</td>
<td style="text-align:right">12</td>
<td style="text-align:right">足球</td>
<td style="text-align:right">数学55</td>
</tr>
</tbody>
</table>
<h3 id="3理解left-joinright-joininner-joinouter-join的区别">3、理解left join、right join、inner join、outer join的区别</h3>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/7.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/7.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/7.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/7.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/7.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/7.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>In [21]:</p>
<div class="highlight" id="id-95"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">left</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;K0&#39;</span><span class="p">,</span> <span class="s1">&#39;K1&#39;</span><span class="p">,</span> <span class="s1">&#39;K2&#39;</span><span class="p">,</span> <span class="s1">&#39;K3&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;A0&#39;</span><span class="p">,</span> <span class="s1">&#39;A1&#39;</span><span class="p">,</span> <span class="s1">&#39;A2&#39;</span><span class="p">,</span> <span class="s1">&#39;A3&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;B0&#39;</span><span class="p">,</span> <span class="s1">&#39;B1&#39;</span><span class="p">,</span> <span class="s1">&#39;B2&#39;</span><span class="p">,</span> <span class="s1">&#39;B3&#39;</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">right</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;K0&#39;</span><span class="p">,</span> <span class="s1">&#39;K1&#39;</span><span class="p">,</span> <span class="s1">&#39;K4&#39;</span><span class="p">,</span> <span class="s1">&#39;K5&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="s1">&#39;C4&#39;</span><span class="p">,</span> <span class="s1">&#39;C5&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;D0&#39;</span><span class="p">,</span> <span class="s1">&#39;D1&#39;</span><span class="p">,</span> <span class="s1">&#39;D4&#39;</span><span class="p">,</span> <span class="s1">&#39;D5&#39;</span><span class="p">]})</span></span></span></code></pre></div><p>In [22]:</p>
<pre tabindex="0"><code>left</code></pre><p>Out[22]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">key</th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">K0</td>
<td style="text-align:right">A0</td>
<td style="text-align:right">B0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">K1</td>
<td style="text-align:right">A1</td>
<td style="text-align:right">B1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">K2</td>
<td style="text-align:right">A2</td>
<td style="text-align:right">B2</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">K3</td>
<td style="text-align:right">A3</td>
<td style="text-align:right">B3</td>
</tr>
</tbody>
</table>
<p>In [23]:</p>
<div class="highlight" id="id-97"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">right</span></span></span></code></pre></div><p>Out[23]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">key</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">K0</td>
<td style="text-align:right">C0</td>
<td style="text-align:right">D0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">K1</td>
<td style="text-align:right">C1</td>
<td style="text-align:right">D1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">K4</td>
<td style="text-align:right">C4</td>
<td style="text-align:right">D4</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">K5</td>
<td style="text-align:right">C5</td>
<td style="text-align:right">D5</td>
</tr>
</tbody>
</table>
<h4 id="31-inner-join默认">3.1 inner join，默认</h4>
<p>左边和右边的key都有，才会出现在结果里</p>
<p>In [24]:</p>
<div class="highlight" id="id-98"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span></span></span></code></pre></div><p>Out[24]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">key</th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">K0</td>
<td style="text-align:right">A0</td>
<td style="text-align:right">B0</td>
<td style="text-align:right">C0</td>
<td style="text-align:right">D0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">K1</td>
<td style="text-align:right">A1</td>
<td style="text-align:right">B1</td>
<td style="text-align:right">C1</td>
<td style="text-align:right">D1</td>
</tr>
</tbody>
</table>
<h4 id="32-left-join">3.2 left join</h4>
<p>左边的都会出现在结果里，右边的如果无法匹配则为Null</p>
<p>In [25]:</p>
<div class="highlight" id="id-99"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span></span></span></code></pre></div><p>Out[25]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">key</th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">K0</td>
<td style="text-align:right">A0</td>
<td style="text-align:right">B0</td>
<td style="text-align:right">C0</td>
<td style="text-align:right">D0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">K1</td>
<td style="text-align:right">A1</td>
<td style="text-align:right">B1</td>
<td style="text-align:right">C1</td>
<td style="text-align:right">D1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">K2</td>
<td style="text-align:right">A2</td>
<td style="text-align:right">B2</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">K3</td>
<td style="text-align:right">A3</td>
<td style="text-align:right">B3</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
</tbody>
</table>
<h4 id="33-right-join">3.3 right join</h4>
<p>右边的都会出现在结果里，左边的如果无法匹配则为Null</p>
<p>In [26]:</p>
<div class="highlight" id="id-100"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span></span></span></code></pre></div><p>Out[26]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">key</th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">K0</td>
<td style="text-align:right">A0</td>
<td style="text-align:right">B0</td>
<td style="text-align:right">C0</td>
<td style="text-align:right">D0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">K1</td>
<td style="text-align:right">A1</td>
<td style="text-align:right">B1</td>
<td style="text-align:right">C1</td>
<td style="text-align:right">D1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">K4</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">C4</td>
<td style="text-align:right">D4</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">K5</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">C5</td>
<td style="text-align:right">D5</td>
</tr>
</tbody>
</table>
<h4 id="34-outer-join">3.4 outer join</h4>
<p>左边、右边的都会出现在结果里，如果无法匹配则为Null</p>
<p>In [27]:</p>
<div class="highlight" id="id-101"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span></span></span></code></pre></div><p>Out[27]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">key</th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">K0</td>
<td style="text-align:right">A0</td>
<td style="text-align:right">B0</td>
<td style="text-align:right">C0</td>
<td style="text-align:right">D0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">K1</td>
<td style="text-align:right">A1</td>
<td style="text-align:right">B1</td>
<td style="text-align:right">C1</td>
<td style="text-align:right">D1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">K2</td>
<td style="text-align:right">A2</td>
<td style="text-align:right">B2</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">K3</td>
<td style="text-align:right">A3</td>
<td style="text-align:right">B3</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">K4</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">C4</td>
<td style="text-align:right">D4</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">K5</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">C5</td>
<td style="text-align:right">D5</td>
</tr>
</tbody>
</table>
<h3 id="4如果出现非key的字段重名怎么办">4、如果出现非Key的字段重名怎么办</h3>
<p>In [28]:</p>
<div class="highlight" id="id-102"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">left</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;K0&#39;</span><span class="p">,</span> <span class="s1">&#39;K1&#39;</span><span class="p">,</span> <span class="s1">&#39;K2&#39;</span><span class="p">,</span> <span class="s1">&#39;K3&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;A0&#39;</span><span class="p">,</span> <span class="s1">&#39;A1&#39;</span><span class="p">,</span> <span class="s1">&#39;A2&#39;</span><span class="p">,</span> <span class="s1">&#39;A3&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;B0&#39;</span><span class="p">,</span> <span class="s1">&#39;B1&#39;</span><span class="p">,</span> <span class="s1">&#39;B2&#39;</span><span class="p">,</span> <span class="s1">&#39;B3&#39;</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">right</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;K0&#39;</span><span class="p">,</span> <span class="s1">&#39;K1&#39;</span><span class="p">,</span> <span class="s1">&#39;K4&#39;</span><span class="p">,</span> <span class="s1">&#39;K5&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;A10&#39;</span><span class="p">,</span> <span class="s1">&#39;A11&#39;</span><span class="p">,</span> <span class="s1">&#39;A12&#39;</span><span class="p">,</span> <span class="s1">&#39;A13&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;D0&#39;</span><span class="p">,</span> <span class="s1">&#39;D1&#39;</span><span class="p">,</span> <span class="s1">&#39;D4&#39;</span><span class="p">,</span> <span class="s1">&#39;D5&#39;</span><span class="p">]})</span></span></span></code></pre></div><p>In [29]:</p>
<div class="highlight" id="id-103"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">left</span></span></span></code></pre></div><p>Out[29]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">key</th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">K0</td>
<td style="text-align:right">A0</td>
<td style="text-align:right">B0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">K1</td>
<td style="text-align:right">A1</td>
<td style="text-align:right">B1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">K2</td>
<td style="text-align:right">A2</td>
<td style="text-align:right">B2</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">K3</td>
<td style="text-align:right">A3</td>
<td style="text-align:right">B3</td>
</tr>
</tbody>
</table>
<p>In [30]:</p>
<div class="highlight" id="id-104"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">right</span></span></span></code></pre></div><p>Out[30]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">key</th>
<th style="text-align:right">A</th>
<th style="text-align:right">D</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">K0</td>
<td style="text-align:right">A10</td>
<td style="text-align:right">D0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">K1</td>
<td style="text-align:right">A11</td>
<td style="text-align:right">D1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">K4</td>
<td style="text-align:right">A12</td>
<td style="text-align:right">D4</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">K5</td>
<td style="text-align:right">A13</td>
<td style="text-align:right">D5</td>
</tr>
</tbody>
</table>
<p>In [31]:</p>
<div class="highlight" id="id-105"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">)</span></span></span></code></pre></div><p>Out[31]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">key</th>
<th style="text-align:right">A_x</th>
<th style="text-align:right">B</th>
<th style="text-align:right">A_y</th>
<th style="text-align:right">D</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">K0</td>
<td style="text-align:right">A0</td>
<td style="text-align:right">B0</td>
<td style="text-align:right">A10</td>
<td style="text-align:right">D0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">K1</td>
<td style="text-align:right">A1</td>
<td style="text-align:right">B1</td>
<td style="text-align:right">A11</td>
<td style="text-align:right">D1</td>
</tr>
</tbody>
</table>
<p>In [32]:</p>
<div class="highlight" id="id-106"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_left&#39;</span><span class="p">,</span> <span class="s1">&#39;_right&#39;</span><span class="p">))</span></span></span></code></pre></div><p>Out[32]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">key</th>
<th style="text-align:right">A_left</th>
<th style="text-align:right">B</th>
<th style="text-align:right">A_right</th>
<th style="text-align:right">D</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">K0</td>
<td style="text-align:right">A0</td>
<td style="text-align:right">B0</td>
<td style="text-align:right">A10</td>
<td style="text-align:right">D0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">K1</td>
<td style="text-align:right">A1</td>
<td style="text-align:right">B1</td>
<td style="text-align:right">A11</td>
<td style="text-align:right">D1</td>
</tr>
</tbody>
</table>
<h1 id="14pandas实现数据的合并concat">14、Pandas实现数据的合并concat</h1>
<h4 id="使用场景">使用场景：</h4>
<p>批量合并相同格式的Excel、给DataFrame添加行、给DataFrame添加列</p>
<h4 id="一句话说明concat语法">一句话说明concat语法：</h4>
<ul>
<li>使用某种合并方式(inner/outer)</li>
<li>沿着某个轴向(axis=0/1)</li>
<li>把多个Pandas对象(DataFrame/Series)合并成一个。</li>
</ul>
<h4 id="concat语法pandasconcatobjs-axis0-joinouter-ignore_indexfalse">concat语法：pandas.concat(objs, axis=0, join=&lsquo;outer&rsquo;, ignore_index=False)</h4>
<ul>
<li>objs：一个列表，内容可以是DataFrame或者Series，可以混合</li>
<li>axis：默认是0代表按行合并，如果等于1代表按列合并</li>
<li>join：合并的时候索引的对齐方式，默认是outer join，也可以是inner join</li>
<li>ignore_index：是否忽略掉原来的数据索引</li>
</ul>
<h4 id="append语法dataframeappendother-ignore_indexfalse">append语法：DataFrame.append(other, ignore_index=False)</h4>
<p>append只有按行合并，没有按列合并，相当于concat按行的简写形式</p>
<ul>
<li>other：单个dataframe、series、dict，或者列表</li>
<li>ignore_index：是否忽略掉原来的数据索引</li>
</ul>
<h4 id="参考文档">参考文档：</h4>
<ul>
<li>pandas.concat的api文档：https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.concat.html</li>
<li>pandas.concat的教程：https://pandas.pydata.org/pandas-docs/stable/user_guide/merging.html</li>
<li>pandas.append的api文档：https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.append.html</li>
</ul>
<p>In [1]:</p>
<div class="highlight" id="id-107"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">warnings</span>
</span></span><span class="line"><span class="cl"><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span></span></span></code></pre></div><h3 id="一使用pandasconcat合并数据">一、使用pandas.concat合并数据</h3>
<p>In [2]:</p>
<div class="highlight" id="id-108"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;A0&#39;</span><span class="p">,</span> <span class="s1">&#39;A1&#39;</span><span class="p">,</span> <span class="s1">&#39;A2&#39;</span><span class="p">,</span> <span class="s1">&#39;A3&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;B0&#39;</span><span class="p">,</span> <span class="s1">&#39;B1&#39;</span><span class="p">,</span> <span class="s1">&#39;B2&#39;</span><span class="p">,</span> <span class="s1">&#39;B3&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="s1">&#39;C2&#39;</span><span class="p">,</span> <span class="s1">&#39;C3&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;D0&#39;</span><span class="p">,</span> <span class="s1">&#39;D1&#39;</span><span class="p">,</span> <span class="s1">&#39;D2&#39;</span><span class="p">,</span> <span class="s1">&#39;D3&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;E0&#39;</span><span class="p">,</span> <span class="s1">&#39;E1&#39;</span><span class="p">,</span> <span class="s1">&#39;E2&#39;</span><span class="p">,</span> <span class="s1">&#39;E3&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                   <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">df1</span></span></span></code></pre></div><p>Out[2]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
<th style="text-align:right">E</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">A0</td>
<td style="text-align:right">B0</td>
<td style="text-align:right">C0</td>
<td style="text-align:right">D0</td>
<td style="text-align:right">E0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">A1</td>
<td style="text-align:right">B1</td>
<td style="text-align:right">C1</td>
<td style="text-align:right">D1</td>
<td style="text-align:right">E1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">A2</td>
<td style="text-align:right">B2</td>
<td style="text-align:right">C2</td>
<td style="text-align:right">D2</td>
<td style="text-align:right">E2</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">A3</td>
<td style="text-align:right">B3</td>
<td style="text-align:right">C3</td>
<td style="text-align:right">D3</td>
<td style="text-align:right">E3</td>
</tr>
</tbody>
</table>
<p>In [3]:</p>
<div class="highlight" id="id-109"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;A4&#39;</span><span class="p">,</span> <span class="s1">&#39;A5&#39;</span><span class="p">,</span> <span class="s1">&#39;A6&#39;</span><span class="p">,</span> <span class="s1">&#39;A7&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                     <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;B4&#39;</span><span class="p">,</span> <span class="s1">&#39;B5&#39;</span><span class="p">,</span> <span class="s1">&#39;B6&#39;</span><span class="p">,</span> <span class="s1">&#39;B7&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                     <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;C4&#39;</span><span class="p">,</span> <span class="s1">&#39;C5&#39;</span><span class="p">,</span> <span class="s1">&#39;C6&#39;</span><span class="p">,</span> <span class="s1">&#39;C7&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                     <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;D4&#39;</span><span class="p">,</span> <span class="s1">&#39;D5&#39;</span><span class="p">,</span> <span class="s1">&#39;D6&#39;</span><span class="p">,</span> <span class="s1">&#39;D7&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                     <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;F4&#39;</span><span class="p">,</span> <span class="s1">&#39;F5&#39;</span><span class="p">,</span> <span class="s1">&#39;F6&#39;</span><span class="p">,</span> <span class="s1">&#39;F7&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                   <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">df2</span></span></span></code></pre></div><p>Out[3]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
<th style="text-align:right">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">A4</td>
<td style="text-align:right">B4</td>
<td style="text-align:right">C4</td>
<td style="text-align:right">D4</td>
<td style="text-align:right">F4</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">A5</td>
<td style="text-align:right">B5</td>
<td style="text-align:right">C5</td>
<td style="text-align:right">D5</td>
<td style="text-align:right">F5</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">A6</td>
<td style="text-align:right">B6</td>
<td style="text-align:right">C6</td>
<td style="text-align:right">D6</td>
<td style="text-align:right">F6</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">A7</td>
<td style="text-align:right">B7</td>
<td style="text-align:right">C7</td>
<td style="text-align:right">D7</td>
<td style="text-align:right">F7</td>
</tr>
</tbody>
</table>
<p>*<strong>1、默认的concat，参数为axis=0、join=outer、ignore_index=False*</strong></p>
<p>In [4]:</p>
<div class="highlight" id="id-110"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">])</span></span></span></code></pre></div><p>Out[4]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
<th style="text-align:right">E</th>
<th style="text-align:right">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">A0</td>
<td style="text-align:right">B0</td>
<td style="text-align:right">C0</td>
<td style="text-align:right">D0</td>
<td style="text-align:right">E0</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">A1</td>
<td style="text-align:right">B1</td>
<td style="text-align:right">C1</td>
<td style="text-align:right">D1</td>
<td style="text-align:right">E1</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">A2</td>
<td style="text-align:right">B2</td>
<td style="text-align:right">C2</td>
<td style="text-align:right">D2</td>
<td style="text-align:right">E2</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">A3</td>
<td style="text-align:right">B3</td>
<td style="text-align:right">C3</td>
<td style="text-align:right">D3</td>
<td style="text-align:right">E3</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">A4</td>
<td style="text-align:right">B4</td>
<td style="text-align:right">C4</td>
<td style="text-align:right">D4</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">F4</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">A5</td>
<td style="text-align:right">B5</td>
<td style="text-align:right">C5</td>
<td style="text-align:right">D5</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">F5</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">A6</td>
<td style="text-align:right">B6</td>
<td style="text-align:right">C6</td>
<td style="text-align:right">D6</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">F6</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">A7</td>
<td style="text-align:right">B7</td>
<td style="text-align:right">C7</td>
<td style="text-align:right">D7</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">F7</td>
</tr>
</tbody>
</table>
<p>*<strong>2、使用ignore_index=True可以忽略原来的索引*</strong></p>
<p>In [5]:</p>
<div class="highlight" id="id-111"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span></span></code></pre></div><p>Out[5]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
<th style="text-align:right">E</th>
<th style="text-align:right">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">A0</td>
<td style="text-align:right">B0</td>
<td style="text-align:right">C0</td>
<td style="text-align:right">D0</td>
<td style="text-align:right">E0</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">A1</td>
<td style="text-align:right">B1</td>
<td style="text-align:right">C1</td>
<td style="text-align:right">D1</td>
<td style="text-align:right">E1</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">A2</td>
<td style="text-align:right">B2</td>
<td style="text-align:right">C2</td>
<td style="text-align:right">D2</td>
<td style="text-align:right">E2</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">A3</td>
<td style="text-align:right">B3</td>
<td style="text-align:right">C3</td>
<td style="text-align:right">D3</td>
<td style="text-align:right">E3</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">A4</td>
<td style="text-align:right">B4</td>
<td style="text-align:right">C4</td>
<td style="text-align:right">D4</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">F4</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">A5</td>
<td style="text-align:right">B5</td>
<td style="text-align:right">C5</td>
<td style="text-align:right">D5</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">F5</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">A6</td>
<td style="text-align:right">B6</td>
<td style="text-align:right">C6</td>
<td style="text-align:right">D6</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">F6</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">A7</td>
<td style="text-align:right">B7</td>
<td style="text-align:right">C7</td>
<td style="text-align:right">D7</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">F7</td>
</tr>
</tbody>
</table>
<p>*<strong>3、使用join=inner过滤掉不匹配的列*</strong></p>
<p>In [6]:</p>
<div class="highlight" id="id-112"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s2">&#34;inner&#34;</span><span class="p">)</span></span></span></code></pre></div><p>Out[6]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">A0</td>
<td style="text-align:right">B0</td>
<td style="text-align:right">C0</td>
<td style="text-align:right">D0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">A1</td>
<td style="text-align:right">B1</td>
<td style="text-align:right">C1</td>
<td style="text-align:right">D1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">A2</td>
<td style="text-align:right">B2</td>
<td style="text-align:right">C2</td>
<td style="text-align:right">D2</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">A3</td>
<td style="text-align:right">B3</td>
<td style="text-align:right">C3</td>
<td style="text-align:right">D3</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">A4</td>
<td style="text-align:right">B4</td>
<td style="text-align:right">C4</td>
<td style="text-align:right">D4</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">A5</td>
<td style="text-align:right">B5</td>
<td style="text-align:right">C5</td>
<td style="text-align:right">D5</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">A6</td>
<td style="text-align:right">B6</td>
<td style="text-align:right">C6</td>
<td style="text-align:right">D6</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">A7</td>
<td style="text-align:right">B7</td>
<td style="text-align:right">C7</td>
<td style="text-align:right">D7</td>
</tr>
</tbody>
</table>
<p>*<strong>4、使用axis=1相当于添加新列*</strong></p>
<p>In [7]:</p>
<div class="highlight" id="id-113"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df1</span></span></span></code></pre></div><p>Out[7]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
<th style="text-align:right">E</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">A0</td>
<td style="text-align:right">B0</td>
<td style="text-align:right">C0</td>
<td style="text-align:right">D0</td>
<td style="text-align:right">E0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">A1</td>
<td style="text-align:right">B1</td>
<td style="text-align:right">C1</td>
<td style="text-align:right">D1</td>
<td style="text-align:right">E1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">A2</td>
<td style="text-align:right">B2</td>
<td style="text-align:right">C2</td>
<td style="text-align:right">D2</td>
<td style="text-align:right">E2</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">A3</td>
<td style="text-align:right">B3</td>
<td style="text-align:right">C3</td>
<td style="text-align:right">D3</td>
<td style="text-align:right">E3</td>
</tr>
</tbody>
</table>
<p>*<strong>A：添加一列Series*</strong></p>
<p>In [8]:</p>
<div class="highlight" id="id-114"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">s1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;F&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span><span class="n">s1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span></span></code></pre></div><p>Out[8]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
<th style="text-align:right">E</th>
<th style="text-align:right">F</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">A0</td>
<td style="text-align:right">B0</td>
<td style="text-align:right">C0</td>
<td style="text-align:right">D0</td>
<td style="text-align:right">E0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">A1</td>
<td style="text-align:right">B1</td>
<td style="text-align:right">C1</td>
<td style="text-align:right">D1</td>
<td style="text-align:right">E1</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">A2</td>
<td style="text-align:right">B2</td>
<td style="text-align:right">C2</td>
<td style="text-align:right">D2</td>
<td style="text-align:right">E2</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">A3</td>
<td style="text-align:right">B3</td>
<td style="text-align:right">C3</td>
<td style="text-align:right">D3</td>
<td style="text-align:right">E3</td>
<td style="text-align:right">3</td>
</tr>
</tbody>
</table>
<p>*<strong>B：添加多列Series*</strong></p>
<p>In [9]:</p>
<div class="highlight" id="id-115"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">s2</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="s2">&#34;A&#34;</span><span class="p">]</span><span class="o">+</span><span class="s2">&#34;_GG&#34;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span></span></code></pre></div><p>In [10]:</p>
<div class="highlight" id="id-116"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">s2</span></span></span></code></pre></div><p>Out[10]:</p>
<div class="highlight" id="id-117"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mi">0</span>    <span class="n">A0_GG</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="n">A1_GG</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="n">A2_GG</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>    <span class="n">A3_GG</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span></span></span></code></pre></div><p>In [11]:</p>
<div class="highlight" id="id-118"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">s2</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s2">&#34;G&#34;</span></span></span></code></pre></div><p>In [12]:</p>
<div class="highlight" id="id-119"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span></span></code></pre></div><p>Out[12]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
<th style="text-align:right">E</th>
<th style="text-align:right">F</th>
<th style="text-align:right">G</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">A0</td>
<td style="text-align:right">B0</td>
<td style="text-align:right">C0</td>
<td style="text-align:right">D0</td>
<td style="text-align:right">E0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">A0_GG</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">A1</td>
<td style="text-align:right">B1</td>
<td style="text-align:right">C1</td>
<td style="text-align:right">D1</td>
<td style="text-align:right">E1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">A1_GG</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">A2</td>
<td style="text-align:right">B2</td>
<td style="text-align:right">C2</td>
<td style="text-align:right">D2</td>
<td style="text-align:right">E2</td>
<td style="text-align:right">2</td>
<td style="text-align:right">A2_GG</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">A3</td>
<td style="text-align:right">B3</td>
<td style="text-align:right">C3</td>
<td style="text-align:right">D3</td>
<td style="text-align:right">E3</td>
<td style="text-align:right">3</td>
<td style="text-align:right">A3_GG</td>
</tr>
</tbody>
</table>
<p>In [13]:</p>
<div class="highlight" id="id-120"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 列表可以只有Series</span>
</span></span><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span></span></code></pre></div><p>Out[13]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">F</th>
<th style="text-align:right">G</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">A0_GG</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">A1_GG</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2</td>
<td style="text-align:right">A2_GG</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">3</td>
<td style="text-align:right">A3_GG</td>
</tr>
</tbody>
</table>
<p>In [14]:</p>
<div class="highlight" id="id-121"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 列表是可以混合顺序的</span>
</span></span><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span><span class="n">df1</span><span class="p">,</span><span class="n">s2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span></span></code></pre></div><p>Out[14]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">F</th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
<th style="text-align:right">E</th>
<th style="text-align:right">G</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">A0</td>
<td style="text-align:right">B0</td>
<td style="text-align:right">C0</td>
<td style="text-align:right">D0</td>
<td style="text-align:right">E0</td>
<td style="text-align:right">A0_GG</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">A1</td>
<td style="text-align:right">B1</td>
<td style="text-align:right">C1</td>
<td style="text-align:right">D1</td>
<td style="text-align:right">E1</td>
<td style="text-align:right">A1_GG</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2</td>
<td style="text-align:right">A2</td>
<td style="text-align:right">B2</td>
<td style="text-align:right">C2</td>
<td style="text-align:right">D2</td>
<td style="text-align:right">E2</td>
<td style="text-align:right">A2_GG</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">3</td>
<td style="text-align:right">A3</td>
<td style="text-align:right">B3</td>
<td style="text-align:right">C3</td>
<td style="text-align:right">D3</td>
<td style="text-align:right">E3</td>
<td style="text-align:right">A3_GG</td>
</tr>
</tbody>
</table>
<h3 id="二使用dataframeappend按行合并数据">二、使用DataFrame.append按行合并数据</h3>
<p>In [15]:</p>
<div class="highlight" id="id-122"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;AB&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">df1</span></span></span></code></pre></div><p>Out[15]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
</tr>
</tbody>
</table>
<p>In [16]:</p>
<div class="highlight" id="id-123"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]],</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;AB&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">df2</span></span></span></code></pre></div><p>Out[16]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">5</td>
<td style="text-align:right">6</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">7</td>
<td style="text-align:right">8</td>
</tr>
</tbody>
</table>
<p>*<strong>1、给1个dataframe添加另一个dataframe*</strong></p>
<p>In [17]:</p>
<div class="highlight" id="id-124"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span></span></span></code></pre></div><p>Out[17]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">5</td>
<td style="text-align:right">6</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">7</td>
<td style="text-align:right">8</td>
</tr>
</tbody>
</table>
<p>*<strong>2、忽略原来的索引ignore_index=True*</strong></p>
<p>In [18]:</p>
<div class="highlight" id="id-125"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span></span></code></pre></div><p>Out[18]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">5</td>
<td style="text-align:right">6</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">7</td>
<td style="text-align:right">8</td>
</tr>
</tbody>
</table>
<p>*<strong>3、可以一行一行的给DataFrame添加数据*</strong></p>
<p>In [19]:</p>
<div class="highlight" id="id-126"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 一个空的df</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span></span></span></code></pre></div><p>Out[19]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
</tbody>
</table>
<p>*<strong>A：低性能版本*</strong></p>
<p>In [20]:</p>
<div class="highlight" id="id-127"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 注意这里每次都在复制</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span></span></span></code></pre></div><p>Out[20]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">4</td>
</tr>
</tbody>
</table>
<p>*<strong>B：性能好的版本*</strong></p>
<p>In [21]:</p>
<div class="highlight" id="id-128"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 第一个入参是一个列表，避免了多次复制</span>
</span></span><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">i</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)],</span>
</span></span><span class="line"><span class="cl">    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span></span></span></code></pre></div><p>Out[21]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">4</td>
</tr>
</tbody>
</table>
<h1 id="15pandas批量拆分excel与合并excel">15、Pandas批量拆分Excel与合并Excel</h1>
<p>实例演示：</p>
<ol>
<li>将一个大Excel等份拆成多个Excel</li>
<li>将多个小Excel合并成一个大Excel并标记来源</li>
</ol>
<p>In [1]:</p>
<div class="highlight" id="id-129"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">work_dir</span><span class="o">=</span><span class="s2">&#34;./course_datas/c15_excel_split_merge&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">splits_dir</span><span class="o">=</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">work_dir</span><span class="si">}</span><span class="s2">/splits&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">splits_dir</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">splits_dir</span><span class="p">)</span></span></span></code></pre></div><h3 id="0读取源excel到pandas">0、读取源Excel到Pandas</h3>
<p>In [2]:</p>
<div class="highlight" id="id-130"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span></span></span></code></pre></div><p>In [3]:</p>
<div class="highlight" id="id-131"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_source</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">work_dir</span><span class="si">}</span><span class="s2">/crazyant_blog_articles_source.xlsx&#34;</span><span class="p">)</span></span></span></code></pre></div><p>In [4]:</p>
<div class="highlight" id="id-132"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_source</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[4]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">id</th>
<th style="text-align:right">title</th>
<th style="text-align:right">tags</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2585</td>
<td style="text-align:right">Tensorflow怎样接收变长列表特征</td>
<td style="text-align:right">python,tensorflow,特征工程</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2583</td>
<td style="text-align:right">Pandas实现数据的合并concat</td>
<td style="text-align:right">pandas,python,数据分析</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2574</td>
<td style="text-align:right">Pandas的Index索引有什么用途？</td>
<td style="text-align:right">pandas,python,数据分析</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">2564</td>
<td style="text-align:right">机器学习常用数据集大全</td>
<td style="text-align:right">python,机器学习</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">2561</td>
<td style="text-align:right">一个数据科学家的修炼路径</td>
<td style="text-align:right">数据分析</td>
</tr>
</tbody>
</table>
<p>In [5]:</p>
<div class="highlight" id="id-133"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_source</span><span class="o">.</span><span class="n">index</span></span></span></code></pre></div><p>Out[5]:</p>
<div class="highlight" id="id-134"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">RangeIndex</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">258</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span></span></code></pre></div><p>In [6]:</p>
<div class="highlight" id="id-135"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_source</span><span class="o">.</span><span class="n">shape</span></span></span></code></pre></div><p>Out[6]:</p>
<div class="highlight" id="id-136"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">(</span><span class="mi">258</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span></span></span></code></pre></div><p>In [7]:</p>
<div class="highlight" id="id-137"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">total_row_count</span> <span class="o">=</span> <span class="n">df_source</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">total_row_count</span></span></span></code></pre></div><p>Out[7]:</p>
<div class="highlight" id="id-138"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mi">258</span></span></span></code></pre></div><h3 id="一将一个大excel等份拆成多个excel">一、将一个大Excel等份拆成多个Excel</h3>
<ol>
<li>使用df.iloc方法，将一个大的dataframe，拆分成多个小dataframe</li>
<li>将使用dataframe.to_excel保存每个小Excel</li>
</ol>
<h4 id="1计算拆分后的每个excel的行数">1、计算拆分后的每个excel的行数</h4>
<p>In [9]:</p>
<div class="highlight" id="id-139"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 这个大excel，会拆分给这几个人</span>
</span></span><span class="line"><span class="cl"><span class="n">user_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;xiao_shuai&#34;</span><span class="p">,</span> <span class="s2">&#34;xiao_wang&#34;</span><span class="p">,</span> <span class="s2">&#34;xiao_ming&#34;</span><span class="p">,</span> <span class="s2">&#34;xiao_lei&#34;</span><span class="p">,</span> <span class="s2">&#34;xiao_bo&#34;</span><span class="p">,</span> <span class="s2">&#34;xiao_hong&#34;</span><span class="p">]</span></span></span></code></pre></div><p>In [10]:</p>
<div class="highlight" id="id-140"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 每个人的任务数目</span>
</span></span><span class="line"><span class="cl"><span class="n">split_size</span> <span class="o">=</span> <span class="n">total_row_count</span> <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_names</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">total_row_count</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_names</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">split_size</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">split_size</span></span></span></code></pre></div><p>Out[10]:</p>
<div class="highlight" id="id-141"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mi">43</span></span></span></code></pre></div><h4 id="2拆分成多个dataframe">2、拆分成多个dataframe</h4>
<p>In [12]:</p>
<div class="highlight" id="id-142"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_subs</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">user_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">user_names</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># iloc的开始索引</span>
</span></span><span class="line"><span class="cl">    <span class="n">begin</span> <span class="o">=</span> <span class="n">idx</span><span class="o">*</span><span class="n">split_size</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># iloc的结束索引</span>
</span></span><span class="line"><span class="cl">    <span class="n">end</span> <span class="o">=</span> <span class="n">begin</span><span class="o">+</span><span class="n">split_size</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 实现df按照iloc拆分</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_sub</span> <span class="o">=</span> <span class="n">df_source</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">begin</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 将每个子df存入列表</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_subs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">idx</span><span class="p">,</span> <span class="n">user_name</span><span class="p">,</span> <span class="n">df_sub</span><span class="p">))</span></span></span></code></pre></div><h4 id="3将每个datafame存入excel">3、将每个datafame存入excel</h4>
<p>In [13]:</p>
<div class="highlight" id="id-143"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">user_name</span><span class="p">,</span> <span class="n">df_sub</span> <span class="ow">in</span> <span class="n">df_subs</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">splits_dir</span><span class="si">}</span><span class="s2">/crazyant_blog_articles_</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">user_name</span><span class="si">}</span><span class="s2">.xlsx&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_sub</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span></span></code></pre></div><h3 id="二合并多个小excel到一个大excel">二、合并多个小Excel到一个大Excel</h3>
<ol>
<li>遍历文件夹，得到要合并的Excel文件列表</li>
<li>分别读取到dataframe，给每个df添加一列用于标记来源</li>
<li>使用pd.concat进行df批量合并</li>
<li>将合并后的dataframe输出到excel</li>
</ol>
<h4 id="1-遍历文件夹得到要合并的excel名称列表">1. 遍历文件夹，得到要合并的Excel名称列表</h4>
<p>In [14]:</p>
<div class="highlight" id="id-144"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="n">excel_names</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">excel_name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">splits_dir</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">excel_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">excel_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">excel_names</span></span></span></code></pre></div><p>Out[14]:</p>
<div class="highlight" id="id-145"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">[</span><span class="s1">&#39;crazyant_blog_articles_0_xiao_shuai.xlsx&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;crazyant_blog_articles_1_xiao_wang.xlsx&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;crazyant_blog_articles_2_xiao_ming.xlsx&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;crazyant_blog_articles_3_xiao_lei.xlsx&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;crazyant_blog_articles_4_xiao_bo.xlsx&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;crazyant_blog_articles_5_xiao_hong.xlsx&#39;</span><span class="p">]</span></span></span></code></pre></div><h4 id="2-分别读取到dataframe">2. 分别读取到dataframe</h4>
<p>In [15]:</p>
<div class="highlight" id="id-146"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_list</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">excel_name</span> <span class="ow">in</span> <span class="n">excel_names</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 读取每个excel到df</span>
</span></span><span class="line"><span class="cl">    <span class="n">excel_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">splits_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">excel_name</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_split</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">excel_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 得到username</span>
</span></span><span class="line"><span class="cl">    <span class="n">username</span> <span class="o">=</span> <span class="n">excel_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;crazyant_blog_articles_&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;.xlsx&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">excel_name</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 给每个df添加1列，即用户名字</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_split</span><span class="p">[</span><span class="s2">&#34;username&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">username</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_split</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">crazyant_blog_articles_0_xiao_shuai</span><span class="o">.</span><span class="n">xlsx</span> <span class="n">xiao_shuai</span>
</span></span><span class="line"><span class="cl"><span class="n">crazyant_blog_articles_1_xiao_wang</span><span class="o">.</span><span class="n">xlsx</span> <span class="n">xiao_wang</span>
</span></span><span class="line"><span class="cl"><span class="n">crazyant_blog_articles_2_xiao_ming</span><span class="o">.</span><span class="n">xlsx</span> <span class="n">xiao_ming</span>
</span></span><span class="line"><span class="cl"><span class="n">crazyant_blog_articles_3_xiao_lei</span><span class="o">.</span><span class="n">xlsx</span> <span class="n">xiao_lei</span>
</span></span><span class="line"><span class="cl"><span class="n">crazyant_blog_articles_4_xiao_bo</span><span class="o">.</span><span class="n">xlsx</span> <span class="n">xiao_bo</span>
</span></span><span class="line"><span class="cl"><span class="n">crazyant_blog_articles_5_xiao_hong</span><span class="o">.</span><span class="n">xlsx</span> <span class="n">xiao_hong</span></span></span></code></pre></div><h4 id="3-使用pdconcat进行合并">3. 使用pd.concat进行合并</h4>
<p>In [16]:</p>
<div class="highlight" id="id-147"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_merged</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">)</span></span></span></code></pre></div><p>In [17]:</p>
<div class="highlight" id="id-148"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_merged</span><span class="o">.</span><span class="n">shape</span></span></span></code></pre></div><p>Out[17]:</p>
<div class="highlight" id="id-149"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">(</span><span class="mi">258</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span></span></span></code></pre></div><p>In [18]:</p>
<div class="highlight" id="id-150"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_merged</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[18]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">id</th>
<th style="text-align:right">title</th>
<th style="text-align:right">tags</th>
<th style="text-align:right">username</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2585</td>
<td style="text-align:right">Tensorflow怎样接收变长列表特征</td>
<td style="text-align:right">python,tensorflow,特征工程</td>
<td style="text-align:right">xiao_shuai</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2583</td>
<td style="text-align:right">Pandas实现数据的合并concat</td>
<td style="text-align:right">pandas,python,数据分析</td>
<td style="text-align:right">xiao_shuai</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2574</td>
<td style="text-align:right">Pandas的Index索引有什么用途？</td>
<td style="text-align:right">pandas,python,数据分析</td>
<td style="text-align:right">xiao_shuai</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">2564</td>
<td style="text-align:right">机器学习常用数据集大全</td>
<td style="text-align:right">python,机器学习</td>
<td style="text-align:right">xiao_shuai</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">2561</td>
<td style="text-align:right">一个数据科学家的修炼路径</td>
<td style="text-align:right">数据分析</td>
<td style="text-align:right">xiao_shuai</td>
</tr>
</tbody>
</table>
<p>In [19]:</p>
<div class="highlight" id="id-151"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_merged</span><span class="p">[</span><span class="s2">&#34;username&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span></span></span></code></pre></div><p>Out[19]:</p>
<div class="highlight" id="id-152"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">xiao_hong</span>     <span class="mi">43</span>
</span></span><span class="line"><span class="cl"><span class="n">xiao_bo</span>       <span class="mi">43</span>
</span></span><span class="line"><span class="cl"><span class="n">xiao_shuai</span>    <span class="mi">43</span>
</span></span><span class="line"><span class="cl"><span class="n">xiao_lei</span>      <span class="mi">43</span>
</span></span><span class="line"><span class="cl"><span class="n">xiao_wang</span>     <span class="mi">43</span>
</span></span><span class="line"><span class="cl"><span class="n">xiao_ming</span>     <span class="mi">43</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span></span></span></code></pre></div><h4 id="4-将合并后的dataframe输出到excel">4. 将合并后的dataframe输出到excel</h4>
<p>In [20]:</p>
<div class="highlight" id="id-153"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_merged</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">work_dir</span><span class="si">}</span><span class="s2">/crazyant_blog_articles_merged.xlsx&#34;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span></span></code></pre></div><h1 id="16pandas怎样实现groupby分组统计">16、Pandas怎样实现groupby分组统计</h1>
<p>类似SQL：
select city,max(temperature) from city_weather group by city;</p>
<p>groupby：先对数据分组，然后在每个分组上应用聚合函数、转换函数</p>
<p>本次演示：
一、分组使用聚合函数做数据统计
二、遍历groupby的结果理解执行流程
三、实例分组探索天气数据</p>
<p>In [1]:</p>
<div class="highlight" id="id-154"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 加上这一句，能在jupyter notebook展示matplot图表</span>
</span></span><span class="line"><span class="cl"><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span></span></span></code></pre></div><p>In [2]:</p>
<div class="highlight" id="id-155"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                   <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                   <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                   <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">)})</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span></span></span></code></pre></div><p>Out[2]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">foo</td>
<td style="text-align:right">one</td>
<td style="text-align:right">0.542903</td>
<td style="text-align:right">0.788896</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">bar</td>
<td style="text-align:right">one</td>
<td style="text-align:right">-0.375789</td>
<td style="text-align:right">-0.345869</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">foo</td>
<td style="text-align:right">two</td>
<td style="text-align:right">-0.903407</td>
<td style="text-align:right">0.428031</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">bar</td>
<td style="text-align:right">three</td>
<td style="text-align:right">-1.564748</td>
<td style="text-align:right">0.081163</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">foo</td>
<td style="text-align:right">two</td>
<td style="text-align:right">-1.093602</td>
<td style="text-align:right">0.837348</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">bar</td>
<td style="text-align:right">two</td>
<td style="text-align:right">-0.202403</td>
<td style="text-align:right">0.701301</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">foo</td>
<td style="text-align:right">one</td>
<td style="text-align:right">-0.665189</td>
<td style="text-align:right">-1.505290</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">foo</td>
<td style="text-align:right">three</td>
<td style="text-align:right">-0.498339</td>
<td style="text-align:right">0.534438</td>
</tr>
</tbody>
</table>
<h3 id="一分组使用聚合函数做数据统计">一、分组使用聚合函数做数据统计</h3>
<h4 id="1单个列groupby查询所有数据列的统计">1、单个列groupby，查询所有数据列的统计</h4>
<p>In [3]:</p>
<div class="highlight" id="id-156"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span></span></span></code></pre></div><p>Out[3]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">A</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">bar</td>
<td style="text-align:right">-2.142940</td>
<td style="text-align:right">0.436595</td>
</tr>
<tr>
<td style="text-align:right">foo</td>
<td style="text-align:right">-2.617633</td>
<td style="text-align:right">1.083423</td>
</tr>
</tbody>
</table>
<p>我们看到：</p>
<ol>
<li>groupby中的&rsquo;A&rsquo;变成了数据的索引列</li>
<li>因为要统计sum，但B列不是数字，所以被自动忽略掉</li>
</ol>
<h4 id="2多个列groupby查询所有数据列的统计">2、多个列groupby，查询所有数据列的统计</h4>
<p>In [4]:</p>
<div class="highlight" id="id-157"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span></span></span></code></pre></div><p>Out[4]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right"></th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">A</td>
<td style="text-align:right">B</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">bar</td>
<td style="text-align:right">one</td>
<td style="text-align:right">-0.375789</td>
<td style="text-align:right">-0.345869</td>
</tr>
<tr>
<td style="text-align:right">three</td>
<td style="text-align:right">-1.564748</td>
<td style="text-align:right">0.081163</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">two</td>
<td style="text-align:right">-0.202403</td>
<td style="text-align:right">0.701301</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">foo</td>
<td style="text-align:right">one</td>
<td style="text-align:right">-0.061143</td>
<td style="text-align:right">-0.358197</td>
</tr>
<tr>
<td style="text-align:right">three</td>
<td style="text-align:right">-0.498339</td>
<td style="text-align:right">0.534438</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">two</td>
<td style="text-align:right">-0.998504</td>
<td style="text-align:right">0.632690</td>
<td style="text-align:right"></td>
</tr>
</tbody>
</table>
<p>我们看到：(&lsquo;A&rsquo;,&lsquo;B&rsquo;)成对变成了二级索引</p>
<p>In [5]:</p>
<div class="highlight" id="id-158"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span></span></span></code></pre></div><p>Out[5]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">bar</td>
<td style="text-align:right">one</td>
<td style="text-align:right">-0.375789</td>
<td style="text-align:right">-0.345869</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">bar</td>
<td style="text-align:right">three</td>
<td style="text-align:right">-1.564748</td>
<td style="text-align:right">0.081163</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">bar</td>
<td style="text-align:right">two</td>
<td style="text-align:right">-0.202403</td>
<td style="text-align:right">0.701301</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">foo</td>
<td style="text-align:right">one</td>
<td style="text-align:right">-0.061143</td>
<td style="text-align:right">-0.358197</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">foo</td>
<td style="text-align:right">three</td>
<td style="text-align:right">-0.498339</td>
<td style="text-align:right">0.534438</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">foo</td>
<td style="text-align:right">two</td>
<td style="text-align:right">-0.998504</td>
<td style="text-align:right">0.632690</td>
</tr>
</tbody>
</table>
<h4 id="3同时查看多种数据统计">3、同时查看多种数据统计</h4>
<p>In [6]:</p>
<div class="highlight" id="id-159"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">])</span></span></span></code></pre></div><p>Out[6]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
<th style="text-align:right"></th>
<th style="text-align:right"></th>
<th style="text-align:right"></th>
<th style="text-align:right"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"></td>
<td style="text-align:right">sum</td>
<td style="text-align:right">mean</td>
<td style="text-align:right">std</td>
<td style="text-align:right">sum</td>
<td style="text-align:right">mean</td>
<td style="text-align:right">std</td>
</tr>
<tr>
<td style="text-align:right">A</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">bar</td>
<td style="text-align:right">-2.142940</td>
<td style="text-align:right">-0.714313</td>
<td style="text-align:right">0.741583</td>
<td style="text-align:right">0.436595</td>
<td style="text-align:right">0.145532</td>
<td style="text-align:right">0.526544</td>
</tr>
<tr>
<td style="text-align:right">foo</td>
<td style="text-align:right">-2.617633</td>
<td style="text-align:right">-0.523527</td>
<td style="text-align:right">0.637822</td>
<td style="text-align:right">1.083423</td>
<td style="text-align:right">0.216685</td>
<td style="text-align:right">0.977686</td>
</tr>
</tbody>
</table>
<p>我们看到：列变成了多级索引</p>
<h4 id="4查看单列的结果数据统计">4、查看单列的结果数据统计</h4>
<p>In [7]:</p>
<div class="highlight" id="id-160"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 方法1：预过滤，性能更好</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">])</span></span></span></code></pre></div><p>Out[7]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">sum</th>
<th style="text-align:right">mean</th>
<th style="text-align:right">std</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">A</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">bar</td>
<td style="text-align:right">-2.142940</td>
<td style="text-align:right">-0.714313</td>
<td style="text-align:right">0.741583</td>
</tr>
<tr>
<td style="text-align:right">foo</td>
<td style="text-align:right">-2.617633</td>
<td style="text-align:right">-0.523527</td>
<td style="text-align:right">0.637822</td>
</tr>
</tbody>
</table>
<p>In [8]:</p>
<div class="highlight" id="id-161"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 方法2</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">])[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span></span></span></code></pre></div><p>Out[8]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">sum</th>
<th style="text-align:right">mean</th>
<th style="text-align:right">std</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">A</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">bar</td>
<td style="text-align:right">-2.142940</td>
<td style="text-align:right">-0.714313</td>
<td style="text-align:right">0.741583</td>
</tr>
<tr>
<td style="text-align:right">foo</td>
<td style="text-align:right">-2.617633</td>
<td style="text-align:right">-0.523527</td>
<td style="text-align:right">0.637822</td>
</tr>
</tbody>
</table>
<h4 id="5不同列使用不同的聚合函数">5、不同列使用不同的聚合函数</h4>
<p>In [9]:</p>
<div class="highlight" id="id-162"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&#34;C&#34;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span> <span class="s2">&#34;D&#34;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">})</span></span></span></code></pre></div><p>Out[9]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">A</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">bar</td>
<td style="text-align:right">-2.142940</td>
<td style="text-align:right">0.145532</td>
</tr>
<tr>
<td style="text-align:right">foo</td>
<td style="text-align:right">-2.617633</td>
<td style="text-align:right">0.216685</td>
</tr>
</tbody>
</table>
<h3 id="二遍历groupby的结果理解执行流程">二、遍历groupby的结果理解执行流程</h3>
<p>for循环可以直接遍历每个group</p>
<h5 id="1遍历单个列聚合的分组">1、遍历单个列聚合的分组</h5>
<p>In [10]:</p>
<div class="highlight" id="id-163"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span></span></span></code></pre></div><p>Out[10]:</p>
<div class="highlight" id="id-164"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">groupby</span><span class="o">.</span><span class="n">generic</span><span class="o">.</span><span class="n">DataFrameGroupBy</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x00000123B250E548</span><span class="o">&gt;</span></span></span></code></pre></div><p>In [11]:</p>
<div class="highlight" id="id-165"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">group</span> <span class="ow">in</span> <span class="n">g</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">bar</span>
</span></span><span class="line"><span class="cl">     <span class="n">A</span>      <span class="n">B</span>         <span class="n">C</span>         <span class="n">D</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="n">bar</span>    <span class="n">one</span> <span class="o">-</span><span class="mf">0.375789</span> <span class="o">-</span><span class="mf">0.345869</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="n">bar</span>  <span class="n">three</span> <span class="o">-</span><span class="mf">1.564748</span>  <span class="mf">0.081163</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>  <span class="n">bar</span>    <span class="n">two</span> <span class="o">-</span><span class="mf">0.202403</span>  <span class="mf">0.701301</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">foo</span>
</span></span><span class="line"><span class="cl">     <span class="n">A</span>      <span class="n">B</span>         <span class="n">C</span>         <span class="n">D</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="n">foo</span>    <span class="n">one</span>  <span class="mf">0.542903</span>  <span class="mf">0.788896</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="n">foo</span>    <span class="n">two</span> <span class="o">-</span><span class="mf">0.903407</span>  <span class="mf">0.428031</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="n">foo</span>    <span class="n">two</span> <span class="o">-</span><span class="mf">1.093602</span>  <span class="mf">0.837348</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>  <span class="n">foo</span>    <span class="n">one</span> <span class="o">-</span><span class="mf">0.665189</span> <span class="o">-</span><span class="mf">1.505290</span>
</span></span><span class="line"><span class="cl"><span class="mi">7</span>  <span class="n">foo</span>  <span class="n">three</span> <span class="o">-</span><span class="mf">0.498339</span>  <span class="mf">0.534438</span></span></span></code></pre></div><p>*<strong>可以获取单个分组的数据*</strong></p>
<p>In [12]:</p>
<div class="highlight" id="id-166"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span></span></span></code></pre></div><p>Out[12]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">bar</td>
<td style="text-align:right">one</td>
<td style="text-align:right">-0.375789</td>
<td style="text-align:right">-0.345869</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">bar</td>
<td style="text-align:right">three</td>
<td style="text-align:right">-1.564748</td>
<td style="text-align:right">0.081163</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">bar</td>
<td style="text-align:right">two</td>
<td style="text-align:right">-0.202403</td>
<td style="text-align:right">0.701301</td>
</tr>
</tbody>
</table>
<h5 id="2遍历多个列聚合的分组">2、遍历多个列聚合的分组</h5>
<p>In [13]:</p>
<div class="highlight" id="id-167"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">])</span></span></span></code></pre></div><p>In [14]:</p>
<pre tabindex="0"><code>for name,group in g:
    print(name)
    print(group)
    print()
(&#39;bar&#39;, &#39;one&#39;)
     A    B         C         D
1  bar  one -0.375789 -0.345869

(&#39;bar&#39;, &#39;three&#39;)
     A      B         C         D
3  bar  three -1.564748  0.081163

(&#39;bar&#39;, &#39;two&#39;)
     A    B         C         D
5  bar  two -0.202403  0.701301

(&#39;foo&#39;, &#39;one&#39;)
     A    B         C         D
0  foo  one  0.542903  0.788896
6  foo  one -0.665189 -1.505290

(&#39;foo&#39;, &#39;three&#39;)
     A      B         C         D
7  foo  three -0.498339  0.534438

(&#39;foo&#39;, &#39;two&#39;)
     A    B         C         D
2  foo  two -0.903407  0.428031
4  foo  two -1.093602  0.837348</code></pre><p>可以看到，name是一个2个元素的tuple，代表不同的列</p>
<p>In [15]:</p>
<div class="highlight" id="id-169"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">get_group</span><span class="p">((</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">))</span></span></span></code></pre></div><p>Out[15]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">A</th>
<th style="text-align:right">B</th>
<th style="text-align:right">C</th>
<th style="text-align:right">D</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">foo</td>
<td style="text-align:right">one</td>
<td style="text-align:right">0.542903</td>
<td style="text-align:right">0.788896</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">foo</td>
<td style="text-align:right">one</td>
<td style="text-align:right">-0.665189</td>
<td style="text-align:right">-1.505290</td>
</tr>
</tbody>
</table>
<p>*<strong>可以直接查询group后的某几列，生成Series或者子DataFrame*</strong></p>
<p>In [16]:</p>
<div class="highlight" id="id-170"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">g</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span></span></span></code></pre></div><p>Out[16]:</p>
<div class="highlight" id="id-171"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">groupby</span><span class="o">.</span><span class="n">generic</span><span class="o">.</span><span class="n">SeriesGroupBy</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x00000123C33F64C8</span><span class="o">&gt;</span></span></span></code></pre></div><p>In [17]:</p>
<div class="highlight" id="id-172"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">g</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">group</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>   <span class="o">-</span><span class="mf">0.375789</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">C</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="s1">&#39;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>   <span class="o">-</span><span class="mf">1.564748</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">C</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="s1">&#39;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>   <span class="o">-</span><span class="mf">0.202403</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">C</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="s1">&#39;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>    <span class="mf">0.542903</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>   <span class="o">-</span><span class="mf">0.665189</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">C</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="s1">&#39;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">7</span>   <span class="o">-</span><span class="mf">0.498339</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">C</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="s1">&#39;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>   <span class="o">-</span><span class="mf">0.903407</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>   <span class="o">-</span><span class="mf">1.093602</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">C</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="s1">&#39;&gt;</span></span></span></code></pre></div><p>其实所有的聚合统计，都是在dataframe和series上进行的；</p>
<h3 id="三实例分组探索天气数据">三、实例分组探索天气数据</h3>
<p>In [18]:</p>
<div class="highlight" id="id-173"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">fpath</span> <span class="o">=</span> <span class="s2">&#34;./datas/beijing_tianqi/beijing_tianqi_2018.csv&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 替换掉温度的后缀℃</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&#34;bWendu&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;℃&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&#34;yWendu&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;yWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;℃&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[18]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2018-01-01</td>
<td style="text-align:right">3</td>
<td style="text-align:right">-6</td>
<td style="text-align:right">晴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">59</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01-02</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">阴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">49</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2018-01-03</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">28</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">2018-01-04</td>
<td style="text-align:right">0</td>
<td style="text-align:right">-8</td>
<td style="text-align:right">阴</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">28</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">2018-01-05</td>
<td style="text-align:right">3</td>
<td style="text-align:right">-6</td>
<td style="text-align:right">多云~晴</td>
<td style="text-align:right">西北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">50</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<p>In [19]:</p>
<div class="highlight" id="id-174"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 新增一列为月份</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ymd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[19]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
<th style="text-align:right">month</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2018-01-01</td>
<td style="text-align:right">3</td>
<td style="text-align:right">-6</td>
<td style="text-align:right">晴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">59</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
<td style="text-align:right">2018-01</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01-02</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">阴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">49</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2018-01-03</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">28</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">2018-01-04</td>
<td style="text-align:right">0</td>
<td style="text-align:right">-8</td>
<td style="text-align:right">阴</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">28</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">2018-01-05</td>
<td style="text-align:right">3</td>
<td style="text-align:right">-6</td>
<td style="text-align:right">多云~晴</td>
<td style="text-align:right">西北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">50</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01</td>
</tr>
</tbody>
</table>
<h4 id="1查看每个月的最高温度">1、查看每个月的最高温度</h4>
<p>In [20]:</p>
<div class="highlight" id="id-175"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)[</span><span class="s1">&#39;bWendu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span></span></span></code></pre></div><p>Out[20]:</p>
<div class="highlight" id="id-176"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">month</span>
</span></span><span class="line"><span class="cl"><span class="mi">2018</span><span class="o">-</span><span class="mi">01</span>     <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="mi">2018</span><span class="o">-</span><span class="mi">02</span>    <span class="mi">12</span>
</span></span><span class="line"><span class="cl"><span class="mi">2018</span><span class="o">-</span><span class="mi">03</span>    <span class="mi">27</span>
</span></span><span class="line"><span class="cl"><span class="mi">2018</span><span class="o">-</span><span class="mi">04</span>    <span class="mi">30</span>
</span></span><span class="line"><span class="cl"><span class="mi">2018</span><span class="o">-</span><span class="mi">05</span>    <span class="mi">35</span>
</span></span><span class="line"><span class="cl"><span class="mi">2018</span><span class="o">-</span><span class="mi">06</span>    <span class="mi">38</span>
</span></span><span class="line"><span class="cl"><span class="mi">2018</span><span class="o">-</span><span class="mi">07</span>    <span class="mi">37</span>
</span></span><span class="line"><span class="cl"><span class="mi">2018</span><span class="o">-</span><span class="mi">08</span>    <span class="mi">36</span>
</span></span><span class="line"><span class="cl"><span class="mi">2018</span><span class="o">-</span><span class="mi">09</span>    <span class="mi">31</span>
</span></span><span class="line"><span class="cl"><span class="mi">2018</span><span class="o">-</span><span class="mi">10</span>    <span class="mi">25</span>
</span></span><span class="line"><span class="cl"><span class="mi">2018</span><span class="o">-</span><span class="mi">11</span>    <span class="mi">18</span>
</span></span><span class="line"><span class="cl"><span class="mi">2018</span><span class="o">-</span><span class="mi">12</span>    <span class="mi">10</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">bWendu</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int32</span></span></span></code></pre></div><p>In [21]:</p>
<div class="highlight" id="id-177"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></span></span></code></pre></div><p>Out[21]:</p>
<div class="highlight" id="id-178"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span></span></span></code></pre></div><p>In [22]:</p>
<div class="highlight" id="id-179"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span></span></span></code></pre></div><p>Out[22]:</p>
<div class="highlight" id="id-180"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0x123c344b308</span><span class="o">&gt;</span></span></span></code></pre></div><p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/8.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/8.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/8.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/8.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/8.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/python_pandas/8.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h4 id="2查看每个月的最高温度最低温度平均空气质量指数">2、查看每个月的最高温度、最低温度、平均空气质量指数</h4>
<p>In [23]:</p>
<div class="highlight" id="id-181"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[23]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">ymd</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
<th style="text-align:right">month</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2018-01-01</td>
<td style="text-align:right">3</td>
<td style="text-align:right">-6</td>
<td style="text-align:right">晴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">59</td>
<td style="text-align:right">良</td>
<td style="text-align:right">2</td>
<td style="text-align:right">2018-01</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01-02</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">阴~多云</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">49</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2018-01-03</td>
<td style="text-align:right">2</td>
<td style="text-align:right">-5</td>
<td style="text-align:right">多云</td>
<td style="text-align:right">北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">28</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">2018-01-04</td>
<td style="text-align:right">0</td>
<td style="text-align:right">-8</td>
<td style="text-align:right">阴</td>
<td style="text-align:right">东北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">28</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">2018-01-05</td>
<td style="text-align:right">3</td>
<td style="text-align:right">-6</td>
<td style="text-align:right">多云~晴</td>
<td style="text-align:right">西北风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">50</td>
<td style="text-align:right">优</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2018-01</td>
</tr>
</tbody>
</table>
<p>In [24]:</p>
<div class="highlight" id="id-182"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">group_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&#34;bWendu&#34;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="s2">&#34;yWendu&#34;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="s2">&#34;aqi&#34;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">group_data</span></span></span></code></pre></div><p>Out[24]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">aqi</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">month</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2018-01</td>
<td style="text-align:right">7</td>
<td style="text-align:right">-12</td>
<td style="text-align:right">60.677419</td>
</tr>
<tr>
<td style="text-align:right">2018-02</td>
<td style="text-align:right">12</td>
<td style="text-align:right">-10</td>
<td style="text-align:right">78.857143</td>
</tr>
<tr>
<td style="text-align:right">2018-03</td>
<td style="text-align:right">27</td>
<td style="text-align:right">-4</td>
<td style="text-align:right">130.322581</td>
</tr>
<tr>
<td style="text-align:right">2018-04</td>
<td style="text-align:right">30</td>
<td style="text-align:right">1</td>
<td style="text-align:right">102.866667</td>
</tr>
<tr>
<td style="text-align:right">2018-05</td>
<td style="text-align:right">35</td>
<td style="text-align:right">10</td>
<td style="text-align:right">99.064516</td>
</tr>
<tr>
<td style="text-align:right">2018-06</td>
<td style="text-align:right">38</td>
<td style="text-align:right">17</td>
<td style="text-align:right">82.300000</td>
</tr>
<tr>
<td style="text-align:right">2018-07</td>
<td style="text-align:right">37</td>
<td style="text-align:right">22</td>
<td style="text-align:right">72.677419</td>
</tr>
<tr>
<td style="text-align:right">2018-08</td>
<td style="text-align:right">36</td>
<td style="text-align:right">20</td>
<td style="text-align:right">59.516129</td>
</tr>
<tr>
<td style="text-align:right">2018-09</td>
<td style="text-align:right">31</td>
<td style="text-align:right">11</td>
<td style="text-align:right">50.433333</td>
</tr>
<tr>
<td style="text-align:right">2018-10</td>
<td style="text-align:right">25</td>
<td style="text-align:right">1</td>
<td style="text-align:right">67.096774</td>
</tr>
<tr>
<td style="text-align:right">2018-11</td>
<td style="text-align:right">18</td>
<td style="text-align:right">-4</td>
<td style="text-align:right">105.100000</td>
</tr>
<tr>
<td style="text-align:right">2018-12</td>
<td style="text-align:right">10</td>
<td style="text-align:right">-12</td>
<td style="text-align:right">77.354839</td>
</tr>
</tbody>
</table>
<p>In [25]:</p>
<div class="highlight" id="id-183"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">group_data</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span></span></span></code></pre></div><p>Out[25]:</p>
<div class="highlight" id="id-184"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0x123c5502d48</span><span class="o">&gt;</span></span></span></code></pre></div><p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/9.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/9.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/9.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/9.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/9.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/9.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h1 id="17pandas的分层索引multiindex">17、Pandas的分层索引MultiIndex</h1>
<p>为什么要学习分层索引MultiIndex？</p>
<ul>
<li>分层索引：在一个轴向上拥有多个索引层级，可以表达更高维度数据的形式；</li>
<li>可以更方便的进行数据筛选，如果有序则性能更好；</li>
<li>groupby等操作的结果，如果是多KEY，结果是分层索引，需要会使用</li>
<li>一般不需要自己创建分层索引(MultiIndex有构造函数但一般不用)</li>
</ul>
<p>演示数据：百度、阿里巴巴、爱奇艺、京东四家公司的10天股票数据
数据来自：英为财经
<a href="https://cn.investing.com/"target="_blank" rel="external nofollow noopener noreferrer">https://cn.investing.com/</a></p>
<p>本次演示提纲：
一、Series的分层索引MultiIndex
二、Series有多层索引怎样筛选数据？
三、DataFrame的多层索引MultiIndex
四、DataFrame有多层索引怎样筛选数据？</p>
<p>In [1]:</p>
<div class="highlight" id="id-185"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span></span></span></code></pre></div><p>In [1]:</p>
<div class="highlight" id="id-186"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;./datas/stocks/互联网公司股票.xlsx&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">---------------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="ne">NameError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">574</span><span class="n">feeeb8bb0</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">stocks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;./datas/stocks/互联网公司股票.xlsx&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="ne">NameError</span><span class="p">:</span> <span class="n">name</span> <span class="s1">&#39;pd&#39;</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span></span></span></code></pre></div><p>In [3]:</p>
<div class="highlight" id="id-187"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span><span class="o">.</span><span class="n">shape</span></span></span></code></pre></div><p>Out[3]:</p>
<div class="highlight" id="id-188"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span></span></span></code></pre></div><p>In [4]:</p>
<div class="highlight" id="id-189"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span></span></span></code></pre></div><p>Out[4]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">日期</th>
<th style="text-align:right">公司</th>
<th style="text-align:right">收盘</th>
<th style="text-align:right">开盘</th>
<th style="text-align:right">高</th>
<th style="text-align:right">低</th>
<th style="text-align:right">交易量</th>
<th style="text-align:right">涨跌幅</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">104.32</td>
<td style="text-align:right">102.35</td>
<td style="text-align:right">104.73</td>
<td style="text-align:right">101.15</td>
<td style="text-align:right">2.24</td>
<td style="text-align:right">0.02</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">102.62</td>
<td style="text-align:right">100.85</td>
<td style="text-align:right">103.24</td>
<td style="text-align:right">99.50</td>
<td style="text-align:right">2.69</td>
<td style="text-align:right">0.01</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">102.00</td>
<td style="text-align:right">102.80</td>
<td style="text-align:right">103.26</td>
<td style="text-align:right">101.00</td>
<td style="text-align:right">1.78</td>
<td style="text-align:right">-0.01</td>
</tr>
</tbody>
</table>
<p>In [5]:</p>
<div class="highlight" id="id-190"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span><span class="p">[</span><span class="s2">&#34;公司&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span></span></span></code></pre></div><p>Out[5]:</p>
<div class="highlight" id="id-191"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">array</span><span class="p">([</span><span class="s1">&#39;BIDU&#39;</span><span class="p">,</span> <span class="s1">&#39;BABA&#39;</span><span class="p">,</span> <span class="s1">&#39;IQ&#39;</span><span class="p">,</span> <span class="s1">&#39;JD&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span></span></span></code></pre></div><p>In [6]:</p>
<div class="highlight" id="id-192"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span><span class="o">.</span><span class="n">index</span></span></span></code></pre></div><p>Out[6]:</p>
<div class="highlight" id="id-193"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">RangeIndex</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span></span></code></pre></div><p>In [7]:</p>
<div class="highlight" id="id-194"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;公司&#39;</span><span class="p">)[</span><span class="s2">&#34;收盘&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span></span></span></code></pre></div><p>Out[7]:</p>
<div class="highlight" id="id-195"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">公司</span>
</span></span><span class="line"><span class="cl"><span class="n">BABA</span>    <span class="mf">166.80</span>
</span></span><span class="line"><span class="cl"><span class="n">BIDU</span>    <span class="mf">102.98</span>
</span></span><span class="line"><span class="cl"><span class="n">IQ</span>       <span class="mf">15.90</span>
</span></span><span class="line"><span class="cl"><span class="n">JD</span>       <span class="mf">28.35</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">收盘</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span></span></span></code></pre></div><h3 id="一series的分层索引multiindex">一、Series的分层索引MultiIndex</h3>
<p>In [8]:</p>
<div class="highlight" id="id-196"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ser</span> <span class="o">=</span> <span class="n">stocks</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;公司&#39;</span><span class="p">,</span> <span class="s1">&#39;日期&#39;</span><span class="p">])[</span><span class="s1">&#39;收盘&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">ser</span></span></span></code></pre></div><p>Out[8]:</p>
<div class="highlight" id="id-197"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">公司</span>    <span class="n">日期</span>        
</span></span><span class="line"><span class="cl"><span class="n">BABA</span>  <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">01</span>    <span class="mf">165.15</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">02</span>    <span class="mf">165.77</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">03</span>    <span class="mf">169.48</span>
</span></span><span class="line"><span class="cl"><span class="n">BIDU</span>  <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">01</span>    <span class="mf">102.00</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">02</span>    <span class="mf">102.62</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">03</span>    <span class="mf">104.32</span>
</span></span><span class="line"><span class="cl"><span class="n">IQ</span>    <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">01</span>     <span class="mf">15.92</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">02</span>     <span class="mf">15.72</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">03</span>     <span class="mf">16.06</span>
</span></span><span class="line"><span class="cl"><span class="n">JD</span>    <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">01</span>     <span class="mf">28.19</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">02</span>     <span class="mf">28.06</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">03</span>     <span class="mf">28.80</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">收盘</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span></span></span></code></pre></div><p>多维索引中，空白的意思是：使用上面的值</p>
<p>In [9]:</p>
<div class="highlight" id="id-198"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ser</span><span class="o">.</span><span class="n">index</span></span></span></code></pre></div><p>Out[9]:</p>
<div class="highlight" id="id-199"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">MultiIndex</span><span class="p">([(</span><span class="s1">&#39;BABA&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-01&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="s1">&#39;BABA&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-02&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="s1">&#39;BABA&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-03&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="s1">&#39;BIDU&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-01&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="s1">&#39;BIDU&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-02&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="s1">&#39;BIDU&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-03&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span>  <span class="s1">&#39;IQ&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-01&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span>  <span class="s1">&#39;IQ&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-02&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span>  <span class="s1">&#39;IQ&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-03&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span>  <span class="s1">&#39;JD&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-01&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span>  <span class="s1">&#39;JD&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-02&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span>  <span class="s1">&#39;JD&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-03&#39;</span><span class="p">)],</span>
</span></span><span class="line"><span class="cl">           <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;公司&#39;</span><span class="p">,</span> <span class="s1">&#39;日期&#39;</span><span class="p">])</span></span></span></code></pre></div><p>In [10]:</p>
<div class="highlight" id="id-200"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># unstack把二级索引变成列</span>
</span></span><span class="line"><span class="cl"><span class="n">ser</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span></span></span></code></pre></div><p>Out[10]:</p>
<table>
<thead>
<tr>
<th style="text-align:right">日期</th>
<th style="text-align:right">2019-10-01</th>
<th style="text-align:right">2019-10-02</th>
<th style="text-align:right">2019-10-03</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">公司</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">BABA</td>
<td style="text-align:right">165.15</td>
<td style="text-align:right">165.77</td>
<td style="text-align:right">169.48</td>
</tr>
<tr>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">102.00</td>
<td style="text-align:right">102.62</td>
<td style="text-align:right">104.32</td>
</tr>
<tr>
<td style="text-align:right">IQ</td>
<td style="text-align:right">15.92</td>
<td style="text-align:right">15.72</td>
<td style="text-align:right">16.06</td>
</tr>
<tr>
<td style="text-align:right">JD</td>
<td style="text-align:right">28.19</td>
<td style="text-align:right">28.06</td>
<td style="text-align:right">28.80</td>
</tr>
</tbody>
</table>
<p>In [11]:</p>
<div class="highlight" id="id-201"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ser</span></span></span></code></pre></div><p>Out[11]:</p>
<div class="highlight" id="id-202"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">公司</span>    <span class="n">日期</span>        
</span></span><span class="line"><span class="cl"><span class="n">BABA</span>  <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">01</span>    <span class="mf">165.15</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">02</span>    <span class="mf">165.77</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">03</span>    <span class="mf">169.48</span>
</span></span><span class="line"><span class="cl"><span class="n">BIDU</span>  <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">01</span>    <span class="mf">102.00</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">02</span>    <span class="mf">102.62</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">03</span>    <span class="mf">104.32</span>
</span></span><span class="line"><span class="cl"><span class="n">IQ</span>    <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">01</span>     <span class="mf">15.92</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">02</span>     <span class="mf">15.72</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">03</span>     <span class="mf">16.06</span>
</span></span><span class="line"><span class="cl"><span class="n">JD</span>    <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">01</span>     <span class="mf">28.19</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">02</span>     <span class="mf">28.06</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">03</span>     <span class="mf">28.80</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">收盘</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span></span></span></code></pre></div><p>In [12]:</p>
<div class="highlight" id="id-203"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ser</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span></span></span></code></pre></div><p>Out[12]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">公司</th>
<th style="text-align:right">日期</th>
<th style="text-align:right">收盘</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">BABA</td>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">165.15</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">BABA</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">165.77</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">BABA</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">169.48</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">102.00</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">102.62</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">104.32</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">IQ</td>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">15.92</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">IQ</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">15.72</td>
</tr>
<tr>
<td style="text-align:right">8</td>
<td style="text-align:right">IQ</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">16.06</td>
</tr>
<tr>
<td style="text-align:right">9</td>
<td style="text-align:right">JD</td>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">28.19</td>
</tr>
<tr>
<td style="text-align:right">10</td>
<td style="text-align:right">JD</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">28.06</td>
</tr>
<tr>
<td style="text-align:right">11</td>
<td style="text-align:right">JD</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">28.80</td>
</tr>
</tbody>
</table>
<h3 id="二series有多层索引multiindex怎样筛选数据">二、Series有多层索引MultiIndex怎样筛选数据？</h3>
<p>In [13]:</p>
<div class="highlight" id="id-204"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ser</span></span></span></code></pre></div><p>Out[13]:</p>
<div class="highlight" id="id-205"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">公司</span>    <span class="n">日期</span>        
</span></span><span class="line"><span class="cl"><span class="n">BABA</span>  <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">01</span>    <span class="mf">165.15</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">02</span>    <span class="mf">165.77</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">03</span>    <span class="mf">169.48</span>
</span></span><span class="line"><span class="cl"><span class="n">BIDU</span>  <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">01</span>    <span class="mf">102.00</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">02</span>    <span class="mf">102.62</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">03</span>    <span class="mf">104.32</span>
</span></span><span class="line"><span class="cl"><span class="n">IQ</span>    <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">01</span>     <span class="mf">15.92</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">02</span>     <span class="mf">15.72</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">03</span>     <span class="mf">16.06</span>
</span></span><span class="line"><span class="cl"><span class="n">JD</span>    <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">01</span>     <span class="mf">28.19</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">02</span>     <span class="mf">28.06</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">03</span>     <span class="mf">28.80</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">收盘</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span></span></span></code></pre></div><p>In [14]:</p>
<div class="highlight" id="id-206"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ser</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;BIDU&#39;</span><span class="p">]</span></span></span></code></pre></div><p>Out[14]:</p>
<div class="highlight" id="id-207"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">日期</span>
</span></span><span class="line"><span class="cl"><span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">01</span>    <span class="mf">102.00</span>
</span></span><span class="line"><span class="cl"><span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">02</span>    <span class="mf">102.62</span>
</span></span><span class="line"><span class="cl"><span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">03</span>    <span class="mf">104.32</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">收盘</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span></span></span></code></pre></div><p>In [15]:</p>
<div class="highlight" id="id-208"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 多层索引，可以用元组的形式筛选</span>
</span></span><span class="line"><span class="cl"><span class="n">ser</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;BIDU&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-02&#39;</span><span class="p">)]</span></span></span></code></pre></div><p>Out[15]:</p>
<div class="highlight" id="id-209"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mf">102.62</span></span></span></code></pre></div><p>In [16]:</p>
<div class="highlight" id="id-210"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ser</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;2019-10-02&#39;</span><span class="p">]</span></span></span></code></pre></div><p>Out[16]:</p>
<div class="highlight" id="id-211"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">公司</span>
</span></span><span class="line"><span class="cl"><span class="n">BABA</span>    <span class="mf">165.77</span>
</span></span><span class="line"><span class="cl"><span class="n">BIDU</span>    <span class="mf">102.62</span>
</span></span><span class="line"><span class="cl"><span class="n">IQ</span>       <span class="mf">15.72</span>
</span></span><span class="line"><span class="cl"><span class="n">JD</span>       <span class="mf">28.06</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">收盘</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span></span></span></code></pre></div><h3 id="三dataframe的多层索引multiindex">三、DataFrame的多层索引MultiIndex</h3>
<p>In [17]:</p>
<div class="highlight" id="id-212"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[17]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">日期</th>
<th style="text-align:right">公司</th>
<th style="text-align:right">收盘</th>
<th style="text-align:right">开盘</th>
<th style="text-align:right">高</th>
<th style="text-align:right">低</th>
<th style="text-align:right">交易量</th>
<th style="text-align:right">涨跌幅</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">104.32</td>
<td style="text-align:right">102.35</td>
<td style="text-align:right">104.73</td>
<td style="text-align:right">101.15</td>
<td style="text-align:right">2.24</td>
<td style="text-align:right">0.02</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">102.62</td>
<td style="text-align:right">100.85</td>
<td style="text-align:right">103.24</td>
<td style="text-align:right">99.50</td>
<td style="text-align:right">2.69</td>
<td style="text-align:right">0.01</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">102.00</td>
<td style="text-align:right">102.80</td>
<td style="text-align:right">103.26</td>
<td style="text-align:right">101.00</td>
<td style="text-align:right">1.78</td>
<td style="text-align:right">-0.01</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">BABA</td>
<td style="text-align:right">169.48</td>
<td style="text-align:right">166.65</td>
<td style="text-align:right">170.18</td>
<td style="text-align:right">165.00</td>
<td style="text-align:right">10.39</td>
<td style="text-align:right">0.02</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">BABA</td>
<td style="text-align:right">165.77</td>
<td style="text-align:right">162.82</td>
<td style="text-align:right">166.88</td>
<td style="text-align:right">161.90</td>
<td style="text-align:right">11.60</td>
<td style="text-align:right">0.00</td>
</tr>
</tbody>
</table>
<p>In [18]:</p>
<div class="highlight" id="id-213"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;公司&#39;</span><span class="p">,</span> <span class="s1">&#39;日期&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">stocks</span></span></span></code></pre></div><p>Out[18]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right"></th>
<th style="text-align:right">收盘</th>
<th style="text-align:right">开盘</th>
<th style="text-align:right">高</th>
<th style="text-align:right">低</th>
<th style="text-align:right">交易量</th>
<th style="text-align:right">涨跌幅</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">公司</td>
<td style="text-align:right">日期</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">104.32</td>
<td style="text-align:right">102.35</td>
<td style="text-align:right">104.73</td>
<td style="text-align:right">101.15</td>
<td style="text-align:right">2.24</td>
<td style="text-align:right">0.02</td>
</tr>
<tr>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">102.62</td>
<td style="text-align:right">100.85</td>
<td style="text-align:right">103.24</td>
<td style="text-align:right">99.50</td>
<td style="text-align:right">2.69</td>
<td style="text-align:right">0.01</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">102.00</td>
<td style="text-align:right">102.80</td>
<td style="text-align:right">103.26</td>
<td style="text-align:right">101.00</td>
<td style="text-align:right">1.78</td>
<td style="text-align:right">-0.01</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">BABA</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">169.48</td>
<td style="text-align:right">166.65</td>
<td style="text-align:right">170.18</td>
<td style="text-align:right">165.00</td>
<td style="text-align:right">10.39</td>
<td style="text-align:right">0.02</td>
</tr>
<tr>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">165.77</td>
<td style="text-align:right">162.82</td>
<td style="text-align:right">166.88</td>
<td style="text-align:right">161.90</td>
<td style="text-align:right">11.60</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">165.15</td>
<td style="text-align:right">168.01</td>
<td style="text-align:right">168.23</td>
<td style="text-align:right">163.64</td>
<td style="text-align:right">14.19</td>
<td style="text-align:right">-0.01</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">IQ</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">16.06</td>
<td style="text-align:right">15.71</td>
<td style="text-align:right">16.38</td>
<td style="text-align:right">15.32</td>
<td style="text-align:right">10.08</td>
<td style="text-align:right">0.02</td>
</tr>
<tr>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">15.72</td>
<td style="text-align:right">15.85</td>
<td style="text-align:right">15.87</td>
<td style="text-align:right">15.12</td>
<td style="text-align:right">8.10</td>
<td style="text-align:right">-0.01</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">15.92</td>
<td style="text-align:right">16.14</td>
<td style="text-align:right">16.22</td>
<td style="text-align:right">15.50</td>
<td style="text-align:right">11.65</td>
<td style="text-align:right">-0.01</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">JD</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">28.80</td>
<td style="text-align:right">28.11</td>
<td style="text-align:right">28.97</td>
<td style="text-align:right">27.82</td>
<td style="text-align:right">8.77</td>
<td style="text-align:right">0.03</td>
</tr>
<tr>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">28.06</td>
<td style="text-align:right">28.00</td>
<td style="text-align:right">28.22</td>
<td style="text-align:right">27.53</td>
<td style="text-align:right">9.53</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">28.19</td>
<td style="text-align:right">28.22</td>
<td style="text-align:right">28.57</td>
<td style="text-align:right">27.97</td>
<td style="text-align:right">10.64</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right"></td>
</tr>
</tbody>
</table>
<p>In [19]:</p>
<div class="highlight" id="id-214"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span><span class="o">.</span><span class="n">index</span></span></span></code></pre></div><p>Out[19]:</p>
<div class="highlight" id="id-215"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">MultiIndex</span><span class="p">([(</span><span class="s1">&#39;BIDU&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-03&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="s1">&#39;BIDU&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-02&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="s1">&#39;BIDU&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-01&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="s1">&#39;BABA&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-03&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="s1">&#39;BABA&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-02&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="s1">&#39;BABA&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-01&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span>  <span class="s1">&#39;IQ&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-03&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span>  <span class="s1">&#39;IQ&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-02&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span>  <span class="s1">&#39;IQ&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-01&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span>  <span class="s1">&#39;JD&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-03&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span>  <span class="s1">&#39;JD&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-02&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span>  <span class="s1">&#39;JD&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-01&#39;</span><span class="p">)],</span>
</span></span><span class="line"><span class="cl">           <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;公司&#39;</span><span class="p">,</span> <span class="s1">&#39;日期&#39;</span><span class="p">])</span></span></span></code></pre></div><p>In [20]:</p>
<div class="highlight" id="id-216"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">stocks</span></span></span></code></pre></div><p>Out[20]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right"></th>
<th style="text-align:right">收盘</th>
<th style="text-align:right">开盘</th>
<th style="text-align:right">高</th>
<th style="text-align:right">低</th>
<th style="text-align:right">交易量</th>
<th style="text-align:right">涨跌幅</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">公司</td>
<td style="text-align:right">日期</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">BABA</td>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">165.15</td>
<td style="text-align:right">168.01</td>
<td style="text-align:right">168.23</td>
<td style="text-align:right">163.64</td>
<td style="text-align:right">14.19</td>
<td style="text-align:right">-0.01</td>
</tr>
<tr>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">165.77</td>
<td style="text-align:right">162.82</td>
<td style="text-align:right">166.88</td>
<td style="text-align:right">161.90</td>
<td style="text-align:right">11.60</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">169.48</td>
<td style="text-align:right">166.65</td>
<td style="text-align:right">170.18</td>
<td style="text-align:right">165.00</td>
<td style="text-align:right">10.39</td>
<td style="text-align:right">0.02</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">102.00</td>
<td style="text-align:right">102.80</td>
<td style="text-align:right">103.26</td>
<td style="text-align:right">101.00</td>
<td style="text-align:right">1.78</td>
<td style="text-align:right">-0.01</td>
</tr>
<tr>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">102.62</td>
<td style="text-align:right">100.85</td>
<td style="text-align:right">103.24</td>
<td style="text-align:right">99.50</td>
<td style="text-align:right">2.69</td>
<td style="text-align:right">0.01</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">104.32</td>
<td style="text-align:right">102.35</td>
<td style="text-align:right">104.73</td>
<td style="text-align:right">101.15</td>
<td style="text-align:right">2.24</td>
<td style="text-align:right">0.02</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">IQ</td>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">15.92</td>
<td style="text-align:right">16.14</td>
<td style="text-align:right">16.22</td>
<td style="text-align:right">15.50</td>
<td style="text-align:right">11.65</td>
<td style="text-align:right">-0.01</td>
</tr>
<tr>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">15.72</td>
<td style="text-align:right">15.85</td>
<td style="text-align:right">15.87</td>
<td style="text-align:right">15.12</td>
<td style="text-align:right">8.10</td>
<td style="text-align:right">-0.01</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">16.06</td>
<td style="text-align:right">15.71</td>
<td style="text-align:right">16.38</td>
<td style="text-align:right">15.32</td>
<td style="text-align:right">10.08</td>
<td style="text-align:right">0.02</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">JD</td>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">28.19</td>
<td style="text-align:right">28.22</td>
<td style="text-align:right">28.57</td>
<td style="text-align:right">27.97</td>
<td style="text-align:right">10.64</td>
<td style="text-align:right">0.00</td>
</tr>
<tr>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">28.06</td>
<td style="text-align:right">28.00</td>
<td style="text-align:right">28.22</td>
<td style="text-align:right">27.53</td>
<td style="text-align:right">9.53</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">28.80</td>
<td style="text-align:right">28.11</td>
<td style="text-align:right">28.97</td>
<td style="text-align:right">27.82</td>
<td style="text-align:right">8.77</td>
<td style="text-align:right">0.03</td>
<td style="text-align:right"></td>
</tr>
</tbody>
</table>
<h3 id="四dataframe有多层索引multiindex怎样筛选数据">四、DataFrame有多层索引MultiIndex怎样筛选数据？</h3>
<p>【*<strong>重要知识*</strong>】在选择数据时：</p>
<ul>
<li>元组(key1,key2)代表筛选多层索引，其中key1是索引第一级，key2是第二级，比如key1=JD, key2=2019-10-02</li>
<li>列表[key1,key2]代表同一层的多个KEY，其中key1和key2是并列的同级索引，比如key1=JD, key2=BIDU</li>
</ul>
<p>In [21]:</p>
<div class="highlight" id="id-217"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;BIDU&#39;</span><span class="p">]</span></span></span></code></pre></div><p>Out[21]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">收盘</th>
<th style="text-align:right">开盘</th>
<th style="text-align:right">高</th>
<th style="text-align:right">低</th>
<th style="text-align:right">交易量</th>
<th style="text-align:right">涨跌幅</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">日期</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">102.00</td>
<td style="text-align:right">102.80</td>
<td style="text-align:right">103.26</td>
<td style="text-align:right">101.00</td>
<td style="text-align:right">1.78</td>
<td style="text-align:right">-0.01</td>
</tr>
<tr>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">102.62</td>
<td style="text-align:right">100.85</td>
<td style="text-align:right">103.24</td>
<td style="text-align:right">99.50</td>
<td style="text-align:right">2.69</td>
<td style="text-align:right">0.01</td>
</tr>
<tr>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">104.32</td>
<td style="text-align:right">102.35</td>
<td style="text-align:right">104.73</td>
<td style="text-align:right">101.15</td>
<td style="text-align:right">2.24</td>
<td style="text-align:right">0.02</td>
</tr>
</tbody>
</table>
<p>In [22]:</p>
<div class="highlight" id="id-218"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;BIDU&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-02&#39;</span><span class="p">),</span> <span class="p">:]</span></span></span></code></pre></div><p>Out[22]:</p>
<div class="highlight" id="id-219"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">收盘</span>     <span class="mf">102.62</span>
</span></span><span class="line"><span class="cl"><span class="n">开盘</span>     <span class="mf">100.85</span>
</span></span><span class="line"><span class="cl"><span class="n">高</span>      <span class="mf">103.24</span>
</span></span><span class="line"><span class="cl"><span class="n">低</span>       <span class="mf">99.50</span>
</span></span><span class="line"><span class="cl"><span class="n">交易量</span>      <span class="mf">2.69</span>
</span></span><span class="line"><span class="cl"><span class="n">涨跌幅</span>      <span class="mf">0.01</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="p">(</span><span class="n">BIDU</span><span class="p">,</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">02</span><span class="p">),</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span></span></span></code></pre></div><p>In [23]:</p>
<div class="highlight" id="id-220"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;BIDU&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-02&#39;</span><span class="p">),</span> <span class="s1">&#39;开盘&#39;</span><span class="p">]</span></span></span></code></pre></div><p>Out[23]:</p>
<div class="highlight" id="id-221"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mf">100.85</span></span></span></code></pre></div><p>In [24]:</p>
<div class="highlight" id="id-222"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;BIDU&#39;</span><span class="p">,</span> <span class="s1">&#39;JD&#39;</span><span class="p">],</span> <span class="p">:]</span></span></span></code></pre></div><p>Out[24]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right"></th>
<th style="text-align:right">收盘</th>
<th style="text-align:right">开盘</th>
<th style="text-align:right">高</th>
<th style="text-align:right">低</th>
<th style="text-align:right">交易量</th>
<th style="text-align:right">涨跌幅</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">公司</td>
<td style="text-align:right">日期</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">102.00</td>
<td style="text-align:right">102.80</td>
<td style="text-align:right">103.26</td>
<td style="text-align:right">101.00</td>
<td style="text-align:right">1.78</td>
<td style="text-align:right">-0.01</td>
</tr>
<tr>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">102.62</td>
<td style="text-align:right">100.85</td>
<td style="text-align:right">103.24</td>
<td style="text-align:right">99.50</td>
<td style="text-align:right">2.69</td>
<td style="text-align:right">0.01</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">104.32</td>
<td style="text-align:right">102.35</td>
<td style="text-align:right">104.73</td>
<td style="text-align:right">101.15</td>
<td style="text-align:right">2.24</td>
<td style="text-align:right">0.02</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">JD</td>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">28.19</td>
<td style="text-align:right">28.22</td>
<td style="text-align:right">28.57</td>
<td style="text-align:right">27.97</td>
<td style="text-align:right">10.64</td>
<td style="text-align:right">0.00</td>
</tr>
<tr>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">28.06</td>
<td style="text-align:right">28.00</td>
<td style="text-align:right">28.22</td>
<td style="text-align:right">27.53</td>
<td style="text-align:right">9.53</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">28.80</td>
<td style="text-align:right">28.11</td>
<td style="text-align:right">28.97</td>
<td style="text-align:right">27.82</td>
<td style="text-align:right">8.77</td>
<td style="text-align:right">0.03</td>
<td style="text-align:right"></td>
</tr>
</tbody>
</table>
<p>In [25]:</p>
<div class="highlight" id="id-223"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span><span class="o">.</span><span class="n">loc</span><span class="p">[([</span><span class="s1">&#39;BIDU&#39;</span><span class="p">,</span> <span class="s1">&#39;JD&#39;</span><span class="p">],</span> <span class="s1">&#39;2019-10-03&#39;</span><span class="p">),</span> <span class="p">:]</span></span></span></code></pre></div><p>Out[25]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right"></th>
<th style="text-align:right">收盘</th>
<th style="text-align:right">开盘</th>
<th style="text-align:right">高</th>
<th style="text-align:right">低</th>
<th style="text-align:right">交易量</th>
<th style="text-align:right">涨跌幅</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">公司</td>
<td style="text-align:right">日期</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">104.32</td>
<td style="text-align:right">102.35</td>
<td style="text-align:right">104.73</td>
<td style="text-align:right">101.15</td>
<td style="text-align:right">2.24</td>
<td style="text-align:right">0.02</td>
</tr>
<tr>
<td style="text-align:right">JD</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">28.80</td>
<td style="text-align:right">28.11</td>
<td style="text-align:right">28.97</td>
<td style="text-align:right">27.82</td>
<td style="text-align:right">8.77</td>
<td style="text-align:right">0.03</td>
</tr>
</tbody>
</table>
<p>In [26]:</p>
<div class="highlight" id="id-224"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span><span class="o">.</span><span class="n">loc</span><span class="p">[([</span><span class="s1">&#39;BIDU&#39;</span><span class="p">,</span> <span class="s1">&#39;JD&#39;</span><span class="p">],</span> <span class="s1">&#39;2019-10-03&#39;</span><span class="p">),</span> <span class="s1">&#39;收盘&#39;</span><span class="p">]</span></span></span></code></pre></div><p>Out[26]:</p>
<div class="highlight" id="id-225"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">公司</span>    <span class="n">日期</span>        
</span></span><span class="line"><span class="cl"><span class="n">BIDU</span>  <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">03</span>    <span class="mf">104.32</span>
</span></span><span class="line"><span class="cl"><span class="n">JD</span>    <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">03</span>     <span class="mf">28.80</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">收盘</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span></span></span></code></pre></div><p>In [27]:</p>
<div class="highlight" id="id-226"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;BIDU&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;2019-10-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-03&#39;</span><span class="p">]),</span> <span class="s1">&#39;收盘&#39;</span><span class="p">]</span></span></span></code></pre></div><p>Out[27]:</p>
<pre tabindex="0"><code>公司    日期        
BIDU  2019-10-02    102.62
      2019-10-03    104.32
Name: 收盘, dtype: float64</code></pre><p>In [28]:</p>
<div class="highlight" id="id-228"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># slice(None)代表筛选这一索引的所有内容</span>
</span></span><span class="line"><span class="cl"><span class="n">stocks</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;2019-10-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-03&#39;</span><span class="p">]),</span> <span class="p">:]</span></span></span></code></pre></div><p>Out[28]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right"></th>
<th style="text-align:right">收盘</th>
<th style="text-align:right">开盘</th>
<th style="text-align:right">高</th>
<th style="text-align:right">低</th>
<th style="text-align:right">交易量</th>
<th style="text-align:right">涨跌幅</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">公司</td>
<td style="text-align:right">日期</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">BABA</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">165.77</td>
<td style="text-align:right">162.82</td>
<td style="text-align:right">166.88</td>
<td style="text-align:right">161.90</td>
<td style="text-align:right">11.60</td>
<td style="text-align:right">0.00</td>
</tr>
<tr>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">169.48</td>
<td style="text-align:right">166.65</td>
<td style="text-align:right">170.18</td>
<td style="text-align:right">165.00</td>
<td style="text-align:right">10.39</td>
<td style="text-align:right">0.02</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">102.62</td>
<td style="text-align:right">100.85</td>
<td style="text-align:right">103.24</td>
<td style="text-align:right">99.50</td>
<td style="text-align:right">2.69</td>
<td style="text-align:right">0.01</td>
</tr>
<tr>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">104.32</td>
<td style="text-align:right">102.35</td>
<td style="text-align:right">104.73</td>
<td style="text-align:right">101.15</td>
<td style="text-align:right">2.24</td>
<td style="text-align:right">0.02</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">IQ</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">15.72</td>
<td style="text-align:right">15.85</td>
<td style="text-align:right">15.87</td>
<td style="text-align:right">15.12</td>
<td style="text-align:right">8.10</td>
<td style="text-align:right">-0.01</td>
</tr>
<tr>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">16.06</td>
<td style="text-align:right">15.71</td>
<td style="text-align:right">16.38</td>
<td style="text-align:right">15.32</td>
<td style="text-align:right">10.08</td>
<td style="text-align:right">0.02</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">JD</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">28.06</td>
<td style="text-align:right">28.00</td>
<td style="text-align:right">28.22</td>
<td style="text-align:right">27.53</td>
<td style="text-align:right">9.53</td>
<td style="text-align:right">0.00</td>
</tr>
<tr>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">28.80</td>
<td style="text-align:right">28.11</td>
<td style="text-align:right">28.97</td>
<td style="text-align:right">27.82</td>
<td style="text-align:right">8.77</td>
<td style="text-align:right">0.03</td>
<td style="text-align:right"></td>
</tr>
</tbody>
</table>
<p>In [29]:</p>
<pre tabindex="0"><code>stocks.reset_index()</code></pre><p>Out[29]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">公司</th>
<th style="text-align:right">日期</th>
<th style="text-align:right">收盘</th>
<th style="text-align:right">开盘</th>
<th style="text-align:right">高</th>
<th style="text-align:right">低</th>
<th style="text-align:right">交易量</th>
<th style="text-align:right">涨跌幅</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">BABA</td>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">165.15</td>
<td style="text-align:right">168.01</td>
<td style="text-align:right">168.23</td>
<td style="text-align:right">163.64</td>
<td style="text-align:right">14.19</td>
<td style="text-align:right">-0.01</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">BABA</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">165.77</td>
<td style="text-align:right">162.82</td>
<td style="text-align:right">166.88</td>
<td style="text-align:right">161.90</td>
<td style="text-align:right">11.60</td>
<td style="text-align:right">0.00</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">BABA</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">169.48</td>
<td style="text-align:right">166.65</td>
<td style="text-align:right">170.18</td>
<td style="text-align:right">165.00</td>
<td style="text-align:right">10.39</td>
<td style="text-align:right">0.02</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">102.00</td>
<td style="text-align:right">102.80</td>
<td style="text-align:right">103.26</td>
<td style="text-align:right">101.00</td>
<td style="text-align:right">1.78</td>
<td style="text-align:right">-0.01</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">102.62</td>
<td style="text-align:right">100.85</td>
<td style="text-align:right">103.24</td>
<td style="text-align:right">99.50</td>
<td style="text-align:right">2.69</td>
<td style="text-align:right">0.01</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">104.32</td>
<td style="text-align:right">102.35</td>
<td style="text-align:right">104.73</td>
<td style="text-align:right">101.15</td>
<td style="text-align:right">2.24</td>
<td style="text-align:right">0.02</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">IQ</td>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">15.92</td>
<td style="text-align:right">16.14</td>
<td style="text-align:right">16.22</td>
<td style="text-align:right">15.50</td>
<td style="text-align:right">11.65</td>
<td style="text-align:right">-0.01</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">IQ</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">15.72</td>
<td style="text-align:right">15.85</td>
<td style="text-align:right">15.87</td>
<td style="text-align:right">15.12</td>
<td style="text-align:right">8.10</td>
<td style="text-align:right">-0.01</td>
</tr>
<tr>
<td style="text-align:right">8</td>
<td style="text-align:right">IQ</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">16.06</td>
<td style="text-align:right">15.71</td>
<td style="text-align:right">16.38</td>
<td style="text-align:right">15.32</td>
<td style="text-align:right">10.08</td>
<td style="text-align:right">0.02</td>
</tr>
<tr>
<td style="text-align:right">9</td>
<td style="text-align:right">JD</td>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">28.19</td>
<td style="text-align:right">28.22</td>
<td style="text-align:right">28.57</td>
<td style="text-align:right">27.97</td>
<td style="text-align:right">10.64</td>
<td style="text-align:right">0.00</td>
</tr>
<tr>
<td style="text-align:right">10</td>
<td style="text-align:right">JD</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">28.06</td>
<td style="text-align:right">28.00</td>
<td style="text-align:right">28.22</td>
<td style="text-align:right">27.53</td>
<td style="text-align:right">9.53</td>
<td style="text-align:right">0.00</td>
</tr>
<tr>
<td style="text-align:right">11</td>
<td style="text-align:right">JD</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">28.80</td>
<td style="text-align:right">28.11</td>
<td style="text-align:right">28.97</td>
<td style="text-align:right">27.82</td>
<td style="text-align:right">8.77</td>
<td style="text-align:right">0.03</td>
</tr>
</tbody>
</table>
<h1 id="18pandas的数据转换函数mapapplyapplymap">18、Pandas的数据转换函数map、apply、applymap</h1>
<p>数据转换函数对比：map、apply、applymap：</p>
<ol>
<li>map：只用于Series，实现每个值-&gt;值的映射；</li>
<li>apply：用于Series实现每个值的处理，用于Dataframe实现某个轴的Series的处理；</li>
<li>applymap：只能用于DataFrame，用于处理该DataFrame的每个元素；</li>
</ol>
<h3 id="1-map用于series值的转换">1. map用于Series值的转换</h3>
<p>实例：将股票代码英文转换成中文名字</p>
<p>Series.map(dict) or Series.map(function)均可</p>
<p>In [1]:</p>
<div class="highlight" id="id-230"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="n">stocks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;./datas/stocks/互联网公司股票.xlsx&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">stocks</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[1]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">日期</th>
<th style="text-align:right">公司</th>
<th style="text-align:right">收盘</th>
<th style="text-align:right">开盘</th>
<th style="text-align:right">高</th>
<th style="text-align:right">低</th>
<th style="text-align:right">交易量</th>
<th style="text-align:right">涨跌幅</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">104.32</td>
<td style="text-align:right">102.35</td>
<td style="text-align:right">104.73</td>
<td style="text-align:right">101.15</td>
<td style="text-align:right">2.24</td>
<td style="text-align:right">0.02</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">102.62</td>
<td style="text-align:right">100.85</td>
<td style="text-align:right">103.24</td>
<td style="text-align:right">99.50</td>
<td style="text-align:right">2.69</td>
<td style="text-align:right">0.01</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">102.00</td>
<td style="text-align:right">102.80</td>
<td style="text-align:right">103.26</td>
<td style="text-align:right">101.00</td>
<td style="text-align:right">1.78</td>
<td style="text-align:right">-0.01</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">BABA</td>
<td style="text-align:right">169.48</td>
<td style="text-align:right">166.65</td>
<td style="text-align:right">170.18</td>
<td style="text-align:right">165.00</td>
<td style="text-align:right">10.39</td>
<td style="text-align:right">0.02</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">BABA</td>
<td style="text-align:right">165.77</td>
<td style="text-align:right">162.82</td>
<td style="text-align:right">166.88</td>
<td style="text-align:right">161.90</td>
<td style="text-align:right">11.60</td>
<td style="text-align:right">0.00</td>
</tr>
</tbody>
</table>
<p>In [2]:</p>
<div class="highlight" id="id-231"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span><span class="p">[</span><span class="s2">&#34;公司&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span></span></span></code></pre></div><p>Out[2]:</p>
<div class="highlight" id="id-232"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">array</span><span class="p">([</span><span class="s1">&#39;BIDU&#39;</span><span class="p">,</span> <span class="s1">&#39;BABA&#39;</span><span class="p">,</span> <span class="s1">&#39;IQ&#39;</span><span class="p">,</span> <span class="s1">&#39;JD&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span></span></span></code></pre></div><p>In [3]:</p>
<div class="highlight" id="id-233"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 公司股票代码到中文的映射，注意这里是小写</span>
</span></span><span class="line"><span class="cl"><span class="n">dict_company_names</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;bidu&#34;</span><span class="p">:</span> <span class="s2">&#34;百度&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;baba&#34;</span><span class="p">:</span> <span class="s2">&#34;阿里巴巴&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;iq&#34;</span><span class="p">:</span> <span class="s2">&#34;爱奇艺&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;jd&#34;</span><span class="p">:</span> <span class="s2">&#34;京东&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><h4 id="方法1seriesmapdict">方法1：Series.map(dict)</h4>
<p>In [4]:</p>
<div class="highlight" id="id-234"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span><span class="p">[</span><span class="s2">&#34;公司中文1&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stocks</span><span class="p">[</span><span class="s2">&#34;公司&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_company_names</span><span class="p">)</span></span></span></code></pre></div><p>In [5]:</p>
<div class="highlight" id="id-235"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[5]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">日期</th>
<th style="text-align:right">公司</th>
<th style="text-align:right">收盘</th>
<th style="text-align:right">开盘</th>
<th style="text-align:right">高</th>
<th style="text-align:right">低</th>
<th style="text-align:right">交易量</th>
<th style="text-align:right">涨跌幅</th>
<th style="text-align:right">公司中文1</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">104.32</td>
<td style="text-align:right">102.35</td>
<td style="text-align:right">104.73</td>
<td style="text-align:right">101.15</td>
<td style="text-align:right">2.24</td>
<td style="text-align:right">0.02</td>
<td style="text-align:right">百度</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">102.62</td>
<td style="text-align:right">100.85</td>
<td style="text-align:right">103.24</td>
<td style="text-align:right">99.50</td>
<td style="text-align:right">2.69</td>
<td style="text-align:right">0.01</td>
<td style="text-align:right">百度</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">102.00</td>
<td style="text-align:right">102.80</td>
<td style="text-align:right">103.26</td>
<td style="text-align:right">101.00</td>
<td style="text-align:right">1.78</td>
<td style="text-align:right">-0.01</td>
<td style="text-align:right">百度</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">BABA</td>
<td style="text-align:right">169.48</td>
<td style="text-align:right">166.65</td>
<td style="text-align:right">170.18</td>
<td style="text-align:right">165.00</td>
<td style="text-align:right">10.39</td>
<td style="text-align:right">0.02</td>
<td style="text-align:right">阿里巴巴</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">BABA</td>
<td style="text-align:right">165.77</td>
<td style="text-align:right">162.82</td>
<td style="text-align:right">166.88</td>
<td style="text-align:right">161.90</td>
<td style="text-align:right">11.60</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right">阿里巴巴</td>
</tr>
</tbody>
</table>
<h4 id="方法2seriesmapfunction">方法2：Series.map(function)</h4>
<p>function的参数是Series的每个元素的值</p>
<p>In [6]:</p>
<pre tabindex="0"><code>stocks[&#34;公司中文2&#34;] = stocks[&#34;公司&#34;].map(lambda x : dict_company_names[x.lower()])</code></pre><p>In [7]:</p>
<pre tabindex="0"><code>stocks.head()</code></pre><p>Out[7]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">日期</th>
<th style="text-align:right">公司</th>
<th style="text-align:right">收盘</th>
<th style="text-align:right">开盘</th>
<th style="text-align:right">高</th>
<th style="text-align:right">低</th>
<th style="text-align:right">交易量</th>
<th style="text-align:right">涨跌幅</th>
<th style="text-align:right">公司中文1</th>
<th style="text-align:right">公司中文2</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">104.32</td>
<td style="text-align:right">102.35</td>
<td style="text-align:right">104.73</td>
<td style="text-align:right">101.15</td>
<td style="text-align:right">2.24</td>
<td style="text-align:right">0.02</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">102.62</td>
<td style="text-align:right">100.85</td>
<td style="text-align:right">103.24</td>
<td style="text-align:right">99.50</td>
<td style="text-align:right">2.69</td>
<td style="text-align:right">0.01</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">102.00</td>
<td style="text-align:right">102.80</td>
<td style="text-align:right">103.26</td>
<td style="text-align:right">101.00</td>
<td style="text-align:right">1.78</td>
<td style="text-align:right">-0.01</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">BABA</td>
<td style="text-align:right">169.48</td>
<td style="text-align:right">166.65</td>
<td style="text-align:right">170.18</td>
<td style="text-align:right">165.00</td>
<td style="text-align:right">10.39</td>
<td style="text-align:right">0.02</td>
<td style="text-align:right">阿里巴巴</td>
<td style="text-align:right">阿里巴巴</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">BABA</td>
<td style="text-align:right">165.77</td>
<td style="text-align:right">162.82</td>
<td style="text-align:right">166.88</td>
<td style="text-align:right">161.90</td>
<td style="text-align:right">11.60</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right">阿里巴巴</td>
<td style="text-align:right">阿里巴巴</td>
</tr>
</tbody>
</table>
<h3 id="2-apply用于series和dataframe的转换">2. apply用于Series和DataFrame的转换</h3>
<ul>
<li>Series.apply(function), 函数的参数是每个值</li>
<li>DataFrame.apply(function), 函数的参数是Series</li>
</ul>
<h4 id="seriesapplyfunction">Series.apply(function)</h4>
<p>function的参数是Series的每个值</p>
<p>In [8]:</p>
<div class="highlight" id="id-238"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span><span class="p">[</span><span class="s2">&#34;公司中文3&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stocks</span><span class="p">[</span><span class="s2">&#34;公司&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">dict_company_names</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()])</span></span></span></code></pre></div><p>In [9]:</p>
<div class="highlight" id="id-239"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[9]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">日期</th>
<th style="text-align:right">公司</th>
<th style="text-align:right">收盘</th>
<th style="text-align:right">开盘</th>
<th style="text-align:right">高</th>
<th style="text-align:right">低</th>
<th style="text-align:right">交易量</th>
<th style="text-align:right">涨跌幅</th>
<th style="text-align:right">公司中文1</th>
<th style="text-align:right">公司中文2</th>
<th style="text-align:right">公司中文3</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">104.32</td>
<td style="text-align:right">102.35</td>
<td style="text-align:right">104.73</td>
<td style="text-align:right">101.15</td>
<td style="text-align:right">2.24</td>
<td style="text-align:right">0.02</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">102.62</td>
<td style="text-align:right">100.85</td>
<td style="text-align:right">103.24</td>
<td style="text-align:right">99.50</td>
<td style="text-align:right">2.69</td>
<td style="text-align:right">0.01</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">102.00</td>
<td style="text-align:right">102.80</td>
<td style="text-align:right">103.26</td>
<td style="text-align:right">101.00</td>
<td style="text-align:right">1.78</td>
<td style="text-align:right">-0.01</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">BABA</td>
<td style="text-align:right">169.48</td>
<td style="text-align:right">166.65</td>
<td style="text-align:right">170.18</td>
<td style="text-align:right">165.00</td>
<td style="text-align:right">10.39</td>
<td style="text-align:right">0.02</td>
<td style="text-align:right">阿里巴巴</td>
<td style="text-align:right">阿里巴巴</td>
<td style="text-align:right">阿里巴巴</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">BABA</td>
<td style="text-align:right">165.77</td>
<td style="text-align:right">162.82</td>
<td style="text-align:right">166.88</td>
<td style="text-align:right">161.90</td>
<td style="text-align:right">11.60</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right">阿里巴巴</td>
<td style="text-align:right">阿里巴巴</td>
<td style="text-align:right">阿里巴巴</td>
</tr>
</tbody>
</table>
<h4 id="dataframeapplyfunction">DataFrame.apply(function)</h4>
<p>function的参数是对应轴的Series</p>
<p>In [10]:</p>
<div class="highlight" id="id-240"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span><span class="p">[</span><span class="s2">&#34;公司中文4&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stocks</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">dict_company_names</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s2">&#34;公司&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()],</span> 
</span></span><span class="line"><span class="cl">    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span></span></code></pre></div><p>注意这个代码：
1、apply是在stocks这个DataFrame上调用；
2、lambda x的x是一个Series，因为指定了axis=1所以Seires的key是列名，可以用x[&lsquo;公司&rsquo;]获取</p>
<p>In [11]:</p>
<div class="highlight" id="id-241"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[11]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">日期</th>
<th style="text-align:right">公司</th>
<th style="text-align:right">收盘</th>
<th style="text-align:right">开盘</th>
<th style="text-align:right">高</th>
<th style="text-align:right">低</th>
<th style="text-align:right">交易量</th>
<th style="text-align:right">涨跌幅</th>
<th style="text-align:right">公司中文1</th>
<th style="text-align:right">公司中文2</th>
<th style="text-align:right">公司中文3</th>
<th style="text-align:right">公司中文4</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">104.32</td>
<td style="text-align:right">102.35</td>
<td style="text-align:right">104.73</td>
<td style="text-align:right">101.15</td>
<td style="text-align:right">2.24</td>
<td style="text-align:right">0.02</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">102.62</td>
<td style="text-align:right">100.85</td>
<td style="text-align:right">103.24</td>
<td style="text-align:right">99.50</td>
<td style="text-align:right">2.69</td>
<td style="text-align:right">0.01</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">102.00</td>
<td style="text-align:right">102.80</td>
<td style="text-align:right">103.26</td>
<td style="text-align:right">101.00</td>
<td style="text-align:right">1.78</td>
<td style="text-align:right">-0.01</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">BABA</td>
<td style="text-align:right">169.48</td>
<td style="text-align:right">166.65</td>
<td style="text-align:right">170.18</td>
<td style="text-align:right">165.00</td>
<td style="text-align:right">10.39</td>
<td style="text-align:right">0.02</td>
<td style="text-align:right">阿里巴巴</td>
<td style="text-align:right">阿里巴巴</td>
<td style="text-align:right">阿里巴巴</td>
<td style="text-align:right">阿里巴巴</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">BABA</td>
<td style="text-align:right">165.77</td>
<td style="text-align:right">162.82</td>
<td style="text-align:right">166.88</td>
<td style="text-align:right">161.90</td>
<td style="text-align:right">11.60</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right">阿里巴巴</td>
<td style="text-align:right">阿里巴巴</td>
<td style="text-align:right">阿里巴巴</td>
<td style="text-align:right">阿里巴巴</td>
</tr>
</tbody>
</table>
<h3 id="3-applymap用于dataframe所有值的转换">3. applymap用于DataFrame所有值的转换</h3>
<p>In [12]:</p>
<div class="highlight" id="id-242"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">sub_df</span> <span class="o">=</span> <span class="n">stocks</span><span class="p">[[</span><span class="s1">&#39;收盘&#39;</span><span class="p">,</span> <span class="s1">&#39;开盘&#39;</span><span class="p">,</span> <span class="s1">&#39;高&#39;</span><span class="p">,</span> <span class="s1">&#39;低&#39;</span><span class="p">,</span> <span class="s1">&#39;交易量&#39;</span><span class="p">]]</span></span></span></code></pre></div><p>In [13]:</p>
<div class="highlight" id="id-243"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">sub_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[13]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">收盘</th>
<th style="text-align:right">开盘</th>
<th style="text-align:right">高</th>
<th style="text-align:right">低</th>
<th style="text-align:right">交易量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">104.32</td>
<td style="text-align:right">102.35</td>
<td style="text-align:right">104.73</td>
<td style="text-align:right">101.15</td>
<td style="text-align:right">2.24</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">102.62</td>
<td style="text-align:right">100.85</td>
<td style="text-align:right">103.24</td>
<td style="text-align:right">99.50</td>
<td style="text-align:right">2.69</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">102.00</td>
<td style="text-align:right">102.80</td>
<td style="text-align:right">103.26</td>
<td style="text-align:right">101.00</td>
<td style="text-align:right">1.78</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">169.48</td>
<td style="text-align:right">166.65</td>
<td style="text-align:right">170.18</td>
<td style="text-align:right">165.00</td>
<td style="text-align:right">10.39</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">165.77</td>
<td style="text-align:right">162.82</td>
<td style="text-align:right">166.88</td>
<td style="text-align:right">161.90</td>
<td style="text-align:right">11.60</td>
</tr>
</tbody>
</table>
<p>In [14]:</p>
<div class="highlight" id="id-244"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 将这些数字取整数，应用于所有元素</span>
</span></span><span class="line"><span class="cl"><span class="n">sub_df</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))</span></span></span></code></pre></div><p>Out[14]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">收盘</th>
<th style="text-align:right">开盘</th>
<th style="text-align:right">高</th>
<th style="text-align:right">低</th>
<th style="text-align:right">交易量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">104</td>
<td style="text-align:right">102</td>
<td style="text-align:right">104</td>
<td style="text-align:right">101</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">102</td>
<td style="text-align:right">100</td>
<td style="text-align:right">103</td>
<td style="text-align:right">99</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">102</td>
<td style="text-align:right">102</td>
<td style="text-align:right">103</td>
<td style="text-align:right">101</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">169</td>
<td style="text-align:right">166</td>
<td style="text-align:right">170</td>
<td style="text-align:right">165</td>
<td style="text-align:right">10</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">165</td>
<td style="text-align:right">162</td>
<td style="text-align:right">166</td>
<td style="text-align:right">161</td>
<td style="text-align:right">11</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">165</td>
<td style="text-align:right">168</td>
<td style="text-align:right">168</td>
<td style="text-align:right">163</td>
<td style="text-align:right">14</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">16</td>
<td style="text-align:right">15</td>
<td style="text-align:right">16</td>
<td style="text-align:right">15</td>
<td style="text-align:right">10</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">15</td>
<td style="text-align:right">15</td>
<td style="text-align:right">15</td>
<td style="text-align:right">15</td>
<td style="text-align:right">8</td>
</tr>
<tr>
<td style="text-align:right">8</td>
<td style="text-align:right">15</td>
<td style="text-align:right">16</td>
<td style="text-align:right">16</td>
<td style="text-align:right">15</td>
<td style="text-align:right">11</td>
</tr>
<tr>
<td style="text-align:right">9</td>
<td style="text-align:right">28</td>
<td style="text-align:right">28</td>
<td style="text-align:right">28</td>
<td style="text-align:right">27</td>
<td style="text-align:right">8</td>
</tr>
<tr>
<td style="text-align:right">10</td>
<td style="text-align:right">28</td>
<td style="text-align:right">28</td>
<td style="text-align:right">28</td>
<td style="text-align:right">27</td>
<td style="text-align:right">9</td>
</tr>
<tr>
<td style="text-align:right">11</td>
<td style="text-align:right">28</td>
<td style="text-align:right">28</td>
<td style="text-align:right">28</td>
<td style="text-align:right">27</td>
<td style="text-align:right">10</td>
</tr>
</tbody>
</table>
<p>In [15]:</p>
<div class="highlight" id="id-245"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 直接修改原df的这几列</span>
</span></span><span class="line"><span class="cl"><span class="n">stocks</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;收盘&#39;</span><span class="p">,</span> <span class="s1">&#39;开盘&#39;</span><span class="p">,</span> <span class="s1">&#39;高&#39;</span><span class="p">,</span> <span class="s1">&#39;低&#39;</span><span class="p">,</span> <span class="s1">&#39;交易量&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sub_df</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))</span></span></span></code></pre></div><p>In [16]:</p>
<div class="highlight" id="id-246"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">stocks</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[16]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">日期</th>
<th style="text-align:right">公司</th>
<th style="text-align:right">收盘</th>
<th style="text-align:right">开盘</th>
<th style="text-align:right">高</th>
<th style="text-align:right">低</th>
<th style="text-align:right">交易量</th>
<th style="text-align:right">涨跌幅</th>
<th style="text-align:right">公司中文1</th>
<th style="text-align:right">公司中文2</th>
<th style="text-align:right">公司中文3</th>
<th style="text-align:right">公司中文4</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">104</td>
<td style="text-align:right">102</td>
<td style="text-align:right">104</td>
<td style="text-align:right">101</td>
<td style="text-align:right">2</td>
<td style="text-align:right">0.02</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">102</td>
<td style="text-align:right">100</td>
<td style="text-align:right">103</td>
<td style="text-align:right">99</td>
<td style="text-align:right">2</td>
<td style="text-align:right">0.01</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">2019-10-01</td>
<td style="text-align:right">BIDU</td>
<td style="text-align:right">102</td>
<td style="text-align:right">102</td>
<td style="text-align:right">103</td>
<td style="text-align:right">101</td>
<td style="text-align:right">1</td>
<td style="text-align:right">-0.01</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
<td style="text-align:right">百度</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">2019-10-03</td>
<td style="text-align:right">BABA</td>
<td style="text-align:right">169</td>
<td style="text-align:right">166</td>
<td style="text-align:right">170</td>
<td style="text-align:right">165</td>
<td style="text-align:right">10</td>
<td style="text-align:right">0.02</td>
<td style="text-align:right">阿里巴巴</td>
<td style="text-align:right">阿里巴巴</td>
<td style="text-align:right">阿里巴巴</td>
<td style="text-align:right">阿里巴巴</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">2019-10-02</td>
<td style="text-align:right">BABA</td>
<td style="text-align:right">165</td>
<td style="text-align:right">162</td>
<td style="text-align:right">166</td>
<td style="text-align:right">161</td>
<td style="text-align:right">11</td>
<td style="text-align:right">0.00</td>
<td style="text-align:right">阿里巴巴</td>
<td style="text-align:right">阿里巴巴</td>
<td style="text-align:right">阿里巴巴</td>
<td style="text-align:right">阿里巴巴</td>
</tr>
</tbody>
</table>
</div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="更新于 2021-10-24 18:38:23">更新于 2021-10-24&nbsp;</span>
      </div><div class="post-info-license">
          <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span>
        </div></div>
    <div class="post-info-line">
      <div class="post-info-md"></div>
      <div class="post-info-share">
        <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="http://blog.yuanshuaicn.com/posts/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%8C-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%8C/" data-title="Python数据分析之Pandas（二）" data-hashtags="Python,数据分析"><i class="fa-brands fa-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="http://blog.yuanshuaicn.com/posts/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%8C-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%8C/" data-hashtag="Python"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="http://blog.yuanshuaicn.com/posts/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%8C-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%8C/" data-title="Python数据分析之Pandas（二）"><i class="fa-brands fa-weibo fa-fw" aria-hidden="true"></i></a>
  </span>
      </div>
    </div>
  </div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/tags/python/' class="post-tag">Python</a><a href='/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/' class="post-tag">数据分析</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="/posts/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%B8%89-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%B8%89/" class="post-nav-item" rel="prev" title="Python数据分析之Pandas（三）"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>Python数据分析之Pandas（三）</a>
      <a href="/posts/python%E7%88%AC%E8%99%AB%E4%B9%8B%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB-python%E7%88%AC%E8%99%AB%E4%B9%8B%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB/" class="post-nav-item" rel="next" title="Python爬虫之验证码识别">Python爬虫之验证码识别<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></main><footer class="footer">
    <div class="footer-container"><div class="footer-line powered">由 <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.119.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.2.18-lts.2"><img class="fixit-icon" src="/fixit.min.svg" alt="FixIt logo" />&nbsp;FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2023</span><span class="author" itemprop="copyrightHolder">
              <a href="/"></a></span></div><div class="footer-line statistics"></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="回到顶部"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">FixIt 主题在启用 JavaScript 的情况下效果最佳。</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/katex/katex.min.js" defer></script><script src="/lib/katex/auto-render.min.js" defer></script><script src="/lib/katex/copy-tex.min.js" defer></script><script src="/lib/katex/mhchem.min.js" defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script>window.config={"code":{"copyTitle":"复制到剪贴板","editLockTitle":"锁定可编辑代码块","editUnLockTitle":"解锁可编辑代码块","editable":true,"maxShownLines":10},"comment":{"enable":false},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验。"},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script src="/js/theme.min.js" defer></script></body>
</html>
