<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>Python数据分析之Pandas（四） - CN.yuanshuai</title><meta name="author" content="">
<meta name="author-link" content="">
<meta name="description" content=": | &mdash;&ndash;: | &mdash;&ndash;: | &mdash;: | &mdash;&mdash;&mdash;: | &mdash;&mdash;-: | | 0 | 1 | F | 1 | 10 | 48067 | | 1 | 2 | M | 56 | 16 | 70072 | | 2 | 3 | M | 25 | 15 | 55117 | | 3 | 4 | M | 45 | 7 | 02460 | | 4 | 5 | M" /><meta name="keywords" content='Python, 数据分析' /><meta itemprop="name" content="Python数据分析之Pandas（四）">
<meta itemprop="description" content=": | &mdash;&ndash;: | &mdash;&ndash;: | &mdash;: | &mdash;&mdash;&mdash;: | &mdash;&mdash;-: | | 0 | 1 | F | 1 | 10 | 48067 | | 1 | 2 | M | 56 | 16 | 70072 | | 2 | 3 | M | 25 | 15 | 55117 | | 3 | 4 | M | 45 | 7 | 02460 | | 4 | 5 | M"><meta itemprop="datePublished" content="2021-10-24T18:38:23+00:00" />
<meta itemprop="dateModified" content="2021-10-24T18:38:23+00:00" />
<meta itemprop="wordCount" content="17040">
<meta itemprop="keywords" content="Python,数据分析," /><meta property="og:title" content="Python数据分析之Pandas（四）" />
<meta property="og:description" content=": | &mdash;&ndash;: | &mdash;&ndash;: | &mdash;: | &mdash;&mdash;&mdash;: | &mdash;&mdash;-: | | 0 | 1 | F | 1 | 10 | 48067 | | 1 | 2 | M | 56 | 16 | 70072 | | 2 | 3 | M | 25 | 15 | 55117 | | 3 | 4 | M | 45 | 7 | 02460 | | 4 | 5 | M" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://yuanshuai1122.github.io/posts/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E5%9B%9B-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E5%9B%9B/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-24T18:38:23+00:00" />
<meta property="article:modified_time" content="2021-10-24T18:38:23+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Python数据分析之Pandas（四）"/>
<meta name="twitter:description" content=": | &mdash;&ndash;: | &mdash;&ndash;: | &mdash;: | &mdash;&mdash;&mdash;: | &mdash;&mdash;-: | | 0 | 1 | F | 1 | 10 | 48067 | | 1 | 2 | M | 56 | 16 | 70072 | | 2 | 3 | M | 25 | 15 | 55117 | | 3 | 4 | M | 45 | 7 | 02460 | | 4 | 5 | M"/>
<meta name="application-name" content="CN.yuanshuai">
<meta name="apple-mobile-web-app-title" content="CN.yuanshuai"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="http://yuanshuai1122.github.io/posts/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E5%9B%9B-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E5%9B%9B/" /><link rel="prev" href="http://yuanshuai1122.github.io/posts/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%94-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%94/" /><link rel="next" href="http://yuanshuai1122.github.io/posts/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%B8%89-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%B8%89/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Python数据分析之Pandas（四）",
    "inLanguage": "zh-CN",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "http:\/\/yuanshuai1122.github.io\/posts\/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E5%9B%9B-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E5%9B%9B\/"
    },"genre": "posts","keywords": "Python, 数据分析","wordcount":  17040 ,
    "url": "http:\/\/yuanshuai1122.github.io\/posts\/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E5%9B%9B-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E5%9B%9B\/","datePublished": "2021-10-24T18:38:23+00:00","dateModified": "2021-10-24T18:38:23+00:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "yuanshuai"
      },"description": ""
  }
  </script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="CN.yuanshuai"><img loading="lazy" src="/fixit.min.svg" srcset="/fixit.min.svg, /fixit.min.svg 1.5x, /fixit.min.svg 2x" sizes="auto" data-title="CN.yuanshuai" data-alt="CN.yuanshuai" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span class="header-title-text">CN.yuanshuai</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/posts/"
                
                
              ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 文章</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/categories/"
                
                
              ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/tags/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li class="menu-item delimiter"></li><li class="menu-item theme-switch" title="切换主题">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="CN.yuanshuai"><img loading="lazy" src="/fixit.min.svg" srcset="/fixit.min.svg, /fixit.min.svg 1.5x, /fixit.min.svg 2x" sizes="auto" data-title="/fixit.min.svg" data-alt="/fixit.min.svg" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span class="header-title-text">CN.yuanshuai</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/posts/"
                  
                  
                ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 文章</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="切换主题"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><main class="container"><aside class="toc" id="toc-auto"><h2 class="toc-title">目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside>

  <aside class="aside-custom">
    </aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>Python数据分析之Pandas（四）</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><a href="https://cloud.tencent.com/developer/user/8180692" title="作者"target="_blank" rel="external nofollow noopener noreferrer author" class="author"><img loading="lazy" src="https://aabb-2023.oss-cn-beijing.aliyuncs.com/hjscijg3uw.png" srcset="https://aabb-2023.oss-cn-beijing.aliyuncs.com/hjscijg3uw.png, https://aabb-2023.oss-cn-beijing.aliyuncs.com/hjscijg3uw.png 1.5x, https://aabb-2023.oss-cn-beijing.aliyuncs.com/hjscijg3uw.png 2x" sizes="auto" data-title="yuanshuai" data-alt="yuanshuai" class="avatar" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/>&nbsp;yuanshuai</a></span></div>
      <div class="post-meta-line"><span title="发布于 2021-10-24 18:38:23"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden="true"></i><time datetime="2021-10-24">2021-10-24</time></span>&nbsp;<span title="更新于 2021-10-24 18:38:23"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden="true"></i><time datetime="2021-10-24">2021-10-24</time></span>&nbsp;<span title="17040 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>约 17100 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>预计阅读 35 分钟</span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>目录</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#2使用categorical类型降低存储量">2、使用categorical类型降低存储量</a></li>
        <li><a href="#3提升运算速度">3、提升运算速度</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#1读取泰坦尼克数据集">1、读取泰坦尼克数据集</a></li>
        <li><a href="#2分类有序特征可以用数字的方法处理">2、分类有序特征可以用数字的方法处理</a></li>
        <li><a href="#3普通无序分类特征可以用get_dummies编码">3、普通无序分类特征可以用get_dummies编码</a></li>
        <li><a href="#4机器学习模型训练">4、机器学习模型训练</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#1读取数据">1、读取数据</a></li>
        <li><a href="#2将genres字段拆分成列表">2、将Genres字段拆分成列表</a></li>
        <li><a href="#3使用explode将一行拆分成多行">3、使用explode将一行拆分成多行</a></li>
        <li><a href="#4实现拆分后的题材的统计">4、实现拆分后的题材的统计</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#0-处理流程">0. 处理流程</a></li>
        <li><a href="#1-登录网易有道词典的pc版微信扫码登录复制cookies到文件">1. 登录网易有道词典的PC版，微信扫码登录，复制cookies到文件</a></li>
        <li><a href="#2-将html都下载下来存入列表">2. 将html都下载下来存入列表</a></li>
        <li><a href="#3-使用pandas解析网页中的表格">3. 使用Pandas解析网页中的表格</a></li>
        <li><a href="#4-将结果数据输出到excel文件">4. 将结果数据输出到Excel文件</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li></li>
        <li><a href="#0-读取连续3年的天气数据">0. 读取连续3年的天气数据</a></li>
        <li><a href="#方法1pandasseriespct_change">方法1：pandas.Series.pct_change</a></li>
        <li><a href="#方法2pandasseriesshift">方法2：pandas.Series.shift</a></li>
        <li><a href="#方法3-pandasseriesdiff">方法3. pandas.Series.diff</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#0-读取泰坦尼克数据集">0. 读取泰坦尼克数据集</a></li>
        <li><a href="#1-select数据查询">1. SELECT数据查询</a></li>
        <li><a href="#2-where按条件查询">2. WHERE按条件查询</a></li>
        <li><a href="#3-in和not-in的条件查询">3. in和not in的条件查询</a></li>
        <li><a href="#4-groupby分组统计">4. groupby分组统计</a></li>
        <li><a href="#5-join数据关联">5. JOIN数据关联</a></li>
        <li><a href="#6-union数据合并">6. UNION数据合并</a></li>
        <li><a href="#7-order-limit先排序后分页">7. Order Limit先排序后分页</a></li>
        <li><a href="#8-取每个分组group的top-n">8. 取每个分组group的top n</a></li>
        <li><a href="#9-update数据更新">9. UPDATE数据更新</a></li>
        <li><a href="#10-delete删除数据">10. DELETE删除数据</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#读取数据">读取数据</a></li>
        <li><a href="#聚合后单列-单指标统计">聚合后单列-单指标统计</a></li>
        <li><a href="#聚合后单列-多指标统计">聚合后单列-多指标统计</a></li>
        <li><a href="#聚合后多列-多指标统计">聚合后多列-多指标统计</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><p>: | &mdash;&ndash;: | &mdash;&ndash;: | &mdash;: | &mdash;&mdash;&mdash;: | &mdash;&mdash;-: |
|    0 |      1 |      F |    1 |         10 |    48067 |
|    1 |      2 |      M |   56 |         16 |    70072 |
|    2 |      3 |      M |   25 |         15 |    55117 |
|    3 |      4 |      M |   45 |          7 |    02460 |
|    4 |      5 |      M |   25 |         20 |    55455 |</p>
<p>In [4]:</p>
<div class="highlight" id="id-1"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="s1">&#39;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">RangeIndex</span><span class="p">:</span> <span class="mi">6040</span> <span class="n">entries</span><span class="p">,</span> <span class="mi">0</span> <span class="n">to</span> <span class="mi">6039</span>
</span></span><span class="line"><span class="cl"><span class="n">Data</span> <span class="n">columns</span> <span class="p">(</span><span class="n">total</span> <span class="mi">5</span> <span class="n">columns</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="n">UserID</span>        <span class="mi">6040</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Gender</span>        <span class="mi">6040</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">Age</span>           <span class="mi">6040</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Occupation</span>    <span class="mi">6040</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Zip</span><span class="o">-</span><span class="n">code</span>      <span class="mi">6040</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">dtypes</span><span class="p">:</span> <span class="n">int64</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nb">object</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">memory</span> <span class="n">usage</span><span class="p">:</span> <span class="mf">236.1</span><span class="o">+</span> <span class="n">KB</span></span></span></code></pre></div><p>In [5]:</p>
<div class="highlight" id="id-2"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">memory_usage</span><span class="o">=</span><span class="s2">&#34;deep&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="s1">&#39;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">RangeIndex</span><span class="p">:</span> <span class="mi">6040</span> <span class="n">entries</span><span class="p">,</span> <span class="mi">0</span> <span class="n">to</span> <span class="mi">6039</span>
</span></span><span class="line"><span class="cl"><span class="n">Data</span> <span class="n">columns</span> <span class="p">(</span><span class="n">total</span> <span class="mi">5</span> <span class="n">columns</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="n">UserID</span>        <span class="mi">6040</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Gender</span>        <span class="mi">6040</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">Age</span>           <span class="mi">6040</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Occupation</span>    <span class="mi">6040</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Zip</span><span class="o">-</span><span class="n">code</span>      <span class="mi">6040</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">dtypes</span><span class="p">:</span> <span class="n">int64</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nb">object</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">memory</span> <span class="n">usage</span><span class="p">:</span> <span class="mf">873.4</span> <span class="n">KB</span></span></span></code></pre></div><p>In [6]:</p>
<div class="highlight" id="id-3"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_cat</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">df_cat</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[6]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">UserID</th>
<th style="text-align:right">Gender</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">Occupation</th>
<th style="text-align:right">Zip-code</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">F</td>
<td style="text-align:right">1</td>
<td style="text-align:right">10</td>
<td style="text-align:right">48067</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">M</td>
<td style="text-align:right">56</td>
<td style="text-align:right">16</td>
<td style="text-align:right">70072</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">M</td>
<td style="text-align:right">25</td>
<td style="text-align:right">15</td>
<td style="text-align:right">55117</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">M</td>
<td style="text-align:right">45</td>
<td style="text-align:right">7</td>
<td style="text-align:right">02460</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">M</td>
<td style="text-align:right">25</td>
<td style="text-align:right">20</td>
<td style="text-align:right">55455</td>
</tr>
</tbody>
</table>
<h3 id="2使用categorical类型降低存储量">2、使用categorical类型降低存储量</h3>
<p>In [8]:</p>
<div class="highlight" id="id-4"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_cat</span><span class="p">[</span><span class="s2">&#34;Gender&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_cat</span><span class="p">[</span><span class="s2">&#34;Gender&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&#34;category&#34;</span><span class="p">)</span></span></span></code></pre></div><p>In [9]:</p>
<div class="highlight" id="id-5"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_cat</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">memory_usage</span><span class="o">=</span><span class="s2">&#34;deep&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="s1">&#39;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">RangeIndex</span><span class="p">:</span> <span class="mi">6040</span> <span class="n">entries</span><span class="p">,</span> <span class="mi">0</span> <span class="n">to</span> <span class="mi">6039</span>
</span></span><span class="line"><span class="cl"><span class="n">Data</span> <span class="n">columns</span> <span class="p">(</span><span class="n">total</span> <span class="mi">5</span> <span class="n">columns</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="n">UserID</span>        <span class="mi">6040</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Gender</span>        <span class="mi">6040</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">category</span>
</span></span><span class="line"><span class="cl"><span class="n">Age</span>           <span class="mi">6040</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Occupation</span>    <span class="mi">6040</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Zip</span><span class="o">-</span><span class="n">code</span>      <span class="mi">6040</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">dtypes</span><span class="p">:</span> <span class="n">category</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">int64</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nb">object</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">memory</span> <span class="n">usage</span><span class="p">:</span> <span class="mf">513.8</span> <span class="n">KB</span></span></span></code></pre></div><p>In [10]:</p>
<pre tabindex="0"><code>df_cat.head()</code></pre><p>Out[10]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">UserID</th>
<th style="text-align:right">Gender</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">Occupation</th>
<th style="text-align:right">Zip-code</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">F</td>
<td style="text-align:right">1</td>
<td style="text-align:right">10</td>
<td style="text-align:right">48067</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">M</td>
<td style="text-align:right">56</td>
<td style="text-align:right">16</td>
<td style="text-align:right">70072</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">M</td>
<td style="text-align:right">25</td>
<td style="text-align:right">15</td>
<td style="text-align:right">55117</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">M</td>
<td style="text-align:right">45</td>
<td style="text-align:right">7</td>
<td style="text-align:right">02460</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">M</td>
<td style="text-align:right">25</td>
<td style="text-align:right">20</td>
<td style="text-align:right">55455</td>
</tr>
</tbody>
</table>
<p>In [11]:</p>
<div class="highlight" id="id-7"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_cat</span><span class="p">[</span><span class="s2">&#34;Gender&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span></span></span></code></pre></div><p>Out[11]:</p>
<div class="highlight" id="id-8"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">M</span>    <span class="mi">4331</span>
</span></span><span class="line"><span class="cl"><span class="n">F</span>    <span class="mi">1709</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">Gender</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span></span></span></code></pre></div><h3 id="3提升运算速度">3、提升运算速度</h3>
<p>In [12]:</p>
<div class="highlight" id="id-9"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%</span><span class="n">timeit</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&#34;Gender&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="mi">564</span> <span class="n">µs</span> <span class="err">±</span> <span class="mf">10.8</span> <span class="n">µs</span> <span class="n">per</span> <span class="n">loop</span> <span class="p">(</span><span class="n">mean</span> <span class="err">±</span> <span class="n">std</span><span class="o">.</span> <span class="n">dev</span><span class="o">.</span> <span class="n">of</span> <span class="mi">7</span> <span class="n">runs</span><span class="p">,</span> <span class="mi">1000</span> <span class="n">loops</span> <span class="n">each</span><span class="p">)</span></span></span></code></pre></div><p>In [13]:</p>
<div class="highlight" id="id-10"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%</span><span class="n">timeit</span> <span class="n">df_cat</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&#34;Gender&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="mi">324</span> <span class="n">µs</span> <span class="err">±</span> <span class="mi">5</span> <span class="n">µs</span> <span class="n">per</span> <span class="n">loop</span> <span class="p">(</span><span class="n">mean</span> <span class="err">±</span> <span class="n">std</span><span class="o">.</span> <span class="n">dev</span><span class="o">.</span> <span class="n">of</span> <span class="mi">7</span> <span class="n">runs</span><span class="p">,</span> <span class="mi">1000</span> <span class="n">loops</span> <span class="n">each</span><span class="p">)</span></span></span></code></pre></div><h1 id="29pandas和flask配合实现快速在网页上展示表格数据">29、Pandas和Flask配合实现快速在网页上展示表格数据</h1>
<p>本次演示是使用PyCharm实现的</p>
<p>在当前目录下有一个子目录就是代码：pandas-flask</p>
<p>打开Pycharm，然后打开pandas-flask这个目录，然后运行app.py就可以启动web服务器</p>
<h1 id="30pandas的get_dummies用于机器学习的特征处理">30、Pandas的get_dummies用于机器学习的特征处理</h1>
<p>分类特征有两种：</p>
<ul>
<li>普通分类：性别、颜色</li>
<li>顺序分类：评分、级别</li>
</ul>
<p>对于评分，可以把这个分类直接转换成1、2、3、4、5表示，因为它们之间有顺序、大小关系</p>
<p>但是对于颜色这种分类，直接用1/2/3/4/5/6/7表达，是不合适的，因为机器学习会误以为这些数字之间有大小关系</p>
<p>get_dummies就是用于颜色、性别这种特征的处理，也叫作one-hot-encoding处理</p>
<p>比如：</p>
<ul>
<li>男性：1 0</li>
<li>女性：0 1</li>
</ul>
<p>这就叫做one-hot-encoding，是机器学习对类别的特征处理</p>
<h3 id="1读取泰坦尼克数据集">1、读取泰坦尼克数据集</h3>
<p>In [1]:</p>
<div class="highlight" id="id-11"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span></span></span></code></pre></div><p>In [2]:</p>
<div class="highlight" id="id-12"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&#34;./datas/titanic/titanic_train.csv&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[2]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">PassengerId</th>
<th style="text-align:right">Survived</th>
<th style="text-align:right">Pclass</th>
<th style="text-align:right">Name</th>
<th style="text-align:right">Sex</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">SibSp</th>
<th style="text-align:right">Parch</th>
<th style="text-align:right">Ticket</th>
<th style="text-align:right">Fare</th>
<th style="text-align:right">Cabin</th>
<th style="text-align:right">Embarked</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Braund, Mr. Owen Harris</td>
<td style="text-align:right">male</td>
<td style="text-align:right">22.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">A/5 21171</td>
<td style="text-align:right">7.2500</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Cumings, Mrs. John Bradley (Florence Briggs Th&hellip;</td>
<td style="text-align:right">female</td>
<td style="text-align:right">38.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">PC 17599</td>
<td style="text-align:right">71.2833</td>
<td style="text-align:right">C85</td>
<td style="text-align:right">C</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Heikkinen, Miss. Laina</td>
<td style="text-align:right">female</td>
<td style="text-align:right">26.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">STON/O2. 3101282</td>
<td style="text-align:right">7.9250</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Futrelle, Mrs. Jacques Heath (Lily May Peel)</td>
<td style="text-align:right">female</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">113803</td>
<td style="text-align:right">53.1000</td>
<td style="text-align:right">C123</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Allen, Mr. William Henry</td>
<td style="text-align:right">male</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">373450</td>
<td style="text-align:right">8.0500</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">S</td>
</tr>
</tbody>
</table>
<p>In [3]:</p>
<div class="highlight" id="id-13"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;Name&#34;</span><span class="p">,</span> <span class="s2">&#34;Ticket&#34;</span><span class="p">,</span> <span class="s2">&#34;Cabin&#34;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[3]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">PassengerId</th>
<th style="text-align:right">Survived</th>
<th style="text-align:right">Pclass</th>
<th style="text-align:right">Sex</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">SibSp</th>
<th style="text-align:right">Parch</th>
<th style="text-align:right">Fare</th>
<th style="text-align:right">Embarked</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">male</td>
<td style="text-align:right">22.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">7.2500</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">female</td>
<td style="text-align:right">38.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">71.2833</td>
<td style="text-align:right">C</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3</td>
<td style="text-align:right">female</td>
<td style="text-align:right">26.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">7.9250</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">female</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">53.1000</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">male</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">8.0500</td>
<td style="text-align:right">S</td>
</tr>
</tbody>
</table>
<p>In [4]:</p>
<div class="highlight" id="id-14"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_train</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="s1">&#39;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">RangeIndex</span><span class="p">:</span> <span class="mi">891</span> <span class="n">entries</span><span class="p">,</span> <span class="mi">0</span> <span class="n">to</span> <span class="mi">890</span>
</span></span><span class="line"><span class="cl"><span class="n">Data</span> <span class="n">columns</span> <span class="p">(</span><span class="n">total</span> <span class="mi">9</span> <span class="n">columns</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="n">PassengerId</span>    <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Survived</span>       <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Pclass</span>         <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Sex</span>            <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">Age</span>            <span class="mi">714</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl"><span class="n">SibSp</span>          <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Parch</span>          <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Fare</span>           <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl"><span class="n">Embarked</span>       <span class="mi">889</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">dtypes</span><span class="p">:</span> <span class="n">float64</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">int64</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="nb">object</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">memory</span> <span class="n">usage</span><span class="p">:</span> <span class="mf">62.8</span><span class="o">+</span> <span class="n">KB</span></span></span></code></pre></div><h4 id="特征说明">特征说明：</h4>
<ul>
<li>数值特征：Fare</li>
<li>分类-有序特征：Age</li>
<li>分类-普通特征：PassengerId、Pclass、Sex、SibSp、Parch、Embarked</li>
</ul>
<p>Survived为要预测的Label</p>
<h3 id="2分类有序特征可以用数字的方法处理">2、分类有序特征可以用数字的方法处理</h3>
<p>In [5]:</p>
<div class="highlight" id="id-15"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 使用年龄的平均值，填充空值</span>
</span></span><span class="line"><span class="cl"><span class="n">df_train</span><span class="p">[</span><span class="s2">&#34;Age&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="s2">&#34;Age&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="s2">&#34;Age&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span></span></span></code></pre></div><p>In [6]:</p>
<div class="highlight" id="id-16"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_train</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="s1">&#39;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">RangeIndex</span><span class="p">:</span> <span class="mi">891</span> <span class="n">entries</span><span class="p">,</span> <span class="mi">0</span> <span class="n">to</span> <span class="mi">890</span>
</span></span><span class="line"><span class="cl"><span class="n">Data</span> <span class="n">columns</span> <span class="p">(</span><span class="n">total</span> <span class="mi">9</span> <span class="n">columns</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="n">PassengerId</span>    <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Survived</span>       <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Pclass</span>         <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Sex</span>            <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">Age</span>            <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl"><span class="n">SibSp</span>          <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Parch</span>          <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Fare</span>           <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl"><span class="n">Embarked</span>       <span class="mi">889</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">dtypes</span><span class="p">:</span> <span class="n">float64</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">int64</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="nb">object</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">memory</span> <span class="n">usage</span><span class="p">:</span> <span class="mf">62.8</span><span class="o">+</span> <span class="n">KB</span></span></span></code></pre></div><h3 id="3普通无序分类特征可以用get_dummies编码">3、普通无序分类特征可以用get_dummies编码</h3>
<p>其实就是one-hot编码</p>
<p>In [7]:</p>
<div class="highlight" id="id-17"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># series</span>
</span></span><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="s2">&#34;Sex&#34;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[7]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">female</th>
<th style="text-align:right">male</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<p>***注意，One-hot-Encoding一般要去掉一列，不然会出现dummy variable trap，因为一个人不是male就是femal，它俩有推导关系***<a href="https://www.geeksforgeeks.org/ml-dummy-variable-trap-in-regression-models/"target="_blank" rel="external nofollow noopener noreferrer">https://www.geeksforgeeks.org/ml-dummy-variable-trap-in-regression-models/</a></p>
<p>In [8]:</p>
<div class="highlight" id="id-18"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 便捷方法，用df全部替换</span>
</span></span><span class="line"><span class="cl"><span class="n">needcode_cat_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;Pclass&#34;</span><span class="p">,</span><span class="s2">&#34;Sex&#34;</span><span class="p">,</span><span class="s2">&#34;SibSp&#34;</span><span class="p">,</span><span class="s2">&#34;Parch&#34;</span><span class="p">,</span><span class="s2">&#34;Embarked&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">df_coded</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_train</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 要转码的列</span>
</span></span><span class="line"><span class="cl">    <span class="n">columns</span><span class="o">=</span><span class="n">needcode_cat_columns</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 生成的列名的前缀</span>
</span></span><span class="line"><span class="cl">    <span class="n">prefix</span><span class="o">=</span><span class="n">needcode_cat_columns</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 把空值也做编码</span>
</span></span><span class="line"><span class="cl">    <span class="n">dummy_na</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 把1 of k移除（dummy variable trap）</span>
</span></span><span class="line"><span class="cl">    <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span></span></span></code></pre></div><p>In [9]:</p>
<pre tabindex="0"><code>df_coded.head()</code></pre><p>Out[9]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">PassengerId</th>
<th style="text-align:right">Survived</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">Fare</th>
<th style="text-align:right">Pclass_2.0</th>
<th style="text-align:right">Pclass_3.0</th>
<th style="text-align:right">Pclass_nan</th>
<th style="text-align:right">Sex_male</th>
<th style="text-align:right">Sex_nan</th>
<th style="text-align:right">SibSp_1.0</th>
<th style="text-align:right">&hellip;</th>
<th style="text-align:right">Parch_1.0</th>
<th style="text-align:right">Parch_2.0</th>
<th style="text-align:right">Parch_3.0</th>
<th style="text-align:right">Parch_4.0</th>
<th style="text-align:right">Parch_5.0</th>
<th style="text-align:right">Parch_6.0</th>
<th style="text-align:right">Parch_nan</th>
<th style="text-align:right">Embarked_Q</th>
<th style="text-align:right">Embarked_S</th>
<th style="text-align:right">Embarked_nan</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">22.0</td>
<td style="text-align:right">7.2500</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">38.0</td>
<td style="text-align:right">71.2833</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">26.0</td>
<td style="text-align:right">7.9250</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">53.1000</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">0</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">8.0500</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
</tr>
</tbody>
</table>
<p>5 rows × 26 columns</p>
<h3 id="4机器学习模型训练">4、机器学习模型训练</h3>
<p>In [10]:</p>
<div class="highlight" id="id-20"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="n">df_coded</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&#34;Survived&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[10]:</p>
<div class="highlight" id="id-21"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mi">0</span>    <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>    <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">Survived</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span></span></span></code></pre></div><p>In [11]:</p>
<pre tabindex="0"><code>X = df_coded
X.head()</code></pre><p>Out[11]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">PassengerId</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">Fare</th>
<th style="text-align:right">Pclass_2.0</th>
<th style="text-align:right">Pclass_3.0</th>
<th style="text-align:right">Pclass_nan</th>
<th style="text-align:right">Sex_male</th>
<th style="text-align:right">Sex_nan</th>
<th style="text-align:right">SibSp_1.0</th>
<th style="text-align:right">SibSp_2.0</th>
<th style="text-align:right">&hellip;</th>
<th style="text-align:right">Parch_1.0</th>
<th style="text-align:right">Parch_2.0</th>
<th style="text-align:right">Parch_3.0</th>
<th style="text-align:right">Parch_4.0</th>
<th style="text-align:right">Parch_5.0</th>
<th style="text-align:right">Parch_6.0</th>
<th style="text-align:right">Parch_nan</th>
<th style="text-align:right">Embarked_Q</th>
<th style="text-align:right">Embarked_S</th>
<th style="text-align:right">Embarked_nan</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">22.0</td>
<td style="text-align:right">7.2500</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">38.0</td>
<td style="text-align:right">71.2833</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">26.0</td>
<td style="text-align:right">7.9250</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">53.1000</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">8.0500</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
</tr>
</tbody>
</table>
<p>5 rows × 25 columns</p>
<p>In [12]:</p>
<div class="highlight" id="id-23"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 创建模型对象</span>
</span></span><span class="line"><span class="cl"><span class="n">logreg</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 实现模型训练</span>
</span></span><span class="line"><span class="cl"><span class="n">logreg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></span></span></code></pre></div><p>Out[12]:</p>
<div class="highlight" id="id-24"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">LogisticRegression</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dual</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="n">intercept_scaling</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">l1_ratio</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="n">multi_class</span><span class="o">=</span><span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="n">warm_start</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span></span></code></pre></div><p>In [13]:</p>
<div class="highlight" id="id-25"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">logreg</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></span></span></code></pre></div><p>Out[13]:</p>
<div class="highlight" id="id-26"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="mf">0.8148148148148148</span></span></span></code></pre></div><h1 id="31pandas使用explode实现一行变多行统计">31、Pandas使用explode实现一行变多行统计</h1>
<p>解决实际问题：一个字段包含多个值，怎样将这个值拆分成多行，然后实现统计</p>
<p>比如：一个电影有多个分类、一个人有多个喜好，需要按分类、喜好做统计</p>
<h3 id="1读取数据">1、读取数据</h3>
<p>In [1]:</p>
<div class="highlight" id="id-27"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span></span></span></code></pre></div><p>In [2]:</p>
<div class="highlight" id="id-28"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;./datas/movielens-1m/movies.dat&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">names</span><span class="o">=</span><span class="s2">&#34;MovieID::Title::Genres&#34;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;::&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">sep</span><span class="o">=</span><span class="s2">&#34;::&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">engine</span><span class="o">=</span><span class="s2">&#34;python&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span></span></span></code></pre></div><p>In [3]:</p>
<div class="highlight" id="id-29"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[3]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">MovieID</th>
<th style="text-align:right">Title</th>
<th style="text-align:right">Genres</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Toy Story (1995)</td>
<td style="text-align:right">Animation|Children&rsquo;s|Comedy</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">Jumanji (1995)</td>
<td style="text-align:right">Adventure|Children&rsquo;s|Fantasy</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Grumpier Old Men (1995)</td>
<td style="text-align:right">Comedy|Romance</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">Waiting to Exhale (1995)</td>
<td style="text-align:right">Comedy|Drama</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">Father of the Bride Part II (1995)</td>
<td style="text-align:right">Comedy</td>
</tr>
</tbody>
</table>
<p>*<strong>问题：怎样实现这样的统计，每个题材有多少部电影？*</strong></p>
<p>解决思路：</p>
<ul>
<li>将Genres按照分隔符|拆分</li>
<li>按Genres拆分成多行</li>
<li>统计每个Genres下的电影数目</li>
</ul>
<h3 id="2将genres字段拆分成列表">2、将Genres字段拆分成列表</h3>
<p>In [4]:</p>
<div class="highlight" id="id-30"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="s1">&#39;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">RangeIndex</span><span class="p">:</span> <span class="mi">3883</span> <span class="n">entries</span><span class="p">,</span> <span class="mi">0</span> <span class="n">to</span> <span class="mi">3882</span>
</span></span><span class="line"><span class="cl"><span class="n">Data</span> <span class="n">columns</span> <span class="p">(</span><span class="n">total</span> <span class="mi">3</span> <span class="n">columns</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="n">MovieID</span>    <span class="mi">3883</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Title</span>      <span class="mi">3883</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">Genres</span>     <span class="mi">3883</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">dtypes</span><span class="p">:</span> <span class="n">int64</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nb">object</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">memory</span> <span class="n">usage</span><span class="p">:</span> <span class="mf">91.1</span><span class="o">+</span> <span class="n">KB</span></span></span></code></pre></div><p>In [5]:</p>
<div class="highlight" id="id-31"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 当前的Genres字段是字符串类型</span>
</span></span><span class="line"><span class="cl"><span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&#34;Genres&#34;</span><span class="p">])</span></span></span></code></pre></div><p>Out[5]:</p>
<div class="highlight" id="id-32"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">str</span></span></span></code></pre></div><p>In [6]:</p>
<div class="highlight" id="id-33"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 新增一列</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Genre&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;Genres&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;|&#34;</span><span class="p">))</span></span></span></code></pre></div><p>In [7]:</p>
<div class="highlight" id="id-34"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[7]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">MovieID</th>
<th style="text-align:right">Title</th>
<th style="text-align:right">Genres</th>
<th style="text-align:right">Genre</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Toy Story (1995)</td>
<td style="text-align:right">Animation|Children&rsquo;s|Comedy</td>
<td style="text-align:right">[Animation, Children&rsquo;s, Comedy]</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">Jumanji (1995)</td>
<td style="text-align:right">Adventure|Children&rsquo;s|Fantasy</td>
<td style="text-align:right">[Adventure, Children&rsquo;s, Fantasy]</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Grumpier Old Men (1995)</td>
<td style="text-align:right">Comedy|Romance</td>
<td style="text-align:right">[Comedy, Romance]</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">Waiting to Exhale (1995)</td>
<td style="text-align:right">Comedy|Drama</td>
<td style="text-align:right">[Comedy, Drama]</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">Father of the Bride Part II (1995)</td>
<td style="text-align:right">Comedy</td>
<td style="text-align:right">[Comedy]</td>
</tr>
</tbody>
</table>
<p>In [8]:</p>
<div class="highlight" id="id-35"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Genre的类型是列表</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Genre&#34;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Genre&#34;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="s1">&#39;Animation&#39;</span><span class="p">,</span> <span class="s2">&#34;Children&#39;s&#34;</span><span class="p">,</span> <span class="s1">&#39;Comedy&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">list</span><span class="s1">&#39;&gt;</span></span></span></code></pre></div><p>In [9]:</p>
<div class="highlight" id="id-36"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="s1">&#39;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">RangeIndex</span><span class="p">:</span> <span class="mi">3883</span> <span class="n">entries</span><span class="p">,</span> <span class="mi">0</span> <span class="n">to</span> <span class="mi">3882</span>
</span></span><span class="line"><span class="cl"><span class="n">Data</span> <span class="n">columns</span> <span class="p">(</span><span class="n">total</span> <span class="mi">4</span> <span class="n">columns</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="n">MovieID</span>    <span class="mi">3883</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Title</span>      <span class="mi">3883</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">Genres</span>     <span class="mi">3883</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">Genre</span>      <span class="mi">3883</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">dtypes</span><span class="p">:</span> <span class="n">int64</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nb">object</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">memory</span> <span class="n">usage</span><span class="p">:</span> <span class="mf">121.5</span><span class="o">+</span> <span class="n">KB</span></span></span></code></pre></div><h3 id="3使用explode将一行拆分成多行">3、使用explode将一行拆分成多行</h3>
<p>语法：pandas.DataFrame.explode(column)
将dataframe的一个list-like的元素按行复制，index索引随之复制</p>
<p>In [10]:</p>
<div class="highlight" id="id-37"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_new</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s2">&#34;Genre&#34;</span><span class="p">)</span></span></span></code></pre></div><p>In [11]:</p>
<div class="highlight" id="id-38"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_new</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span></span></span></code></pre></div><p>Out[11]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">MovieID</th>
<th style="text-align:right">Title</th>
<th style="text-align:right">Genres</th>
<th style="text-align:right">Genre</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Toy Story (1995)</td>
<td style="text-align:right">Animation|Children&rsquo;s|Comedy</td>
<td style="text-align:right">Animation</td>
</tr>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Toy Story (1995)</td>
<td style="text-align:right">Animation|Children&rsquo;s|Comedy</td>
<td style="text-align:right">Children&rsquo;s</td>
</tr>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Toy Story (1995)</td>
<td style="text-align:right">Animation|Children&rsquo;s|Comedy</td>
<td style="text-align:right">Comedy</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">Jumanji (1995)</td>
<td style="text-align:right">Adventure|Children&rsquo;s|Fantasy</td>
<td style="text-align:right">Adventure</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">Jumanji (1995)</td>
<td style="text-align:right">Adventure|Children&rsquo;s|Fantasy</td>
<td style="text-align:right">Children&rsquo;s</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">Jumanji (1995)</td>
<td style="text-align:right">Adventure|Children&rsquo;s|Fantasy</td>
<td style="text-align:right">Fantasy</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Grumpier Old Men (1995)</td>
<td style="text-align:right">Comedy|Romance</td>
<td style="text-align:right">Comedy</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Grumpier Old Men (1995)</td>
<td style="text-align:right">Comedy|Romance</td>
<td style="text-align:right">Romance</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">Waiting to Exhale (1995)</td>
<td style="text-align:right">Comedy|Drama</td>
<td style="text-align:right">Comedy</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">Waiting to Exhale (1995)</td>
<td style="text-align:right">Comedy|Drama</td>
<td style="text-align:right">Drama</td>
</tr>
</tbody>
</table>
<h3 id="4实现拆分后的题材的统计">4、实现拆分后的题材的统计</h3>
<p>In [12]:</p>
<div class="highlight" id="id-39"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</span></span><span class="line"><span class="cl"><span class="n">df_new</span><span class="p">[</span><span class="s2">&#34;Genre&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">()</span></span></span></code></pre></div><p>Out[12]:</p>
<div class="highlight" id="id-40"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0x23d73917cc8</span><span class="o">&gt;</span></span></span></code></pre></div><p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/25.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/25.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/25.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/25.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/25.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/25.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h1 id="32pandas借助python爬虫读取html网页表格存储到excel文件">32、Pandas借助Python爬虫读取HTML网页表格存储到Excel文件</h1>
<p>实现目标：</p>
<ul>
<li>网易有道词典可以用于英语单词查询，可以将查询的单词加入到单词本;</li>
<li>当前没有导出全部单词列表的功能。为了复习方便，可以爬取所有的单词列表，存入Excel方便复习</li>
</ul>
<p>涉及技术：</p>
<ul>
<li>Pandas：Python语言最强大的数据处理和数据分析库</li>
<li>Python爬虫：可以将网页下载下来然后解析，使用requests库实现，需要绕过登录验证</li>
</ul>
<p>In [1]:</p>
<div class="highlight" id="id-41"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests.cookies</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span></span></span></code></pre></div><h3 id="0-处理流程">0. 处理流程</h3>
<h4 id="输入网页有道词典-单词本">输入网页：有道词典-单词本</h4>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/26.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/26.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/26.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/26.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/26.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/26.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h4 id="处理流程">处理流程</h4>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/27.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/27.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/27.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/27.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/27.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/27.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h4 id="数据结果到excel文件方便打印复习">数据结果到Excel文件（方便打印复习）：</h4>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/28.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/28.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/28.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/28.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/28.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/28.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="1-登录网易有道词典的pc版微信扫码登录复制cookies到文件">1. 登录网易有道词典的PC版，微信扫码登录，复制cookies到文件</h3>
<ul>
<li>PC版地址：http://dict.youdao.com/</li>
<li>Chrome插件可以复制Cookies为Json格式：http://www.editthiscookie.com/</li>
</ul>
<p>In [2]:</p>
<div class="highlight" id="id-42"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cookie_jar</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">RequestsCookieJar</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;./course_datas/c32_read_html/cookie.txt&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">cookiejson</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">fin</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">cookie</span> <span class="ow">in</span> <span class="n">cookiejson</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">cookie_jar</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">name</span><span class="o">=</span><span class="n">cookie</span><span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">value</span><span class="o">=</span><span class="n">cookie</span><span class="p">[</span><span class="s2">&#34;value&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">domain</span><span class="o">=</span><span class="n">cookie</span><span class="p">[</span><span class="s2">&#34;domain&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">path</span><span class="o">=</span><span class="n">cookie</span><span class="p">[</span><span class="s2">&#34;path&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span></span></span></code></pre></div><p>In [3]:</p>
<div class="highlight" id="id-43"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cookie_jar</span></span></span></code></pre></div><p>Out[3]:</p>
<pre tabindex="0"><code>&lt;RequestsCookieJar[Cookie(version=0, name=&#39;DICT_LOGIN&#39;, value=&#39;3||1578922508302&#39;, port=None, port_specified=False, domain=&#39;.youdao.com&#39;, domain_specified=True, domain_initial_dot=True, path=&#39;/&#39;, path_specified=True, secure=False, expires=None, discard=True, comment=None, comment_url=None, rest={&#39;HttpOnly&#39;: None}, rfc2109=False), Cookie(version=0, name=&#39;DICT_PERS&#39;, value=&#39;v2|weixin||DICT||web||2592000000||1578922508299||114.244.161.198||wxoXQUDj_FtHSw23tfJWsboPkq38ok||gFnMeLRLQLRpBOMYMhf6LRUf0Mz5P4TLRqSOM6uhfY5RzW0L6ZhHTB0kGRHeukLg40QZOMOMkMwu0gBkfJF0LTL0&#39;, port=None, port_specified=False, domain=&#39;.youdao.com&#39;, domain_specified=True, domain_initial_dot=True, path=&#39;/&#39;, path_specified=True, secure=False, expires=None, discard=True, comment=None, comment_url=None, rest={&#39;HttpOnly&#39;: None}, rfc2109=False), Cookie(version=0, name=&#39;DICT_SESS&#39;, value=&#39;v2|odmTRIUgTmgz6MlEOMqB0TBnfk5h4pZ0Py0MeBP4Q40qynHeuPMOWRpLPMY5RHJuRQykfJBOLQBRPKO4YYOLquR6zhLwBnMYMR&#39;, port=None, port_specified=False, domain=&#39;.youdao.com&#39;, domain_specified=True, domain_initial_dot=True, path=&#39;/&#39;, path_specified=True, secure=False, expires=None, discard=True, comment=None, comment_url=None, rest={&#39;HttpOnly&#39;: None}, rfc2109=False), Cookie(version=0, name=&#39;DICT_UGC&#39;, value=&#39;be3af0da19b5c5e6aa4e17bd8d90b28a|&#39;, port=None, port_specified=False, domain=&#39;.youdao.com&#39;, domain_specified=True, domain_initial_dot=True, path=&#39;/&#39;, path_specified=True, secure=False, expires=None, discard=True, comment=None, comment_url=None, rest={&#39;HttpOnly&#39;: None}, rfc2109=False), Cookie(version=0, name=&#39;JSESSIONID&#39;, value=&#39;abc46uQPL03Au_P0ghF_w&#39;, port=None, port_specified=False, domain=&#39;.youdao.com&#39;, domain_specified=True, domain_initial_dot=True, path=&#39;/&#39;, path_specified=True, secure=False, expires=None, discard=True, comment=None, comment_url=None, rest={&#39;HttpOnly&#39;: None}, rfc2109=False), Cookie(version=0, name=&#39;OUTFOX_SEARCH_USER_ID&#39;, value=&#39;&#34;1678365514@10.108.160.18&#34;&#39;, port=None, port_specified=False, domain=&#39;.youdao.com&#39;, domain_specified=True, domain_initial_dot=True, path=&#39;/&#39;, path_specified=True, secure=False, expires=None, discard=True, comment=None, comment_url=None, rest={&#39;HttpOnly&#39;: None}, rfc2109=False), Cookie(version=0, name=&#39;OUTFOX_SEARCH_USER_ID_NCOO&#39;, value=&#39;1349541628.6994112&#39;, port=None, port_specified=False, domain=&#39;.youdao.com&#39;, domain_specified=True, domain_initial_dot=True, path=&#39;/&#39;, path_specified=True, secure=False, expires=None, discard=True, comment=None, comment_url=None, rest={&#39;HttpOnly&#39;: None}, rfc2109=False), Cookie(version=0, name=&#39;ACCSESSIONID&#39;, value=&#39;8F00E30693F3BD052C9A4F293394BE0A&#39;, port=None, port_specified=False, domain=&#39;dict.youdao.com&#39;, domain_specified=True, domain_initial_dot=False, path=&#39;/&#39;, path_specified=True, secure=False, expires=None, discard=True, comment=None, comment_url=None, rest={&#39;HttpOnly&#39;: None}, rfc2109=False), Cookie(version=0, name=&#39;___rl__test__cookies&#39;, value=&#39;1578922438675&#39;, port=None, port_specified=False, domain=&#39;dict.youdao.com&#39;, domain_specified=True, domain_initial_dot=False, path=&#39;/&#39;, path_specified=True, secure=False, expires=None, discard=True, comment=None, comment_url=None, rest={&#39;HttpOnly&#39;: None}, rfc2109=False)]&gt;</code></pre><h3 id="2-将html都下载下来存入列表">2. 将html都下载下来存入列表</h3>
<p>In [4]:</p>
<div class="highlight" id="id-45"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">htmls</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://dict.youdao.com/wordbook/wordlist?p=</span><span class="si">{idx}</span><span class="s2">&amp;tags=&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;**爬数据：第</span><span class="si">%d</span><span class="s2">页&#34;</span> <span class="o">%</span> <span class="n">idx</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="o">=</span><span class="n">idx</span><span class="p">),</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookie_jar</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">htmls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">**</span><span class="n">爬数据</span><span class="err">：</span><span class="n">第0页</span>
</span></span><span class="line"><span class="cl"><span class="o">**</span><span class="n">爬数据</span><span class="err">：</span><span class="n">第1页</span>
</span></span><span class="line"><span class="cl"><span class="o">**</span><span class="n">爬数据</span><span class="err">：</span><span class="n">第2页</span>
</span></span><span class="line"><span class="cl"><span class="o">**</span><span class="n">爬数据</span><span class="err">：</span><span class="n">第3页</span>
</span></span><span class="line"><span class="cl"><span class="o">**</span><span class="n">爬数据</span><span class="err">：</span><span class="n">第4页</span>
</span></span><span class="line"><span class="cl"><span class="o">**</span><span class="n">爬数据</span><span class="err">：</span><span class="n">第5页</span></span></span></code></pre></div><p>In [5]:</p>
<div class="highlight" id="id-46"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">htmls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></span></span></code></pre></div><p>Out[5]:</p>
<pre tabindex="0"><code>&#39;&lt;!doctype html&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;meta http-equiv=&#34;Content-Type&#34; content=&#34;text/html; charset=UTF-8&#34;/&gt;\n&lt;title&gt;有道单词本&lt;/title&gt;\n\n&lt;link rel=&#34;canonical&#34; href=&#34;http://dict.youdao.com/wordbook/&#34;/&gt; \n&lt;meta name=&#34;Keywords&#34; content=&#34;单词本,web单词本,有道,词典,youdao&#34; /&gt;\n&lt;meta name=&#34;Description&#34; content=&#34;有道词典单词本&#34; /&gt;\n&lt;link rel=&#34;shortcut icon&#34; href=&#34;http://shared.ydstatic.com/images/favicon.ico?213&#34; type=&#34;image/x-icon&#34;/&gt;\n&lt;link href=&#34;http://shared.ydstatic.com/r/1.0/s/g3.css?20110428&#34; rel=&#34;stylesheet&#34; type=&#34;text/css&#34;/&gt;\n&lt;link type=&#34;text/css&#34; href=&#34;resources/styles/main.css&#34; rel=&#34;stylesheet&#34;&gt;\n\n&lt;style type=&#34;text/css&#34;&gt;\n\n#f{background-image:url(http://shared.ydstatic.com/images/skins/default/skin-x.jpg)}\n#fbl{background:url(http://shared.ydstatic.com/images/skins/default/skin_.jpg) left top}\n#fbr{background:url(http://shared.ydstatic.com/images/skins/default/skin_.jpg) right -200px}\n\n&lt;/style&gt;\n&lt;script type=&#34;text/javascript&#34;&gt;\nvar VARIABLES={ \n                tags:&#34;&#34;,\n                page:&#34;0&#34;,\n                sort:&#34;&#34;,\n                querystring:&#34;&#34;\n        };\n&lt;/script&gt;\n\n\n&lt;/head&gt;\n\n&lt;body&gt;\n\n&lt;div id=&#34;t&#34;&gt;\n    &lt;div id=&#34;u&#34;&gt;\n                    &lt;span id=&#34;un&#34;&gt;\n        &lt;span class=&#34;un_n&#34;&gt;晚上好，&lt;/span&gt;\n        &lt;span id=&#34;mun&#34; class=&#34;un_box&#34;&gt;&lt;b class=&#34;un_l&#34;&gt;&lt;q&gt;&lt;/q&gt;&lt;/b&gt;&lt;b class=&#34;un_r&#34;&gt;&lt;q&gt;&lt;/q&gt;&lt;/b&gt;\n                 &lt;span class=&#34;un_btn&#34;&gt;&lt;b class=&#34;un_m&#34;&gt;&amp;nbsp;&lt;q&gt;&lt;/q&gt;&lt;/b&gt;\n               &lt;span class=&#34;un_ml&#34;&gt;\n                    wxoXQUDj_FtHSw23tfJWsboPkq38ok\n                                  &lt;/span&gt;\n                                    &lt;/span&gt;\n            &lt;/span&gt;\n       &lt;/span&gt;\n                       &lt;span class=&#34;sl&#34;&gt;|&lt;/span&gt;\n                            &lt;a href=&#34;http://account.youdao.com/logout?service=dict&amp;back_url=http%3A%2F%2Fdict.youdao.com%2Fwordbook%2Fwordlist&#34;&gt;登出&lt;/a&gt;\n            &lt;/div&gt;\n    &lt;div id=&#34;n&#34;&gt;\n        &lt;a href=&#34;http://www.163.com/&#34; id=&#34;mn&#34; class=&#34;mn&#34; target=&#34;_blank&#34;&gt;&lt;u&gt;网易&lt;/u&gt;&lt;s&gt;▼&lt;/s&gt;&lt;/a&gt;\n        &lt;span class=&#34;sl&#34;&gt;|&lt;/span&gt;\n        &lt;a class=&#34;search-js&#34; data-product=\&#39;www\&#39; href=&#34;http://www.youdao.com&#34;&gt;网页&lt;/a&gt;\n        &lt;a class=&#34;search-js&#34; data-product=\&#39;image\&#39; href=&#34;http://image.youdao.com&#34;&gt;图片&lt;/a&gt;\n        &lt;a class=&#34;search-js&#34; data-product=\&#39;news\&#39; href=&#34;http://news.youdao.com&#34;&gt;热闻&lt;/a&gt;\n        &lt;a class=&#34;search-js&#34; data-product=\&#39;gouwu\&#39; href=&#34;http://gouwu.youdao.com&#34;&gt;购物&lt;/a&gt;\n        &lt;a class=&#34;search-js&#34; data-product=\&#39;dict\&#39; href=&#34;http://dict.youdao.com&#34;&gt;词典&lt;/a&gt;\n        &lt;a class=&#34;search-js&#34; data-product=\&#39;fanyi\&#39; data-trans=\&#39;translate?i=\&#39; href=&#34;http://fanyi.youdao.com/&#34;&gt;翻译&lt;/a&gt;\n        &lt;a class=&#34;search-js&#34; data-product=\&#39;note\&#39; href=&#34;http://note.youdao.com&#34;&gt;笔记&lt;/a&gt;\n        &lt;strong&gt;单词本&lt;/strong&gt;\n\t&lt;a class=&#34;mn&#34; target=&#34;_blank&#34; href=&#34;http://www.youdao.com/about/productlist.html&#34;&gt;&lt;u&gt;更多»&lt;/u&gt;&lt;/a&gt;\n    &lt;/div&gt;\n    &lt;/div&gt;\n\n\n&lt;div id=&#34;ym&#34; class=&#34;pm&#34;&gt;\n    &lt;ul&gt;\n        &lt;li&gt;&lt;a href=&#34;http://video.youdao.com&#34; class=&#34;search-js&#34; data-product=\&#39;video\&#39;&gt;视频&lt;/a&gt;&lt;/li&gt;\n        &lt;li&gt;&lt;a href=&#34;http://blog.youdao.com/&#34; class=&#34;search-js&#34; data-product=\&#39;blog\&#39;&gt;博客&lt;/a&gt;&lt;/li&gt;\n        &lt;li&gt;&lt;a href=&#34;http://tie.youdao.com/&#34; class=&#34;search-js&#34; data-product=\&#39;tie\&#39;&gt;快贴&lt;/a&gt;&lt;/li&gt;\n        &lt;li&gt;&lt;a href=&#34;http://ditu.youdao.com/&#34; class=&#34;search-js&#34; data-product=\&#39;ditu\&#39;&gt;地图&lt;/a&gt;&lt;/li&gt;\n\n        &lt;li class=&#34;sl&#34;&gt;&lt;/li&gt;\n        &lt;li&gt;&lt;a href=&#34;http://reader.youdao.com&#34;&gt;阅读&lt;/a&gt;&lt;/li&gt;\n        &lt;li&gt;&lt;a href=&#34;http://m.youdao.com/help&#34;&gt;手机&lt;/a&gt;&lt;/li&gt;\n        &lt;li&gt;&lt;a href=&#34;http://shuqian.youdao.com&#34;&gt;书签&lt;/a&gt;&lt;/li&gt;\n        &lt;li&gt;&lt;a href=&#34;http://cidian.youdao.com&#34; class=&#34;search-js&#34; data-product=\&#39;cidian\&#39;&gt;桌面词典&lt;/a&gt;&lt;/li&gt;\n        &lt;li class=&#34;sl&#34;&gt;&lt;/li&gt;\n        &lt;li&gt;&lt;a href=&#34;http://www.youdao.com/about/productlist.html&#34;&gt;全部产品&lt;/a&gt;&lt;/li&gt;\n\n    &lt;/ul&gt;\n&lt;/div&gt;\n&lt;div id=&#34;nm&#34; class=&#34;pm&#34;&gt;\n    &lt;ul&gt;\n        &lt;li&gt;&lt;a href=&#34;http://www.163.com/&#34; target=&#34;_blank&#34;&gt;首页&lt;/a&gt;&lt;/li&gt;\n        &lt;li&gt;&lt;a href=&#34;http://news.163.com/&#34; target=&#34;_blank&#34;&gt;新闻&lt;/a&gt;&lt;/li&gt;\n        &lt;li&gt;&lt;a href=&#34;http://email.163.com/&#34; target=&#34;_blank&#34;&gt;邮箱&lt;/a&gt;&lt;/li&gt;\n        &lt;li&gt;&lt;a href=&#34;http://blog.163.com/&#34; target=&#34;_blank&#34;&gt;博客&lt;/a&gt;&lt;/li&gt;\n\n        &lt;li&gt;&lt;a href=&#34;http://photo.163.com/&#34; target=&#34;_blank&#34;&gt;相册&lt;/a&gt;&lt;/li&gt;\n        &lt;li&gt;&lt;a href=&#34;http://nie.163.com/&#34; target=&#34;_blank&#34;&gt;游戏&lt;/a&gt;&lt;/li&gt;\n        &lt;li class=&#34;sl&#34;&gt;&lt;/li&gt;\n        &lt;li&gt;&lt;a href=&#34;http://sitemap.163.com/&#34; target=&#34;_blank&#34;&gt;全部产品&lt;/a&gt;&lt;/li&gt;\n    &lt;/ul&gt;\n&lt;/div&gt;\n\n\n&lt;!-- 图标与搜索框 --&gt;\n&lt;form id=&#34;f&#34; method=&#34;get&#34; action=&#34;#&#34; name=&#34;sb&#34;&gt;\n  &lt;h1 id=&#34;yd&#34;&gt;&lt;a href=&#34;/wordbook/wordlist&#34;&gt;有道单词本&lt;/a&gt;&lt;/h1&gt;\n   &lt;!--&lt;div id=&#34;ts&#34; class=&#34;fc&#34;&gt;\n \n    &lt;div class=&#34;qc no-suggest&#34; id=&#34;qc&#34;&gt;\n      &lt;input name=&#34;tab&#34; value=&#34;chn&#34; type=&#34;hidden&#34;&gt;\n      &lt;input name=&#34;keyfrom&#34; value=&#34;shuqian.top&#34; type=&#34;hidden&#34;&gt;\n      &lt;input type=&#34;text&#34; class=&#34;q&#34; name=&#34;q&#34; id=&#34;query&#34; autocomplete=&#34;off&#34;  value=&#34;&#34;/&gt;\n    &lt;/div&gt;\n    &lt;input type=&#34;submit&#34; value=&#34;搜 索&#34; class=&#34;qb&#34; name=&#34;btnSearchTag&#34;/&gt;\n    \n  &lt;/div&gt;--&gt;\n  &lt;div class=&#34;ao&#34;&gt;&lt;/div&gt;\n  &lt;div id=&#34;fbl&#34;&gt; &lt;/div&gt;\n  &lt;div id=&#34;fbr&#34;&gt; &lt;/div&gt;\n&lt;/form&gt; \n \n\n&lt;div id=&#34;wrapper&#34;&gt;\n\n\n    &lt;div id=&#34;top&#34; &gt;\n        \n\n                &lt;a href=&#34;#&#34; id=&#34;addword&#34;&gt;&lt;/a&gt;\n\n                \n              \n            &lt;div style=&#34;width:500px;float:right;text-align:right;&#34;&gt;    \n                &lt;label for=&#34;select_category&#34;&gt;分类&lt;/label&gt;\n                &lt;select id=&#34;select_category&#34;&gt;\n                    &lt;option value=&#34;&#34;&gt;全部分类&lt;/option&gt;\n                                            &lt;option value=&#34;无标签&#34; &gt;无标签 &lt;/option&gt;\n                                    &lt;/select&gt;  \n                        \n        &lt;a href=&#34;#&#34; id=&#34;toggle_listmode&#34; class=&#34;active&#34;&gt;&lt;/a&gt;&lt;a href=&#34;#&#34; id=&#34;toggle_cardmode&#34; &gt;&lt;/a&gt;\n        &lt;/div&gt;\n        &lt;div class=&#34;clear&#34;&gt;&lt;/div&gt;\n\n    &lt;/div&gt;   \n    \n    &lt;div id=&#34;listmode&#34;&gt;\n               &lt;div id=&#34;wordhead&#34;&gt;\n            &lt;table  width=&#34;100%&#34; style=&#34;table-layout:fixed;background:#fff;&#34;&gt;\n                    &lt;tr&gt;\n                        &lt;th width=&#34;50px&#34;&gt;序号&lt;/th&gt;\n                        &lt;th width=&#34;80px&#34;&gt;单词&lt;/th&gt;\n                        &lt;th width=&#34;80px&#34;&gt;音标&lt;/th&gt;\n                        &lt;th width=&#34;320px&#34;&gt;解释&lt;/th&gt;\n                       &lt;!--  &lt;th width=&#34;50px&#34;&gt;难度&lt;/th&gt; --&gt;\n                        &lt;th width=&#34;85px&#34;&gt;时间&lt;/th&gt;\n                        &lt;th&gt;分类&lt;/th&gt;\n                        &lt;th width=&#34;65px&#34;&gt;操作&lt;/th&gt;\n                    &lt;/tr&gt;\n            &lt;/table&gt;\n        &lt;/div&gt; \n        \n        &lt;div id=&#34;wordlist&#34; &gt;\n            &lt;table  width=&#34;100%&#34; style=&#34;table-layout:fixed&#34;&gt;\n\n                &lt;tbody&gt;\n                                        &lt;tr&gt;\n                        &lt;td width=&#34;50px&#34;&gt; 1&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;word&#34;  title=&#34;agglomerative&#34;&gt;&lt;a href=&#34;/search?keyfrom=webwordbook&amp;q=agglomerative&#34;  target=&#34;_blank&#34;&gt;&lt;strong&gt;agglomerative&lt;/strong&gt;&lt;/a&gt;&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;phonetic&#34;  title=&#34;&#34;&gt;&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;320px&#34;&gt;\n                            &lt;div  class=&#34;desc&#34;  title=&#34;adj. 会凝聚的；[冶] 烧结的，凝结的&#34;&gt;adj. 会凝聚的；[冶] 烧结的，凝结的&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;!-- &lt;td width=&#34;50px&#34;&gt;\n                            &lt;span class=&#34;flag&#34; style=&#34;display:none;&#34;&gt;0&lt;/span&gt;\n                            &lt;span class=&#34;level&#34;&gt;\n                                                        &lt;/span&gt;\n                        &lt;/td&gt; --&gt;\n\n                        &lt;td width=&#34;85px&#34;&gt;2020-1-13&lt;/td&gt;\n                        &lt;td &gt;\n                            &lt;div  class=&#34;tags&#34; title=&#34;&#34;&gt;&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;td width=&#34;65px&#34; style=&#34;vertical-align:middle;&#34;&gt;\n                            &lt;a href=&#34;#&#34; class=&#34;editword&#34;  title=&#34;编辑agglomerative&#34; &gt;&lt;/a&gt;\n                            \n                           \n                            &lt;a href=\n                                                        &#34;wordlist?action=delete&amp;word=agglomerative&amp;p=0&#34; \n                                                        class=&#34;deleteword&#34; title=&#34;删除agglomerative&#34; onclick=\&#39;if(!confirm(&#34;您确定删除单词 agglomerative 吗？&#34;)){ return false;}else return true;\&#39;&gt;&lt;/a&gt;\n                        &lt;/td&gt;\n                    &lt;/tr&gt;\n                                        &lt;tr&gt;\n                        &lt;td width=&#34;50px&#34;&gt; 2&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;word&#34;  title=&#34;anatomy&#34;&gt;&lt;a href=&#34;/search?keyfrom=webwordbook&amp;q=anatomy&#34;  target=&#34;_blank&#34;&gt;&lt;strong&gt;anatomy&lt;/strong&gt;&lt;/a&gt;&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;phonetic&#34;  title=&#34;[ə&amp;#39;nætəmɪ]&#34;&gt;[ə&amp;#39;nætəmɪ]&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;320px&#34;&gt;\n                            &lt;div  class=&#34;desc&#34;  title=&#34;n. 解剖；解剖学；剖析；骨骼&#34;&gt;n. 解剖；解剖学；剖析；骨骼&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;!-- &lt;td width=&#34;50px&#34;&gt;\n                            &lt;span class=&#34;flag&#34; style=&#34;display:none;&#34;&gt;0&lt;/span&gt;\n                            &lt;span class=&#34;level&#34;&gt;\n                                                        &lt;/span&gt;\n                        &lt;/td&gt; --&gt;\n\n                        &lt;td width=&#34;85px&#34;&gt;2017-7-17&lt;/td&gt;\n                        &lt;td &gt;\n                            &lt;div  class=&#34;tags&#34; title=&#34;&#34;&gt;&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;td width=&#34;65px&#34; style=&#34;vertical-align:middle;&#34;&gt;\n                            &lt;a href=&#34;#&#34; class=&#34;editword&#34;  title=&#34;编辑anatomy&#34; &gt;&lt;/a&gt;\n                            \n                           \n                            &lt;a href=\n                                                        &#34;wordlist?action=delete&amp;word=anatomy&amp;p=0&#34; \n                                                        class=&#34;deleteword&#34; title=&#34;删除anatomy&#34; onclick=\&#39;if(!confirm(&#34;您确定删除单词 anatomy 吗？&#34;)){ return false;}else return true;\&#39;&gt;&lt;/a&gt;\n                        &lt;/td&gt;\n                    &lt;/tr&gt;\n                                        &lt;tr&gt;\n                        &lt;td width=&#34;50px&#34;&gt; 3&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;word&#34;  title=&#34;backbone&#34;&gt;&lt;a href=&#34;/search?keyfrom=webwordbook&amp;q=backbone&#34;  target=&#34;_blank&#34;&gt;&lt;strong&gt;backbone&lt;/strong&gt;&lt;/a&gt;&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;phonetic&#34;  title=&#34;[&amp;#39;bækbəʊn]&#34;&gt;[&amp;#39;bækbəʊn]&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;320px&#34;&gt;\n                            &lt;div  class=&#34;desc&#34;  title=&#34;n. 支柱;主干网;决心,毅力;脊椎&#34;&gt;n. 支柱;主干网;决心,毅力;脊椎&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;!-- &lt;td width=&#34;50px&#34;&gt;\n                            &lt;span class=&#34;flag&#34; style=&#34;display:none;&#34;&gt;0&lt;/span&gt;\n                            &lt;span class=&#34;level&#34;&gt;\n                                                        &lt;/span&gt;\n                        &lt;/td&gt; --&gt;\n\n                        &lt;td width=&#34;85px&#34;&gt;2017-7-13&lt;/td&gt;\n                        &lt;td &gt;\n                            &lt;div  class=&#34;tags&#34; title=&#34;&#34;&gt;&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;td width=&#34;65px&#34; style=&#34;vertical-align:middle;&#34;&gt;\n                            &lt;a href=&#34;#&#34; class=&#34;editword&#34;  title=&#34;编辑backbone&#34; &gt;&lt;/a&gt;\n                            \n                           \n                            &lt;a href=\n                                                        &#34;wordlist?action=delete&amp;word=backbone&amp;p=0&#34; \n                                                        class=&#34;deleteword&#34; title=&#34;删除backbone&#34; onclick=\&#39;if(!confirm(&#34;您确定删除单词 backbone 吗？&#34;)){ return false;}else return true;\&#39;&gt;&lt;/a&gt;\n                        &lt;/td&gt;\n                    &lt;/tr&gt;\n                                        &lt;tr&gt;\n                        &lt;td width=&#34;50px&#34;&gt; 4&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;word&#34;  title=&#34;ballpark&#34;&gt;&lt;a href=&#34;/search?keyfrom=webwordbook&amp;q=ballpark&#34;  target=&#34;_blank&#34;&gt;&lt;strong&gt;ballpark&lt;/strong&gt;&lt;/a&gt;&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;phonetic&#34;  title=&#34;[&amp;#39;bɔːlpɑːk]&#34;&gt;[&amp;#39;bɔːlpɑːk]&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;320px&#34;&gt;\n                            &lt;div  class=&#34;desc&#34;  title=&#34;n. (美)棒球场;活动领域;可变通范围\nadj. 大约的&#34;&gt;n. (美)棒球场;活动领域;可变通范围\nadj. 大约的&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;!-- &lt;td width=&#34;50px&#34;&gt;\n                            &lt;span class=&#34;flag&#34; style=&#34;display:none;&#34;&gt;0&lt;/span&gt;\n                            &lt;span class=&#34;level&#34;&gt;\n                                                        &lt;/span&gt;\n                        &lt;/td&gt; --&gt;\n\n                        &lt;td width=&#34;85px&#34;&gt;2019-10-16&lt;/td&gt;\n                        &lt;td &gt;\n                            &lt;div  class=&#34;tags&#34; title=&#34;&#34;&gt;&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;td width=&#34;65px&#34; style=&#34;vertical-align:middle;&#34;&gt;\n                            &lt;a href=&#34;#&#34; class=&#34;editword&#34;  title=&#34;编辑ballpark&#34; &gt;&lt;/a&gt;\n                            \n                           \n                            &lt;a href=\n                                                        &#34;wordlist?action=delete&amp;word=ballpark&amp;p=0&#34; \n                                                        class=&#34;deleteword&#34; title=&#34;删除ballpark&#34; onclick=\&#39;if(!confirm(&#34;您确定删除单词 ballpark 吗？&#34;)){ return false;}else return true;\&#39;&gt;&lt;/a&gt;\n                        &lt;/td&gt;\n                    &lt;/tr&gt;\n                                        &lt;tr&gt;\n                        &lt;td width=&#34;50px&#34;&gt; 5&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;word&#34;  title=&#34;bilingual&#34;&gt;&lt;a href=&#34;/search?keyfrom=webwordbook&amp;q=bilingual&#34;  target=&#34;_blank&#34;&gt;&lt;strong&gt;bilingual&lt;/strong&gt;&lt;/a&gt;&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;phonetic&#34;  title=&#34;[baɪ&amp;#39;lɪŋgw(ə)l]&#34;&gt;[baɪ&amp;#39;lɪŋgw(ə)l]&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;320px&#34;&gt;\n                            &lt;div  class=&#34;desc&#34;  title=&#34;adj. 双语的\nn. 通两种语言的人&#34;&gt;adj. 双语的\nn. 通两种语言的人&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;!-- &lt;td width=&#34;50px&#34;&gt;\n                            &lt;span class=&#34;flag&#34; style=&#34;display:none;&#34;&gt;0&lt;/span&gt;\n                            &lt;span class=&#34;level&#34;&gt;\n                                                        &lt;/span&gt;\n                        &lt;/td&gt; --&gt;\n\n                        &lt;td width=&#34;85px&#34;&gt;2019-10-15&lt;/td&gt;\n                        &lt;td &gt;\n                            &lt;div  class=&#34;tags&#34; title=&#34;&#34;&gt;&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;td width=&#34;65px&#34; style=&#34;vertical-align:middle;&#34;&gt;\n                            &lt;a href=&#34;#&#34; class=&#34;editword&#34;  title=&#34;编辑bilingual&#34; &gt;&lt;/a&gt;\n                            \n                           \n                            &lt;a href=\n                                                        &#34;wordlist?action=delete&amp;word=bilingual&amp;p=0&#34; \n                                                        class=&#34;deleteword&#34; title=&#34;删除bilingual&#34; onclick=\&#39;if(!confirm(&#34;您确定删除单词 bilingual 吗？&#34;)){ return false;}else return true;\&#39;&gt;&lt;/a&gt;\n                        &lt;/td&gt;\n                    &lt;/tr&gt;\n                                        &lt;tr&gt;\n                        &lt;td width=&#34;50px&#34;&gt; 6&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;word&#34;  title=&#34;canonical&#34;&gt;&lt;a href=&#34;/search?keyfrom=webwordbook&amp;q=canonical&#34;  target=&#34;_blank&#34;&gt;&lt;strong&gt;canonical&lt;/strong&gt;&lt;/a&gt;&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;phonetic&#34;  title=&#34;[kə&amp;#39;nɒnɪk(ə)l]&#34;&gt;[kə&amp;#39;nɒnɪk(ə)l]&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;320px&#34;&gt;\n                            &lt;div  class=&#34;desc&#34;  title=&#34;adj. 依教规的;权威的;牧师的\nn. 牧师礼服&#34;&gt;adj. 依教规的;权威的;牧师的\nn. 牧师礼服&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;!-- &lt;td width=&#34;50px&#34;&gt;\n                            &lt;span class=&#34;flag&#34; style=&#34;display:none;&#34;&gt;0&lt;/span&gt;\n                            &lt;span class=&#34;level&#34;&gt;\n                                                        &lt;/span&gt;\n                        &lt;/td&gt; --&gt;\n\n                        &lt;td width=&#34;85px&#34;&gt;2019-10-14&lt;/td&gt;\n                        &lt;td &gt;\n                            &lt;div  class=&#34;tags&#34; title=&#34;&#34;&gt;&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;td width=&#34;65px&#34; style=&#34;vertical-align:middle;&#34;&gt;\n                            &lt;a href=&#34;#&#34; class=&#34;editword&#34;  title=&#34;编辑canonical&#34; &gt;&lt;/a&gt;\n                            \n                           \n                            &lt;a href=\n                                                        &#34;wordlist?action=delete&amp;word=canonical&amp;p=0&#34; \n                                                        class=&#34;deleteword&#34; title=&#34;删除canonical&#34; onclick=\&#39;if(!confirm(&#34;您确定删除单词 canonical 吗？&#34;)){ return false;}else return true;\&#39;&gt;&lt;/a&gt;\n                        &lt;/td&gt;\n                    &lt;/tr&gt;\n                                        &lt;tr&gt;\n                        &lt;td width=&#34;50px&#34;&gt; 7&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;word&#34;  title=&#34;cater&#34;&gt;&lt;a href=&#34;/search?keyfrom=webwordbook&amp;q=cater&#34;  target=&#34;_blank&#34;&gt;&lt;strong&gt;cater&lt;/strong&gt;&lt;/a&gt;&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;phonetic&#34;  title=&#34;[&amp;#39;keɪtə]&#34;&gt;[&amp;#39;keɪtə]&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;320px&#34;&gt;\n                            &lt;div  class=&#34;desc&#34;  title=&#34;vt. 投合，迎合；满足需要；提供饮食及服务\nn. (Cater)人名；(英)凯特&#34;&gt;vt. 投合，迎合；满足需要；提供饮食及服务\nn. (Cater)人名；(英)凯特&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;!-- &lt;td width=&#34;50px&#34;&gt;\n                            &lt;span class=&#34;flag&#34; style=&#34;display:none;&#34;&gt;0&lt;/span&gt;\n                            &lt;span class=&#34;level&#34;&gt;\n                                                        &lt;/span&gt;\n                        &lt;/td&gt; --&gt;\n\n                        &lt;td width=&#34;85px&#34;&gt;2017-7-17&lt;/td&gt;\n                        &lt;td &gt;\n                            &lt;div  class=&#34;tags&#34; title=&#34;&#34;&gt;&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;td width=&#34;65px&#34; style=&#34;vertical-align:middle;&#34;&gt;\n                            &lt;a href=&#34;#&#34; class=&#34;editword&#34;  title=&#34;编辑cater&#34; &gt;&lt;/a&gt;\n                            \n                           \n                            &lt;a href=\n                                                        &#34;wordlist?action=delete&amp;word=cater&amp;p=0&#34; \n                                                        class=&#34;deleteword&#34; title=&#34;删除cater&#34; onclick=\&#39;if(!confirm(&#34;您确定删除单词 cater 吗？&#34;)){ return false;}else return true;\&#39;&gt;&lt;/a&gt;\n                        &lt;/td&gt;\n                    &lt;/tr&gt;\n                                        &lt;tr&gt;\n                        &lt;td width=&#34;50px&#34;&gt; 8&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;word&#34;  title=&#34;clarity&#34;&gt;&lt;a href=&#34;/search?keyfrom=webwordbook&amp;q=clarity&#34;  target=&#34;_blank&#34;&gt;&lt;strong&gt;clarity&lt;/strong&gt;&lt;/a&gt;&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;phonetic&#34;  title=&#34;[&amp;#39;klærɪtɪ]&#34;&gt;[&amp;#39;klærɪtɪ]&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;320px&#34;&gt;\n                            &lt;div  class=&#34;desc&#34;  title=&#34;n. 清楚,明晰;透明\nn. (Clarity)人名;(英)克拉里蒂&#34;&gt;n. 清楚,明晰;透明\nn. (Clarity)人名;(英)克拉里蒂&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;!-- &lt;td width=&#34;50px&#34;&gt;\n                            &lt;span class=&#34;flag&#34; style=&#34;display:none;&#34;&gt;0&lt;/span&gt;\n                            &lt;span class=&#34;level&#34;&gt;\n                                                        &lt;/span&gt;\n                        &lt;/td&gt; --&gt;\n\n                        &lt;td width=&#34;85px&#34;&gt;2019-10-16&lt;/td&gt;\n                        &lt;td &gt;\n                            &lt;div  class=&#34;tags&#34; title=&#34;&#34;&gt;&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;td width=&#34;65px&#34; style=&#34;vertical-align:middle;&#34;&gt;\n                            &lt;a href=&#34;#&#34; class=&#34;editword&#34;  title=&#34;编辑clarity&#34; &gt;&lt;/a&gt;\n                            \n                           \n                            &lt;a href=\n                                                        &#34;wordlist?action=delete&amp;word=clarity&amp;p=0&#34; \n                                                        class=&#34;deleteword&#34; title=&#34;删除clarity&#34; onclick=\&#39;if(!confirm(&#34;您确定删除单词 clarity 吗？&#34;)){ return false;}else return true;\&#39;&gt;&lt;/a&gt;\n                        &lt;/td&gt;\n                    &lt;/tr&gt;\n                                        &lt;tr&gt;\n                        &lt;td width=&#34;50px&#34;&gt; 9&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;word&#34;  title=&#34;compression&#34;&gt;&lt;a href=&#34;/search?keyfrom=webwordbook&amp;q=compression&#34;  target=&#34;_blank&#34;&gt;&lt;strong&gt;compression&lt;/strong&gt;&lt;/a&gt;&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;phonetic&#34;  title=&#34;[kəm&amp;#39;preʃ(ə)n]&#34;&gt;[kəm&amp;#39;preʃ(ə)n]&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;320px&#34;&gt;\n                            &lt;div  class=&#34;desc&#34;  title=&#34;n. 压缩,浓缩;压榨,压迫&#34;&gt;n. 压缩,浓缩;压榨,压迫&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;!-- &lt;td width=&#34;50px&#34;&gt;\n                            &lt;span class=&#34;flag&#34; style=&#34;display:none;&#34;&gt;0&lt;/span&gt;\n                            &lt;span class=&#34;level&#34;&gt;\n                                                        &lt;/span&gt;\n                        &lt;/td&gt; --&gt;\n\n                        &lt;td width=&#34;85px&#34;&gt;2019-10-15&lt;/td&gt;\n                        &lt;td &gt;\n                            &lt;div  class=&#34;tags&#34; title=&#34;&#34;&gt;&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;td width=&#34;65px&#34; style=&#34;vertical-align:middle;&#34;&gt;\n                            &lt;a href=&#34;#&#34; class=&#34;editword&#34;  title=&#34;编辑compression&#34; &gt;&lt;/a&gt;\n                            \n                           \n                            &lt;a href=\n                                                        &#34;wordlist?action=delete&amp;word=compression&amp;p=0&#34; \n                                                        class=&#34;deleteword&#34; title=&#34;删除compression&#34; onclick=\&#39;if(!confirm(&#34;您确定删除单词 compression 吗？&#34;)){ return false;}else return true;\&#39;&gt;&lt;/a&gt;\n                        &lt;/td&gt;\n                    &lt;/tr&gt;\n                                        &lt;tr&gt;\n                        &lt;td width=&#34;50px&#34;&gt; 10&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;word&#34;  title=&#34;contaminated&#34;&gt;&lt;a href=&#34;/search?keyfrom=webwordbook&amp;q=contaminated&#34;  target=&#34;_blank&#34;&gt;&lt;strong&gt;contaminated&lt;/strong&gt;&lt;/a&gt;&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;phonetic&#34;  title=&#34;&#34;&gt;&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;320px&#34;&gt;\n                            &lt;div  class=&#34;desc&#34;  title=&#34;adj. 受污染的，弄脏的 v. 污染；玷污，毒害（contaminate 的过去式和过去分词）&#34;&gt;adj. 受污染的，弄脏的 v. 污染；玷污，毒害（contaminate 的过去式和过去分词）&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;!-- &lt;td width=&#34;50px&#34;&gt;\n                            &lt;span class=&#34;flag&#34; style=&#34;display:none;&#34;&gt;0&lt;/span&gt;\n                            &lt;span class=&#34;level&#34;&gt;\n                                                        &lt;/span&gt;\n                        &lt;/td&gt; --&gt;\n\n                        &lt;td width=&#34;85px&#34;&gt;2020-1-13&lt;/td&gt;\n                        &lt;td &gt;\n                            &lt;div  class=&#34;tags&#34; title=&#34;&#34;&gt;&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;td width=&#34;65px&#34; style=&#34;vertical-align:middle;&#34;&gt;\n                            &lt;a href=&#34;#&#34; class=&#34;editword&#34;  title=&#34;编辑contaminated&#34; &gt;&lt;/a&gt;\n                            \n                           \n                            &lt;a href=\n                                                        &#34;wordlist?action=delete&amp;word=contaminated&amp;p=0&#34; \n                                                        class=&#34;deleteword&#34; title=&#34;删除contaminated&#34; onclick=\&#39;if(!confirm(&#34;您确定删除单词 contaminated 吗？&#34;)){ return false;}else return true;\&#39;&gt;&lt;/a&gt;\n                        &lt;/td&gt;\n                    &lt;/tr&gt;\n                                        &lt;tr&gt;\n                        &lt;td width=&#34;50px&#34;&gt; 11&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;word&#34;  title=&#34;counterparts&#34;&gt;&lt;a href=&#34;/search?keyfrom=webwordbook&amp;q=counterparts&#34;  target=&#34;_blank&#34;&gt;&lt;strong&gt;counterparts&lt;/strong&gt;&lt;/a&gt;&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;phonetic&#34;  title=&#34;[]&#34;&gt;[]&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;320px&#34;&gt;\n                            &lt;div  class=&#34;desc&#34;  title=&#34;n. （契约）副本（counterpart的复数）；相对物；相对应的人&#34;&gt;n. （契约）副本（counterpart的复数）；相对物；相对应的人&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;!-- &lt;td width=&#34;50px&#34;&gt;\n                            &lt;span class=&#34;flag&#34; style=&#34;display:none;&#34;&gt;0&lt;/span&gt;\n                            &lt;span class=&#34;level&#34;&gt;\n                                                        &lt;/span&gt;\n                        &lt;/td&gt; --&gt;\n\n                        &lt;td width=&#34;85px&#34;&gt;2017-7-16&lt;/td&gt;\n                        &lt;td &gt;\n                            &lt;div  class=&#34;tags&#34; title=&#34;&#34;&gt;&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;td width=&#34;65px&#34; style=&#34;vertical-align:middle;&#34;&gt;\n                            &lt;a href=&#34;#&#34; class=&#34;editword&#34;  title=&#34;编辑counterparts&#34; &gt;&lt;/a&gt;\n                            \n                           \n                            &lt;a href=\n                                                        &#34;wordlist?action=delete&amp;word=counterparts&amp;p=0&#34; \n                                                        class=&#34;deleteword&#34; title=&#34;删除counterparts&#34; onclick=\&#39;if(!confirm(&#34;您确定删除单词 counterparts 吗？&#34;)){ return false;}else return true;\&#39;&gt;&lt;/a&gt;\n                        &lt;/td&gt;\n                    &lt;/tr&gt;\n                                        &lt;tr&gt;\n                        &lt;td width=&#34;50px&#34;&gt; 12&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;word&#34;  title=&#34;criteria&#34;&gt;&lt;a href=&#34;/search?keyfrom=webwordbook&amp;q=criteria&#34;  target=&#34;_blank&#34;&gt;&lt;strong&gt;criteria&lt;/strong&gt;&lt;/a&gt;&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;phonetic&#34;  title=&#34;[kraɪ&amp;#39;tɪərɪə]&#34;&gt;[kraɪ&amp;#39;tɪərɪə]&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;320px&#34;&gt;\n                            &lt;div  class=&#34;desc&#34;  title=&#34;n. 标准，条件（criterion的复数）&#34;&gt;n. 标准，条件（criterion的复数）&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;!-- &lt;td width=&#34;50px&#34;&gt;\n                            &lt;span class=&#34;flag&#34; style=&#34;display:none;&#34;&gt;0&lt;/span&gt;\n                            &lt;span class=&#34;level&#34;&gt;\n                                                        &lt;/span&gt;\n                        &lt;/td&gt; --&gt;\n\n                        &lt;td width=&#34;85px&#34;&gt;2017-7-6&lt;/td&gt;\n                        &lt;td &gt;\n                            &lt;div  class=&#34;tags&#34; title=&#34;&#34;&gt;&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;td width=&#34;65px&#34; style=&#34;vertical-align:middle;&#34;&gt;\n                            &lt;a href=&#34;#&#34; class=&#34;editword&#34;  title=&#34;编辑criteria&#34; &gt;&lt;/a&gt;\n                            \n                           \n                            &lt;a href=\n                                                        &#34;wordlist?action=delete&amp;word=criteria&amp;p=0&#34; \n                                                        class=&#34;deleteword&#34; title=&#34;删除criteria&#34; onclick=\&#39;if(!confirm(&#34;您确定删除单词 criteria 吗？&#34;)){ return false;}else return true;\&#39;&gt;&lt;/a&gt;\n                        &lt;/td&gt;\n                    &lt;/tr&gt;\n                                        &lt;tr&gt;\n                        &lt;td width=&#34;50px&#34;&gt; 13&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;word&#34;  title=&#34;crunch&#34;&gt;&lt;a href=&#34;/search?keyfrom=webwordbook&amp;q=crunch&#34;  target=&#34;_blank&#34;&gt;&lt;strong&gt;crunch&lt;/strong&gt;&lt;/a&gt;&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;phonetic&#34;  title=&#34;[krʌntʃ]&#34;&gt;[krʌntʃ]&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;320px&#34;&gt;\n                            &lt;div  class=&#34;desc&#34;  title=&#34;n.咬碎，咬碎声；扎扎地踏\nvt.压碎；嘎扎嘎扎的咬嚼；扎扎地踏过\nvi.嘎吱作响地咀嚼；嘎吱嘎吱地踏过&#34;&gt;n.咬碎，咬碎声；扎扎地踏\nvt.压碎；嘎扎嘎扎的咬嚼；扎扎地踏过\nvi.嘎吱作响地咀嚼；嘎吱嘎吱地踏过&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;!-- &lt;td width=&#34;50px&#34;&gt;\n                            &lt;span class=&#34;flag&#34; style=&#34;display:none;&#34;&gt;0&lt;/span&gt;\n                            &lt;span class=&#34;level&#34;&gt;\n                                                        &lt;/span&gt;\n                        &lt;/td&gt; --&gt;\n\n                        &lt;td width=&#34;85px&#34;&gt;2019-10-8&lt;/td&gt;\n                        &lt;td &gt;\n                            &lt;div  class=&#34;tags&#34; title=&#34;&#34;&gt;&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;td width=&#34;65px&#34; style=&#34;vertical-align:middle;&#34;&gt;\n                            &lt;a href=&#34;#&#34; class=&#34;editword&#34;  title=&#34;编辑crunch&#34; &gt;&lt;/a&gt;\n                            \n                           \n                            &lt;a href=\n                                                        &#34;wordlist?action=delete&amp;word=crunch&amp;p=0&#34; \n                                                        class=&#34;deleteword&#34; title=&#34;删除crunch&#34; onclick=\&#39;if(!confirm(&#34;您确定删除单词 crunch 吗？&#34;)){ return false;}else return true;\&#39;&gt;&lt;/a&gt;\n                        &lt;/td&gt;\n                    &lt;/tr&gt;\n                                        &lt;tr&gt;\n                        &lt;td width=&#34;50px&#34;&gt; 14&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;word&#34;  title=&#34;delighted&#34;&gt;&lt;a href=&#34;/search?keyfrom=webwordbook&amp;q=delighted&#34;  target=&#34;_blank&#34;&gt;&lt;strong&gt;delighted&lt;/strong&gt;&lt;/a&gt;&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;phonetic&#34;  title=&#34;[dɪ&amp;#39;laɪtɪd]&#34;&gt;[dɪ&amp;#39;laɪtɪd]&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;320px&#34;&gt;\n                            &lt;div  class=&#34;desc&#34;  title=&#34;adj. 高兴的;欣喜的\nv. 使…兴高采烈;感到快乐(delight的过去分词)&#34;&gt;adj. 高兴的;欣喜的\nv. 使…兴高采烈;感到快乐(delight的过去分词)&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;!-- &lt;td width=&#34;50px&#34;&gt;\n                            &lt;span class=&#34;flag&#34; style=&#34;display:none;&#34;&gt;0&lt;/span&gt;\n                            &lt;span class=&#34;level&#34;&gt;\n                                                        &lt;/span&gt;\n                        &lt;/td&gt; --&gt;\n\n                        &lt;td width=&#34;85px&#34;&gt;2019-10-16&lt;/td&gt;\n                        &lt;td &gt;\n                            &lt;div  class=&#34;tags&#34; title=&#34;&#34;&gt;&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;td width=&#34;65px&#34; style=&#34;vertical-align:middle;&#34;&gt;\n                            &lt;a href=&#34;#&#34; class=&#34;editword&#34;  title=&#34;编辑delighted&#34; &gt;&lt;/a&gt;\n                            \n                           \n                            &lt;a href=\n                                                        &#34;wordlist?action=delete&amp;word=delighted&amp;p=0&#34; \n                                                        class=&#34;deleteword&#34; title=&#34;删除delighted&#34; onclick=\&#39;if(!confirm(&#34;您确定删除单词 delighted 吗？&#34;)){ return false;}else return true;\&#39;&gt;&lt;/a&gt;\n                        &lt;/td&gt;\n                    &lt;/tr&gt;\n                                        &lt;tr&gt;\n                        &lt;td width=&#34;50px&#34;&gt; 15&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;word&#34;  title=&#34;denominator&#34;&gt;&lt;a href=&#34;/search?keyfrom=webwordbook&amp;q=denominator&#34;  target=&#34;_blank&#34;&gt;&lt;strong&gt;denominator&lt;/strong&gt;&lt;/a&gt;&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;80px&#34;&gt;&lt;div class=&#34;phonetic&#34;  title=&#34;&#34;&gt;&lt;/div&gt;&lt;/td&gt;\n                        &lt;td width=&#34;320px&#34;&gt;\n                            &lt;div  class=&#34;desc&#34;  title=&#34;n. [数] 分母；命名者；共同特征或共同性质；平均水平或标准&#34;&gt;n. [数] 分母；命名者；共同特征或共同性质；平均水平或标准&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;!-- &lt;td width=&#34;50px&#34;&gt;\n                            &lt;span class=&#34;flag&#34; style=&#34;display:none;&#34;&gt;0&lt;/span&gt;\n                            &lt;span class=&#34;level&#34;&gt;\n                                                        &lt;/span&gt;\n                        &lt;/td&gt; --&gt;\n\n                        &lt;td width=&#34;85px&#34;&gt;2020-1-13&lt;/td&gt;\n                        &lt;td &gt;\n                            &lt;div  class=&#34;tags&#34; title=&#34;&#34;&gt;&lt;/div&gt;\n                        &lt;/td&gt;\n                        &lt;td width=&#34;65px&#34; style=&#34;vertical-align:middle;&#34;&gt;\n                            &lt;a href=&#34;#&#34; class=&#34;editword&#34;  title=&#34;编辑denominator&#34; &gt;&lt;/a&gt;\n                            \n                           \n                            &lt;a href=\n                                                        &#34;wordlist?action=delete&amp;word=denominator&amp;p=0&#34; \n                                                        class=&#34;deleteword&#34; title=&#34;删除denominator&#34; onclick=\&#39;if(!confirm(&#34;您确定删除单词 denominator 吗？&#34;)){ return false;}else return true;\&#39;&gt;&lt;/a&gt;\n                        &lt;/td&gt;\n                    &lt;/tr&gt;\n                                    &lt;/tbody&gt;\n            &lt;/table&gt;\n        &lt;/div&gt;\n      \n  \n        &lt;div id=&#34;wordfoot&#34; &gt;\n            \n                                &lt;div id=&#34;pagination&#34;&gt;\n                                                             &lt;span class=&#34;current-page&#34;&gt;1 &lt;/span&gt;\n                    \n                    \n                                                                                                                                                                                                                                                    &lt;a href=&#34;wordlist?p=1&amp;tags=&#34;&gt;2&lt;/a&gt; \n                                                                                                                                                                                                                                                                                                                                                                                            &lt;a href=&#34;wordlist?p=2&amp;tags=&#34;&gt;3&lt;/a&gt; \n                                                                                                                                                                                                                                                                                                        &lt;span style=&#34;border:none;&#34;&gt;...&lt;/span&gt;\n                                \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    \n                                        &lt;a href=&#34;wordlist?p=1&amp;tags=&#34; class=&#34;next-page&#34;&gt;下一页&lt;/a&gt;\n                                        &lt;a href=&#34;wordlist?p=7&amp;tags=&#34; class=&#34;next-page&#34;&gt;最后一页&lt;/a&gt;\n                &lt;/div&gt;\n               &lt;form id=&#34;pagejumpform&#34; action=&#34;#&#34;&gt;\n               跳至第&lt;input type=&#34;text&#34; value=&#34;&#34;/&gt;页&lt;button type=&#34;submit&#34;&gt;确定&lt;/button&gt;\n               &lt;/form&gt;                \n                              \n\n               \n             \n             \n             &lt;div class=&#34;right&#34; &gt;当前分类：&lt;strong&gt; 全部分类 &lt;/strong&gt; &amp;nbsp;&amp;nbsp;共计 &lt;strong&gt;86&lt;/strong&gt; 个单词 &lt;/div&gt;\n             &lt;div class=&#34;clear&#34;&gt;&lt;/div&gt;\n        &lt;/div&gt;\n            &lt;/div&gt;\n    \n\n    \n    &lt;div id=&#34;cardmode&#34;&gt;\n          &lt;div id=&#34;cardmode-wrap&#34;&gt;\n        &lt;div id=&#34;card&#34;&gt;\n                                            &lt;h1 &gt;&lt;span id=&#34;card_word&#34;&gt;agglomerative&lt;/span&gt;&lt;a href=&#34;#&#34; id=&#34;phonetic-voice&#34;&gt;&lt;/a&gt;&lt;/h1&gt; \n                &lt;div id=&#34;card_pronounce&#34;&gt;\n                    \n                &lt;/div&gt;\n\n                &lt;div id=&#34;description&#34; style=&#34;display:none;&#34;&gt;\n                    adj. 会凝聚的；[冶] 烧结的，凝结的\n                &lt;/div&gt;\n\n                &lt;div id=&#34;mask&#34; &gt;\n                    &lt;span id=&#34;toggle-description&#34; &gt;&lt;img src=&#34;http://shared.ydstatic.com/dict/wordbook-v1/images/mask.png&#34;&gt;&lt;/span&gt;\n                &lt;/div&gt;\n            \n                &lt;div id=&#34;action&#34;&gt;\n                    &lt;a id=&#34;pre&#34; href=&#34;#&#34;&gt;&lt;/a&gt;\n                    &lt;a id=&#34;next&#34; href=&#34;#&#34;&gt;&lt;/a&gt;\n                    &lt;div style=&#34;clear:both;&#34;&gt;&lt;/div&gt;\n                &lt;/div&gt;\n                \n                                                                                                                                                                                                                                                                                                                                                                                                                                            &lt;/div&gt;\n      &lt;/div&gt;\n        &lt;div style=&#34;line-height:28px;text-align:right;&#34;&gt;\n            当前分类：&lt;strong&gt; 全部分类 &lt;/strong&gt; &amp;nbsp;&amp;nbsp;共计 \n            &lt;strong id=&#34;card_max_id&#34;&gt;86&lt;/strong&gt; 个单词 现在是第&lt;span id=&#34;card_id&#34;&gt; 1&lt;/span&gt;个\n        &lt;/div&gt;\n              \n    &lt;/div&gt;\n    \n\n\n\n\n\n&lt;div id=&#34;footarea&#34; &gt;\n    &lt;div style=&#34; line-height:2; margin:10px 0 20px;&#34;&gt;更好的进行生词的整理/记忆，请使用桌面版和手机版有道词典中的单词本&lt;/div&gt;\n    &lt;div id=&#34;foot-ad&#34;&gt;\n    \n        &lt;a href=&#34;http://cidian.youdao.com/?keyform=webwordbook&#34; class=&#34;go-to-desktop&#34; target=&#34;_blank&#34;&gt;&lt;/a&gt;\n        &lt;a href=&#34;http://cidian.youdao.com/android.html?keyform=webwordbook&#34; class=&#34;go-to-mobile&#34; target=&#34;_blank&#34;&gt;&lt;/a&gt;\n\n    &lt;/div&gt;\n&lt;/div&gt;   \n\n&lt;/div&gt;\n\n&lt;div id=&#34;bottom&#34;&gt;\n  &lt;p&gt;&lt;a href=&#34;http://youdao.com/&#34;&gt;有道首页&lt;/a&gt; - &lt;a href=&#34;http://www.youdao.com/help/dict/description/001/&#34;&gt;帮助&lt;/a&gt; - &lt;a href=&#34;http://www.youdao.com/about/&#34;&gt;关于有道&lt;/a&gt; - &lt;a href=&#34;http://i.youdao.com/&#34;&gt;官方博客&lt;/a&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;copy; 2020 网易公司 京ICP证080268号&lt;/p&gt;\n  \n&lt;/div&gt;\n\n\n\n    &lt;div id=&#34;editwordform&#34;&gt;\n        &lt;h1&gt;danci&lt;/h1&gt;\n        &lt;a href=&#34;#&#34; id=&#34;close-editwordform&#34;&gt;&lt;/a&gt;\n        &lt;form method=&#34;post&#34; action=&#34;wordlist?action=modify&#34;&gt;\n        \n        &lt;label for=&#34;word&#34;&gt;单词&lt;span id=&#34;waittext&#34;&gt;&lt;/span&gt;&lt;/label&gt;\n        &lt;input id=&#34;word&#34; type=&#34;text&#34; value=&#34;&#34; name=&#34;word&#34; autocomplete=&#34;off&#34; /&gt;\n        &lt;label for=&#34;phonetic&#34;&gt;音标&lt;/label&gt;\n        &lt;input id=&#34;phonetic&#34; type=&#34;text&#34; value=&#34;&#34; name=&#34;phonetic&#34; /&gt;\n        &lt;label for=&#34;desc&#34;&gt;解释&lt;/label&gt;\n        &lt;textarea id=&#34;desc&#34; name=&#34;desc&#34; &gt;&lt;/textarea&gt;\n        \n        &lt;label style=&#34;color:blue;&#34;&gt;更多（可不填）&lt;/label&gt;\n\n        &lt;label for=&#34;tags&#34;&gt;分类&lt;/label&gt;&lt;input id=&#34;tags&#34; type=&#34;text&#34; value=&#34;&#34; name=&#34;tags&#34; autocomplete=&#34;off&#34; /&gt;\n        &lt;ul id=&#34;tag-select-list&#34;&gt;\n                                            &lt;li&gt;无标签&lt;/li&gt;\n                                    &lt;/ul&gt;\n            \n        &lt;div class=&#34;center-content&#34;&gt;&lt;button type=&#34;submit&#34;&gt;&lt;/button&gt;&lt;/div&gt;\n        &lt;/form&gt;\n    &lt;/div&gt;        \n\n&lt;div id=&#34;leftbar&#34;&gt;\n&lt;a href=&#34;/?keyfrom=webwordbook&#34;&gt;返回词典首页&lt;/a&gt;\n&lt;br/&gt;&lt;br/&gt;\n&lt;a href=&#34;http://xue.youdao.com/&#34;&gt;返回有道学堂&lt;/a&gt;\n&lt;/div&gt;    \n    &lt;object width=&#34;1&#34; height=&#34;1&#34; type=&#34;application/x-shockwave-flash&#34; id=&#34;dictVoice&#34; data=&#34;/dictVoice.swf&#34;&gt;\n        &lt;param name=&#34;movie&#34; value=&#34;/dictVoice.swf&#34;/&gt;\n        &lt;param name=&#34;menu&#34; value=&#34;false&#34;/&gt;\n        &lt;param name=&#34;allowScriptAccess&#34; value=&#34;always&#34;/&gt;\n        &lt;param name=&#34;wmode&#34; value=&#34;transparent&#34;/&gt;\n    &lt;/object&gt;\n    \n&lt;script type=&#34;text/javascript&#34; src=&#34;http://shared.ydstatic.com/dict/wordbook-v1/scripts/jquery-1.5.2.min.js&#34;&gt;&lt;/script&gt;\n&lt;script type=&#34;text/javascript&#34; src=&#34;http://shared.ydstatic.com/dict/wordbook-v1/scripts/jquery.extention.dict4.js&#34;&gt;&lt;/script&gt;\n&lt;script type=&#34;text/javascript&#34; src=&#34;http://shared.ydstatic.com/dict/wordbook-v1/scripts/navigatorBar.js&#34;&gt;&lt;/script&gt;\n&lt;script type=&#34;text/javascript&#34; src=&#34;resources/scripts/main.js&#34;&gt;&lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n&#39;</code></pre><h3 id="3-使用pandas解析网页中的表格">3. 使用Pandas解析网页中的表格</h3>
<p>In [7]:</p>
<div class="highlight" id="id-48"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">htmls</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></span></span></code></pre></div><p>In [8]:</p>
<div class="highlight" id="id-49"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">list</span><span class="s1">&#39;&gt;</span></span></span></code></pre></div><p>In [9]:</p>
<div class="highlight" id="id-50"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span></span></span></code></pre></div><p>Out[9]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">序号</th>
<th style="text-align:right">单词</th>
<th style="text-align:right">音标</th>
<th style="text-align:right">解释</th>
<th style="text-align:right">时间</th>
<th style="text-align:right">分类</th>
<th style="text-align:right">操作</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
</tbody>
</table>
<p>In [10]:</p>
<div class="highlight" id="id-51"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span></span></span></code></pre></div><p>Out[10]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">0</th>
<th style="text-align:right">1</th>
<th style="text-align:right">2</th>
<th style="text-align:right">3</th>
<th style="text-align:right">4</th>
<th style="text-align:right">5</th>
<th style="text-align:right">6</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">agglomerative</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">adj. 会凝聚的；[冶] 烧结的，凝结的</td>
<td style="text-align:right">2020-1-13</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">anatomy</td>
<td style="text-align:right">[ə&rsquo;nætəmɪ]</td>
<td style="text-align:right">n. 解剖；解剖学；剖析；骨骼</td>
<td style="text-align:right">2017-7-17</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">backbone</td>
<td style="text-align:right">[&lsquo;bækbəʊn]</td>
<td style="text-align:right">n. 支柱;主干网;决心,毅力;脊椎</td>
<td style="text-align:right">2017-7-13</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
</tbody>
</table>
<p>In [11]:</p>
<div class="highlight" id="id-52"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_cont</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></span></span></code></pre></div><p>In [12]:</p>
<div class="highlight" id="id-53"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_cont</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span></span></span></code></pre></div><p>In [13]:</p>
<div class="highlight" id="id-54"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_cont</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span></span></span></code></pre></div><p>Out[13]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">序号</th>
<th style="text-align:right">单词</th>
<th style="text-align:right">音标</th>
<th style="text-align:right">解释</th>
<th style="text-align:right">时间</th>
<th style="text-align:right">分类</th>
<th style="text-align:right">操作</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">agglomerative</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">adj. 会凝聚的；[冶] 烧结的，凝结的</td>
<td style="text-align:right">2020-1-13</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">anatomy</td>
<td style="text-align:right">[ə&rsquo;nætəmɪ]</td>
<td style="text-align:right">n. 解剖；解剖学；剖析；骨骼</td>
<td style="text-align:right">2017-7-17</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">backbone</td>
<td style="text-align:right">[&lsquo;bækbəʊn]</td>
<td style="text-align:right">n. 支柱;主干网;决心,毅力;脊椎</td>
<td style="text-align:right">2017-7-13</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
</tbody>
</table>
<p>In [14]:</p>
<div class="highlight" id="id-55"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 收集6个网页的表格</span>
</span></span><span class="line"><span class="cl"><span class="n">df_list</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">html</span> <span class="ow">in</span> <span class="n">htmls</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_cont</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_cont</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_cont</span><span class="p">)</span></span></span></code></pre></div><p>In [15]:</p>
<div class="highlight" id="id-56"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 合并多个表格</span>
</span></span><span class="line"><span class="cl"><span class="n">df_all</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">)</span></span></span></code></pre></div><p>In [16]:</p>
<div class="highlight" id="id-57"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_all</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span></span></span></code></pre></div><p>Out[16]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">序号</th>
<th style="text-align:right">单词</th>
<th style="text-align:right">音标</th>
<th style="text-align:right">解释</th>
<th style="text-align:right">时间</th>
<th style="text-align:right">分类</th>
<th style="text-align:right">操作</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">agglomerative</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">adj. 会凝聚的；[冶] 烧结的，凝结的</td>
<td style="text-align:right">2020-1-13</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">anatomy</td>
<td style="text-align:right">[ə&rsquo;nætəmɪ]</td>
<td style="text-align:right">n. 解剖；解剖学；剖析；骨骼</td>
<td style="text-align:right">2017-7-17</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">backbone</td>
<td style="text-align:right">[&lsquo;bækbəʊn]</td>
<td style="text-align:right">n. 支柱;主干网;决心,毅力;脊椎</td>
<td style="text-align:right">2017-7-13</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
</tbody>
</table>
<p>In [17]:</p>
<div class="highlight" id="id-58"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_all</span><span class="o">.</span><span class="n">shape</span></span></span></code></pre></div><p>Out[17]:</p>
<pre tabindex="0"><code>(86, 7)</code></pre><h3 id="4-将结果数据输出到excel文件">4. 将结果数据输出到Excel文件</h3>
<p>In [18]:</p>
<div class="highlight" id="id-60"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_all</span><span class="p">[[</span><span class="s2">&#34;单词&#34;</span><span class="p">,</span> <span class="s2">&#34;音标&#34;</span><span class="p">,</span> <span class="s2">&#34;解释&#34;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s2">&#34;./course_datas/c32_read_html/网易有道单词本列表.xlsx&#34;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span></span></code></pre></div><h1 id="33pandas计算同比环比指标的3种方法">33、Pandas计算同比环比指标的3种方法</h1>
<h4 id="同比和环比环比和同比用于描述统计数据的变化情况">同比和环比：环比和同比用于描述统计数据的变化情况</h4>
<ul>
<li>环比：表示本次统计段与相连的上次统计段之间的比较。
<ul>
<li>比如2010年中国第一季度GDP为G2010Q1亿元，第二季度GDP为G2010Q2亿元，则第二季度GDP环比增长（G2010Q2-G2010Q1)/G2010Q1；</li>
</ul>
</li>
<li>同比：即同期相比，表示某个特定统计段今年与去年之间的比较。
<ul>
<li>比如2009年中国第一季度GDP为G2009Q1亿元，则2010年第一季度的GDP同比增长为（G2010Q1-G2009Q1)/G2009Q1。</li>
</ul>
</li>
</ul>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/29.jpg" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/29.jpg, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/29.jpg 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/29.jpg 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/29.jpg" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/29.jpg" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>演示步骤：</p>
<ol>
<li>读取连续3年的天气数据</li>
<li>方法1：pandas.Series.pct_change</li>
<li>方法2：pandas.Series.shift</li>
<li>方法3：pandas.Series.diff</li>
</ol>
<p>pct_change、shift、diff，都实现了跨越多行的数据计算</p>
<h3 id="0-读取连续3年的天气数据">0. 读取连续3年的天气数据</h3>
<p>In [1]:</p>
<div class="highlight" id="id-61"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span></span></span></code></pre></div><p>In [2]:</p>
<div class="highlight" id="id-62"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">fpath</span> <span class="o">=</span> <span class="s2">&#34;./datas/beijing_tianqi/beijing_tianqi_2017-2019.csv&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s2">&#34;ymd&#34;</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span></span></code></pre></div><p>In [3]:</p>
<div class="highlight" id="id-63"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span></span></span></code></pre></div><p>Out[3]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">ymd</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2017-01-01</td>
<td style="text-align:right">5℃</td>
<td style="text-align:right">-3℃</td>
<td style="text-align:right">霾~晴</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">450</td>
<td style="text-align:right">严重污染</td>
<td style="text-align:right">6</td>
</tr>
<tr>
<td style="text-align:right">2017-01-02</td>
<td style="text-align:right">7℃</td>
<td style="text-align:right">-6℃</td>
<td style="text-align:right">晴~霾</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">246</td>
<td style="text-align:right">重度污染</td>
<td style="text-align:right">5</td>
</tr>
<tr>
<td style="text-align:right">2017-01-03</td>
<td style="text-align:right">5℃</td>
<td style="text-align:right">-5℃</td>
<td style="text-align:right">霾</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">320</td>
<td style="text-align:right">严重污染</td>
<td style="text-align:right">6</td>
</tr>
</tbody>
</table>
<p>In [4]:</p>
<div class="highlight" id="id-64"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 替换掉温度的后缀℃</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;℃&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span></span></span></code></pre></div><p>In [5]:</p>
<div class="highlight" id="id-65"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span></span></span></code></pre></div><p>Out[5]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">yWendu</th>
<th style="text-align:right">tianqi</th>
<th style="text-align:right">fengxiang</th>
<th style="text-align:right">fengli</th>
<th style="text-align:right">aqi</th>
<th style="text-align:right">aqiInfo</th>
<th style="text-align:right">aqiLevel</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">ymd</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2017-01-01</td>
<td style="text-align:right">5</td>
<td style="text-align:right">-3℃</td>
<td style="text-align:right">霾~晴</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">450</td>
<td style="text-align:right">严重污染</td>
<td style="text-align:right">6</td>
</tr>
<tr>
<td style="text-align:right">2017-01-02</td>
<td style="text-align:right">7</td>
<td style="text-align:right">-6℃</td>
<td style="text-align:right">晴~霾</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">246</td>
<td style="text-align:right">重度污染</td>
<td style="text-align:right">5</td>
</tr>
<tr>
<td style="text-align:right">2017-01-03</td>
<td style="text-align:right">5</td>
<td style="text-align:right">-5℃</td>
<td style="text-align:right">霾</td>
<td style="text-align:right">南风</td>
<td style="text-align:right">1-2级</td>
<td style="text-align:right">320</td>
<td style="text-align:right">严重污染</td>
<td style="text-align:right">6</td>
</tr>
</tbody>
</table>
<p>In [6]:</p>
<div class="highlight" id="id-66"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 新的df，为每个月的平均最高温</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&#34;M&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span></span></span></code></pre></div><p>In [7]:</p>
<div class="highlight" id="id-67"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 将索引按照日期升序排列</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span></span></code></pre></div><p>In [8]:</p>
<div class="highlight" id="id-68"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[8]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">bWendu</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">ymd</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2017-01-31</td>
<td style="text-align:right">3.322581</td>
</tr>
<tr>
<td style="text-align:right">2017-02-28</td>
<td style="text-align:right">7.642857</td>
</tr>
<tr>
<td style="text-align:right">2017-03-31</td>
<td style="text-align:right">14.129032</td>
</tr>
<tr>
<td style="text-align:right">2017-04-30</td>
<td style="text-align:right">23.700000</td>
</tr>
<tr>
<td style="text-align:right">2017-05-31</td>
<td style="text-align:right">29.774194</td>
</tr>
</tbody>
</table>
<p>In [9]:</p>
<div class="highlight" id="id-69"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">index</span></span></span></code></pre></div><p>Out[9]:</p>
<div class="highlight" id="id-70"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2017-01-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2017-02-28&#39;</span><span class="p">,</span> <span class="s1">&#39;2017-03-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2017-04-30&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2017-05-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2017-06-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2017-07-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2017-08-31&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2017-09-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2017-10-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2017-11-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2017-12-31&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-01-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-02-28&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-03-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-04-30&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-05-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-06-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-07-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-08-31&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2018-09-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-10-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-11-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-12-31&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2019-01-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-02-28&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-03-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-04-30&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2019-05-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-06-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-07-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-08-31&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;2019-09-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-10-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-11-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-12-31&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ymd&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span></span></span></code></pre></div><p>In [10]:</p>
<div class="highlight" id="id-71"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span></span></span></code></pre></div><p>Out[10]:</p>
<div class="highlight" id="id-72"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0x13d8d77dc48</span><span class="o">&gt;</span></span></span></code></pre></div><p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/30.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/30.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/30.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/30.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/30.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_pandas/30.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="方法1pandasseriespct_change">方法1：pandas.Series.pct_change</h3>
<p>pct_change方法直接算好了&quot;(新-旧)/旧&quot;的百分比</p>
<p>官方文档地址：https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.pct_change.html</p>
<p>In [11]:</p>
<div class="highlight" id="id-73"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu_way1_huanbi&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu_way1_tongbi&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span></span></span></code></pre></div><p>In [12]:</p>
<div class="highlight" id="id-74"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span></span></span></code></pre></div><p>Out[12]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">bWendu_way1_huanbi</th>
<th style="text-align:right">bWendu_way1_tongbi</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">ymd</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2017-01-31</td>
<td style="text-align:right">3.322581</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-02-28</td>
<td style="text-align:right">7.642857</td>
<td style="text-align:right">1.300277</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-03-31</td>
<td style="text-align:right">14.129032</td>
<td style="text-align:right">0.848658</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-04-30</td>
<td style="text-align:right">23.700000</td>
<td style="text-align:right">0.677397</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-05-31</td>
<td style="text-align:right">29.774194</td>
<td style="text-align:right">0.256295</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-06-30</td>
<td style="text-align:right">30.966667</td>
<td style="text-align:right">0.040051</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-07-31</td>
<td style="text-align:right">31.612903</td>
<td style="text-align:right">0.020869</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-08-31</td>
<td style="text-align:right">30.129032</td>
<td style="text-align:right">-0.046939</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-09-30</td>
<td style="text-align:right">27.866667</td>
<td style="text-align:right">-0.075089</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-10-31</td>
<td style="text-align:right">17.225806</td>
<td style="text-align:right">-0.381849</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-11-30</td>
<td style="text-align:right">9.566667</td>
<td style="text-align:right">-0.444632</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-12-31</td>
<td style="text-align:right">4.483871</td>
<td style="text-align:right">-0.531303</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2018-01-31</td>
<td style="text-align:right">1.322581</td>
<td style="text-align:right">-0.705036</td>
<td style="text-align:right">-0.601942</td>
</tr>
<tr>
<td style="text-align:right">2018-02-28</td>
<td style="text-align:right">4.892857</td>
<td style="text-align:right">2.699477</td>
<td style="text-align:right">-0.359813</td>
</tr>
<tr>
<td style="text-align:right">2018-03-31</td>
<td style="text-align:right">14.129032</td>
<td style="text-align:right">1.887685</td>
<td style="text-align:right">0.000000</td>
</tr>
</tbody>
</table>
<h3 id="方法2pandasseriesshift">方法2：pandas.Series.shift</h3>
<p>shift用于移动数据，但是保持索引不变</p>
<p>官方文档地址：https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.shift.html</p>
<p>In [13]:</p>
<div class="highlight" id="id-75"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 见识一下shift做了什么事情</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 使用pd.concat合并Series列表变成一个大的df</span>
</span></span><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">     <span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">     <span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">12</span><span class="p">)],</span>
</span></span><span class="line"><span class="cl">    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span></span></span></code></pre></div><p>Out[13]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">bWendu</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">ymd</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2017-01-31</td>
<td style="text-align:right">3.322581</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-02-28</td>
<td style="text-align:right">7.642857</td>
<td style="text-align:right">3.322581</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-03-31</td>
<td style="text-align:right">14.129032</td>
<td style="text-align:right">7.642857</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-04-30</td>
<td style="text-align:right">23.700000</td>
<td style="text-align:right">14.129032</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-05-31</td>
<td style="text-align:right">29.774194</td>
<td style="text-align:right">23.700000</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-06-30</td>
<td style="text-align:right">30.966667</td>
<td style="text-align:right">29.774194</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-07-31</td>
<td style="text-align:right">31.612903</td>
<td style="text-align:right">30.966667</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-08-31</td>
<td style="text-align:right">30.129032</td>
<td style="text-align:right">31.612903</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-09-30</td>
<td style="text-align:right">27.866667</td>
<td style="text-align:right">30.129032</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-10-31</td>
<td style="text-align:right">17.225806</td>
<td style="text-align:right">27.866667</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-11-30</td>
<td style="text-align:right">9.566667</td>
<td style="text-align:right">17.225806</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-12-31</td>
<td style="text-align:right">4.483871</td>
<td style="text-align:right">9.566667</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2018-01-31</td>
<td style="text-align:right">1.322581</td>
<td style="text-align:right">4.483871</td>
<td style="text-align:right">3.322581</td>
</tr>
<tr>
<td style="text-align:right">2018-02-28</td>
<td style="text-align:right">4.892857</td>
<td style="text-align:right">1.322581</td>
<td style="text-align:right">7.642857</td>
</tr>
<tr>
<td style="text-align:right">2018-03-31</td>
<td style="text-align:right">14.129032</td>
<td style="text-align:right">4.892857</td>
<td style="text-align:right">14.129032</td>
</tr>
</tbody>
</table>
<p>In [14]:</p>
<div class="highlight" id="id-76"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 环比</span>
</span></span><span class="line"><span class="cl"><span class="n">series_shift1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu_way2_huanbi&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">-</span><span class="n">series_shift1</span><span class="p">)</span><span class="o">/</span><span class="n">series_shift1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 同比</span>
</span></span><span class="line"><span class="cl"><span class="n">series_shift2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu_way2_tongbi&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">-</span><span class="n">series_shift2</span><span class="p">)</span><span class="o">/</span><span class="n">series_shift2</span></span></span></code></pre></div><p>In [15]:</p>
<div class="highlight" id="id-77"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span></span></span></code></pre></div><p>Out[15]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">bWendu_way1_huanbi</th>
<th style="text-align:right">bWendu_way1_tongbi</th>
<th style="text-align:right">bWendu_way2_huanbi</th>
<th style="text-align:right">bWendu_way2_tongbi</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">ymd</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2017-01-31</td>
<td style="text-align:right">3.322581</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-02-28</td>
<td style="text-align:right">7.642857</td>
<td style="text-align:right">1.300277</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">1.300277</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-03-31</td>
<td style="text-align:right">14.129032</td>
<td style="text-align:right">0.848658</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">0.848658</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-04-30</td>
<td style="text-align:right">23.700000</td>
<td style="text-align:right">0.677397</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">0.677397</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-05-31</td>
<td style="text-align:right">29.774194</td>
<td style="text-align:right">0.256295</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">0.256295</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-06-30</td>
<td style="text-align:right">30.966667</td>
<td style="text-align:right">0.040051</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">0.040051</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-07-31</td>
<td style="text-align:right">31.612903</td>
<td style="text-align:right">0.020869</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">0.020869</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-08-31</td>
<td style="text-align:right">30.129032</td>
<td style="text-align:right">-0.046939</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">-0.046939</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-09-30</td>
<td style="text-align:right">27.866667</td>
<td style="text-align:right">-0.075089</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">-0.075089</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-10-31</td>
<td style="text-align:right">17.225806</td>
<td style="text-align:right">-0.381849</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">-0.381849</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-11-30</td>
<td style="text-align:right">9.566667</td>
<td style="text-align:right">-0.444632</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">-0.444632</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-12-31</td>
<td style="text-align:right">4.483871</td>
<td style="text-align:right">-0.531303</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">-0.531303</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2018-01-31</td>
<td style="text-align:right">1.322581</td>
<td style="text-align:right">-0.705036</td>
<td style="text-align:right">-0.601942</td>
<td style="text-align:right">-0.705036</td>
<td style="text-align:right">-0.601942</td>
</tr>
<tr>
<td style="text-align:right">2018-02-28</td>
<td style="text-align:right">4.892857</td>
<td style="text-align:right">2.699477</td>
<td style="text-align:right">-0.359813</td>
<td style="text-align:right">2.699477</td>
<td style="text-align:right">-0.359813</td>
</tr>
<tr>
<td style="text-align:right">2018-03-31</td>
<td style="text-align:right">14.129032</td>
<td style="text-align:right">1.887685</td>
<td style="text-align:right">0.000000</td>
<td style="text-align:right">1.887685</td>
<td style="text-align:right">0.000000</td>
</tr>
</tbody>
</table>
<h3 id="方法3-pandasseriesdiff">方法3. pandas.Series.diff</h3>
<p>pandas.Series.diff用于新值减去旧值</p>
<p>官方文档：https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.diff.html</p>
<p>In [16]:</p>
<pre tabindex="0"><code>pd.concat(
    [df[&#34;bWendu&#34;], 
     df[&#34;bWendu&#34;].diff(periods=1), 
     df[&#34;bWendu&#34;].diff(periods=12)],
    axis=1
).head(15)</code></pre><p>Out[16]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">bWendu</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">ymd</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2017-01-31</td>
<td style="text-align:right">3.322581</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-02-28</td>
<td style="text-align:right">7.642857</td>
<td style="text-align:right">4.320276</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-03-31</td>
<td style="text-align:right">14.129032</td>
<td style="text-align:right">6.486175</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-04-30</td>
<td style="text-align:right">23.700000</td>
<td style="text-align:right">9.570968</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-05-31</td>
<td style="text-align:right">29.774194</td>
<td style="text-align:right">6.074194</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-06-30</td>
<td style="text-align:right">30.966667</td>
<td style="text-align:right">1.192473</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-07-31</td>
<td style="text-align:right">31.612903</td>
<td style="text-align:right">0.646237</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-08-31</td>
<td style="text-align:right">30.129032</td>
<td style="text-align:right">-1.483871</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-09-30</td>
<td style="text-align:right">27.866667</td>
<td style="text-align:right">-2.262366</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-10-31</td>
<td style="text-align:right">17.225806</td>
<td style="text-align:right">-10.640860</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-11-30</td>
<td style="text-align:right">9.566667</td>
<td style="text-align:right">-7.659140</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-12-31</td>
<td style="text-align:right">4.483871</td>
<td style="text-align:right">-5.082796</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2018-01-31</td>
<td style="text-align:right">1.322581</td>
<td style="text-align:right">-3.161290</td>
<td style="text-align:right">-2.00</td>
</tr>
<tr>
<td style="text-align:right">2018-02-28</td>
<td style="text-align:right">4.892857</td>
<td style="text-align:right">3.570276</td>
<td style="text-align:right">-2.75</td>
</tr>
<tr>
<td style="text-align:right">2018-03-31</td>
<td style="text-align:right">14.129032</td>
<td style="text-align:right">9.236175</td>
<td style="text-align:right">0.00</td>
</tr>
</tbody>
</table>
<p>In [17]:</p>
<div class="highlight" id="id-79"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 环比</span>
</span></span><span class="line"><span class="cl"><span class="n">series_diff1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu_way3_huanbi&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">series_diff1</span><span class="o">/</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">-</span><span class="n">series_diff1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 同比</span>
</span></span><span class="line"><span class="cl"><span class="n">series_diff2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu_way3_tongbi&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">series_diff2</span><span class="o">/</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;bWendu&#34;</span><span class="p">]</span><span class="o">-</span><span class="n">series_diff2</span><span class="p">)</span></span></span></code></pre></div><p>In [18]:</p>
<div class="highlight" id="id-80"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span></span></span></code></pre></div><p>Out[18]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">bWendu</th>
<th style="text-align:right">bWendu_way1_huanbi</th>
<th style="text-align:right">bWendu_way1_tongbi</th>
<th style="text-align:right">bWendu_way2_huanbi</th>
<th style="text-align:right">bWendu_way2_tongbi</th>
<th style="text-align:right">bWendu_way3_huanbi</th>
<th style="text-align:right">bWendu_way3_tongbi</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">ymd</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">2017-01-31</td>
<td style="text-align:right">3.322581</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-02-28</td>
<td style="text-align:right">7.642857</td>
<td style="text-align:right">1.300277</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">1.300277</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">1.300277</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-03-31</td>
<td style="text-align:right">14.129032</td>
<td style="text-align:right">0.848658</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">0.848658</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">0.848658</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-04-30</td>
<td style="text-align:right">23.700000</td>
<td style="text-align:right">0.677397</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">0.677397</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">0.677397</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-05-31</td>
<td style="text-align:right">29.774194</td>
<td style="text-align:right">0.256295</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">0.256295</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">0.256295</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-06-30</td>
<td style="text-align:right">30.966667</td>
<td style="text-align:right">0.040051</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">0.040051</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">0.040051</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-07-31</td>
<td style="text-align:right">31.612903</td>
<td style="text-align:right">0.020869</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">0.020869</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">0.020869</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-08-31</td>
<td style="text-align:right">30.129032</td>
<td style="text-align:right">-0.046939</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">-0.046939</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">-0.046939</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-09-30</td>
<td style="text-align:right">27.866667</td>
<td style="text-align:right">-0.075089</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">-0.075089</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">-0.075089</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-10-31</td>
<td style="text-align:right">17.225806</td>
<td style="text-align:right">-0.381849</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">-0.381849</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">-0.381849</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-11-30</td>
<td style="text-align:right">9.566667</td>
<td style="text-align:right">-0.444632</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">-0.444632</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">-0.444632</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2017-12-31</td>
<td style="text-align:right">4.483871</td>
<td style="text-align:right">-0.531303</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">-0.531303</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">-0.531303</td>
<td style="text-align:right">NaN</td>
</tr>
<tr>
<td style="text-align:right">2018-01-31</td>
<td style="text-align:right">1.322581</td>
<td style="text-align:right">-0.705036</td>
<td style="text-align:right">-0.601942</td>
<td style="text-align:right">-0.705036</td>
<td style="text-align:right">-0.601942</td>
<td style="text-align:right">-0.705036</td>
<td style="text-align:right">-0.601942</td>
</tr>
<tr>
<td style="text-align:right">2018-02-28</td>
<td style="text-align:right">4.892857</td>
<td style="text-align:right">2.699477</td>
<td style="text-align:right">-0.359813</td>
<td style="text-align:right">2.699477</td>
<td style="text-align:right">-0.359813</td>
<td style="text-align:right">2.699477</td>
<td style="text-align:right">-0.359813</td>
</tr>
<tr>
<td style="text-align:right">2018-03-31</td>
<td style="text-align:right">14.129032</td>
<td style="text-align:right">1.887685</td>
<td style="text-align:right">0.000000</td>
<td style="text-align:right">1.887685</td>
<td style="text-align:right">0.000000</td>
<td style="text-align:right">1.887685</td>
<td style="text-align:right">0.000000</td>
</tr>
</tbody>
</table>
<h1 id="34pandas和数据库查询语言sql的对比">34、Pandas和数据库查询语言SQL的对比</h1>
<ul>
<li>Pandas：Python最流行的数据处理与数据分析的类库</li>
<li>SQL：结构化查询语言，用于对MySQL、Oracle等关系型数据库的增删改查</li>
</ul>
<p>两者都是对“表格型”数据的操作和查询，所以很多语法都能对应起来</p>
<p>对比列表：</p>
<ol>
<li>SELECT数据查询</li>
<li>WHERE按条件查询</li>
<li>in和not in的条件查询</li>
<li>groupby分组统计</li>
<li>JOIN数据关联</li>
<li>UNION数据合并</li>
<li>Order Limit先排序后分页</li>
<li>取每个分组group的top n</li>
<li>UPDATE数据更新</li>
<li>DELETE删除数据</li>
</ol>
<h3 id="0-读取泰坦尼克数据集">0. 读取泰坦尼克数据集</h3>
<p>In [1]:</p>
<div class="highlight" id="id-81"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></span></span></code></pre></div><p>In [2]:</p>
<div class="highlight" id="id-82"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&#34;./datas/titanic/titanic_train.csv&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[2]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">PassengerId</th>
<th style="text-align:right">Survived</th>
<th style="text-align:right">Pclass</th>
<th style="text-align:right">Name</th>
<th style="text-align:right">Sex</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">SibSp</th>
<th style="text-align:right">Parch</th>
<th style="text-align:right">Ticket</th>
<th style="text-align:right">Fare</th>
<th style="text-align:right">Cabin</th>
<th style="text-align:right">Embarked</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Braund, Mr. Owen Harris</td>
<td style="text-align:right">male</td>
<td style="text-align:right">22.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">A/5 21171</td>
<td style="text-align:right">7.2500</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Cumings, Mrs. John Bradley (Florence Briggs Th&hellip;</td>
<td style="text-align:right">female</td>
<td style="text-align:right">38.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">PC 17599</td>
<td style="text-align:right">71.2833</td>
<td style="text-align:right">C85</td>
<td style="text-align:right">C</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Heikkinen, Miss. Laina</td>
<td style="text-align:right">female</td>
<td style="text-align:right">26.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">STON/O2. 3101282</td>
<td style="text-align:right">7.9250</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Futrelle, Mrs. Jacques Heath (Lily May Peel)</td>
<td style="text-align:right">female</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">113803</td>
<td style="text-align:right">53.1000</td>
<td style="text-align:right">C123</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Allen, Mr. William Henry</td>
<td style="text-align:right">male</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">373450</td>
<td style="text-align:right">8.0500</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">S</td>
</tr>
</tbody>
</table>
<h3 id="1-select数据查询">1. SELECT数据查询</h3>
<p>In [3]:</p>
<div class="highlight" id="id-83"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># SQL：</span>
</span></span><span class="line"><span class="cl"><span class="n">sql</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    SELECT PassengerId, Sex, Age, Survived
</span></span></span><span class="line"><span class="cl"><span class="s2">    FROM titanic
</span></span></span><span class="line"><span class="cl"><span class="s2">    LIMIT 5;
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span></span></span></code></pre></div><p>In [4]:</p>
<div class="highlight" id="id-84"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Pandas</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[[</span><span class="s2">&#34;PassengerId&#34;</span><span class="p">,</span> <span class="s2">&#34;Sex&#34;</span><span class="p">,</span> <span class="s2">&#34;Age&#34;</span><span class="p">,</span> <span class="s2">&#34;Survived&#34;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span></span></span></code></pre></div><p>Out[4]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">PassengerId</th>
<th style="text-align:right">Sex</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">Survived</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">male</td>
<td style="text-align:right">22.0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">female</td>
<td style="text-align:right">38.0</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">female</td>
<td style="text-align:right">26.0</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">female</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">male</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">0</td>
</tr>
</tbody>
</table>
<p>df.head(5)类似select * from table limit 5，查询所有的字段</p>
<h3 id="2-where按条件查询">2. WHERE按条件查询</h3>
<p>In [5]:</p>
<div class="highlight" id="id-85"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># SQL：</span>
</span></span><span class="line"><span class="cl"><span class="n">sql</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    SELECT *
</span></span></span><span class="line"><span class="cl"><span class="s2">    FROM titanic
</span></span></span><span class="line"><span class="cl"><span class="s2">    where Sex=&#39;male&#39; and Age&gt;=20.0 and Age&lt;=40.0
</span></span></span><span class="line"><span class="cl"><span class="s2">    LIMIT 5;
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span></span></span></code></pre></div><p>In [6]:</p>
<div class="highlight" id="id-86"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 使用括号的方式，级联多个条件|</span>
</span></span><span class="line"><span class="cl"><span class="n">condition</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Sex&#34;</span><span class="p">]</span><span class="o">==</span><span class="s2">&#34;male&#34;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Age&#34;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mf">20.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Age&#34;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mf">40.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">condition</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span></span></span></code></pre></div><p>Out[6]:</p>
<div class="highlight" id="id-87"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kc">False</span>    <span class="mi">629</span>
</span></span><span class="line"><span class="cl"><span class="kc">True</span>     <span class="mi">262</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span></span></span></code></pre></div><p>In [7]:</p>
<div class="highlight" id="id-88"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="n">condition</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span></span></span></code></pre></div><p>Out[7]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">PassengerId</th>
<th style="text-align:right">Survived</th>
<th style="text-align:right">Pclass</th>
<th style="text-align:right">Name</th>
<th style="text-align:right">Sex</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">SibSp</th>
<th style="text-align:right">Parch</th>
<th style="text-align:right">Ticket</th>
<th style="text-align:right">Fare</th>
<th style="text-align:right">Cabin</th>
<th style="text-align:right">Embarked</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Braund, Mr. Owen Harris</td>
<td style="text-align:right">male</td>
<td style="text-align:right">22.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">A/5 21171</td>
<td style="text-align:right">7.250</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Allen, Mr. William Henry</td>
<td style="text-align:right">male</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">373450</td>
<td style="text-align:right">8.050</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">12</td>
<td style="text-align:right">13</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Saundercock, Mr. William Henry</td>
<td style="text-align:right">male</td>
<td style="text-align:right">20.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">A/5. 2151</td>
<td style="text-align:right">8.050</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">13</td>
<td style="text-align:right">14</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Andersson, Mr. Anders Johan</td>
<td style="text-align:right">male</td>
<td style="text-align:right">39.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">5</td>
<td style="text-align:right">347082</td>
<td style="text-align:right">31.275</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">20</td>
<td style="text-align:right">21</td>
<td style="text-align:right">0</td>
<td style="text-align:right">2</td>
<td style="text-align:right">Fynney, Mr. Joseph J</td>
<td style="text-align:right">male</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">239865</td>
<td style="text-align:right">26.000</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">S</td>
</tr>
</tbody>
</table>
<h3 id="3-in和not-in的条件查询">3. in和not in的条件查询</h3>
<p>In [8]:</p>
<div class="highlight" id="id-89"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Pclass&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span></span></span></code></pre></div><p>Out[8]:</p>
<div class="highlight" id="id-90"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span></span></span></code></pre></div><p>In [9]:</p>
<div class="highlight" id="id-91"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># SQL：</span>
</span></span><span class="line"><span class="cl"><span class="n">sql</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    SELECT *
</span></span></span><span class="line"><span class="cl"><span class="s2">    FROM titanic
</span></span></span><span class="line"><span class="cl"><span class="s2">    where Pclass in (1,2)
</span></span></span><span class="line"><span class="cl"><span class="s2">    LIMIT 5;
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span></span></span></code></pre></div><p>In [10]:</p>
<div class="highlight" id="id-92"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># in </span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Pclass&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[10]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">PassengerId</th>
<th style="text-align:right">Survived</th>
<th style="text-align:right">Pclass</th>
<th style="text-align:right">Name</th>
<th style="text-align:right">Sex</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">SibSp</th>
<th style="text-align:right">Parch</th>
<th style="text-align:right">Ticket</th>
<th style="text-align:right">Fare</th>
<th style="text-align:right">Cabin</th>
<th style="text-align:right">Embarked</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Cumings, Mrs. John Bradley (Florence Briggs Th&hellip;</td>
<td style="text-align:right">female</td>
<td style="text-align:right">38.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">PC 17599</td>
<td style="text-align:right">71.2833</td>
<td style="text-align:right">C85</td>
<td style="text-align:right">C</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Futrelle, Mrs. Jacques Heath (Lily May Peel)</td>
<td style="text-align:right">female</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">113803</td>
<td style="text-align:right">53.1000</td>
<td style="text-align:right">C123</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">7</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">McCarthy, Mr. Timothy J</td>
<td style="text-align:right">male</td>
<td style="text-align:right">54.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">17463</td>
<td style="text-align:right">51.8625</td>
<td style="text-align:right">E46</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">9</td>
<td style="text-align:right">10</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">Nasser, Mrs. Nicholas (Adele Achem)</td>
<td style="text-align:right">female</td>
<td style="text-align:right">14.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">237736</td>
<td style="text-align:right">30.0708</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">C</td>
</tr>
<tr>
<td style="text-align:right">11</td>
<td style="text-align:right">12</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Bonnell, Miss. Elizabeth</td>
<td style="text-align:right">female</td>
<td style="text-align:right">58.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">113783</td>
<td style="text-align:right">26.5500</td>
<td style="text-align:right">C103</td>
<td style="text-align:right">S</td>
</tr>
</tbody>
</table>
<p>In [11]:</p>
<div class="highlight" id="id-93"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># not in </span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Pclass&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[11]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">PassengerId</th>
<th style="text-align:right">Survived</th>
<th style="text-align:right">Pclass</th>
<th style="text-align:right">Name</th>
<th style="text-align:right">Sex</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">SibSp</th>
<th style="text-align:right">Parch</th>
<th style="text-align:right">Ticket</th>
<th style="text-align:right">Fare</th>
<th style="text-align:right">Cabin</th>
<th style="text-align:right">Embarked</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Braund, Mr. Owen Harris</td>
<td style="text-align:right">male</td>
<td style="text-align:right">22.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">A/5 21171</td>
<td style="text-align:right">7.2500</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Heikkinen, Miss. Laina</td>
<td style="text-align:right">female</td>
<td style="text-align:right">26.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">STON/O2. 3101282</td>
<td style="text-align:right">7.9250</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Allen, Mr. William Henry</td>
<td style="text-align:right">male</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">373450</td>
<td style="text-align:right">8.0500</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">6</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Moran, Mr. James</td>
<td style="text-align:right">male</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">330877</td>
<td style="text-align:right">8.4583</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">Q</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">8</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Palsson, Master. Gosta Leonard</td>
<td style="text-align:right">male</td>
<td style="text-align:right">2.0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">349909</td>
<td style="text-align:right">21.0750</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">S</td>
</tr>
</tbody>
</table>
<h3 id="4-groupby分组统计">4. groupby分组统计</h3>
<h4 id="41-单个列的聚合">4.1 单个列的聚合</h4>
<p>In [12]:</p>
<div class="highlight" id="id-94"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># SQL：</span>
</span></span><span class="line"><span class="cl"><span class="n">sql</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    SELECT 
</span></span></span><span class="line"><span class="cl"><span class="s2">        -- 分性别的存活人数
</span></span></span><span class="line"><span class="cl"><span class="s2">        sum(Survived),
</span></span></span><span class="line"><span class="cl"><span class="s2">        -- 分性别的平均年龄
</span></span></span><span class="line"><span class="cl"><span class="s2">        mean(Age)
</span></span></span><span class="line"><span class="cl"><span class="s2">        -- 分性别的平均票价
</span></span></span><span class="line"><span class="cl"><span class="s2">        mean(Fare)
</span></span></span><span class="line"><span class="cl"><span class="s2">    FROM titanic
</span></span></span><span class="line"><span class="cl"><span class="s2">    group by Sex
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span></span></span></code></pre></div><p>In [13]:</p>
<div class="highlight" id="id-95"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&#34;Sex&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&#34;Survived&#34;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span> <span class="s2">&#34;Age&#34;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="s2">&#34;Fare&#34;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">})</span></span></span></code></pre></div><p>Out[13]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">Survived</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">Fare</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">Sex</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">female</td>
<td style="text-align:right">233</td>
<td style="text-align:right">27.915709</td>
<td style="text-align:right">44.479818</td>
</tr>
<tr>
<td style="text-align:right">male</td>
<td style="text-align:right">109</td>
<td style="text-align:right">30.726645</td>
<td style="text-align:right">25.523893</td>
</tr>
</tbody>
</table>
<h4 id="42-多个列的聚合">4.2 多个列的聚合</h4>
<p>In [14]:</p>
<div class="highlight" id="id-96"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># SQL：</span>
</span></span><span class="line"><span class="cl"><span class="n">sql</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    SELECT 
</span></span></span><span class="line"><span class="cl"><span class="s2">        -- 不同存活和性别分组的，平均年龄
</span></span></span><span class="line"><span class="cl"><span class="s2">        mean(Age)
</span></span></span><span class="line"><span class="cl"><span class="s2">        -- 不同存活和性别分组的，平均票价
</span></span></span><span class="line"><span class="cl"><span class="s2">        mean(Fare)
</span></span></span><span class="line"><span class="cl"><span class="s2">    FROM titanic
</span></span></span><span class="line"><span class="cl"><span class="s2">    group by Survived, Sex
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span></span></span></code></pre></div><p>In [15]:</p>
<div class="highlight" id="id-97"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&#34;Survived&#34;</span><span class="p">,</span> <span class="s2">&#34;Sex&#34;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&#34;Age&#34;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="s2">&#34;Fare&#34;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">})</span></span></span></code></pre></div><p>Out[15]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right"></th>
<th style="text-align:right">Age</th>
<th style="text-align:right">Fare</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">Survived</td>
<td style="text-align:right">Sex</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">female</td>
<td style="text-align:right">25.046875</td>
<td style="text-align:right">23.024385</td>
</tr>
<tr>
<td style="text-align:right">male</td>
<td style="text-align:right">31.618056</td>
<td style="text-align:right">21.960993</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">female</td>
<td style="text-align:right">28.847716</td>
<td style="text-align:right">51.938573</td>
</tr>
<tr>
<td style="text-align:right">male</td>
<td style="text-align:right">27.276022</td>
<td style="text-align:right">40.821484</td>
<td style="text-align:right"></td>
</tr>
</tbody>
</table>
<h3 id="5-join数据关联">5. JOIN数据关联</h3>
<p>In [16]:</p>
<div class="highlight" id="id-98"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 电影评分数据集，评分表</span>
</span></span><span class="line"><span class="cl"><span class="n">df_rating</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&#34;./datas/ml-latest-small/ratings.csv&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_rating</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span></span></span></code></pre></div><p>Out[16]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">userId</th>
<th style="text-align:right">movieId</th>
<th style="text-align:right">rating</th>
<th style="text-align:right">timestamp</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">4.0</td>
<td style="text-align:right">964982703</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3</td>
<td style="text-align:right">4.0</td>
<td style="text-align:right">964981247</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">6</td>
<td style="text-align:right">4.0</td>
<td style="text-align:right">964982224</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">1</td>
<td style="text-align:right">47</td>
<td style="text-align:right">5.0</td>
<td style="text-align:right">964983815</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
<td style="text-align:right">50</td>
<td style="text-align:right">5.0</td>
<td style="text-align:right">964982931</td>
</tr>
</tbody>
</table>
<p>In [17]:</p>
<div class="highlight" id="id-99"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 电影评分数据集，电影信息表</span>
</span></span><span class="line"><span class="cl"><span class="n">df_movies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&#34;./datas/ml-latest-small/movies.csv&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_movies</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span></span></span></code></pre></div><p>Out[17]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">movieId</th>
<th style="text-align:right">title</th>
<th style="text-align:right">genres</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Toy Story (1995)</td>
<td style="text-align:right">Adventure|Animation|Children|Comedy|Fantasy</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">Jumanji (1995)</td>
<td style="text-align:right">Adventure|Children|Fantasy</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Grumpier Old Men (1995)</td>
<td style="text-align:right">Comedy|Romance</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">4</td>
<td style="text-align:right">Waiting to Exhale (1995)</td>
<td style="text-align:right">Comedy|Drama|Romance</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">Father of the Bride Part II (1995)</td>
<td style="text-align:right">Comedy</td>
</tr>
</tbody>
</table>
<p>In [18]:</p>
<div class="highlight" id="id-100"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># SQL：</span>
</span></span><span class="line"><span class="cl"><span class="n">sql</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    SELECT *
</span></span></span><span class="line"><span class="cl"><span class="s2">    FROM 
</span></span></span><span class="line"><span class="cl"><span class="s2">        rating join movies 
</span></span></span><span class="line"><span class="cl"><span class="s2">        on(rating.movieId=movies.movieId)
</span></span></span><span class="line"><span class="cl"><span class="s2">    limit 5
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span></span></span></code></pre></div><p>In [19]:</p>
<div class="highlight" id="id-101"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_merged</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">df_rating</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">df_movies</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&#34;movieId&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_merged</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span></span></span></code></pre></div><p>Out[19]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">userId</th>
<th style="text-align:right">movieId</th>
<th style="text-align:right">rating</th>
<th style="text-align:right">timestamp</th>
<th style="text-align:right">title</th>
<th style="text-align:right">genres</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">4.0</td>
<td style="text-align:right">964982703</td>
<td style="text-align:right">Toy Story (1995)</td>
<td style="text-align:right">Adventure|Animation|Children|Comedy|Fantasy</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">5</td>
<td style="text-align:right">1</td>
<td style="text-align:right">4.0</td>
<td style="text-align:right">847434962</td>
<td style="text-align:right">Toy Story (1995)</td>
<td style="text-align:right">Adventure|Animation|Children|Comedy|Fantasy</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">7</td>
<td style="text-align:right">1</td>
<td style="text-align:right">4.5</td>
<td style="text-align:right">1106635946</td>
<td style="text-align:right">Toy Story (1995)</td>
<td style="text-align:right">Adventure|Animation|Children|Comedy|Fantasy</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">15</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2.5</td>
<td style="text-align:right">1510577970</td>
<td style="text-align:right">Toy Story (1995)</td>
<td style="text-align:right">Adventure|Animation|Children|Comedy|Fantasy</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">17</td>
<td style="text-align:right">1</td>
<td style="text-align:right">4.5</td>
<td style="text-align:right">1305696483</td>
<td style="text-align:right">Toy Story (1995)</td>
<td style="text-align:right">Adventure|Animation|Children|Comedy|Fantasy</td>
</tr>
</tbody>
</table>
<h3 id="6-union数据合并">6. UNION数据合并</h3>
<p>In [20]:</p>
<div class="highlight" id="id-102"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Chicago&#39;</span><span class="p">,</span> <span class="s1">&#39;San Francisco&#39;</span><span class="p">,</span> <span class="s1">&#39;New York City&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;rank&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)})</span> 
</span></span><span class="line"><span class="cl"><span class="n">df1</span></span></span></code></pre></div><p>Out[20]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">city</th>
<th style="text-align:right">rank</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">Chicago</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">San Francisco</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">New York City</td>
<td style="text-align:right">3</td>
</tr>
</tbody>
</table>
<p>In [21]:</p>
<div class="highlight" id="id-103"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Chicago&#39;</span><span class="p">,</span> <span class="s1">&#39;Boston&#39;</span><span class="p">,</span> <span class="s1">&#39;Los Angeles&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;rank&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl"><span class="n">df2</span></span></span></code></pre></div><p>Out[21]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">city</th>
<th style="text-align:right">rank</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">Chicago</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">Boston</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">Los Angeles</td>
<td style="text-align:right">5</td>
</tr>
</tbody>
</table>
<p>In [22]:</p>
<div class="highlight" id="id-104"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># SQL：</span>
</span></span><span class="line"><span class="cl"><span class="n">sql</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    SELECT city, rank
</span></span></span><span class="line"><span class="cl"><span class="s2">    FROM df1
</span></span></span><span class="line"><span class="cl"><span class="s2">    
</span></span></span><span class="line"><span class="cl"><span class="s2">    UNION ALL
</span></span></span><span class="line"><span class="cl"><span class="s2">    
</span></span></span><span class="line"><span class="cl"><span class="s2">    SELECT city, rank
</span></span></span><span class="line"><span class="cl"><span class="s2">    FROM df2;
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span></span></span></code></pre></div><p>In [23]:</p>
<div class="highlight" id="id-105"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># pandas</span>
</span></span><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">])</span></span></span></code></pre></div><p>Out[23]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">city</th>
<th style="text-align:right">rank</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">Chicago</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">San Francisco</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">New York City</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">Chicago</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">Boston</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">Los Angeles</td>
<td style="text-align:right">5</td>
</tr>
</tbody>
</table>
<h3 id="7-order-limit先排序后分页">7. Order Limit先排序后分页</h3>
<p>In [24]:</p>
<div class="highlight" id="id-106"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># SQL：</span>
</span></span><span class="line"><span class="cl"><span class="n">sql</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    SELECT *
</span></span></span><span class="line"><span class="cl"><span class="s2">    from titanic
</span></span></span><span class="line"><span class="cl"><span class="s2">    order by Fare
</span></span></span><span class="line"><span class="cl"><span class="s2">    limit 5
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span></span></span></code></pre></div><p>In [25]:</p>
<div class="highlight" id="id-107"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&#34;Fare&#34;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span></span></span></code></pre></div><p>Out[25]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">PassengerId</th>
<th style="text-align:right">Survived</th>
<th style="text-align:right">Pclass</th>
<th style="text-align:right">Name</th>
<th style="text-align:right">Sex</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">SibSp</th>
<th style="text-align:right">Parch</th>
<th style="text-align:right">Ticket</th>
<th style="text-align:right">Fare</th>
<th style="text-align:right">Cabin</th>
<th style="text-align:right">Embarked</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">258</td>
<td style="text-align:right">259</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Ward, Miss. Anna</td>
<td style="text-align:right">female</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">PC 17755</td>
<td style="text-align:right">512.3292</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">C</td>
</tr>
<tr>
<td style="text-align:right">737</td>
<td style="text-align:right">738</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Lesurer, Mr. Gustave J</td>
<td style="text-align:right">male</td>
<td style="text-align:right">35.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">PC 17755</td>
<td style="text-align:right">512.3292</td>
<td style="text-align:right">B101</td>
<td style="text-align:right">C</td>
</tr>
<tr>
<td style="text-align:right">679</td>
<td style="text-align:right">680</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Cardeza, Mr. Thomas Drake Martinez</td>
<td style="text-align:right">male</td>
<td style="text-align:right">36.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">PC 17755</td>
<td style="text-align:right">512.3292</td>
<td style="text-align:right">B51 B53 B55</td>
<td style="text-align:right">C</td>
</tr>
<tr>
<td style="text-align:right">88</td>
<td style="text-align:right">89</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Fortune, Miss. Mabel Helen</td>
<td style="text-align:right">female</td>
<td style="text-align:right">23.0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">2</td>
<td style="text-align:right">19950</td>
<td style="text-align:right">263.0000</td>
<td style="text-align:right">C23 C25 C27</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">27</td>
<td style="text-align:right">28</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Fortune, Mr. Charles Alexander</td>
<td style="text-align:right">male</td>
<td style="text-align:right">19.0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">2</td>
<td style="text-align:right">19950</td>
<td style="text-align:right">263.0000</td>
<td style="text-align:right">C23 C25 C27</td>
<td style="text-align:right">S</td>
</tr>
</tbody>
</table>
<h3 id="8-取每个分组group的top-n">8. 取每个分组group的top n</h3>
<p>In [26]:</p>
<div class="highlight" id="id-108"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># MYSQL不支持</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Oracle有ROW_NUMBER语法</span></span></span></code></pre></div><p>In [27]:</p>
<div class="highlight" id="id-109"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 按（Survived，Sex）分组，取Age的TOP 2</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&#34;Survived&#34;</span><span class="p">,</span> <span class="s2">&#34;Sex&#34;</span><span class="p">])</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&#34;Age&#34;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span></span></span></code></pre></div><p>Out[27]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right"></th>
<th style="text-align:right"></th>
<th style="text-align:right">PassengerId</th>
<th style="text-align:right">Survived</th>
<th style="text-align:right">Pclass</th>
<th style="text-align:right">Name</th>
<th style="text-align:right">Sex</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">SibSp</th>
<th style="text-align:right">Parch</th>
<th style="text-align:right">Ticket</th>
<th style="text-align:right">Fare</th>
<th style="text-align:right">Cabin</th>
<th style="text-align:right">Embarked</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">Survived</td>
<td style="text-align:right">Sex</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">female</td>
<td style="text-align:right">772</td>
<td style="text-align:right">773</td>
<td style="text-align:right">0</td>
<td style="text-align:right">2</td>
<td style="text-align:right">Mack, Mrs. (Mary)</td>
<td style="text-align:right">female</td>
<td style="text-align:right">57.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">S.O./P.P. 3</td>
<td style="text-align:right">10.5000</td>
<td style="text-align:right">E77</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">177</td>
<td style="text-align:right">178</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Isham, Miss. Ann Elizabeth</td>
<td style="text-align:right">female</td>
<td style="text-align:right">50.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">PC 17595</td>
<td style="text-align:right">28.7125</td>
<td style="text-align:right">C49</td>
<td style="text-align:right">C</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">male</td>
<td style="text-align:right">851</td>
<td style="text-align:right">852</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Svensson, Mr. Johan</td>
<td style="text-align:right">male</td>
<td style="text-align:right">74.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">347060</td>
<td style="text-align:right">7.7750</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">S</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">493</td>
<td style="text-align:right">494</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Artagaveytia, Mr. Ramon</td>
<td style="text-align:right">male</td>
<td style="text-align:right">71.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">PC 17609</td>
<td style="text-align:right">49.5042</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">C</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">female</td>
<td style="text-align:right">483</td>
<td style="text-align:right">484</td>
<td style="text-align:right">1</td>
<td style="text-align:right">3</td>
<td style="text-align:right">Turkula, Mrs. (Hedwig)</td>
<td style="text-align:right">female</td>
<td style="text-align:right">63.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">4134</td>
<td style="text-align:right">9.5875</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">S</td>
</tr>
<tr>
<td style="text-align:right">275</td>
<td style="text-align:right">276</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Andrews, Miss. Kornelia Theodosia</td>
<td style="text-align:right">female</td>
<td style="text-align:right">63.0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">13502</td>
<td style="text-align:right">77.9583</td>
<td style="text-align:right">D7</td>
<td style="text-align:right">S</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">male</td>
<td style="text-align:right">630</td>
<td style="text-align:right">631</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">Barkworth, Mr. Algernon Henry Wilson</td>
<td style="text-align:right">male</td>
<td style="text-align:right">80.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">27042</td>
<td style="text-align:right">30.0000</td>
<td style="text-align:right">A23</td>
<td style="text-align:right">S</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">570</td>
<td style="text-align:right">571</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">Harris, Mr. George</td>
<td style="text-align:right">male</td>
<td style="text-align:right">62.0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">S.W./PP 752</td>
<td style="text-align:right">10.5000</td>
<td style="text-align:right">NaN</td>
<td style="text-align:right">S</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
</tbody>
</table>
<h3 id="9-update数据更新">9. UPDATE数据更新</h3>
<p>In [28]:</p>
<div class="highlight" id="id-110"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="s1">&#39;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">RangeIndex</span><span class="p">:</span> <span class="mi">891</span> <span class="n">entries</span><span class="p">,</span> <span class="mi">0</span> <span class="n">to</span> <span class="mi">890</span>
</span></span><span class="line"><span class="cl"><span class="n">Data</span> <span class="n">columns</span> <span class="p">(</span><span class="n">total</span> <span class="mi">12</span> <span class="n">columns</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="n">PassengerId</span>    <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Survived</span>       <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Pclass</span>         <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span>           <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">Sex</span>            <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">Age</span>            <span class="mi">714</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl"><span class="n">SibSp</span>          <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Parch</span>          <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl"><span class="n">Ticket</span>         <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">Fare</span>           <span class="mi">891</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl"><span class="n">Cabin</span>          <span class="mi">204</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">Embarked</span>       <span class="mi">889</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span> <span class="nb">object</span>
</span></span><span class="line"><span class="cl"><span class="n">dtypes</span><span class="p">:</span> <span class="n">float64</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">int64</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="nb">object</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">memory</span> <span class="n">usage</span><span class="p">:</span> <span class="mf">83.7</span><span class="o">+</span> <span class="n">KB</span></span></span></code></pre></div><p>In [29]:</p>
<div class="highlight" id="id-111"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># SQL：</span>
</span></span><span class="line"><span class="cl"><span class="n">sql</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    UPDATE titanic
</span></span></span><span class="line"><span class="cl"><span class="s2">    set Age=0
</span></span></span><span class="line"><span class="cl"><span class="s2">    where Age is null
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span></span></span></code></pre></div><p>In [30]:</p>
<div class="highlight" id="id-112"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">condition</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;Age&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">condition</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span></span></span></code></pre></div><p>Out[30]:</p>
<div class="highlight" id="id-113"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kc">False</span>    <span class="mi">714</span>
</span></span><span class="line"><span class="cl"><span class="kc">True</span>     <span class="mi">177</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">Age</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span></span></span></code></pre></div><p>In [31]:</p>
<div class="highlight" id="id-114"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="n">condition</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></span></span></code></pre></div><p>In [32]:</p>
<div class="highlight" id="id-115"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Age&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span></span></span></code></pre></div><p>Out[32]:</p>
<div class="highlight" id="id-116"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kc">False</span>    <span class="mi">891</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">Age</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span></span></span></code></pre></div><h3 id="10-delete删除数据">10. DELETE删除数据</h3>
<p>In [33]:</p>
<div class="highlight" id="id-117"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># SQL：</span>
</span></span><span class="line"><span class="cl"><span class="n">sql</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    DELETE FROM titanic
</span></span></span><span class="line"><span class="cl"><span class="s2">    where Age=0
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span></span></span></code></pre></div><p>In [34]:</p>
<div class="highlight" id="id-118"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_new</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Age&#34;</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span></span></span></code></pre></div><p>In [35]:</p>
<div class="highlight" id="id-119"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_new</span><span class="p">[</span><span class="n">df_new</span><span class="p">[</span><span class="s2">&#34;Age&#34;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span></span></span></code></pre></div><p>Out[35]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">PassengerId</th>
<th style="text-align:right">Survived</th>
<th style="text-align:right">Pclass</th>
<th style="text-align:right">Name</th>
<th style="text-align:right">Sex</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">SibSp</th>
<th style="text-align:right">Parch</th>
<th style="text-align:right">Ticket</th>
<th style="text-align:right">Fare</th>
<th style="text-align:right">Cabin</th>
<th style="text-align:right">Embarked</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
</tbody>
</table>
<h1 id="35pandas实现groupby聚合后不同列数据统计">35、Pandas实现groupby聚合后不同列数据统计</h1>
<p>电影评分数据集（UserID，MovieID，Rating，Timestamp）</p>
<p><strong>聚合后单列-单指标统计：每个MovieID的平均评分</strong>
df.groupby(&ldquo;MovieID&rdquo;)[&ldquo;Rating&rdquo;].mean()</p>
<p><strong>聚合后单列-多指标统计：每个MoiveID的最高评分、最低评分、平均评分</strong>
df.groupby(&ldquo;MovieID&rdquo;)[&ldquo;Rating&rdquo;].agg(mean=&ldquo;mean&rdquo;, max=&ldquo;max&rdquo;, min=np.min)
df.groupby(&ldquo;MovieID&rdquo;).agg({&ldquo;Rating&rdquo;:[&lsquo;mean&rsquo;, &lsquo;max&rsquo;, np.min]})</p>
<p><strong>聚合后多列-多指标统计：每个MoiveID的评分人数，最高评分、最低评分、平均评分</strong>
df.groupby(&ldquo;MovieID&rdquo;).agg( rating_mean=(&ldquo;Rating&rdquo;, &ldquo;mean&rdquo;), user_count=(&ldquo;UserID&rdquo;, lambda x : x.nunique())
df.groupby(&ldquo;MovieID&rdquo;).agg( {&ldquo;Rating&rdquo;: [&lsquo;mean&rsquo;, &lsquo;min&rsquo;, &lsquo;max&rsquo;], &ldquo;UserID&rdquo;: lambda x :x.nunique()})
df.groupby(&ldquo;MovieID&rdquo;).apply( lambda x: pd.Series( {&ldquo;min&rdquo;: x[&ldquo;Rating&rdquo;].min(), &ldquo;mean&rdquo;: x[&ldquo;Rating&rdquo;].mean()}))</p>
<p>**记忆：**agg(新列名=函数)、agg(新列名=(原列名，函数))、agg({&ldquo;原列名&rdquo;：函数/列表})
agg函数的两种形式，等号代表“把结果赋值给新列”，字典/元组代表“对这个列运用这些函数”</p>
<p>官网文档：https://pandas.pydata.org/pandas-docs/version/0.23.4/generated/pandas.core.groupby.DataFrameGroupBy.agg.html</p>
<h3 id="读取数据">读取数据</h3>
<p>In [1]:</p>
<div class="highlight" id="id-120"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></span></span></code></pre></div><p>In [2]:</p>
<div class="highlight" id="id-121"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;./datas/movielens-1m/ratings.dat&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">sep</span><span class="o">=</span><span class="s2">&#34;::&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">names</span><span class="o">=</span><span class="s2">&#34;UserID::MovieID::Rating::Timestamp&#34;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;::&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span></span></span></code></pre></div><p>In [3]:</p>
<div class="highlight" id="id-122"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span></span></span></code></pre></div><p>Out[3]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">UserID</th>
<th style="text-align:right">MovieID</th>
<th style="text-align:right">Rating</th>
<th style="text-align:right">Timestamp</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1193</td>
<td style="text-align:right">5</td>
<td style="text-align:right">978300760</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">661</td>
<td style="text-align:right">3</td>
<td style="text-align:right">978302109</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">1</td>
<td style="text-align:right">914</td>
<td style="text-align:right">3</td>
<td style="text-align:right">978301968</td>
</tr>
</tbody>
</table>
<h3 id="聚合后单列-单指标统计">聚合后单列-单指标统计</h3>
<p>In [4]:</p>
<div class="highlight" id="id-123"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 每个MovieID的平均评分</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&#34;MovieID&#34;</span><span class="p">)[</span><span class="s2">&#34;Rating&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[4]:</p>
<div class="highlight" id="id-124"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">MovieID</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="mf">4.146846</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="mf">3.201141</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>    <span class="mf">3.016736</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>    <span class="mf">2.729412</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>    <span class="mf">3.006757</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">Rating</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span></span></span></code></pre></div><p>In [5]:</p>
<div class="highlight" id="id-125"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></span></span></code></pre></div><p>Out[5]:</p>
<div class="highlight" id="id-126"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span></span></span></code></pre></div><h3 id="聚合后单列-多指标统计">聚合后单列-多指标统计</h3>
<p>每个MoiveID的最高评分、最低评分、平均评分</p>
<h4 id="方法1agg函数传入多个结果列名函数名形式">方法1：agg函数传入多个结果列名=函数名形式</h4>
<p>In [6]:</p>
<div class="highlight" id="id-127"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&#34;MovieID&#34;</span><span class="p">)[</span><span class="s2">&#34;Rating&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">mean</span><span class="o">=</span><span class="s2">&#34;mean&#34;</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="s2">&#34;max&#34;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[6]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">mean</th>
<th style="text-align:right">max</th>
<th style="text-align:right">min</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">MovieID</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">4.146846</td>
<td style="text-align:right">5</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3.201141</td>
<td style="text-align:right">5</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">3.016736</td>
<td style="text-align:right">5</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">2.729412</td>
<td style="text-align:right">5</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">3.006757</td>
<td style="text-align:right">5</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<h4 id="方法2agg函数传入字典key是column名value是函数列表">方法2：agg函数传入字典，key是column名，value是函数列表</h4>
<p>In [7]:</p>
<div class="highlight" id="id-128"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 每个MoiveID的最高评分、最低评分、平均评分</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&#34;MovieID&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="s2">&#34;Rating&#34;</span><span class="p">:[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">]}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[7]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">Rating</th>
<th style="text-align:right"></th>
<th style="text-align:right"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"></td>
<td style="text-align:right">mean</td>
<td style="text-align:right">max</td>
<td style="text-align:right">amin</td>
</tr>
<tr>
<td style="text-align:right">MovieID</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">4.146846</td>
<td style="text-align:right">5</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3.201141</td>
<td style="text-align:right">5</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">3.016736</td>
<td style="text-align:right">5</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">2.729412</td>
<td style="text-align:right">5</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">3.006757</td>
<td style="text-align:right">5</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<p>In [8]:</p>
<div class="highlight" id="id-129"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">result</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;age_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;age_min&#39;</span><span class="p">,</span> <span class="s1">&#39;age_max&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[8]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">age_mean</th>
<th style="text-align:right">age_min</th>
<th style="text-align:right">age_max</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">MovieID</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">4.146846</td>
<td style="text-align:right">5</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3.201141</td>
<td style="text-align:right">5</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">3.016736</td>
<td style="text-align:right">5</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">2.729412</td>
<td style="text-align:right">5</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">3.006757</td>
<td style="text-align:right">5</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<h3 id="聚合后多列-多指标统计">聚合后多列-多指标统计</h3>
<p>每个MoiveID的评分人数，最高评分、最低评分、平均评分</p>
<h4 id="方法1agg函数传入字典key是原列名value是原列名和函数元组">方法1：agg函数传入字典，key是原列名，value是原列名和函数元组</h4>
<p>In [9]:</p>
<div class="highlight" id="id-130"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 回忆：agg函数的两种形式，等号代表“把结果赋值给新列”，字典/元组代表“对这个列运用这些函数”</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&#34;MovieID&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">rating_mean</span><span class="o">=</span><span class="p">(</span><span class="s2">&#34;Rating&#34;</span><span class="p">,</span> <span class="s2">&#34;mean&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">rating_min</span><span class="o">=</span><span class="p">(</span><span class="s2">&#34;Rating&#34;</span><span class="p">,</span> <span class="s2">&#34;min&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">rating_max</span><span class="o">=</span><span class="p">(</span><span class="s2">&#34;Rating&#34;</span><span class="p">,</span> <span class="s2">&#34;max&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_count</span><span class="o">=</span><span class="p">(</span><span class="s2">&#34;UserID&#34;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">nunique</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[9]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">rating_mean</th>
<th style="text-align:right">rating_min</th>
<th style="text-align:right">rating_max</th>
<th style="text-align:right">user_count</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">MovieID</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">4.146846</td>
<td style="text-align:right">1</td>
<td style="text-align:right">5</td>
<td style="text-align:right">2077</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3.201141</td>
<td style="text-align:right">1</td>
<td style="text-align:right">5</td>
<td style="text-align:right">701</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">3.016736</td>
<td style="text-align:right">1</td>
<td style="text-align:right">5</td>
<td style="text-align:right">478</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">2.729412</td>
<td style="text-align:right">1</td>
<td style="text-align:right">5</td>
<td style="text-align:right">170</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">3.006757</td>
<td style="text-align:right">1</td>
<td style="text-align:right">5</td>
<td style="text-align:right">296</td>
</tr>
</tbody>
</table>
<h4 id="方法2agg函数传入字典key是原列名value是函数列表">方法2：agg函数传入字典，key是原列名，value是函数列表</h4>
<p>统计后是二级索引，需要做索引处理</p>
<p>In [10]:</p>
<div class="highlight" id="id-131"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&#34;MovieID&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Rating&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;UserID&#34;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[10]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">Rating</th>
<th style="text-align:right">UserID</th>
<th style="text-align:right"></th>
<th style="text-align:right"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"></td>
<td style="text-align:right">mean</td>
<td style="text-align:right">min</td>
<td style="text-align:right">max</td>
<td style="text-align:right"><!-- raw HTML omitted --></td>
</tr>
<tr>
<td style="text-align:right">MovieID</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">4.146846</td>
<td style="text-align:right">1</td>
<td style="text-align:right">5</td>
<td style="text-align:right">2077</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3.201141</td>
<td style="text-align:right">1</td>
<td style="text-align:right">5</td>
<td style="text-align:right">701</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">3.016736</td>
<td style="text-align:right">1</td>
<td style="text-align:right">5</td>
<td style="text-align:right">478</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">2.729412</td>
<td style="text-align:right">1</td>
<td style="text-align:right">5</td>
<td style="text-align:right">170</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">3.006757</td>
<td style="text-align:right">1</td>
<td style="text-align:right">5</td>
<td style="text-align:right">296</td>
</tr>
</tbody>
</table>
<p>In [11]:</p>
<div class="highlight" id="id-132"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">result</span><span class="p">[</span><span class="s2">&#34;Rating&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span></span></span></code></pre></div><p>Out[11]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">mean</th>
<th style="text-align:right">min</th>
<th style="text-align:right">max</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">MovieID</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">4.146846</td>
<td style="text-align:right">1</td>
<td style="text-align:right">5</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3.201141</td>
<td style="text-align:right">1</td>
<td style="text-align:right">5</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">3.016736</td>
<td style="text-align:right">1</td>
<td style="text-align:right">5</td>
</tr>
</tbody>
</table>
<p>In [12]:</p>
<div class="highlight" id="id-133"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">result</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;rating_mean&#34;</span><span class="p">,</span> <span class="s2">&#34;rating_min&#34;</span><span class="p">,</span><span class="s2">&#34;rating_max&#34;</span><span class="p">,</span><span class="s2">&#34;user_count&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[12]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">rating_mean</th>
<th style="text-align:right">rating_min</th>
<th style="text-align:right">rating_max</th>
<th style="text-align:right">user_count</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">MovieID</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">4.146846</td>
<td style="text-align:right">1</td>
<td style="text-align:right">5</td>
<td style="text-align:right">2077</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3.201141</td>
<td style="text-align:right">1</td>
<td style="text-align:right">5</td>
<td style="text-align:right">701</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">3.016736</td>
<td style="text-align:right">1</td>
<td style="text-align:right">5</td>
<td style="text-align:right">478</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">2.729412</td>
<td style="text-align:right">1</td>
<td style="text-align:right">5</td>
<td style="text-align:right">170</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">3.006757</td>
<td style="text-align:right">1</td>
<td style="text-align:right">5</td>
<td style="text-align:right">296</td>
</tr>
</tbody>
</table>
<h4 id="方法3使用groupby之后apply对每个子df单独统计">方法3：使用groupby之后apply对每个子df单独统计</h4>
<p>In [13]:</p>
<div class="highlight" id="id-134"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">agg_func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;注意，这个x是子DF&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 这个Series会变成一行，字典KEY是列名</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;rating_mean&#34;</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&#34;Rating&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;rating_min&#34;</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&#34;Rating&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;rating_max&#34;</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&#34;Rating&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;user_count&#34;</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&#34;UserID&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&#34;MovieID&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">agg_func</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span></span></code></pre></div><p>Out[13]:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">rating_mean</th>
<th style="text-align:right">rating_min</th>
<th style="text-align:right">rating_max</th>
<th style="text-align:right">user_count</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">MovieID</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">4.146846</td>
<td style="text-align:right">1.0</td>
<td style="text-align:right">5.0</td>
<td style="text-align:right">2077.0</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">3.201141</td>
<td style="text-align:right">1.0</td>
<td style="text-align:right">5.0</td>
<td style="text-align:right">701.0</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">3.016736</td>
<td style="text-align:right">1.0</td>
<td style="text-align:right">5.0</td>
<td style="text-align:right">478.0</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">2.729412</td>
<td style="text-align:right">1.0</td>
<td style="text-align:right">5.0</td>
<td style="text-align:right">170.0</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">3.006757</td>
<td style="text-align:right">1.0</td>
<td style="text-align:right">5.0</td>
<td style="text-align:right">296.0</td>
</tr>
</tbody>
</table>
<h1 id="36pandas读取excel将数据展示在网页上">36、Pandas读取Excel将数据展示在网页上</h1>
<p>注意：</p>
<p>本节课程演示的代码，在当前目录下找。</p>
<p>子目录名字：&ldquo;Pandas读取Excel将数据展示在网页上&rdquo;</p>
</div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="更新于 2021-10-24 18:38:23">更新于 2021-10-24&nbsp;</span>
      </div><div class="post-info-license">
          <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span>
        </div></div>
    <div class="post-info-line">
      <div class="post-info-md"></div>
      <div class="post-info-share">
        <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="http://yuanshuai1122.github.io/posts/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E5%9B%9B-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E5%9B%9B/" data-title="Python数据分析之Pandas（四）" data-hashtags="Python,数据分析"><i class="fa-brands fa-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="http://yuanshuai1122.github.io/posts/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E5%9B%9B-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E5%9B%9B/" data-hashtag="Python"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="http://yuanshuai1122.github.io/posts/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E5%9B%9B-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E5%9B%9B/" data-title="Python数据分析之Pandas（四）"><i class="fa-brands fa-weibo fa-fw" aria-hidden="true"></i></a>
  </span>
      </div>
    </div>
  </div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/tags/python/' class="post-tag">Python</a><a href='/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/' class="post-tag">数据分析</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="/posts/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%94-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%BA%94/" class="post-nav-item" rel="prev" title="Python数据分析之Pandas（五）"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>Python数据分析之Pandas（五）</a>
      <a href="/posts/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%B8%89-python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bpandas%E4%B8%89/" class="post-nav-item" rel="next" title="Python数据分析之Pandas（三）">Python数据分析之Pandas（三）<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></main><footer class="footer">
    <div class="footer-container"><div class="footer-line powered">由 <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.119.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.2.18-lts.2"><img class="fixit-icon" src="/fixit.min.svg" alt="FixIt logo" />&nbsp;FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2023</span><span class="author" itemprop="copyrightHolder">
              <a href="/"></a></span></div><div class="footer-line statistics"></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="回到顶部"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">FixIt 主题在启用 JavaScript 的情况下效果最佳。</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/katex/katex.min.js" defer></script><script src="/lib/katex/auto-render.min.js" defer></script><script src="/lib/katex/copy-tex.min.js" defer></script><script src="/lib/katex/mhchem.min.js" defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script>window.config={"code":{"copyTitle":"复制到剪贴板","editLockTitle":"锁定可编辑代码块","editUnLockTitle":"解锁可编辑代码块","editable":true,"maxShownLines":10},"comment":{"enable":false},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验。"},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script src="/js/theme.min.js" defer></script></body>
</html>
