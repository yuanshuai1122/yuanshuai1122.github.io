<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>SpringBoot2核心技术-web开发 - CN.yuanshuai</title><meta name="author" content="">
<meta name="author-link" content="">
<meta name="description" content="BindingAwareModelMap 是Model 也是Map mavContainer.getModel(); 获取到值的 1.4、自定义对象参数： 可以自动类型转换与格式化，可以级联封装。 /** * 姓名： &lt;input name=&#34;userName&#34;/&gt; &lt;br/&gt; * 年龄： &lt;input name=&#34;age&#34;/&gt; &lt;br/&gt; * 生日： &lt;input" /><meta name="keywords" content='Java, SpringBoot' /><meta itemprop="name" content="SpringBoot2核心技术-web开发">
<meta itemprop="description" content="BindingAwareModelMap 是Model 也是Map mavContainer.getModel(); 获取到值的 1.4、自定义对象参数： 可以自动类型转换与格式化，可以级联封装。 /** * 姓名： &lt;input name=&#34;userName&#34;/&gt; &lt;br/&gt; * 年龄： &lt;input name=&#34;age&#34;/&gt; &lt;br/&gt; * 生日： &lt;input"><meta itemprop="datePublished" content="2021-07-23T18:38:23+00:00" />
<meta itemprop="dateModified" content="2021-07-23T18:38:23+00:00" />
<meta itemprop="wordCount" content="10051">
<meta itemprop="keywords" content="Java,SpringBoot," /><meta property="og:title" content="SpringBoot2核心技术-web开发" />
<meta property="og:description" content="BindingAwareModelMap 是Model 也是Map mavContainer.getModel(); 获取到值的 1.4、自定义对象参数： 可以自动类型转换与格式化，可以级联封装。 /** * 姓名： &lt;input name=&#34;userName&#34;/&gt; &lt;br/&gt; * 年龄： &lt;input name=&#34;age&#34;/&gt; &lt;br/&gt; * 生日： &lt;input" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://yuanshuai1122.github.io/posts/springboot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-web%E5%BC%80%E5%8F%91-springboot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-web%E5%BC%80%E5%8F%91/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-23T18:38:23+00:00" />
<meta property="article:modified_time" content="2021-07-23T18:38:23+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SpringBoot2核心技术-web开发"/>
<meta name="twitter:description" content="BindingAwareModelMap 是Model 也是Map mavContainer.getModel(); 获取到值的 1.4、自定义对象参数： 可以自动类型转换与格式化，可以级联封装。 /** * 姓名： &lt;input name=&#34;userName&#34;/&gt; &lt;br/&gt; * 年龄： &lt;input name=&#34;age&#34;/&gt; &lt;br/&gt; * 生日： &lt;input"/>
<meta name="application-name" content="CN.yuanshuai">
<meta name="apple-mobile-web-app-title" content="CN.yuanshuai"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="http://yuanshuai1122.github.io/posts/springboot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-web%E5%BC%80%E5%8F%91-springboot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-web%E5%BC%80%E5%8F%91/" /><link rel="prev" href="http://yuanshuai1122.github.io/posts/springboot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-springboot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" /><link rel="next" href="http://yuanshuai1122.github.io/posts/spring5%E4%B9%8B%E6%96%B0%E5%8A%9F%E8%83%BDwebflux-spring5%E4%B9%8B%E6%96%B0%E5%8A%9F%E8%83%BDwebflux/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "SpringBoot2核心技术-web开发",
    "inLanguage": "zh-CN",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "http:\/\/yuanshuai1122.github.io\/posts\/springboot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-web%E5%BC%80%E5%8F%91-springboot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-web%E5%BC%80%E5%8F%91\/"
    },"genre": "posts","keywords": "Java, SpringBoot","wordcount":  10051 ,
    "url": "http:\/\/yuanshuai1122.github.io\/posts\/springboot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-web%E5%BC%80%E5%8F%91-springboot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-web%E5%BC%80%E5%8F%91\/","datePublished": "2021-07-23T18:38:23+00:00","dateModified": "2021-07-23T18:38:23+00:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "yuanshuai"
      },"description": ""
  }
  </script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="CN.yuanshuai"><img loading="lazy" src="/fixit.min.svg" srcset="/fixit.min.svg, /fixit.min.svg 1.5x, /fixit.min.svg 2x" sizes="auto" data-title="CN.yuanshuai" data-alt="CN.yuanshuai" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span class="header-title-text">CN.yuanshuai</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/posts/"
                
                
              ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 文章</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/categories/"
                
                
              ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/tags/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li class="menu-item delimiter"></li><li class="menu-item theme-switch" title="切换主题">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="CN.yuanshuai"><img loading="lazy" src="/fixit.min.svg" srcset="/fixit.min.svg, /fixit.min.svg 1.5x, /fixit.min.svg 2x" sizes="auto" data-title="/fixit.min.svg" data-alt="/fixit.min.svg" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span class="header-title-text">CN.yuanshuai</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/posts/"
                  
                  
                ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 文章</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="切换主题"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><main class="container"><aside class="toc" id="toc-auto"><h2 class="toc-title">目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside>

  <aside class="aside-custom">
    </aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>SpringBoot2核心技术-web开发</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><a href="https://cloud.tencent.com/developer/user/8180692" title="作者"target="_blank" rel="external nofollow noopener noreferrer author" class="author"><img loading="lazy" src="https://aabb-2023.oss-cn-beijing.aliyuncs.com/hjscijg3uw.png" srcset="https://aabb-2023.oss-cn-beijing.aliyuncs.com/hjscijg3uw.png, https://aabb-2023.oss-cn-beijing.aliyuncs.com/hjscijg3uw.png 1.5x, https://aabb-2023.oss-cn-beijing.aliyuncs.com/hjscijg3uw.png 2x" sizes="auto" data-title="yuanshuai" data-alt="yuanshuai" class="avatar" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/>&nbsp;yuanshuai</a></span></div>
      <div class="post-meta-line"><span title="发布于 2021-07-23 18:38:23"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden="true"></i><time datetime="2021-07-23">2021-07-23</time></span>&nbsp;<span title="更新于 2021-07-23 18:38:23"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden="true"></i><time datetime="2021-07-23">2021-07-23</time></span>&nbsp;<span title="10051 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>约 10100 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>预计阅读 21 分钟</span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>目录</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#14自定义对象参数">1.4、自定义对象参数：</a></li>
      </ul>
    </li>
    <li><a href="#2pojo封装过程">2、POJO封装过程</a></li>
    <li><a href="#3参数处理原理">3、参数处理原理</a>
      <ul>
        <li><a href="#1handleradapter">1、HandlerAdapter</a></li>
        <li><a href="#2执行目标方法">2、执行目标方法</a></li>
        <li><a href="#3参数解析器-handlermethodargumentresolver">3、参数解析器-HandlerMethodArgumentResolver</a></li>
        <li><a href="#4返回值处理器">4、返回值处理器</a></li>
        <li><a href="#5如何确定目标方法每一个参数的值">5、如何确定目标方法每一个参数的值</a></li>
        <li><a href="#heading"></a></li>
        <li><a href="#6目标方法执行完成">6、目标方法执行完成</a></li>
        <li><a href="#7处理派发结果">7、处理派发结果</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#1响应json">1、响应JSON</a>
      <ul>
        <li><a href="#11jacksonjarresponsebody">1.1、jackson.jar+@ResponseBody</a></li>
        <li><a href="#12springmvc到底支持哪些返回值">1.2、SpringMVC到底支持哪些返回值</a></li>
        <li><a href="#13httpmessageconverter原理">1.3、HTTPMessageConverter原理</a></li>
      </ul>
    </li>
    <li><a href="#2内容协商">2、内容协商</a>
      <ul>
        <li><a href="#1引入xml依赖">1、引入xml依赖</a></li>
        <li><a href="#2postman分别测试返回json和xml">2、postman分别测试返回json和xml</a></li>
        <li><a href="#3开启浏览器参数方式内容协商功能">3、开启浏览器参数方式内容协商功能</a></li>
        <li><a href="#4内容协商原理">4、内容协商原理</a></li>
        <li><a href="#5自定义-messageconverter">5、自定义 MessageConverter</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#1视图解析">1、视图解析</a>
      <ul>
        <li><a href="#1视图解析原理流程">1、视图解析原理流程</a></li>
      </ul>
    </li>
    <li><a href="#2模板引擎-thymeleaf">2、模板引擎-Thymeleaf</a>
      <ul>
        <li><a href="#1thymeleaf简介">1、thymeleaf简介</a></li>
        <li><a href="#2基本语法">2、基本语法</a></li>
        <li><a href="#3设置属性值-thattr">3、设置属性值-th:attr</a></li>
        <li><a href="#4迭代">4、迭代</a></li>
        <li><a href="#5条件运算">5、条件运算</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#6属性优先级">6、属性优先级</a></li>
      </ul>
    </li>
    <li><a href="#3thymeleaf使用">3、thymeleaf使用</a>
      <ul>
        <li></li>
      </ul>
    </li>
    <li><a href="#4构建后台管理系统">4、构建后台管理系统</a>
      <ul>
        <li><a href="#1项目创建">1、项目创建</a></li>
        <li><a href="#2静态资源处理">2、静态资源处理</a></li>
        <li><a href="#3路径构建">3、路径构建</a></li>
        <li><a href="#4模板抽取">4、模板抽取</a></li>
        <li><a href="#5页面跳转">5、页面跳转</a></li>
        <li><a href="#6数据渲染">6、数据渲染</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#1handlerinterceptor-接口">1、HandlerInterceptor 接口</a></li>
    <li><a href="#2配置拦截器">2、配置拦截器</a></li>
    <li><a href="#3拦截器原理">3、拦截器原理</a></li>
  </ul>

  <ul>
    <li><a href="#1页面表单">1、页面表单</a></li>
    <li><a href="#2文件上传代码">2、文件上传代码</a></li>
    <li><a href="#3自动配置原理">3、自动配置原理</a></li>
  </ul>

  <ul>
    <li><a href="#1错误处理">1、错误处理</a>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#1使用servlet-api">1、使用Servlet API</a></li>
    <li><a href="#2使用registrationbean">2、使用RegistrationBean</a></li>
  </ul>

  <ul>
    <li><a href="#1切换嵌入式servlet容器">1、切换嵌入式Servlet容器</a></li>
    <li><a href="#2定制servlet容器">2、定制Servlet容器</a></li>
  </ul>

  <ul>
    <li><a href="#1定制化的常见方式">1、定制化的常见方式</a></li>
    <li><a href="#2原理分析套路">2、原理分析套路</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><blockquote>
<p>BindingAwareModelMap 是Model 也是Map</p>
</blockquote>
<p><strong>mavContainer</strong>.getModel(); 获取到值的</p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/19.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/19.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/19.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/19.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/19.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/19.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/20.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/20.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/20.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/20.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/20.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/20.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/21.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/21.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/21.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/21.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/21.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/21.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="14自定义对象参数">1.4、自定义对象参数：</h3>
<p>可以自动类型转换与格式化，可以级联封装。</p>
<div class="highlight" id="id-1"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> *     姓名： &lt;input name=&#34;userName&#34;/&gt; &lt;br/&gt;
</span></span></span><span class="line"><span class="cl"><span class="cm"> *     年龄： &lt;input name=&#34;age&#34;/&gt; &lt;br/&gt;
</span></span></span><span class="line"><span class="cl"><span class="cm"> *     生日： &lt;input name=&#34;birth&#34;/&gt; &lt;br/&gt;
</span></span></span><span class="line"><span class="cl"><span class="cm"> *     宠物姓名：&lt;input name=&#34;pet.name&#34;/&gt;&lt;br/&gt;
</span></span></span><span class="line"><span class="cl"><span class="cm"> *     宠物年龄：&lt;input name=&#34;pet.age&#34;/&gt;
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Data</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">userName</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">age</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Date</span> <span class="n">birth</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Pet</span> <span class="n">pet</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@Data</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Pet</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">age</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span></span></span></code></pre></div><h2 id="2pojo封装过程">2、POJO封装过程</h2>
<ul>
<li><strong>ServletModelAttributeMethodProcessor</strong></li>
</ul>
<h2 id="3参数处理原理">3、参数处理原理</h2>
<ul>
<li>HandlerMapping中找到能处理请求的Handler（Controller.method()）</li>
<li>为当前Handler 找一个适配器 HandlerAdapter； <strong>RequestMappingHandlerAdapter</strong></li>
<li>适配器执行目标方法并确定方法参数的每一个值</li>
</ul>
<h3 id="1handleradapter">1、HandlerAdapter</h3>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/22.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/22.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/22.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/22.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/22.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/22.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>0 - 支持方法上标注@RequestMapping</p>
<p>1 - 支持函数式编程的</p>
<p>xxxxxx</p>
<h3 id="2执行目标方法">2、执行目标方法</h3>
<div class="highlight" id="id-2"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Actually invoke the handler.
</span></span></span><span class="line"><span class="cl"><span class="c1">//DispatcherServlet -- doDispatch
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">mv</span> <span class="o">=</span> <span class="n">ha</span><span class="o">.</span><span class="na">handle</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">mappedHandler</span><span class="o">.</span><span class="na">getHandler</span><span class="o">());</span>
</span></span><span class="line"><span class="cl"><span class="n">mav</span> <span class="o">=</span> <span class="n">invokeHandlerMethod</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handlerMethod</span><span class="o">);</span> <span class="c1">//执行目标方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//ServletInvocableHandlerMethod
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Object</span> <span class="n">returnValue</span> <span class="o">=</span> <span class="n">invokeForRequest</span><span class="o">(</span><span class="n">webRequest</span><span class="o">,</span> <span class="n">mavContainer</span><span class="o">,</span> <span class="n">providedArgs</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//获取方法的参数值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Object</span><span class="o">[]</span> <span class="n">args</span> <span class="o">=</span> <span class="n">getMethodArgumentValues</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">mavContainer</span><span class="o">,</span> <span class="n">providedArgs</span><span class="o">);</span></span></span></code></pre></div><h3 id="3参数解析器-handlermethodargumentresolver">3、参数解析器-HandlerMethodArgumentResolver</h3>
<p>确定将要执行的目标方法的每一个参数的值是什么;</p>
<p>SpringMVC目标方法能写多少种参数类型。取决于参数解析器。</p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/23.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/23.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/23.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/23.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/23.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/23.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/24.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/24.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/24.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/24.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/24.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/24.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<ul>
<li>当前解析器是否支持解析这种参数</li>
<li>支持就调用 resolveArgument</li>
</ul>
<h3 id="4返回值处理器">4、返回值处理器</h3>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/25.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/25.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/25.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/25.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/25.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/25.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="5如何确定目标方法每一个参数的值">5、如何确定目标方法每一个参数的值</h3>
<div class="highlight" id="id-3"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">============</span><span class="n">InvocableHandlerMethod</span><span class="o">==========================</span>
</span></span><span class="line"><span class="cl"><span class="kd">protected</span> <span class="n">Object</span><span class="o">[]</span> <span class="nf">getMethodArgumentValues</span><span class="o">(</span><span class="n">NativeWebRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">ModelAndViewContainer</span> <span class="n">mavContainer</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">Object</span><span class="o">...</span> <span class="n">providedArgs</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">MethodParameter</span><span class="o">[]</span> <span class="n">parameters</span> <span class="o">=</span> <span class="n">getMethodParameters</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">ObjectUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">parameters</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">EMPTY_ARGS</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">Object</span><span class="o">[]</span> <span class="n">args</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[</span><span class="n">parameters</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">parameters</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">MethodParameter</span> <span class="n">parameter</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">            <span class="n">parameter</span><span class="o">.</span><span class="na">initParameterNameDiscovery</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">parameterNameDiscoverer</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">args</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">findProvidedArgument</span><span class="o">(</span><span class="n">parameter</span><span class="o">,</span> <span class="n">providedArgs</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">continue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">resolvers</span><span class="o">.</span><span class="na">supportsParameter</span><span class="o">(</span><span class="n">parameter</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalStateException</span><span class="o">(</span><span class="n">formatArgumentError</span><span class="o">(</span><span class="n">parameter</span><span class="o">,</span> <span class="s">&#34;No suitable resolver&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">args</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">resolvers</span><span class="o">.</span><span class="na">resolveArgument</span><span class="o">(</span><span class="n">parameter</span><span class="o">,</span> <span class="n">mavContainer</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">dataBinderFactory</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// Leave stack trace for later, exception may actually be resolved and handled...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">String</span> <span class="n">exMsg</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="na">getMessage</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="o">(</span><span class="n">exMsg</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">exMsg</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">parameter</span><span class="o">.</span><span class="na">getExecutable</span><span class="o">().</span><span class="na">toGenericString</span><span class="o">()))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="n">formatArgumentError</span><span class="o">(</span><span class="n">parameter</span><span class="o">,</span> <span class="n">exMsg</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">                    <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="k">throw</span> <span class="n">ex</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">args</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span></span></span></code></pre></div><h4 id="51挨个判断所有参数解析器那个支持解析这个参数">5.1、挨个判断所有参数解析器那个支持解析这个参数</h4>
<div class="highlight" id="id-4"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">    <span class="nd">@Nullable</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">HandlerMethodArgumentResolver</span> <span class="nf">getArgumentResolver</span><span class="o">(</span><span class="n">MethodParameter</span> <span class="n">parameter</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">HandlerMethodArgumentResolver</span> <span class="n">result</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">argumentResolverCache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">parameter</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">result</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="o">(</span><span class="n">HandlerMethodArgumentResolver</span> <span class="n">resolver</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">argumentResolvers</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">resolver</span><span class="o">.</span><span class="na">supportsParameter</span><span class="o">(</span><span class="n">parameter</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">result</span> <span class="o">=</span> <span class="n">resolver</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">this</span><span class="o">.</span><span class="na">argumentResolverCache</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">parameter</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="k">break</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span></span></span></code></pre></div><h4 id="52解析这个参数的值">5.2、解析这个参数的值</h4>
<div class="highlight" id="id-5"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">调用各自</span> <span class="n">HandlerMethodArgumentResolver</span> <span class="n">的</span> <span class="n">resolveArgument</span> <span class="n">方法即可</span></span></span></code></pre></div><h4 id="53自定义类型参数-封装pojo">5.3、自定义类型参数 封装POJO</h4>
<p><strong>ServletModelAttributeMethodProcessor  这个参数处理器支持</strong></p>
<p><strong>是否为简单类型。</strong></p>
<div class="highlight" id="id-6"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isSimpleValueType</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">(</span><span class="n">Void</span><span class="o">.</span><span class="na">class</span> <span class="o">!=</span> <span class="n">type</span> <span class="o">&amp;&amp;</span> <span class="kt">void</span><span class="o">.</span><span class="na">class</span> <span class="o">!=</span> <span class="n">type</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">                <span class="o">(</span><span class="n">ClassUtils</span><span class="o">.</span><span class="na">isPrimitiveOrWrapper</span><span class="o">(</span><span class="n">type</span><span class="o">)</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">                <span class="n">Enum</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="n">type</span><span class="o">)</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">                <span class="n">CharSequence</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="n">type</span><span class="o">)</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">                <span class="n">Number</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="n">type</span><span class="o">)</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">                <span class="n">Date</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="n">type</span><span class="o">)</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">                <span class="n">Temporal</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="n">type</span><span class="o">)</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">                <span class="n">URI</span><span class="o">.</span><span class="na">class</span> <span class="o">==</span> <span class="n">type</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">                <span class="n">URL</span><span class="o">.</span><span class="na">class</span> <span class="o">==</span> <span class="n">type</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">                <span class="n">Locale</span><span class="o">.</span><span class="na">class</span> <span class="o">==</span> <span class="n">type</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">                <span class="n">Class</span><span class="o">.</span><span class="na">class</span> <span class="o">==</span> <span class="n">type</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Nullable</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">final</span> <span class="n">Object</span> <span class="nf">resolveArgument</span><span class="o">(</span><span class="n">MethodParameter</span> <span class="n">parameter</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">ModelAndViewContainer</span> <span class="n">mavContainer</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">NativeWebRequest</span> <span class="n">webRequest</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">WebDataBinderFactory</span> <span class="n">binderFactory</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">Assert</span><span class="o">.</span><span class="na">state</span><span class="o">(</span><span class="n">mavContainer</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">,</span> <span class="s">&#34;ModelAttributeMethodProcessor requires ModelAndViewContainer&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">Assert</span><span class="o">.</span><span class="na">state</span><span class="o">(</span><span class="n">binderFactory</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">,</span> <span class="s">&#34;ModelAttributeMethodProcessor requires WebDataBinderFactory&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">ModelFactory</span><span class="o">.</span><span class="na">getNameForParameter</span><span class="o">(</span><span class="n">parameter</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">ModelAttribute</span> <span class="n">ann</span> <span class="o">=</span> <span class="n">parameter</span><span class="o">.</span><span class="na">getParameterAnnotation</span><span class="o">(</span><span class="n">ModelAttribute</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">ann</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">mavContainer</span><span class="o">.</span><span class="na">setBinding</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">ann</span><span class="o">.</span><span class="na">binding</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">Object</span> <span class="n">attribute</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">BindingResult</span> <span class="n">bindingResult</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">mavContainer</span><span class="o">.</span><span class="na">containsAttribute</span><span class="o">(</span><span class="n">name</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">attribute</span> <span class="o">=</span> <span class="n">mavContainer</span><span class="o">.</span><span class="na">getModel</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// Create attribute instance
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">attribute</span> <span class="o">=</span> <span class="n">createAttribute</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">parameter</span><span class="o">,</span> <span class="n">binderFactory</span><span class="o">,</span> <span class="n">webRequest</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">catch</span> <span class="o">(</span><span class="n">BindException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">isBindExceptionRequired</span><span class="o">(</span><span class="n">parameter</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="c1">// No BindingResult parameter -&gt; fail with BindException
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="k">throw</span> <span class="n">ex</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// Otherwise, expose null/empty value and associated BindingResult
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">if</span> <span class="o">(</span><span class="n">parameter</span><span class="o">.</span><span class="na">getParameterType</span><span class="o">()</span> <span class="o">==</span> <span class="n">Optional</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">attribute</span> <span class="o">=</span> <span class="n">Optional</span><span class="o">.</span><span class="na">empty</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="n">bindingResult</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="na">getBindingResult</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">bindingResult</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// Bean property binding and validation;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// skipped in case of binding failure on construction.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">WebDataBinder</span> <span class="n">binder</span> <span class="o">=</span> <span class="n">binderFactory</span><span class="o">.</span><span class="na">createBinder</span><span class="o">(</span><span class="n">webRequest</span><span class="o">,</span> <span class="n">attribute</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">binder</span><span class="o">.</span><span class="na">getTarget</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(!</span><span class="n">mavContainer</span><span class="o">.</span><span class="na">isBindingDisabled</span><span class="o">(</span><span class="n">name</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">bindRequestParameters</span><span class="o">(</span><span class="n">binder</span><span class="o">,</span> <span class="n">webRequest</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="n">validateIfApplicable</span><span class="o">(</span><span class="n">binder</span><span class="o">,</span> <span class="n">parameter</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">binder</span><span class="o">.</span><span class="na">getBindingResult</span><span class="o">().</span><span class="na">hasErrors</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">isBindExceptionRequired</span><span class="o">(</span><span class="n">binder</span><span class="o">,</span> <span class="n">parameter</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="k">throw</span> <span class="k">new</span> <span class="n">BindException</span><span class="o">(</span><span class="n">binder</span><span class="o">.</span><span class="na">getBindingResult</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// Value type adaptation, also covering java.util.Optional
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="o">(!</span><span class="n">parameter</span><span class="o">.</span><span class="na">getParameterType</span><span class="o">().</span><span class="na">isInstance</span><span class="o">(</span><span class="n">attribute</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">attribute</span> <span class="o">=</span> <span class="n">binder</span><span class="o">.</span><span class="na">convertIfNecessary</span><span class="o">(</span><span class="n">binder</span><span class="o">.</span><span class="na">getTarget</span><span class="o">(),</span> <span class="n">parameter</span><span class="o">.</span><span class="na">getParameterType</span><span class="o">(),</span> <span class="n">parameter</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">bindingResult</span> <span class="o">=</span> <span class="n">binder</span><span class="o">.</span><span class="na">getBindingResult</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Add resolved attribute and BindingResult at the end of the model
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">bindingResultModel</span> <span class="o">=</span> <span class="n">bindingResult</span><span class="o">.</span><span class="na">getModel</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">mavContainer</span><span class="o">.</span><span class="na">removeAttributes</span><span class="o">(</span><span class="n">bindingResultModel</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mavContainer</span><span class="o">.</span><span class="na">addAllAttributes</span><span class="o">(</span><span class="n">bindingResultModel</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">attribute</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span></span></span></code></pre></div><h3 id="heading"></h3>
<p><strong>WebDataBinder binder = binderFactory.createBinder(webRequest, attribute, name);</strong></p>
<p><strong>WebDataBinder :web数据绑定器，将请求参数的值绑定到指定的JavaBean里面</strong></p>
<p><strong>WebDataBinder 利用它里面的 Converters 将请求数据转成指定的数据类型。再次封装到JavaBean中</strong></p>
<p>**
**</p>
<p><strong>GenericConversionService：在设置每一个值的时候，找它里面的所有converter那个可以将这个数据类型（request带来参数的字符串）转换到指定的类型（JavaBean &ndash; Integer）</strong></p>
<p><strong>byte &ndash; &gt; file</strong></p>
<p>**
**</p>
<p>@FunctionalInterface<strong>public interface</strong> Converter&lt;S, T&gt;</p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/26.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/26.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/26.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/26.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/26.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/26.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/27.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/27.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/27.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/27.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/27.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/27.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>未来我们可以给WebDataBinder里面放自己的Converter；</p>
<p><strong>private static final class</strong> StringToNumber&lt;T <strong>extends</strong> Number&gt; <strong>implements</strong> Converter&lt;String, T&gt;</p>
<p>自定义 Converter</p>
<div class="highlight" id="id-7"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">    <span class="c1">//1、WebMvcConfigurer定制化SpringMVC的功能
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">WebMvcConfigurer</span> <span class="nf">webMvcConfigurer</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">WebMvcConfigurer</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configurePathMatch</span><span class="o">(</span><span class="n">PathMatchConfigurer</span> <span class="n">configurer</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">UrlPathHelper</span> <span class="n">urlPathHelper</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UrlPathHelper</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// 不移除；后面的内容。矩阵变量功能就可以生效
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">urlPathHelper</span><span class="o">.</span><span class="na">setRemoveSemicolonContent</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">configurer</span><span class="o">.</span><span class="na">setUrlPathHelper</span><span class="o">(</span><span class="n">urlPathHelper</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addFormatters</span><span class="o">(</span><span class="n">FormatterRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">registry</span><span class="o">.</span><span class="na">addConverter</span><span class="o">(</span><span class="k">new</span> <span class="n">Converter</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Pet</span><span class="o">&gt;()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">                    <span class="kd">public</span> <span class="n">Pet</span> <span class="nf">convert</span><span class="o">(</span><span class="n">String</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="c1">// 啊猫,3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                        <span class="k">if</span><span class="o">(!</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">source</span><span class="o">)){</span>
</span></span><span class="line"><span class="cl">                            <span class="n">Pet</span> <span class="n">pet</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Pet</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                            <span class="n">String</span><span class="o">[]</span> <span class="n">split</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&#34;,&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                            <span class="n">pet</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">split</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
</span></span><span class="line"><span class="cl">                            <span class="n">pet</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">split</span><span class="o">[</span><span class="mi">1</span><span class="o">]));</span>
</span></span><span class="line"><span class="cl">                            <span class="k">return</span> <span class="n">pet</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                        <span class="o">}</span>
</span></span><span class="line"><span class="cl">                        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                    <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="o">});</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">};</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span></span></span></code></pre></div><h3 id="6目标方法执行完成">6、目标方法执行完成</h3>
<p>将所有的数据都放在 <strong>ModelAndViewContainer</strong>；包含要去的页面地址View。还包含Model数据。</p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/28.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/28.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/28.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/28.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/28.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/28.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="7处理派发结果">7、处理派发结果</h3>
<p><strong>processDispatchResult</strong>(processedRequest, response, mappedHandler, mv, dispatchException);</p>
<p>renderMergedOutputModel(mergedModel, getRequestToExpose(request), response);</p>
<div class="highlight" id="id-8"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">InternalResourceView</span><span class="err">：</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">renderMergedOutputModel</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Expose the model object as request attributes.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">exposeModelAsRequestAttributes</span><span class="o">(</span><span class="n">model</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Expose helpers as request attributes, if any.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">exposeHelpers</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Determine the path for the request dispatcher.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">String</span> <span class="n">dispatcherPath</span> <span class="o">=</span> <span class="n">prepareForRendering</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Obtain a RequestDispatcher for the target resource (typically a JSP).
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">RequestDispatcher</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">getRequestDispatcher</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">dispatcherPath</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">rd</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="n">ServletException</span><span class="o">(</span><span class="s">&#34;Could not get RequestDispatcher for [&#34;</span> <span class="o">+</span> <span class="n">getUrl</span><span class="o">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">                    <span class="s">&#34;]: Check that the corresponding file exists within your web application archive!&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// If already included or response already committed, perform include, else forward.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">useInclude</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="n">getContentType</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34;Including [&#34;</span> <span class="o">+</span> <span class="n">getUrl</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;]&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">rd</span><span class="o">.</span><span class="na">include</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// Note: The forwarded resource is supposed to determine the content type itself.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34;Forwarding to [&#34;</span> <span class="o">+</span> <span class="n">getUrl</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;]&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">rd</span><span class="o">.</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span></span></span></code></pre></div><h1 id="heading-1"></h1>
<div class="highlight" id="id-9"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">暴露模型作为请求域属性</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Expose the model object as request attributes.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">exposeModelAsRequestAttributes</span><span class="o">(</span><span class="n">model</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span></span></span></code></pre></div><h1 id="heading-2"></h1>
<div class="highlight" id="id-10"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">exposeModelAsRequestAttributes</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">model</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//model中的所有数据遍历挨个放在请求域中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">model</span><span class="o">.</span><span class="na">forEach</span><span class="o">((</span><span class="n">name</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">request</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">});</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span></span></span></code></pre></div><h1 id="4数据响应与内容协商">4、数据响应与内容协商</h1>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/29.jpg" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/29.jpg, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/29.jpg 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/29.jpg 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/29.jpg" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/29.jpg" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h2 id="1响应json">1、响应JSON</h2>
<h3 id="11jacksonjarresponsebody">1.1、jackson.jar+@ResponseBody</h3>
<div class="highlight" id="id-11"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">web场景自动引入了json场景
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-json<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;version&gt;</span>2.3.4.RELEASE<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;scope&gt;</span>compile<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span></span></span></code></pre></div><p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/30.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/30.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/30.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/30.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/30.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/30.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>给前端自动返回json数据；</p>
<h4 id="1返回值解析器">1、返回值解析器</h4>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/31.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/31.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/31.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/31.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/31.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/31.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<div class="highlight" id="id-12"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">this</span><span class="o">.</span><span class="na">returnValueHandlers</span><span class="o">.</span><span class="na">handleReturnValue</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">					<span class="n">returnValue</span><span class="o">,</span> <span class="n">getReturnValueType</span><span class="o">(</span><span class="n">returnValue</span><span class="o">),</span> <span class="n">mavContainer</span><span class="o">,</span> <span class="n">webRequest</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span></span></span></code></pre></div><div class="highlight" id="id-13"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">	<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleReturnValue</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="n">Object</span> <span class="n">returnValue</span><span class="o">,</span> <span class="n">MethodParameter</span> <span class="n">returnType</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">			<span class="n">ModelAndViewContainer</span> <span class="n">mavContainer</span><span class="o">,</span> <span class="n">NativeWebRequest</span> <span class="n">webRequest</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">HandlerMethodReturnValueHandler</span> <span class="n">handler</span> <span class="o">=</span> <span class="n">selectHandler</span><span class="o">(</span><span class="n">returnValue</span><span class="o">,</span> <span class="n">returnType</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="o">(</span><span class="n">handler</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;Unknown return value type: &#34;</span> <span class="o">+</span> <span class="n">returnType</span><span class="o">.</span><span class="na">getParameterType</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="n">handler</span><span class="o">.</span><span class="na">handleReturnValue</span><span class="o">(</span><span class="n">returnValue</span><span class="o">,</span> <span class="n">returnType</span><span class="o">,</span> <span class="n">mavContainer</span><span class="o">,</span> <span class="n">webRequest</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span></span></span></code></pre></div><div class="highlight" id="id-14"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">RequestResponseBodyMethodProcessor</span>  	
</span></span><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleReturnValue</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="n">Object</span> <span class="n">returnValue</span><span class="o">,</span> <span class="n">MethodParameter</span> <span class="n">returnType</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">			<span class="n">ModelAndViewContainer</span> <span class="n">mavContainer</span><span class="o">,</span> <span class="n">NativeWebRequest</span> <span class="n">webRequest</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">			<span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">HttpMediaTypeNotAcceptableException</span><span class="o">,</span> <span class="n">HttpMessageNotWritableException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">mavContainer</span><span class="o">.</span><span class="na">setRequestHandled</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">ServletServerHttpRequest</span> <span class="n">inputMessage</span> <span class="o">=</span> <span class="n">createInputMessage</span><span class="o">(</span><span class="n">webRequest</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">ServletServerHttpResponse</span> <span class="n">outputMessage</span> <span class="o">=</span> <span class="n">createOutputMessage</span><span class="o">(</span><span class="n">webRequest</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Try even with null return value. ResponseBodyAdvice could get involved.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// 使用消息转换器进行写出操作
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">writeWithMessageConverters</span><span class="o">(</span><span class="n">returnValue</span><span class="o">,</span> <span class="n">returnType</span><span class="o">,</span> <span class="n">inputMessage</span><span class="o">,</span> <span class="n">outputMessage</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span></span></span></code></pre></div><h4 id="2返回值解析器原理">2、返回值解析器原理</h4>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/32.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/32.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/32.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/32.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/32.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/32.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<ul>
<li>
<p>1、返回值处理器判断是否支持这种类型返回值 supportsReturnType</p>
</li>
<li>
<p>2、返回值处理器调用 handleReturnValue 进行处理</p>
</li>
<li>
<p>3、RequestResponseBodyMethodProcessor 可以处理返回值标了@ResponseBody 注解的。</p>
</li>
<li>
<ul>
<li>
<ol>
<li>利用 MessageConverters 进行处理 将数据写为json</li>
</ol>
</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>1、内容协商（浏览器默认会以请求头的方式告诉服务器他能接受什么样的内容类型）</li>
<li>2、服务器最终根据自己自身的能力，决定服务器能生产出什么样内容类型的数据，</li>
<li>3、SpringMVC会挨个遍历所有容器底层的 HttpMessageConverter ，看谁能处理？</li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>
<ul>
<li>1、得到MappingJackson2HttpMessageConverter可以将对象写为json</li>
<li>2、利用MappingJackson2HttpMessageConverter将对象转为json再写出去。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/33.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/33.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/33.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/33.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/33.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/33.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="12springmvc到底支持哪些返回值">1.2、SpringMVC到底支持哪些返回值</h3>
<div class="highlight" id="id-15"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ModelAndView</span>
</span></span><span class="line"><span class="cl"><span class="n">Model</span>
</span></span><span class="line"><span class="cl"><span class="n">View</span>
</span></span><span class="line"><span class="cl"><span class="n">ResponseEntity</span> 
</span></span><span class="line"><span class="cl"><span class="n">ResponseBodyEmitter</span>
</span></span><span class="line"><span class="cl"><span class="n">StreamingResponseBody</span>
</span></span><span class="line"><span class="cl"><span class="n">HttpEntity</span>
</span></span><span class="line"><span class="cl"><span class="n">HttpHeaders</span>
</span></span><span class="line"><span class="cl"><span class="n">Callable</span>
</span></span><span class="line"><span class="cl"><span class="n">DeferredResult</span>
</span></span><span class="line"><span class="cl"><span class="n">ListenableFuture</span>
</span></span><span class="line"><span class="cl"><span class="n">CompletionStage</span>
</span></span><span class="line"><span class="cl"><span class="n">WebAsyncTask</span>
</span></span><span class="line"><span class="cl"><span class="n">有</span> <span class="nd">@ModelAttribute</span> <span class="n">且为对象类型的</span>
</span></span><span class="line"><span class="cl"><span class="nd">@ResponseBody</span> <span class="n">注解</span> <span class="o">---&gt;</span> <span class="n">RequestResponseBodyMethodProcessor</span><span class="err">；</span></span></span></code></pre></div><h3 id="13httpmessageconverter原理">1.3、HTTPMessageConverter原理</h3>
<h4 id="1messageconverter规范">1、MessageConverter规范</h4>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/34.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/34.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/34.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/34.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/34.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/34.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>HttpMessageConverter: 看是否支持将 此 Class类型的对象，转为MediaType类型的数据。</p>
<p>例子：Person对象转为JSON。或者 JSON转为Person</p>
<h4 id="2默认的messageconverter">2、默认的MessageConverter</h4>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/35.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/35.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/35.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/35.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/35.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/35.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>0 - 只支持Byte类型的</p>
<p>1 - String</p>
<p>2 - String</p>
<p>3 - Resource</p>
<p>4 - ResourceRegion</p>
<p>5 - DOMSource.*<em>class *</em> SAXSource.<strong>class</strong>) \ StAXSource.**class **StreamSource.**class **Source.<strong>class</strong></p>
<p><strong>6 -</strong> MultiValueMap</p>
<p>7 - <strong>true</strong></p>
<p><strong>8 - true</strong></p>
<p><strong>9 - 支持注解方式xml处理的。</strong></p>
<p>最终 MappingJackson2HttpMessageConverter  把对象转为JSON（利用底层的jackson的objectMapper转换的）</p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/36.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/36.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/36.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/36.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/36.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/36.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h2 id="2内容协商">2、内容协商</h2>
<p>根据客户端接收能力不同，返回不同媒体类型的数据。</p>
<h3 id="1引入xml依赖">1、引入xml依赖</h3>
<div class="highlight" id="id-16"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"> <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>com.fasterxml.jackson.dataformat<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>jackson-dataformat-xml<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span></span></span></code></pre></div><h3 id="2postman分别测试返回json和xml">2、postman分别测试返回json和xml</h3>
<p>只需要改变请求头中Accept字段。Http协议中规定的，告诉服务器本客户端可以接收的数据类型。</p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/37.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/37.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/37.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/37.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/37.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/37.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="3开启浏览器参数方式内容协商功能">3、开启浏览器参数方式内容协商功能</h3>
<p>为了方便内容协商，开启基于请求参数的内容协商功能。</p>
<div class="highlight" id="id-17"><pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">contentnegotiation</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">favor-parameter</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">  </span><span class="c">#开启请求参数内容协商模式</span></span></span></code></pre></div><p>发请求： http://localhost:8080/test/person?format=json</p>
<p><a href="http://localhost:8080/test/person?format=json"target="_blank" rel="external nofollow noopener noreferrer">http://localhost:8080/test/person?format=</a>xml</p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/38.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/38.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/38.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/38.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/38.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/38.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>确定客户端接收什么样的内容类型；</p>
<p>1、Parameter策略优先确定是要返回json数据（获取请求头中的format的值）</p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/39.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/39.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/39.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/39.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/39.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/39.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>2、最终进行内容协商返回给客户端json即可。</p>
<h3 id="4内容协商原理">4、内容协商原理</h3>
<ul>
<li>
<p>1、判断当前响应头中是否已经有确定的媒体类型。MediaType</p>
</li>
<li>
<p><strong>2、获取客户端（PostMan、浏览器）支持接收的内容类型。（获取客户端Accept请求头字段）【application/xml】</strong></p>
</li>
<li>
<ul>
<li><strong>contentNegotiationManager 内容协商管理器 默认使用基于请求头的策略</strong></li>
</ul>
</li>
</ul>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/40.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/40.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/40.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/40.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/40.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/40.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<ul>
<li></li>
<li><strong>HeaderContentNegotiationStrategy  确定客户端可以接收的内容类型</strong></li>
</ul>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/41.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/41.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/41.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/41.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/41.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/41.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>3、遍历循环所有当前系统的 <strong>MessageConverter</strong>，看谁支持操作这个对象（Person）</p>
<p>4、找到支持操作Person的converter，把converter支持的媒体类型统计出来。</p>
<p>5、客户端需要【application/xml】。服务端能力【10种、json、xml】</p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/42.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/42.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/42.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/42.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/42.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/42.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/43.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/43.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/43.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/43.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/43.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/43.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>6、进行内容协商的最佳匹配媒体类型</p>
<p>7、用 支持 将对象转为 最佳匹配媒体类型 的converter。调用它进行转化 。</p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/44.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/44.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/44.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/44.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/44.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/44.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>导入了jackson处理xml的包，xml的converter就会自动进来</p>
<div class="highlight" id="id-18"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">WebMvcConfigurationSupport</span>
</span></span><span class="line"><span class="cl"><span class="n">jackson2XmlPresent</span> <span class="o">=</span> <span class="n">ClassUtils</span><span class="o">.</span><span class="na">isPresent</span><span class="o">(</span><span class="s">&#34;com.fasterxml.jackson.dataformat.xml.XmlMapper&#34;</span><span class="o">,</span> <span class="n">classLoader</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">(</span><span class="n">jackson2XmlPresent</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Jackson2ObjectMapperBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">Jackson2ObjectMapperBuilder</span><span class="o">.</span><span class="na">xml</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">applicationContext</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">builder</span><span class="o">.</span><span class="na">applicationContext</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">applicationContext</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">messageConverters</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">MappingJackson2XmlHttpMessageConverter</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">()));</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span></span></span></code></pre></div><h3 id="5自定义-messageconverter">5、自定义 MessageConverter</h3>
<p><strong>实现多协议数据兼容。json、xml、x-guigu</strong></p>
<p><strong>0、</strong>@ResponseBody 响应数据出去 调用 <strong>RequestResponseBodyMethodProcessor</strong> 处理</p>
<p>1、Processor 处理方法返回值。通过 <strong>MessageConverter</strong> 处理</p>
<p>2、所有 <strong>MessageConverter</strong> 合起来可以支持各种媒体类型数据的操作（读、写）</p>
<p>3、内容协商找到最终的 <strong>messageConverter</strong>；</p>
<p>SpringMVC的什么功能。一个入口给容器中添加一个  WebMvcConfigurer</p>
<div class="highlight" id="id-19"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"> <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">WebMvcConfigurer</span> <span class="nf">webMvcConfigurer</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">WebMvcConfigurer</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">extendMessageConverters</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">HttpMessageConverter</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">converters</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span></span></span></code></pre></div><p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/45.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/45.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/45.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/45.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/45.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/45.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/46.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/46.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/46.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/46.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/46.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/46.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><strong>有可能我们添加的自定义的功能会覆盖默认很多功能，导致一些默认的功能失效。</strong></p>
<p><strong>大家考虑，上述功能除了我们完全自定义外？SpringBoot有没有为我们提供基于配置文件的快速修改媒体类型功能？怎么配置呢？【提示：参照SpringBoot官方文档web开发内容协商章节】</strong></p>
<h1 id="5视图解析与模板引擎">5、视图解析与模板引擎</h1>
<p>视图解析：<strong>SpringBoot默认不支持 JSP，需要引入第三方模板引擎技术实现页面渲染。</strong></p>
<h2 id="1视图解析">1、视图解析</h2>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/47.jpg" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/47.jpg, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/47.jpg 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/47.jpg 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/47.jpg" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/47.jpg" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="1视图解析原理流程">1、视图解析原理流程</h3>
<p>1、目标方法处理的过程中，所有数据都会被放在 <strong>ModelAndViewContainer 里面。包括数据和视图地址</strong></p>
<p><strong>2、方法的参数是一个自定义类型对象（从请求参数中确定的），把他重新放在</strong> <strong>ModelAndViewContainer</strong></p>
<p><strong>3、任何目标方法执行完成以后都会返回 ModelAndView（<strong><strong>数据和视图地址</strong></strong>）。</strong></p>
<p>**4、**<strong>processDispatchResult  处理派发结果（页面改如何响应）</strong></p>
<ul>
<li>
<p>1、<strong>render</strong>(<strong>mv</strong>, request, response); 进行页面渲染逻辑</p>
</li>
<li>
<ul>
<li>1、根据方法的String返回值得到 <strong>View</strong> 对象【定义了页面的渲染逻辑】</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>1、所有的视图解析器尝试是否能根据当前返回值得到<strong>View</strong>对象</li>
<li>2、得到了 <strong>redirect:/main.html</strong> &ndash;&gt; Thymeleaf new <strong>RedirectView</strong>()</li>
<li>3、ContentNegotiationViewResolver 里面包含了下面所有的视图解析器，内部还是利用下面所有视图解析器得到视图对象。</li>
<li>4、view.render(mv.getModelInternal(), request, response);  视图对象调用自定义的render进行页面渲染工作</li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>
<ul>
<li><strong>RedirectView 如何渲染【重定向到一个页面】</strong></li>
<li><strong>1、获取目标url地址</strong></li>
<li>**2、**<strong>response.sendRedirect(encodedURL);</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>视图解析：</strong></p>
<ul>
<li>
<ul>
<li><strong>返回值以 forward: 开始： new InternalResourceView(forwardUrl); &ndash;&gt;  转发****request.getRequestDispatcher(path).forward(request, response);</strong></li>
<li><strong>返回值以</strong> <strong>redirect: 开始：</strong> <strong>new RedirectView() &ndash;》 render就是重定向</strong></li>
<li><strong>返回值是普通字符串： new ThymeleafView（）&mdash;&gt;</strong></li>
</ul>
</li>
</ul>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/48.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/48.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/48.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/48.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/48.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/48.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/49.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/49.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/49.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/49.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/49.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/49.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/50.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/50.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/50.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/50.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/50.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/50.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/51.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/51.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/51.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/51.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/51.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/51.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h2 id="2模板引擎-thymeleaf">2、模板引擎-Thymeleaf</h2>
<h3 id="1thymeleaf简介">1、thymeleaf简介</h3>
<p>Thymeleaf is a modern server-side Java template engine for both web and standalone environments, capable of processing HTML, XML, JavaScript, CSS and even plain text.</p>
<p><strong>现代化、服务端Java模板引擎</strong></p>
<h3 id="2基本语法">2、基本语法</h3>
<h4 id="1表达式">1、表达式</h4>
<table>
<thead>
<tr>
<th>表达式名字</th>
<th>语法</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>变量取值</td>
<td>${&hellip;}</td>
<td>获取请求域、session域、对象等值</td>
</tr>
<tr>
<td>选择变量</td>
<td>*{&hellip;}</td>
<td>获取上下文对象值</td>
</tr>
<tr>
<td>消息</td>
<td>#{&hellip;}</td>
<td>获取国际化等值</td>
</tr>
<tr>
<td>链接</td>
<td>@{&hellip;}</td>
<td>生成链接</td>
</tr>
<tr>
<td>片段表达式</td>
<td>~{&hellip;}</td>
<td>jsp:include 作用，引入公共页面片段</td>
</tr>
</tbody>
</table>
<h4 id="2字面量">2、字面量</h4>
<p>文本值: <strong>&lsquo;one text&rsquo;</strong> <strong>,</strong> <strong>&lsquo;Another one!&rsquo;</strong> **,…**数字: <strong>0</strong> <strong>,</strong> <strong>34</strong> <strong>,</strong> <strong>3.0</strong> <strong>,</strong> <strong>12.3</strong> **,…**布尔值: <strong>true</strong> <strong>,</strong> <strong>false</strong></p>
<p>空值: <strong>null</strong></p>
<p>变量： one，two，&hellip;. 变量不能有空格</p>
<h4 id="3文本操作">3、文本操作</h4>
<p>字符串拼接: <strong>+</strong></p>
<p>变量替换: <strong>|The name is ${name}|</strong></p>
<h4 id="4数学运算">4、数学运算</h4>
<p>运算符: + , - , * , / , %</p>
<h4 id="5布尔运算">5、布尔运算</h4>
<p>运算符:  <strong>and</strong> <strong>,</strong> <strong>or</strong></p>
<p>一元运算: <strong>!</strong> <strong>,</strong> <strong>not</strong></p>
<p>**
**</p>
<h4 id="6比较运算">6、比较运算</h4>
<p>比较: <strong>&gt;</strong> <strong>,</strong> <strong>&lt;</strong> <strong>,</strong> <strong>&gt;=</strong> <strong>,</strong> <strong>&lt;=</strong> <strong>(</strong> <strong>gt</strong> <strong>,</strong> <strong>lt</strong> <strong>,</strong> <strong>ge</strong> <strong>,</strong> <strong>le</strong> **)**等式: <strong>==</strong> <strong>,</strong> <strong>!=</strong> <strong>(</strong> <strong>eq</strong> <strong>,</strong> <strong>ne</strong> <strong>)</strong></p>
<h4 id="7条件运算">7、条件运算</h4>
<p>If-then: <strong>(if) ? (then)</strong></p>
<p>If-then-else: <strong>(if) ? (then) : (else)</strong></p>
<p>Default: (value) <strong>?: (defaultvalue)</strong></p>
<h4 id="8特殊操作">8、特殊操作</h4>
<p>无操作： _</p>
<h3 id="3设置属性值-thattr">3、设置属性值-th:attr</h3>
<p>设置单个值</p>
<div class="highlight" id="id-20"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;subscribe.html&#34;</span> <span class="na">th:attr</span><span class="o">=</span><span class="s">&#34;action=@{/subscribe}&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">fieldset</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;email&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;Subscribe!&#34;</span> <span class="na">th:attr</span><span class="o">=</span><span class="s">&#34;value=#{subscribe.submit}&#34;</span><span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">fieldset</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span></span></span></code></pre></div><p>设置多个值</p>
<div class="highlight" id="id-21"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;../../images/gtvglogo.png&#34;</span>  <span class="na">th:attr</span><span class="o">=</span><span class="s">&#34;src=@{/images/gtvglogo.png},title=#{logo},alt=#{logo}&#34;</span> <span class="p">/&gt;</span></span></span></code></pre></div><p>以上两个的代替写法 th:xxxx</p>
<div class="highlight" id="id-22"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;Subscribe!&#34;</span> <span class="na">th:value</span><span class="o">=</span><span class="s">&#34;#{subscribe.submit}&#34;</span><span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;subscribe.html&#34;</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&#34;@{/subscribe}&#34;</span><span class="p">&gt;</span></span></span></code></pre></div><p>所有h5兼容的标签写法</p>
<p><a href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#setting-value-to-specific-attributes"target="_blank" rel="external nofollow noopener noreferrer">https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#setting-value-to-specific-attributes</a></p>
<h3 id="4迭代">4、迭代</h3>
<div class="highlight" id="id-23"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">tr</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&#34;prod : ${prods}&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&#34;${prod.name}&#34;</span><span class="p">&gt;</span>Onions<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&#34;${prod.price}&#34;</span><span class="p">&gt;</span>2.41<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&#34;${prod.inStock}? #{true} : #{false}&#34;</span><span class="p">&gt;</span>yes<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span></span></span></code></pre></div><div class="highlight" id="id-24"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">tr</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&#34;prod,iterStat : ${prods}&#34;</span> <span class="na">th:class</span><span class="o">=</span><span class="s">&#34;${iterStat.odd}? &#39;odd&#39;&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">td</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&#34;${prod.name}&#34;</span><span class="p">&gt;</span>Onions<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">td</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&#34;${prod.price}&#34;</span><span class="p">&gt;</span>2.41<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">td</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&#34;${prod.inStock}? #{true} : #{false}&#34;</span><span class="p">&gt;</span>yes<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span></span></span></code></pre></div><h3 id="5条件运算">5、条件运算</h3>
<div class="highlight" id="id-25"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;comments.html&#34;</span>
</span></span><span class="line"><span class="cl"><span class="na">th:href</span><span class="o">=</span><span class="s">&#34;@{/product/comments(prodId=${prod.id})}&#34;</span>
</span></span><span class="line"><span class="cl"><span class="na">th:if</span><span class="o">=</span><span class="s">&#34;${not #lists.isEmpty(prod.comments)}&#34;</span><span class="p">&gt;</span>view<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span></span></span></code></pre></div><div class="highlight" id="id-26"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:switch</span><span class="o">=</span><span class="s">&#34;${user.role}&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">p</span> <span class="na">th:case</span><span class="o">=</span><span class="s">&#34;&#39;admin&#39;&#34;</span><span class="p">&gt;</span>User is an administrator<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">p</span> <span class="na">th:case</span><span class="o">=</span><span class="s">&#34;#{roles.manager}&#34;</span><span class="p">&gt;</span>User is a manager<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">p</span> <span class="na">th:case</span><span class="o">=</span><span class="s">&#34;*&#34;</span><span class="p">&gt;</span>User is some other thing<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span></span></span></code></pre></div><h1 id="heading-3"></h1>
<h3 id="6属性优先级">6、属性优先级</h3>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/52.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/52.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/52.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/52.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/52.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/52.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h2 id="3thymeleaf使用">3、thymeleaf使用</h2>
<h4 id="1引入starter">1、引入Starter</h4>
<div class="highlight" id="id-27"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-thymeleaf<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span></span></span></code></pre></div><h4 id="2自动配置好了thymeleaf">2、自动配置好了thymeleaf</h4>
<div class="highlight" id="id-28"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">@Configuration(proxyBeanMethods = false)
</span></span><span class="line"><span class="cl">@EnableConfigurationProperties(ThymeleafProperties.class)
</span></span><span class="line"><span class="cl">@ConditionalOnClass({ TemplateMode.class, SpringTemplateEngine.class })
</span></span><span class="line"><span class="cl">@AutoConfigureAfter({ WebMvcAutoConfiguration.class, WebFluxAutoConfiguration.class })
</span></span><span class="line"><span class="cl">public class ThymeleafAutoConfiguration { }</span></span></code></pre></div><p>自动配好的策略</p>
<ul>
<li>1、所有thymeleaf的配置值都在 ThymeleafProperties</li>
<li>2、配置好了 <strong>SpringTemplateEngine</strong></li>
<li><strong>3、配好了</strong> <strong>ThymeleafViewResolver</strong></li>
<li>4、我们只需要直接开发页面</li>
</ul>
<div class="highlight" id="id-29"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DEFAULT_PREFIX</span> <span class="o">=</span> <span class="s">&#34;classpath:/templates/&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DEFAULT_SUFFIX</span> <span class="o">=</span> <span class="s">&#34;.html&#34;</span><span class="o">;</span>  <span class="c1">//xxx.html
</span></span></span></code></pre></div><h4 id="3页面开发">3、页面开发</h4>
<div class="highlight" id="id-30"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Title<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">h1</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&#34;${msg}&#34;</span><span class="p">&gt;</span>哈哈<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;www.atguigu.com&#34;</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&#34;${link}&#34;</span><span class="p">&gt;</span>去百度<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>  <span class="p">&lt;</span><span class="nt">br</span><span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;www.atguigu.com&#34;</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&#34;@{link}&#34;</span><span class="p">&gt;</span>去百度2<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span></span></span></code></pre></div><h2 id="4构建后台管理系统">4、构建后台管理系统</h2>
<h3 id="1项目创建">1、项目创建</h3>
<p>thymeleaf、web-starter、devtools、lombok</p>
<h3 id="2静态资源处理">2、静态资源处理</h3>
<p>自动配置好，我们只需要把所有静态资源放到 static 文件夹下</p>
<h3 id="3路径构建">3、路径构建</h3>
<p>th:action=&quot;@{/login}&quot;</p>
<h3 id="4模板抽取">4、模板抽取</h3>
<p>th:insert/replace/include</p>
<h3 id="5页面跳转">5、页面跳转</h3>
<div class="highlight" id="id-31"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">&#34;/login&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">main</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">hasLength</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getUserName</span><span class="o">())</span> <span class="o">&amp;&amp;</span> <span class="s">&#34;123456&#34;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getPassword</span><span class="o">())){</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//把登陆成功的用户保存起来
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;loginUser&#34;</span><span class="o">,</span><span class="n">user</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//登录成功重定向到main.html;  重定向防止表单重复提交
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">return</span> <span class="s">&#34;redirect:/main.html&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span><span class="s">&#34;账号密码错误&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//回到登录页面
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">return</span> <span class="s">&#34;login&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span></span></span></code></pre></div><h3 id="6数据渲染">6、数据渲染</h3>
<div class="highlight" id="id-32"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/dynamic_table&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">dynamic_table</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//表格内容的遍历
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">&#34;zhangsan&#34;</span><span class="o">,</span> <span class="s">&#34;123456&#34;</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">                <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">&#34;lisi&#34;</span><span class="o">,</span> <span class="s">&#34;123444&#34;</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">                <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">&#34;haha&#34;</span><span class="o">,</span> <span class="s">&#34;aaaaa&#34;</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">                <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">&#34;hehe &#34;</span><span class="o">,</span> <span class="s">&#34;aaddd&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;users&#34;</span><span class="o">,</span><span class="n">users</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;table/dynamic_table&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">table</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;display table table-bordered&#34;</span> <span class="n">id</span><span class="o">=</span><span class="s">&#34;hidden-table-info&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">thead</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="err">#</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">用户名</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">密码</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;/</span><span class="n">thead</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">tbody</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">tr</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;gradeX&#34;</span> <span class="n">th</span><span class="o">:</span><span class="n">each</span><span class="o">=</span><span class="s">&#34;user,stats:${users}&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="o">&lt;</span><span class="n">td</span> <span class="n">th</span><span class="o">:</span><span class="n">text</span><span class="o">=</span><span class="s">&#34;${stats.count}&#34;</span><span class="o">&gt;</span><span class="n">Trident</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="o">&lt;</span><span class="n">td</span> <span class="n">th</span><span class="o">:</span><span class="n">text</span><span class="o">=</span><span class="s">&#34;${user.userName}&#34;</span><span class="o">&gt;</span><span class="n">Internet</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="o">&lt;</span><span class="n">td</span> <span class="o">&gt;[[</span><span class="n">$</span><span class="o">{</span><span class="n">user</span><span class="o">.</span><span class="na">password</span><span class="o">}]]&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;/</span><span class="n">tbody</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span></span></span></code></pre></div><h1 id="6拦截器">6、拦截器</h1>
<h2 id="1handlerinterceptor-接口">1、HandlerInterceptor 接口</h2>
<div class="highlight" id="id-33"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 登录检查
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 1、配置好拦截器要拦截哪些请求
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 2、把这些配置放在容器中
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Slf4j</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginInterceptor</span> <span class="kd">implements</span> <span class="n">HandlerInterceptor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 目标方法执行之前
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param request
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param response
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param handler
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @throws Exception
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">requestURI</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;preHandle拦截的请求路径是{}&#34;</span><span class="o">,</span><span class="n">requestURI</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">//登录检查逻辑
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">Object</span> <span class="n">loginUser</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;loginUser&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="o">(</span><span class="n">loginUser</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//放行
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">//拦截住。未登录。跳转到登录页
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span><span class="s">&#34;请先登录&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//        re.sendRedirect(&#34;/&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="s">&#34;/&#34;</span><span class="o">).</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span><span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 目标方法执行完成以后
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param request
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param response
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param handler
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param modelAndView
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @throws Exception
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="n">ModelAndView</span> <span class="n">modelAndView</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;postHandle执行{}&#34;</span><span class="o">,</span><span class="n">modelAndView</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 页面渲染以后
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param request
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param response
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param handler
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param ex
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @throws Exception
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterCompletion</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;afterCompletion执行异常{}&#34;</span><span class="o">,</span><span class="n">ex</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div><h2 id="2配置拦截器">2、配置拦截器</h2>
<div class="highlight" id="id-34"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 1、编写一个拦截器实现HandlerInterceptor接口
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 2、拦截器注册到容器中（实现WebMvcConfigurer的addInterceptors）
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 3、指定拦截规则【如果是拦截所有，静态资源也会被拦截】
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AdminWebConfig</span> <span class="kd">implements</span> <span class="n">WebMvcConfigurer</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addInterceptors</span><span class="o">(</span><span class="n">InterceptorRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">registry</span><span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="k">new</span> <span class="n">LoginInterceptor</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">addPathPatterns</span><span class="o">(</span><span class="s">&#34;/**&#34;</span><span class="o">)</span>  <span class="c1">//所有请求都被拦截包括静态资源
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="o">.</span><span class="na">excludePathPatterns</span><span class="o">(</span><span class="s">&#34;/&#34;</span><span class="o">,</span><span class="s">&#34;/login&#34;</span><span class="o">,</span><span class="s">&#34;/css/**&#34;</span><span class="o">,</span><span class="s">&#34;/fonts/**&#34;</span><span class="o">,</span><span class="s">&#34;/images/**&#34;</span><span class="o">,</span><span class="s">&#34;/js/**&#34;</span><span class="o">);</span> <span class="c1">//放行的请求
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div><h2 id="3拦截器原理">3、拦截器原理</h2>
<p>1、根据当前请求，找到**HandlerExecutionChain【**可以处理请求的handler以及handler的所有 拦截器】</p>
<p>2、先来<strong>顺序执行</strong> 所有拦截器的 preHandle方法</p>
<ul>
<li>1、如果当前拦截器prehandler返回为true。则执行下一个拦截器的preHandle</li>
<li>2、如果当前拦截器返回为false。直接   倒序执行所有已经执行了的拦截器的  afterCompletion；</li>
</ul>
<p><strong>3、如果任何一个拦截器返回false。直接跳出不执行目标方法</strong></p>
<p><strong>4、所有拦截器都返回True。执行目标方法</strong></p>
<p><strong>5、倒序执行所有拦截器的postHandle方法。</strong></p>
<p><strong>6、前面的步骤有任何异常都会直接倒序触发</strong> afterCompletion</p>
<p>7、页面成功渲染完成以后，也会倒序触发 afterCompletion</p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/53.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/53.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/53.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/53.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/53.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/53.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/54.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/54.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/54.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/54.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/54.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/54.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h1 id="7文件上传">7、文件上传</h1>
<h2 id="1页面表单">1、页面表单</h2>
<div class="highlight" id="id-35"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;/upload&#34;</span> <span class="na">enctype</span><span class="o">=</span><span class="s">&#34;multipart/form-data&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;file&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;file&#34;</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;提交&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span></span></span></code></pre></div><h2 id="2文件上传代码">2、文件上传代码</h2>
<div class="highlight" id="id-36"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * MultipartFile 自动封装上传过来的文件
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param email
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param username
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param headerImg
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param photos
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">&#34;/upload&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">upload</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;email&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">email</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                         <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">username</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                         <span class="nd">@RequestPart</span><span class="o">(</span><span class="s">&#34;headerImg&#34;</span><span class="o">)</span> <span class="n">MultipartFile</span> <span class="n">headerImg</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                         <span class="nd">@RequestPart</span><span class="o">(</span><span class="s">&#34;photos&#34;</span><span class="o">)</span> <span class="n">MultipartFile</span><span class="o">[]</span> <span class="n">photos</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;上传的信息：email={}，username={}，headerImg={}，photos={}&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">email</span><span class="o">,</span><span class="n">username</span><span class="o">,</span><span class="n">headerImg</span><span class="o">.</span><span class="na">getSize</span><span class="o">(),</span><span class="n">photos</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="o">(!</span><span class="n">headerImg</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()){</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//保存到文件服务器，OSS服务器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">String</span> <span class="n">originalFilename</span> <span class="o">=</span> <span class="n">headerImg</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">headerImg</span><span class="o">.</span><span class="na">transferTo</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&#34;H:\\cache\\&#34;</span><span class="o">+</span><span class="n">originalFilename</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="o">(</span><span class="n">photos</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="o">(</span><span class="n">MultipartFile</span> <span class="n">photo</span> <span class="o">:</span> <span class="n">photos</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span><span class="o">(!</span><span class="n">photo</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()){</span>
</span></span><span class="line"><span class="cl">                    <span class="n">String</span> <span class="n">originalFilename</span> <span class="o">=</span> <span class="n">photo</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                    <span class="n">photo</span><span class="o">.</span><span class="na">transferTo</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&#34;H:\\cache\\&#34;</span><span class="o">+</span><span class="n">originalFilename</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;main&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span></span></span></code></pre></div><h2 id="3自动配置原理">3、自动配置原理</h2>
<p>**文件上传自动配置类-MultipartAutoConfiguration-**<strong>MultipartProperties</strong></p>
<ul>
<li>
<p>自动配置好了 <strong>StandardServletMultipartResolver  【文件上传解析器】</strong></p>
</li>
<li>
<p><strong>原理步骤</strong></p>
</li>
<li>
<ul>
<li><strong>1、请求进来使用文件上传解析器判断（<strong>isMultipart</strong>）并封装（<strong>resolveMultipart，<strong>返回</strong>MultipartHttpServletRequest</strong>）文件上传请求</strong></li>
<li><strong>2、参数解析器来解析请求中的文件内容封装成MultipartFile</strong></li>
<li>**3、将request中文件信息封装为一个Map；**MultiValueMap&lt;String, MultipartFile&gt;</li>
</ul>
</li>
</ul>
<p><strong>FileCopyUtils</strong>。实现文件流的拷贝</p>
<div class="highlight" id="id-37"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">&#34;/upload&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">upload</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;email&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">email</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                         <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">username</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                         <span class="nd">@RequestPart</span><span class="o">(</span><span class="s">&#34;headerImg&#34;</span><span class="o">)</span> <span class="n">MultipartFile</span> <span class="n">headerImg</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                         <span class="nd">@RequestPart</span><span class="o">(</span><span class="s">&#34;photos&#34;</span><span class="o">)</span> <span class="n">MultipartFile</span><span class="o">[]</span> <span class="n">photos</span><span class="o">)</span></span></span></code></pre></div><p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/55.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/55.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/55.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/55.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/55.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/55.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h1 id="8异常处理">8、异常处理</h1>
<h2 id="1错误处理">1、错误处理</h2>
<h4 id="1默认规则">1、默认规则</h4>
<ul>
<li>默认情况下，Spring Boot提供<code>/error</code>处理所有错误的映射</li>
<li>对于机器客户端，它将生成JSON响应，其中包含错误，HTTP状态和异常消息的详细信息。对于浏览器客户端，响应一个“ whitelabel”错误视图，以HTML格式呈现相同的数据</li>
</ul>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/56.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/56.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/56.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/56.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/56.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/56.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/57.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/57.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/57.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/57.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/57.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/57.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><strong>要对其进行自定义，添加</strong>**<code>View</code>**<strong>解析为`error```</strong></p>
<p>要完全替换默认行为，可以实现 <code>ErrorController </code>并注册该类型的Bean定义，或添加<code>ErrorAttributes类型的组件</code>以使用现有机制但替换其内容。</p>
<p>error/下的4xx，5xx页面会被自动解析；</p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/58.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/58.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/58.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/58.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/58.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/58.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h4 id="2定制错误处理逻辑">2、定制错误处理逻辑</h4>
<ul>
<li>
<p>自定义错误页</p>
</li>
<li>
<ul>
<li>error/404.html  error/5xx.html；有精确的错误状态码页面就匹配精确，没有就找 4xx.html；如果都没有就触发白页</li>
</ul>
</li>
<li>
<p>@ControllerAdvice+@ExceptionHandler处理全局异常；底层是 <strong>ExceptionHandlerExceptionResolver 支持的</strong></p>
</li>
<li>
<p>@ResponseStatus+自定义异常 ；底层是 <strong>ResponseStatusExceptionResolver ，把responsestatus注解的信息底层调用</strong> <strong>response.sendError(statusCode, resolvedReason)；tomcat发送的/error</strong></p>
</li>
<li>
<p>Spring底层的异常，如 参数类型转换异常；<strong>DefaultHandlerExceptionResolver 处理框架底层的异常。</strong></p>
</li>
<li>
<ul>
<li>response.sendError(HttpServletResponse.<strong>SC_BAD_REQUEST</strong>, ex.getMessage());</li>
</ul>
</li>
</ul>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/59.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/59.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/59.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/59.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/59.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/59.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<ul>
<li>自定义实现 HandlerExceptionResolver 处理异常；可以作为默认的全局异常处理规则</li>
</ul>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/60.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/60.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/60.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/60.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/60.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/60.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<ul>
<li>
<p><strong>ErrorViewResolver</strong> 实现自定义处理异常；</p>
</li>
<li>
<ul>
<li>response.sendError 。error请求就会转给controller</li>
<li>你的异常没有任何人能处理。tomcat底层 response.sendError。error请求就会转给controller</li>
<li><strong>basicErrorController 要去的页面地址是</strong> <strong>ErrorViewResolver</strong> ；</li>
</ul>
</li>
</ul>
<h4 id="3异常处理自动配置原理">3、异常处理自动配置原理</h4>
<ul>
<li>
<p><strong>ErrorMvcAutoConfiguration  自动配置异常处理规则</strong></p>
</li>
<li>
<ul>
<li><strong>容器中的组件：类型：DefaultErrorAttributes -&gt;</strong> <strong>id：errorAttributes</strong></li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li><strong>public class</strong> <strong>DefaultErrorAttributes</strong> <strong>implements</strong> <strong>ErrorAttributes</strong>, <strong>HandlerExceptionResolver</strong></li>
<li><strong>DefaultErrorAttributes</strong>：定义错误页面中可以包含哪些数据。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/61.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/61.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/61.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/61.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/61.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/61.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/62.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/62.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/62.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/62.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/62.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/62.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<ul>
<li>
<ul>
<li>**容器中的组件：类型：**<strong>BasicErrorController &ndash;&gt; id：basicErrorController（json+白页 适配响应）</strong></li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li><strong>处理默认</strong> <strong>/error 路径的请求；页面响应</strong> <strong>new</strong> ModelAndView(<strong>&ldquo;error&rdquo;</strong>, model)；</li>
<li><strong>容器中有组件 View</strong>-&gt;<strong>id是error</strong>；（响应默认错误页）</li>
<li>容器中放组件 <strong>BeanNameViewResolver（视图解析器）；按照返回的视图名作为组件的id去容器中找View对象。</strong></li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>**容器中的组件：**类型：**DefaultErrorViewResolver -&gt; id：**conventionErrorViewResolver</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>如果发生错误，会以HTTP的状态码 作为视图页地址（viewName），找到真正的页面</li>
<li>error/404、5xx.html</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>如果想要返回页面；就会找error视图【<strong>StaticView</strong>】。(默认是一个白页)</p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/63.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/63.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/63.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/63.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/63.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/63.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<ul>
<li>
<h4 id="4异常处理步骤流程">4、异常处理步骤流程</h4>
</li>
<li>
<p>1、执行目标方法，目标方法运行期间有任何异常都会被catch、而且标志当前请求结束；并且用 <strong>dispatchException</strong></p>
</li>
<li>
<p>2、进入视图解析流程（页面渲染？）</p>
</li>
<li>
<p>processDispatchResult(processedRequest, response, mappedHandler, <strong>mv</strong>, <strong>dispatchException</strong>);</p>
</li>
<li>
<p>3、<strong>mv</strong> = <strong>processHandlerException</strong>；处理handler发生的异常，处理完成返回ModelAndView；</p>
</li>
<li>
<ul>
<li>1、遍历所有的 <strong>handlerExceptionResolvers，看谁能处理当前异常【<strong><strong>HandlerExceptionResolver处理器异常解析器</strong></strong>】</strong></li>
</ul>
</li>
</ul>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/64.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/64.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/64.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/64.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/64.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/64.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<ul>
<li><strong>2、系统默认的  异常解析器；</strong></li>
</ul>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/65.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/65.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/65.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/65.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/65.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/65.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<ul>
<li>
<ul>
<li><strong>1、DefaultErrorAttributes先来处理异常。把异常信息保存到rrequest域，并且返回null；</strong></li>
<li><strong>2、默认没有任何人能处理异常，所以异常会被抛出</strong></li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li><strong>1、如果没有任何人能处理最终底层就会发送 /error 请求。会被底层的BasicErrorController处理</strong></li>
<li><strong>2、解析错误视图；遍历所有的</strong>  <strong>ErrorViewResolver  看谁能解析。</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/66.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/66.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/66.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/66.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/66.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/66.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>​			<strong>3、默认的</strong> <strong>DefaultErrorViewResolver ,作用是把响应状态码作为错误页的地址，error/500.html</strong></p>
<p>​			<strong>4、模板引擎最终响应这个页面</strong> <strong>error/500.html</strong></p>
<h1 id="9web原生组件注入servletfilterlistener">9、Web原生组件注入（Servlet、Filter、Listener）</h1>
<h2 id="1使用servlet-api">1、使用Servlet API</h2>
<p>@ServletComponentScan(basePackages = <strong>&ldquo;com.atguigu.admin&rdquo;</strong>) :指定原生Servlet组件都放在那里</p>
<p>@WebServlet(urlPatterns = <strong>&quot;/my&quot;</strong>)：效果：直接响应，<strong>没有经过Spring的拦截器？</strong></p>
<p>@WebFilter(urlPatterns={<strong>&quot;/css/*&quot;</strong>,<strong>&quot;/images/*&quot;</strong>})</p>
<p>@WebListener</p>
<p>推荐可以这种方式；</p>
<p>扩展：DispatchServlet 如何注册进来</p>
<ul>
<li>容器中自动配置了  DispatcherServlet  属性绑定到 WebMvcProperties；对应的配置文件配置项是 <strong>spring.mvc。</strong></li>
<li><strong>通过</strong> <strong>ServletRegistrationBean</strong><!-- raw HTML omitted --> 把 DispatcherServlet  配置进来。</li>
<li>默认映射的是 / 路径。</li>
</ul>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/67.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/67.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/67.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/67.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/67.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/67.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>Tomcat-Servlet；</p>
<p>多个Servlet都能处理到同一层路径，精确优选原则</p>
<p>A： /my/</p>
<p>B： /my/1</p>
<h2 id="2使用registrationbean">2、使用RegistrationBean</h2>
<div class="highlight" id="id-38"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ServletRegistrationBean</span><span class="err">`</span><span class="o">,</span> <span class="err">`</span><span class="n">FilterRegistrationBean</span><span class="err">`</span><span class="o">,</span> <span class="n">and</span> <span class="err">`</span><span class="n">ServletListenerRegistrationBean</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyRegistConfig</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">ServletRegistrationBean</span> <span class="nf">myServlet</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="n">MyServlet</span> <span class="n">myServlet</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyServlet</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">ServletRegistrationBean</span><span class="o">(</span><span class="n">myServlet</span><span class="o">,</span><span class="s">&#34;/my&#34;</span><span class="o">,</span><span class="s">&#34;/my02&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">FilterRegistrationBean</span> <span class="nf">myFilter</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">MyFilter</span> <span class="n">myFilter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyFilter</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">//        return new FilterRegistrationBean(myFilter,myServlet());
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">FilterRegistrationBean</span> <span class="n">filterRegistrationBean</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FilterRegistrationBean</span><span class="o">(</span><span class="n">myFilter</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">filterRegistrationBean</span><span class="o">.</span><span class="na">setUrlPatterns</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;/my&#34;</span><span class="o">,</span><span class="s">&#34;/css/*&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">filterRegistrationBean</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">ServletListenerRegistrationBean</span> <span class="nf">myListener</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="n">MySwervletContextListener</span> <span class="n">mySwervletContextListener</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MySwervletContextListener</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">ServletListenerRegistrationBean</span><span class="o">(</span><span class="n">mySwervletContextListener</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div><h1 id="10嵌入式servlet容器">10、嵌入式Servlet容器</h1>
<h2 id="1切换嵌入式servlet容器">1、切换嵌入式Servlet容器</h2>
<ul>
<li>
<p>默认支持的webServer</p>
</li>
<li>
<ul>
<li><code>Tomcat</code>, <code>Jetty</code>, or <code>Undertow</code></li>
<li><code>ServletWebServerApplicationContext 容器启动寻找ServletWebServerFactory 并引导创建服务器</code></li>
</ul>
</li>
<li>
<p>切换服务器</p>
</li>
</ul>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/68.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/68.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/68.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/68.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/68.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/springboot2.x/68.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<div class="highlight" id="id-39"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;exclusions&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;exclusion&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-tomcat<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/exclusion&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/exclusions&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span></span></span></code></pre></div><ul>
<li>
<p>原理</p>
</li>
<li>
<ul>
<li>SpringBoot应用启动发现当前是Web应用。web场景包-导入tomcat</li>
<li>web应用会创建一个web版的ioc容器 <code>ServletWebServerApplicationContext</code></li>
<li><code>ServletWebServerApplicationContext</code> 启动的时候寻找 <strong><code>ServletWebServerFactory</code></strong><code>（Servlet 的web服务器工厂---&gt; Servlet 的web服务器）</code></li>
<li>SpringBoot底层默认有很多的WebServer工厂；<code>TomcatServletWebServerFactory</code>, <code>JettyServletWebServerFactory</code>, or <code>UndertowServletWebServerFactory</code></li>
<li><code>底层直接会有一个自动配置类。ServletWebServerFactoryAutoConfiguration</code></li>
<li><code>ServletWebServerFactoryAutoConfiguration导入了ServletWebServerFactoryConfiguration（配置类）</code></li>
<li><code>ServletWebServerFactoryConfiguration 配置类 根据动态判断系统中到底导入了那个Web服务器的包。（默认是web-starter导入tomcat包），容器中就有 TomcatServletWebServerFactory</code></li>
<li><code>TomcatServletWebServerFactory 创建出Tomcat服务器并启动；TomcatWebServer 的构造器拥有初始化方法initialize---this.tomcat.start();</code></li>
<li><code>内嵌服务器，就是手动把启动服务器的代码调用（tomcat核心jar包存在）</code></li>
</ul>
</li>
<li>
<p>``</p>
</li>
</ul>
<h2 id="2定制servlet容器">2、定制Servlet容器</h2>
<ul>
<li>
<p>实现 <strong>WebServerFactoryCu</strong>stomizer<!-- raw HTML omitted --></p>
</li>
<li>
<ul>
<li>把配置文件的值和**<code>ServletWebServerFactory 进行绑定</code>**</li>
</ul>
</li>
<li>
<p>修改配置文件 <strong>server.xxx</strong></p>
</li>
<li>
<p>直接自定义 <strong>ConfigurableServletWebServerFactory</strong></p>
</li>
</ul>
<p><strong>xxxxx<strong><strong>Customizer</strong></strong>：定制化器，可以改变xxxx的默认规则</strong></p>
<div class="highlight" id="id-40"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.boot.web.server.WebServerFactoryCustomizer</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.boot.web.servlet.server.ConfigurableServletWebServerFactory</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@Component</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomizationBean</span> <span class="kd">implements</span> <span class="n">WebServerFactoryCustomizer</span><span class="o">&lt;</span><span class="n">ConfigurableServletWebServerFactory</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">customize</span><span class="o">(</span><span class="n">ConfigurableServletWebServerFactory</span> <span class="n">server</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">server</span><span class="o">.</span><span class="na">setPort</span><span class="o">(</span><span class="mi">9000</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div><h1 id="11定制化原理">11、定制化原理</h1>
<h2 id="1定制化的常见方式">1、定制化的常见方式</h2>
<ul>
<li>修改配置文件；</li>
<li><strong>xxxxxCustomizer；</strong></li>
<li><strong>编写自定义的配置类  xxxConfiguration；+</strong> <strong>@Bean替换、增加容器中默认组件；视图解析器</strong></li>
<li><strong>Web应用 编写一个配置类实现 WebMvcConfigurer 即可定制化web功能；+ @Bean给容器中再扩展一些组件</strong></li>
</ul>
<div class="highlight" id="id-41"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AdminWebConfig</span> <span class="kd">implements</span> <span class="n">WebMvcConfigurer</span></span></span></code></pre></div><ul>
<li>
<p>@EnableWebMvc + WebMvcConfigurer —— @Bean 可以全面接管SpringMVC，所有规则全部自己重新配置； 实现定制和扩展功能</p>
</li>
<li>
<ul>
<li>原理</li>
<li>1、WebMvcAutoConfiguration  默认的SpringMVC的自动配置功能类。静态资源、欢迎页&hellip;..</li>
<li>2、一旦使用 @EnableWebMvc 、。会 @Import(DelegatingWebMvcConfiguration.<strong>class</strong>)</li>
<li>3、<strong>DelegatingWebMvcConfiguration</strong> 的 作用，只保证SpringMVC最基本的使用</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>把所有系统中的 WebMvcConfigurer 拿过来。所有功能的定制都是这些 WebMvcConfigurer  合起来一起生效</li>
<li>自动配置了一些非常底层的组件。<strong>RequestMappingHandlerMapping</strong>、这些组件依赖的组件都是从容器中获取</li>
<li><strong>public class</strong> DelegatingWebMvcConfiguration <strong>extends</strong> <strong>WebMvcConfigurationSupport</strong></li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>4、<strong>WebMvcAutoConfiguration</strong> 里面的配置要能生效 必须  @ConditionalOnMissingBean(<strong>WebMvcConfigurationSupport</strong>.<strong>class</strong>)</li>
<li>5、@EnableWebMvc  导致了 <strong>WebMvcAutoConfiguration  没有生效。</strong></li>
</ul>
</li>
<li>
<p>&hellip; &hellip;</p>
</li>
</ul>
<h2 id="2原理分析套路">2、原理分析套路</h2>
<p><strong>场景starter</strong> <strong>- xxxxAutoConfiguration - 导入xxx组件 - 绑定xxxProperties &ndash;</strong> <strong>绑定配置文件项</strong></p>
</div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="更新于 2021-07-23 18:38:23">更新于 2021-07-23&nbsp;</span>
      </div><div class="post-info-license">
          <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span>
        </div></div>
    <div class="post-info-line">
      <div class="post-info-md"></div>
      <div class="post-info-share">
        <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="http://yuanshuai1122.github.io/posts/springboot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-web%E5%BC%80%E5%8F%91-springboot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-web%E5%BC%80%E5%8F%91/" data-title="SpringBoot2核心技术-web开发" data-hashtags="Java,SpringBoot"><i class="fa-brands fa-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="http://yuanshuai1122.github.io/posts/springboot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-web%E5%BC%80%E5%8F%91-springboot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-web%E5%BC%80%E5%8F%91/" data-hashtag="Java"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="http://yuanshuai1122.github.io/posts/springboot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-web%E5%BC%80%E5%8F%91-springboot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-web%E5%BC%80%E5%8F%91/" data-title="SpringBoot2核心技术-web开发"><i class="fa-brands fa-weibo fa-fw" aria-hidden="true"></i></a>
  </span>
      </div>
    </div>
  </div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/tags/java/' class="post-tag">Java</a><a href='/tags/springboot/' class="post-tag">SpringBoot</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="/posts/springboot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-springboot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" class="post-nav-item" rel="prev" title="SpringBoot2核心技术-单元测试"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>SpringBoot2核心技术-单元测试</a>
      <a href="/posts/spring5%E4%B9%8B%E6%96%B0%E5%8A%9F%E8%83%BDwebflux-spring5%E4%B9%8B%E6%96%B0%E5%8A%9F%E8%83%BDwebflux/" class="post-nav-item" rel="next" title="Spring5之新功能Webflux">Spring5之新功能Webflux<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></main><footer class="footer">
    <div class="footer-container"><div class="footer-line powered">由 <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.119.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.2.18-lts.2"><img class="fixit-icon" src="/fixit.min.svg" alt="FixIt logo" />&nbsp;FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2023</span><span class="author" itemprop="copyrightHolder">
              <a href="/"></a></span></div><div class="footer-line statistics"></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="回到顶部"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">FixIt 主题在启用 JavaScript 的情况下效果最佳。</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/katex/katex.min.js" defer></script><script src="/lib/katex/auto-render.min.js" defer></script><script src="/lib/katex/copy-tex.min.js" defer></script><script src="/lib/katex/mhchem.min.js" defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script>window.config={"code":{"copyTitle":"复制到剪贴板","editLockTitle":"锁定可编辑代码块","editUnLockTitle":"解锁可编辑代码块","editable":true,"maxShownLines":10},"comment":{"enable":false},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验。"},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script src="/js/theme.min.js" defer></script></body>
</html>
