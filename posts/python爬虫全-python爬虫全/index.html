<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>Python爬虫（全） - 我的 Hugo FixIt 网站</title><meta name="author" content="">
<meta name="author-link" content="">
<meta name="description" content="（编码encode()） pat=r&quot;(.*?)&quot; data=re.findall(pat,reponse) print(data[0]) ```python #创建自定义opener from urllib import request #构建HTTP处理器对象（专门处理HTTP请求的对象） http_hander=request.HTTPHandler() #创建自定义open" /><meta name="keywords" content='Python, 爬虫' /><meta itemprop="name" content="Python爬虫（全）">
<meta itemprop="description" content="（编码encode()） pat=r&quot;(.*?)&quot; data=re.findall(pat,reponse) print(data[0]) ```python #创建自定义opener from urllib import request #构建HTTP处理器对象（专门处理HTTP请求的对象） http_hander=request.HTTPHandler() #创建自定义open">

<meta itemprop="wordCount" content="9488">
<meta itemprop="keywords" content="Python,爬虫," /><meta property="og:title" content="Python爬虫（全）" />
<meta property="og:description" content="（编码encode()） pat=r&quot;(.*?)&quot; data=re.findall(pat,reponse) print(data[0]) ```python #创建自定义opener from urllib import request #构建HTTP处理器对象（专门处理HTTP请求的对象） http_hander=request.HTTPHandler() #创建自定义open" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yuanshuai1122.github.com/posts/python%E7%88%AC%E8%99%AB%E5%85%A8-python%E7%88%AC%E8%99%AB%E5%85%A8/" /><meta property="article:section" content="posts" />


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Python爬虫（全）"/>
<meta name="twitter:description" content="（编码encode()） pat=r&quot;(.*?)&quot; data=re.findall(pat,reponse) print(data[0]) ```python #创建自定义opener from urllib import request #构建HTTP处理器对象（专门处理HTTP请求的对象） http_hander=request.HTTPHandler() #创建自定义open"/>
<meta name="application-name" content="FixIt">
<meta name="apple-mobile-web-app-title" content="FixIt"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="https://yuanshuai1122.github.com/posts/python%E7%88%AC%E8%99%AB%E5%85%A8-python%E7%88%AC%E8%99%AB%E5%85%A8/" /><link rel="prev" href="https://yuanshuai1122.github.com/posts/python%E7%88%AC%E8%99%AB%E4%B9%8Bbeautifulsoup-python%E7%88%AC%E8%99%AB%E4%B9%8Bbeautifulsoup/" /><link rel="next" href="https://yuanshuai1122.github.com/posts/nps%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E7%9A%84%E6%90%AD%E5%BB%BA%E4%B8%8E%E6%BC%94%E7%A4%BA-nps%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E7%9A%84%E6%90%AD%E5%BB%BA%E4%B8%8E%E6%BC%94%E7%A4%BA/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Python爬虫（全）",
    "inLanguage": "zh-CN",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/yuanshuai1122.github.com\/posts\/python%E7%88%AC%E8%99%AB%E5%85%A8-python%E7%88%AC%E8%99%AB%E5%85%A8\/"
    },"genre": "posts","keywords": "Python, 爬虫","wordcount":  9488 ,
    "url": "https:\/\/yuanshuai1122.github.com\/posts\/python%E7%88%AC%E8%99%AB%E5%85%A8-python%E7%88%AC%E8%99%AB%E5%85%A8\/","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "yuanshuai"
      },"description": ""
  }
  </script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="我的 Hugo FixIt 网站"><img loading="lazy" src="/fixit.min.svg" srcset="/fixit.min.svg, /fixit.min.svg 1.5x, /fixit.min.svg 2x" sizes="auto" data-title="我的 Hugo FixIt 网站" data-alt="我的 Hugo FixIt 网站" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span class="header-title-text">My Hugo FixIt Site</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/posts/"
                
                
              >文章</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/categories/"
                
                
              >分类</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/tags/"
                
                
              >标签</a></li><li class="menu-item delimiter"></li><li class="menu-item theme-switch" title="切换主题">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="我的 Hugo FixIt 网站"><img loading="lazy" src="/fixit.min.svg" srcset="/fixit.min.svg, /fixit.min.svg 1.5x, /fixit.min.svg 2x" sizes="auto" data-title="/fixit.min.svg" data-alt="/fixit.min.svg" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span class="header-title-text">My Hugo FixIt Site</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/posts/"
                  
                  
                >文章</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                >分类</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                >标签</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="切换主题"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><main class="container"><aside class="toc" id="toc-auto"><h2 class="toc-title">目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside>

  <aside class="aside-custom">
    </aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>Python爬虫（全）</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><i class="fa-solid fa-user-circle" aria-hidden="true"></i>
      yuanshuai</span></span></div>
      <div class="post-meta-line"><span title="发布于 0001-01-01 00:00:00"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden="true"></i><time datetime="0001-01-01">0001-01-01</time></span>&nbsp;<span title="更新于 0001-01-01 00:00:00"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden="true"></i><time datetime="0001-01-01">0001-01-01</time></span>&nbsp;<span title="9488 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>约 9500 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>预计阅读 19 分钟</span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>目录</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#二requests">二、requests</a></li>
    <li><a href="#三正则表达式">三、正则表达式</a></li>
    <li><a href="#四xpath表达式">四、xpath表达式</a></li>
    <li><a href="#五beautifulsoup">五、BeautifulSoup</a></li>
    <li><a href="#六多线程">六、多线程</a></li>
    <li><a href="#七验证码识别">七、验证码识别</a></li>
    <li><a href="#八scrapy框架">八、scrapy框架</a>
      <ul>
        <li><a href="#1scrapy框架的安装">1.Scrapy框架的安装</a></li>
        <li><a href="#2scrapy框架的简单使用">2.Scrapy框架的简单使用</a></li>
        <li><a href="#3scrapy框架的整体架构和组成">3.Scrapy框架的整体架构和组成</a></li>
        <li><a href="#4中间件介绍">4.中间件介绍</a></li>
        <li><a href="#5附件">5.附件</a></li>
      </ul>
    </li>
    <li><a href="#九fiddler手机抓包">九、fiddler手机抓包</a>
      <ul>
        <li><a href="#用fiddler对android应用进行抓包">用Fiddler对Android应用进行抓包</a></li>
        <li><a href="#用fiddler对iphone手机应用进行抓包">用Fiddler对iPhone手机应用进行抓包</a></li>
      </ul>
    </li>
    <li><a href="#十数据写入">十、数据写入</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><p>（编码encode()）</p>
<p>pat=r&quot;<!-- raw HTML omitted -->(.*?)<!-- raw HTML omitted -->&quot;</p>
<p>data=re.findall(pat,reponse)</p>
<p>print(data[0])</p>
<pre tabindex="0"><code>
```python
#创建自定义opener

from urllib import request

#构建HTTP处理器对象（专门处理HTTP请求的对象）
http_hander=request.HTTPHandler()

#创建自定义opener
opener=request.build_opener(http_hander)

#创建自定义请求对象
req=request.Request(&#34;http://www.baidu.com&#34;)

#发送请求，获取响应
#reponse=opener.open(req).read()

#把自定义opener设置为全局，这样用urlopen发送的请求也会使用自定义的opener;
request.install_opener(opener)

reponse=request.urlopen(req).read()


print(reponse)</code></pre><div class="highlight" id="id-2"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">random</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#反爬虫2：判断请求来源的ip地址</span>
</span></span><span class="line"><span class="cl"><span class="c1">#措施：使用代理IP</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">proxylist</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span><span class="s2">&#34;http&#34;</span><span class="p">:</span><span class="s2">&#34;101.248.64.82:80&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">proxy</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">proxylist</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#构建代理处理器对象</span>
</span></span><span class="line"><span class="cl"><span class="n">proxyHandler</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">ProxyHandler</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#创建自定义opener</span>
</span></span><span class="line"><span class="cl"><span class="n">opener</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">build_opener</span><span class="p">(</span><span class="n">proxyHandler</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#创建请求对象</span>
</span></span><span class="line"><span class="cl"><span class="n">req</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s2">&#34;http://www.baidu.com&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">res</span><span class="o">=</span><span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">read</span><span class="p">())</span></span></span></code></pre></div><div class="highlight" id="id-3"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#处理get请求</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">urllib</span>
</span></span><span class="line"><span class="cl"><span class="c1">#http://www.baidu.com/s?wd=%E5%8C%97%E4%BA%AC #url编码</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">wd</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;wd&#34;</span><span class="p">:</span><span class="s2">&#34;北京&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span><span class="o">=</span><span class="s2">&#34;http://www.baidu.com/s?&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#构造url编码</span>
</span></span><span class="line"><span class="cl"><span class="n">wdd</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">wd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="o">+</span><span class="n">wdd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">req</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">reponse</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">reponse</span><span class="p">)</span></span></span></code></pre></div><div class="highlight" id="id-4"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 实战：贴吧爬虫</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">urllib</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#构造请求头信息</span>
</span></span><span class="line"><span class="cl"><span class="n">header</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;User-Agent&#34;</span><span class="p">:</span><span class="s2">&#34;Mozilla/5.0 (Linux; U; An</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">droid 8.1.0; zh-cn; BLA-AL00 Build/HUAW</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">EIBLA-AL00) AppleWebKit/537.36 (KHTML, l</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">ike Gecko) Version/4.0 Chrome/57.0.2987.13</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">2 MQQBrowser/8.9 Mobile Safari/537.36&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#url规律</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># http://tieba.baidu.com/f?kw=python&amp;ie=utf-8&amp;pn=0  #第一页 （1-1）*50</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># http://tieba.baidu.com/f?kw=python&amp;ie=utf-8&amp;pn=50 #第二页 （2-1）*50</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># http://tieba.baidu.com/f?kw=python&amp;ie=utf-8&amp;pn=100 #第三页 （3-1）*50</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># http://tieba.baidu.com/f?kw=python&amp;ie=utf-8&amp;pn=150 #第四页（4-1）*50</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># for i in range(1,4):</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 	print(&#34;http://tieba.baidu.com/f?kw=python&amp;ie=utf-8&amp;pn=&#34;+str((i-1)*50))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">loadpage</span><span class="p">(</span><span class="n">fullurl</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;正在下载：&#34;</span><span class="p">,</span><span class="n">filename</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">req</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">fullurl</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">resp</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">resp</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">writepage</span><span class="p">(</span><span class="n">html</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;正在保存：&#34;</span><span class="p">,</span><span class="n">filename</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s2">&#34;wb&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;---------------------------&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#构造url</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">tiebaSpider</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">begin</span><span class="p">,</span><span class="n">end</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">begin</span><span class="p">,</span><span class="n">end</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">		<span class="n">pn</span><span class="o">=</span><span class="p">(</span><span class="n">page</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">50</span>
</span></span><span class="line"><span class="cl">		<span class="n">fullurl</span><span class="o">=</span><span class="n">url</span><span class="o">+</span><span class="s2">&#34;&amp;pn=&#34;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">pn</span><span class="p">)</span> <span class="c1">#每次请求的完整url</span>
</span></span><span class="line"><span class="cl">		<span class="n">filename</span><span class="o">=</span><span class="s2">&#34;c:/第&#34;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">+</span><span class="s2">&#34;页.html&#34;</span> <span class="c1">#每次请求后保存的文件名</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">html</span><span class="o">=</span><span class="n">loadpage</span><span class="p">(</span><span class="n">fullurl</span><span class="p">,</span><span class="n">filename</span><span class="p">)</span> <span class="c1">#调用爬虫，爬取网页</span>
</span></span><span class="line"><span class="cl">		<span class="n">writepage</span><span class="p">(</span><span class="n">html</span><span class="p">,</span><span class="n">filename</span><span class="p">)</span> <span class="c1">#把获取到的网页信息写入本地</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">kw</span><span class="o">=</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;请输入贴吧名：&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">begin</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;请输入起始页：&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="n">end</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;请输入结束页：&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">url</span><span class="o">=</span><span class="s2">&#34;http://tieba.baidu.com/f?&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">key</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">({</span><span class="s2">&#34;kw&#34;</span><span class="p">:</span><span class="n">kw</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="o">+</span><span class="n">key</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">tiebaSpider</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">begin</span><span class="p">,</span><span class="n">end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span></span></span></code></pre></div><div class="highlight" id="id-5"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 实战：贴吧爬虫</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">urllib</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">random</span>
</span></span><span class="line"><span class="cl"><span class="c1">#反爬虫1 ： 伪装浏览器的爬虫</span>
</span></span><span class="line"><span class="cl"><span class="c1">#构造请求头信息</span>
</span></span><span class="line"><span class="cl"><span class="n">agent1</span><span class="o">=</span><span class="s2">&#34;Mozilla/5.0 (Linux; U; Android 8.1.0; zh-cn; BLA-AL00 Build/HUAWEIBLA-AL00) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/57.0.2987.132 MQQBrowser/8.9 Mobile Safari/537.36&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">agent2</span><span class="o">=</span><span class="s2">&#34;Mozilla/5.0 (Linux; Android 8.1; EML-AL00 Build/HUAWEIEML-AL00; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/53.0.2785.143 Crosswalk/24.53.595.0 XWEB/358 MMWEBSDK/23 Mobile Safari/537.36 MicroMessenger/6.7.2.1340(0x2607023A) NetType/4G Language/zh_CN&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">agent3</span><span class="o">=</span><span class="s2">&#34;Mozilla/5.0 (Linux; U; Android 8.0.0; zh-CN; MHA-AL00 Build/HUAWEIMHA-AL00) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/57.0.2987.108 UCBrowser/12.1.4.994 Mobile Safari/537.36&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">agent4</span><span class="o">=</span><span class="s2">&#34;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">agent5</span><span class="o">=</span><span class="s2">&#34;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.102 Safari/537.36&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">list1</span><span class="o">=</span><span class="p">[</span><span class="n">agent1</span><span class="p">,</span><span class="n">agent2</span><span class="p">,</span><span class="n">agent3</span><span class="p">,</span><span class="n">agent4</span><span class="p">,</span><span class="n">agent5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">agent</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">list1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 反爬虫2：判断请求来源的ip地址</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 措施：使用代理IP</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># proxylist = [</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 	#{&#34;http&#34;: &#34;101.248.64.82:80&#34;}</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 	#{&#34;http&#34;: &#34;49.89.87.40:3000&#34;},</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 	#{&#34;http&#34;: &#34;36.249.109.42:9999&#34;},</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 	#{&#34;http&#34;: &#34;58.254.220.116:53579&#34;},</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 	#{&#34;http&#34;: &#34;183.166.136.49:8888&#34;}</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ]</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># proxy = random.choice(proxylist)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># print(proxy)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># # 构建代理处理器对象</span>
</span></span><span class="line"><span class="cl"><span class="c1"># proxyHandler = request.ProxyHandler(proxy)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># # 创建自定义opener</span>
</span></span><span class="line"><span class="cl"><span class="c1"># opener = request.build_opener(proxyHandler)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># #把自定义opener设置为全局，这样用urlopen发送的请求也会使用自定义的opener;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># request.install_opener(opener)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">header</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;User-Agent&#34;</span><span class="p">:</span><span class="n">agent</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span><span class="o">=</span><span class="s2">&#34;http://fanyi.youdao.com/translate?smartresult=dict&amp;smartresult=rule&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#key=&#34;自学&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">key</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;请输入要翻译的文字：&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#post请求需要提交的参数</span>
</span></span><span class="line"><span class="cl"><span class="n">formdata</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;i&#34;</span><span class="p">:</span><span class="n">key</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;from&#34;</span><span class="p">:</span><span class="s2">&#34;AUTO&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;to&#34;</span><span class="p">:</span><span class="s2">&#34;AUTO&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;smartresult&#34;</span><span class="p">:</span><span class="s2">&#34;dict&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;client&#34;</span><span class="p">:</span><span class="s2">&#34;fanyideskweb&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;salt&#34;</span><span class="p">:</span><span class="s2">&#34;15503049709404&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;sign&#34;</span><span class="p">:</span><span class="s2">&#34;3da914b136a37f75501f7f31b11e75fb&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;ts&#34;</span><span class="p">:</span><span class="s2">&#34;1550304970940&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;bv&#34;</span><span class="p">:</span><span class="s2">&#34;ab57a166e6a56368c9f95952de6192b5&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;doctype&#34;</span><span class="p">:</span><span class="s2">&#34;json&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;version&#34;</span><span class="p">:</span><span class="s2">&#34;2.1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;keyfrom&#34;</span><span class="p">:</span><span class="s2">&#34;fanyi.web&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;action&#34;</span><span class="p">:</span><span class="s2">&#34;FY_BY_REALTIME&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;typoResult&#34;</span><span class="p">:</span><span class="s2">&#34;false&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">#转码</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">formdata</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">req</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">resp</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#正则表达式 提取&#34;tgt&#34;:&#34;和&#34;}]]中间的任意内容</span>
</span></span><span class="line"><span class="cl"><span class="n">pat</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;&#34;tgt&#34;:&#34;(.*?)&#34;}]]&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span><span class="n">resp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></span></span></code></pre></div><div class="highlight" id="id-6"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#异常处理</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">list1</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s2">&#34;http://www.baidu.com&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;http://www.baidu.com&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;http://www.jiswiswissnduehduehd.com&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;http://www.baidu.com&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;http://www.baidu.com&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">i</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">list1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;第&#34;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s2">&#34;次请求完成&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></span></span></code></pre></div><div class="highlight" id="id-7"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Cookie</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://i.baidu.com/&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;User-Agent&#34;</span> <span class="p">:</span> <span class="s2">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) App</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">    leWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Cookie&#34;</span><span class="p">:</span><span class="s2">&#34;BAIDUID=F1676F6D91D12CF987A81C35B5683EF5:FG=1; PSTM=1543068715; BIDUPSID=F1676F6D91D12CF987A81C35B5683EF5; BDUSS=k4VllQdW9-ZDR6fmo1LWxIeEo5LWd1OTMxLUhCQkY5eUZlZXY0OEtKSzdVSEZjQVFBQUFBJCQAAAAAAAAAAAEAAABATb2F1~OwttK76ti0s8zs0cQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALvDSVy7w0lca3; BDORZ=B490B5EBF6F3CD402E515D22BCDA1598; PHPSESSID=e1sso19h9qnjugdq974cpofk50; __guid=62687476.678578182179940700.1550386788528.5847; Hm_lvt_4010fd5075fcfe46a16ec4cb65e02f04=1550386790; monitor_count=4; Hm_lpvt_4010fd5075fcfe46a16ec4cb65e02f04=1550387997&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">req</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">headers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">response</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span></span></span></code></pre></div><h2 id="二requests">二、requests</h2>
<div class="highlight" id="id-8"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;User-Agent&#34;</span><span class="p">:</span> <span class="s2">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) Ap</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">pleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Sa</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">fari/537.36&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">wd</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;wd&#34;</span><span class="p">:</span><span class="s2">&#34;中国&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">response</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;http://www.baidu.com/s?&#34;</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">wd</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>  <span class="c1">#get请求的参数为params</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">text</span> <span class="c1">#返回一个字符串形式的数据</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data2</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">content</span> <span class="c1">#返回一个二进制形式的数据</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">data2</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span></span></span></code></pre></div><div class="highlight" id="id-9"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#构造请求头信息</span>
</span></span><span class="line"><span class="cl"><span class="n">header</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;User-Agent&#34;</span><span class="p">:</span><span class="s2">&#34;Mozilla/5.0 (Linux; U; An</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">droid 8.1.0; zh-cn; BLA-AL00 Build/HUAW</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">EIBLA-AL00) AppleWebKit/537.36 (KHTML, l</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">ike Gecko) Version/4.0 Chrome/57.0.2987.13</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">2 MQQBrowser/8.9 Mobile Safari/537.36&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span><span class="o">=</span><span class="s2">&#34;http://fanyi.youdao.com/translate?smartresult=dict&amp;smartresult=rule&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#key=&#34;自学&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">key</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;请输入要翻译的文字：&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#post请求需要提交的参数</span>
</span></span><span class="line"><span class="cl"><span class="n">formdata</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;i&#34;</span><span class="p">:</span><span class="n">key</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;from&#34;</span><span class="p">:</span><span class="s2">&#34;AUTO&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;to&#34;</span><span class="p">:</span><span class="s2">&#34;AUTO&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;smartresult&#34;</span><span class="p">:</span><span class="s2">&#34;dict&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;client&#34;</span><span class="p">:</span><span class="s2">&#34;fanyideskweb&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;salt&#34;</span><span class="p">:</span><span class="s2">&#34;15503049709404&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;sign&#34;</span><span class="p">:</span><span class="s2">&#34;3da914b136a37f75501f7f31b11e75fb&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;ts&#34;</span><span class="p">:</span><span class="s2">&#34;1550304970940&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;bv&#34;</span><span class="p">:</span><span class="s2">&#34;ab57a166e6a56368c9f95952de6192b5&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;doctype&#34;</span><span class="p">:</span><span class="s2">&#34;json&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;version&#34;</span><span class="p">:</span><span class="s2">&#34;2.1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;keyfrom&#34;</span><span class="p">:</span><span class="s2">&#34;fanyi.web&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;action&#34;</span><span class="p">:</span><span class="s2">&#34;FY_BY_REALTIME&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s2">&#34;typoResult&#34;</span><span class="p">:</span><span class="s2">&#34;false&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">response</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">header</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">formdata</span><span class="p">)</span>   <span class="c1">#post请求的参数为data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#正则表达式 提取&#34;tgt&#34;:&#34;和&#34;}]]中间的任意内容</span>
</span></span><span class="line"><span class="cl"><span class="n">pat</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;&#34;tgt&#34;:&#34;(.*?)&#34;}]]&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></span></span></code></pre></div><div class="highlight" id="id-10"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#设置ip地址</span>
</span></span><span class="line"><span class="cl"><span class="n">proxy</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;http&#34;</span><span class="p">:</span><span class="s2">&#34;http://101.248.64.72:80&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;http&#34;</span><span class="p">:</span><span class="s2">&#34;http://101.248.64.68:80&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;https&#34;</span><span class="p">:</span><span class="s2">&#34;https://101.248.64.72:80&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">response</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;http://www.baidu.com&#34;</span><span class="p">,</span><span class="n">proxies</span><span class="o">=</span><span class="n">proxy</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span></span></span></code></pre></div><div class="highlight" id="id-11"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">response</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;http://www.baidu.com&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#1.获取返回的cookiejar对象</span>
</span></span><span class="line"><span class="cl"><span class="n">cookiejar</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">cookies</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#2.将cookiejar转换成字典</span>
</span></span><span class="line"><span class="cl"><span class="n">cookiedict</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">dict_from_cookiejar</span><span class="p">(</span><span class="n">cookiejar</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#print(cookiejar)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">cookiedict</span><span class="p">)</span></span></span></code></pre></div><div class="highlight" id="id-12"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#使用session实现登陆</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># import requests</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># headers = {&#34;User-Agent&#34;: &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36&#34;}</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># #创建session对象</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ses=requests.session()</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># #构造登陆需要的参数</span>
</span></span><span class="line"><span class="cl"><span class="c1"># data={&#34;email&#34;:&#34;3254272716@qq.com&#34;,&#34;password&#34;:&#34;123321a&#34;}</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># #通过传递用户名密码得到cookie信息</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ses.post(&#34;http://www.renren.com/PLogin.do&#34;,data=data)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># #请求需要的页面</span>
</span></span><span class="line"><span class="cl"><span class="c1"># response=ses.get(&#34;http://www.renren.com/880151247/profile&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># print(response.text)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;User-Agent&#34;</span><span class="p">:</span> <span class="s2">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#创建session对象</span>
</span></span><span class="line"><span class="cl"><span class="n">ses</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">session</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#构造登陆需要的参数</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;email&#34;</span><span class="p">:</span><span class="s2">&#34;18232336174@163.com&#34;</span><span class="p">,</span><span class="s2">&#34;password&#34;</span><span class="p">:</span><span class="s2">&#34;18232336174...&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#通过传递用户名密码得到cookie信息</span>
</span></span><span class="line"><span class="cl"><span class="n">ses</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&#34;http://mail.163.com&#34;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#请求需要的页面</span>
</span></span><span class="line"><span class="cl"><span class="n">response</span><span class="o">=</span><span class="n">ses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;http://mail.163.com/js6/main.jsp?sid=KAOGBblSlxmIGlAAmDSSXTjrBseNxEhE&amp;df=mail163_letter#module=contact.ContactModule%7C%7B%7D&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span></span></span></code></pre></div><div class="highlight" id="id-13"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>   <span class="c1"># python 的正则库</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>     <span class="c1"># python 的requests库</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># page=int(input(&#34;请输入您要爬取的页数：&#34;))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">songID</span><span class="o">=</span><span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="n">songName</span><span class="o">=</span><span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">page_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;请问要爬取第几页呢：&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">page_size</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="n">url</span><span class="o">=</span><span class="s2">&#34;http://www.htqyy.com/top/musicList/hot?pageIndex=&#34;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&#34;&amp;pageSize=20&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#$url = &#34;http://www.htqyy.com/top/hot&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#构造请求头信息</span>
</span></span><span class="line"><span class="cl"><span class="n">header</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;Accept&#34;</span><span class="p">:</span> <span class="s2">&#34;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;Accept-Encoding&#34;</span><span class="p">:</span> <span class="s2">&#34;gzip, deflate&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;Accept-Language&#34;</span><span class="p">:</span> <span class="s2">&#34;zh-CN,zh;q=0.9&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;Cache-Control&#34;</span><span class="p">:</span> <span class="s2">&#34;max-age=0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;Connection&#34;</span><span class="p">:</span> <span class="s2">&#34;keep-alive&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#&#34;Cookie&#34;:&#34; __cfduid=d54ff2470d42e999d942b3b64cc266a9f1594821751; BAIDU_SSP_lcr=https://www.baidu.com/link?url=zPqjAbMqG9O52ECGWPxIoo5nIDVDpw6DO0i0JHZqbgy&amp;wd=&amp;eqid=e3b52e830007c46a000000035f0f0c70; blk=0; Hm_lvt_74e11efe27096f6ef1745cd53f168168=1594821752; isPlay=0; jploop=false; Hm_lpvt_74e11efe27096f6ef1745cd53f168168=1594828497&#34;,</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;Host&#34;</span><span class="p">:</span> <span class="s2">&#34;www.htqyy.com&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;Referer&#34;</span><span class="p">:</span> <span class="s2">&#34;http://www.htqyy.com/top/hot&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;Upgrade-Insecure-Requests&#34;</span><span class="p">:</span> <span class="s2">&#34;1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;User-Agent&#34;</span><span class="p">:</span> <span class="s2">&#34;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#获取音乐榜单的网页信息</span>
</span></span><span class="line"><span class="cl"><span class="n">html</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">headers</span> <span class="o">=</span> <span class="n">header</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">strr</span><span class="o">=</span><span class="n">html</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pat1</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;title=&#34;(.*?)&#34; sid&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">pat2</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;sid=&#34;(.*?)&#34;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">idlist</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pat2</span><span class="p">,</span><span class="n">strr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">titlelist</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pat1</span><span class="p">,</span><span class="n">strr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">songID</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">idlist</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">songName</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">titlelist</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">songID</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">	<span class="n">songurl</span><span class="o">=</span><span class="s2">&#34;http://f2.htqyy.com/play8/&#34;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">songID</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="s2">&#34;/mp3/7&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="n">songname</span><span class="o">=</span><span class="n">songName</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">data</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">songurl</span><span class="p">)</span><span class="o">.</span><span class="n">content</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;正在下载第&#34;</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="s2">&#34;首,&#34;&#34;歌曲名为：&#34;</span><span class="p">,</span><span class="n">songName</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;/Users/yuanshuai/Downloads/music/</span><span class="si">{}</span><span class="s2">.mp3&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">songname</span><span class="p">),</span><span class="s2">&#34;wb&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span></span></span></code></pre></div><h2 id="三正则表达式">三、正则表达式</h2>
<div class="highlight" id="id-14"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#原子：正则表达式中实现匹配的基本单位</span>
</span></span><span class="line"><span class="cl"><span class="c1">#元字符：正则表达式中具有特殊含义的字符</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#以普通字符作为原子（匹配一个普通字符）</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span><span class="o">=</span><span class="s2">&#34;湖南湖北广东广西&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">pat</span><span class="o">=</span><span class="s2">&#34;湖北&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#匹配通用字符</span>
</span></span><span class="line"><span class="cl"><span class="c1">#\w 任意字母/数字/下划线 </span>
</span></span><span class="line"><span class="cl"><span class="c1">#\W 和小写w相反 </span>
</span></span><span class="line"><span class="cl"><span class="c1">#\d 十进制数字</span>
</span></span><span class="line"><span class="cl"><span class="c1">#\D 除了十进制数以外的值</span>
</span></span><span class="line"><span class="cl"><span class="c1">#\s 空白字符 </span>
</span></span><span class="line"><span class="cl"><span class="c1">#\S 非空白字符 </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">b</span><span class="o">=</span><span class="s2">&#34;136892763900&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">pat2</span><span class="o">=</span><span class="s2">&#34;1\d\d\d\d\d\d\d\d\d\d&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pat2</span><span class="p">,</span><span class="n">b</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">c</span><span class="o">=</span><span class="s2">&#34;@@@@@@@@@@##@!_tdyuhdihdiw&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">pat3</span><span class="o">=</span><span class="sa">r</span><span class="s2">&#34;\W\w\w&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pat3</span><span class="p">,</span><span class="n">c</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#匹配数字、英文、中文</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 数字 [0-9]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 英文 [a-z][A-Z]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 中文 [\u4e00-\u9fa5]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">d</span><span class="o">=</span><span class="s2">&#34;!@#$@#@##$张三%$^%$%#@$boy#@%##$%$$@#@#23@#@#@#@##$%$%$&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pat1</span><span class="o">=</span><span class="sa">r</span><span class="s2">&#34;[\u4e00-\u9fa5][\u4e00-\u9fa5]&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">pat2</span><span class="o">=</span><span class="sa">r</span><span class="s2">&#34;[a-z][a-z][a-z]&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">pat3</span><span class="o">=</span><span class="sa">r</span><span class="s2">&#34;[0-9][0-9]&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result1</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pat1</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">result2</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pat2</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">result3</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pat3</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result1</span><span class="p">,</span><span class="n">result2</span><span class="p">,</span><span class="n">result3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#原子表</span>
</span></span><span class="line"><span class="cl"><span class="c1">#定义一组平等的原子</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span><span class="o">=</span><span class="s2">&#34;18689276390&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">pat2</span><span class="o">=</span><span class="s2">&#34;1[3578]\d\d\d\d\d\d\d\d\d&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pat2</span><span class="p">,</span><span class="n">b</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">c</span><span class="o">=</span><span class="s2">&#34;nsiwsoiwpythonjsoksosj&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">pat3</span><span class="o">=</span><span class="sa">r</span><span class="s2">&#34;py[abcdt]hon&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pat2</span><span class="p">,</span><span class="n">b</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#元字符--正则表达式中具有特殊含义的字符</span>
</span></span><span class="line"><span class="cl"><span class="c1"># . 匹配任意字符 \n除外</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ^ 匹配字符串开始位置  ^136</span>
</span></span><span class="line"><span class="cl"><span class="c1"># $ 匹配字符串中结束的位置 6666$</span>
</span></span><span class="line"><span class="cl"><span class="c1"># * 重复0次1次多次前面的原子 \d*</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ? 重复一次或者0次前面的原子 \d?</span>
</span></span><span class="line"><span class="cl"><span class="c1"># + 重复一次或多次前面的原子  \d+</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">d</span><span class="o">=</span><span class="s2">&#34;135738484941519874888813774748687&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">pat1</span><span class="o">=</span><span class="s2">&#34;...&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">pat2</span><span class="o">=</span><span class="s2">&#34;^135\d\d\d\d\d\d\d\d&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">pat3</span><span class="o">=</span><span class="s2">&#34;.*8687$&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">pat4</span><span class="o">=</span><span class="s2">&#34;8*&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">pat5</span><span class="o">=</span><span class="s2">&#34;8+&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pat5</span><span class="p">,</span><span class="n">d</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#匹配固定次数</span>
</span></span><span class="line"><span class="cl"><span class="c1">#{n}前面的原子出现了n次</span>
</span></span><span class="line"><span class="cl"><span class="c1">#{n,}至少出现n次</span>
</span></span><span class="line"><span class="cl"><span class="c1">#{n,m}出现次数介于n-m之间</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">a</span><span class="o">=</span><span class="s2">&#34;234ded65de45667888991jisw&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">pat1</span><span class="o">=</span><span class="sa">r</span><span class="s2">&#34;\d{8,10}&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pat1</span><span class="p">,</span><span class="n">a</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># #多个表达式 | </span>
</span></span><span class="line"><span class="cl"><span class="n">a</span><span class="o">=</span><span class="s2">&#34;13699998888&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span><span class="o">=</span><span class="s2">&#34;027-1234567&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pat1</span><span class="o">=</span><span class="sa">r</span><span class="s2">&#34;1[3578]\d</span><span class="si">{9}</span><span class="s2">|\d</span><span class="si">{3}</span><span class="s2">-\d</span><span class="si">{7}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pat1</span><span class="p">,</span><span class="n">a</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#分组 ()</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span><span class="o">=</span><span class="s2">&#34;jiwdjeodjo@$#python%$$^^&amp;*&amp;^%$java#@!!!!!!!!!!!!!!13688889999!!!!!!!!!!!!!!!!!#@#$#$&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">pat</span><span class="o">=</span><span class="sa">r</span><span class="s2">&#34;(python).{0,}(java).{0,}(1[3578]\d</span><span class="si">{9}</span><span class="s2">)&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">a</span><span class="o">=</span><span class="s2">&#34;jiwdjeodjo@$#python%$$^^&amp;*&amp;^%$java#@!!!!!!!!!!!!!!aaa我要自学网bbb!!!!!!!!!!!!!!!!!#@#$#$&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">pat</span><span class="o">=</span><span class="sa">r</span><span class="s2">&#34;aaa(.*?)bbb&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span><span class="n">a</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#贪婪模式和非贪婪模式</span>
</span></span><span class="line"><span class="cl"><span class="c1">#贪婪模式：在整个表达式匹配成功的前提下，尽可能多的匹配；</span>
</span></span><span class="line"><span class="cl"><span class="c1">#非贪婪模式：在整个表达式匹配成功的前提下，尽可能少的匹配 ( ? )；</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Python里默认是贪婪的。</span>
</span></span><span class="line"><span class="cl"><span class="n">strr</span><span class="o">=</span><span class="s1">&#39;aa&lt;div&gt;test1&lt;/div&gt;bb&lt;div&gt;test2&lt;/div&gt;cc&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">pat1</span><span class="o">=</span><span class="sa">r</span><span class="s2">&#34;&lt;div&gt;.*&lt;/div&gt;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pat1</span><span class="p">,</span><span class="n">strr</span><span class="p">))</span> <span class="c1">#贪婪模式</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">strr</span><span class="o">=</span><span class="s1">&#39;aa&lt;div&gt;test1&lt;/div&gt;bb&lt;div&gt;test2&lt;/div&gt;cc&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">pat1</span><span class="o">=</span><span class="sa">r</span><span class="s2">&#34;&lt;div&gt;.*?&lt;/div&gt;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pat1</span><span class="p">,</span><span class="n">strr</span><span class="p">))</span> <span class="c1">#非贪婪模式</span></span></span></code></pre></div><div class="highlight" id="id-15"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#compile函数---将正则表达式转换成内部格式，提高执行效率</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">strr</span><span class="o">=</span><span class="s2">&#34;PYTHON666Java&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pat</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;Python&#34;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="c1">#模式修正符：忽略大小写</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">pat</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">strr</span><span class="p">))</span></span></span></code></pre></div><div class="highlight" id="id-16"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#match函数和search函数</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># match函数--匹配开头</span>
</span></span><span class="line"><span class="cl"><span class="c1"># search函数--匹配任意位置</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#这两个函数都是一次匹配，匹配到一次就不再往后继续匹配了</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">strr</span><span class="o">=</span><span class="s2">&#34;javapythonjavahtmlpythonjs&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pat</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;python&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">pat</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">strr</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">())</span></span></span></code></pre></div><div class="highlight" id="id-17"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#findall()   查找所有匹配的内容，装到列表中</span>
</span></span><span class="line"><span class="cl"><span class="c1">#finditer()  查找所有匹配的内容，装到迭代器中</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">strr</span><span class="o">=</span><span class="s2">&#34;hello--------hello-----------</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">---------hello-----------------</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">---------hello--hello----------------</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">----------hello---------hello----hello----------&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pat</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;hello&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#print(pat.findall(strr))</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="o">=</span><span class="n">pat</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">strr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">list1</span><span class="o">=</span><span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">list1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">list1</span><span class="p">)</span></span></span></code></pre></div><div class="highlight" id="id-18"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#split()  按照能够匹配的子串将字符串分割后返回列表</span>
</span></span><span class="line"><span class="cl"><span class="c1">#sub()    sub方法 用于替换</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">strr1</span><span class="o">=</span><span class="s2">&#34;张三,,,李四,,,,,,,,,王五,,,,,,,,赵六&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pat1</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;,+&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result1</span><span class="o">=</span><span class="n">pat1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">strr1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">strr2</span><span class="o">=</span><span class="s2">&#34;hello 123,hello 456!&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pat2</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;\d+&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result2</span><span class="o">=</span><span class="n">pat2</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&#34;666&#34;</span><span class="p">,</span><span class="n">strr2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result2</span><span class="p">)</span></span></span></code></pre></div><div class="highlight" id="id-19"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;User-Agent&#34;</span><span class="p">:</span> <span class="s2">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) Ap</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">pleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Sa</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">fari/537.36&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">response</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;http://changyongdianhuahaoma.51240.com/&#34;</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pat1</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;&lt;tr bgcolor=&#34;#EFF7F0&#34;&gt;[\s\S]*?&lt;td&gt;(.*?)&lt;/td&gt;[\s\S]*?&lt;td&gt;[\s\S]*?&lt;/td&gt;[\s\S]*?&lt;/tr&gt;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">pat2</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;&lt;tr bgcolor=&#34;#EFF7F0&#34;&gt;[\s\S]*?&lt;td&gt;[\s\S]*?&lt;/td&gt;[\s\S]*?&lt;td&gt;(.*?)&lt;/td&gt;[\s\S]*?&lt;/tr&gt;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pattern1</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pat1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pattern2</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pat2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data1</span><span class="o">=</span><span class="n">pattern1</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">data2</span><span class="o">=</span><span class="n">pattern2</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">resultlist</span><span class="o">=</span><span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">data1</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">	<span class="n">resultlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">data2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">resultlist</span><span class="p">)</span></span></span></code></pre></div><div class="highlight" id="id-20"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">urllib.request</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 全局取消证书验证</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">ssl</span>
</span></span><span class="line"><span class="cl"><span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;User-Agent&#34;</span> <span class="p">:</span> <span class="s2">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">page_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;请问要爬取第几页呢：&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">page</span><span class="o">=</span><span class="nb">str</span><span class="p">((</span><span class="n">page_num</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span><span class="o">=</span><span class="s2">&#34;https://movie.douban.com/j/chart/top_list?type=11&amp;interval_id=100%3A90&amp;action=&amp;start=&#34;</span><span class="o">+</span><span class="n">page</span><span class="o">+</span><span class="s2">&#34;&amp;limit=20&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">req</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pat1</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;&#34;rating&#34;:\[&#34;(.*?)&#34;,&#34;\d+&#34;\]&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">pat2</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;&#34;title&#34;:&#34;(.*?)&#34;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pattern1</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pat1</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pattern2</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pat2</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data1</span><span class="o">=</span><span class="n">pattern1</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">data2</span><span class="o">=</span><span class="n">pattern2</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data1</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">	<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;排名：&#34;</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="s2">&#34;电影名：&#34;</span><span class="p">,</span><span class="n">data2</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="s2">&#34;豆瓣评分:&#34;</span><span class="p">,</span><span class="n">data1</span><span class="p">[</span><span class="n">x</span><span class="p">])</span></span></span></code></pre></div><h2 id="四xpath表达式">四、xpath表达式</h2>
<div class="highlight" id="id-21"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#xpath表达式</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#有同学说，我正则用的不好，处理HTML文档很累，有没有其他的方法？</span>
</span></span><span class="line"><span class="cl"><span class="c1">#有！那就是XPath，我们可以先将 HTML文件 转换成 XML文档，</span>
</span></span><span class="line"><span class="cl"><span class="c1">#然后用 XPath 查找 HTML 节点或元素。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#我们需要安装lxml模块来支持xpath的操作。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#使用 pip 安装：pip install lxml</span></span></span></code></pre></div><div class="highlight" id="id-22"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#解析字符串形式html</span>
</span></span><span class="line"><span class="cl"><span class="n">text</span> <span class="o">=</span><span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">&lt;div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">    &lt;ul&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">         &lt;li class=&#34;item-0&#34;&gt;&lt;a href=&#34;link1.html&#34;&gt;张三&lt;/a&gt;&lt;/li&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">         &lt;li class=&#34;item-1&#34;&gt;&lt;a href=&#34;link2.html&#34;&gt;李四&lt;/a&gt;&lt;/li&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">         &lt;li class=&#34;item-inactive&#34;&gt;&lt;a href=&#34;link3.html&#34;&gt;王五&lt;/a&gt;&lt;/li&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">         &lt;li class=&#34;item-1&#34;&gt;&lt;a href=&#34;link4.html&#34;&gt;赵六&lt;/a&gt;&lt;/li&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">         &lt;li class=&#34;item-0&#34;&gt;&lt;a href=&#34;link5.html&#34;&gt;老七&lt;/a&gt; 
</span></span></span><span class="line"><span class="cl"><span class="s1">     &lt;/ul&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1"> &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#etree.HTML()将字符串解析成了特殊的html对象</span>
</span></span><span class="line"><span class="cl"><span class="n">html</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#将html对象转成字符串</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">html</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&#34;utf-8&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></span></span></code></pre></div><div class="highlight" id="id-23"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#解析本地html</span>
</span></span><span class="line"><span class="cl"><span class="c1">#爬虫中网页处理方式：</span>
</span></span><span class="line"><span class="cl"><span class="c1">#1，在爬虫中，数据获取和数据清洗一体，HTML()</span>
</span></span><span class="line"><span class="cl"><span class="c1">#2、数据获取和数据清洗分开，parse()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#获取本地html文档</span>
</span></span><span class="line"><span class="cl"><span class="n">html</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;C:\file\hello.html&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">html</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&#34;utf-8&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></span></span></code></pre></div><div class="highlight" id="id-24"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#获取一类标签</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">html</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;C:\file\hello.html&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">=</span><span class="n">html</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;//a&#34;</span><span class="p">)</span> <span class="c1">#获取所有span标签的信息</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span></span></span></code></pre></div><div class="highlight" id="id-25"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#获取指定属性的标签</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&#34;c:/file/hello.html&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># result1=html.xpath(&#34;//li[@class=&#39;item-88&#39;]&#34;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result2</span><span class="o">=</span><span class="n">html</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;//li/a[@href=&#39;link2.html&#39;]&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result2</span><span class="p">)</span></span></span></code></pre></div><div class="highlight" id="id-26"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span> 
</span></span><span class="line"><span class="cl"><span class="c1">#获取标签的属性</span>
</span></span><span class="line"><span class="cl"><span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&#34;c:/file/hello.html&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># result1=html.xpath(&#34;//li/@class&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">result2</span><span class="o">=</span><span class="n">html</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;//li/a/@href&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">result2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">)</span></span></span></code></pre></div><div class="highlight" id="id-27"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#获取子标签</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&#34;c:/file/hello.html&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result1</span><span class="o">=</span><span class="n">html</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;//li/a&#34;</span><span class="p">)</span> <span class="c1">#获取下一级子标签</span>
</span></span><span class="line"><span class="cl"><span class="n">result2</span><span class="o">=</span><span class="n">html</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;//li//span&#34;</span><span class="p">)</span> <span class="c1">#获取所有符合条件子标签</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#print(result2[1].text)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#获取li标签下a标签里所有的class</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result3</span><span class="o">=</span><span class="n">html</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;//li/a//@class&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result3</span><span class="p">)</span></span></span></code></pre></div><div class="highlight" id="id-28"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#获取标签名和内容</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&#34;c:/file/hello.html&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#获取倒数第二个li元素下a的内容</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#result1=html.xpath(&#34;//li[last()-1]/a&#34;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># result2=html.xpath(&#34;//li/a&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># print(result1[-2].text) #.text获取标签内容</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#获取 class 值为 bold 的标签名</span>
</span></span><span class="line"><span class="cl"><span class="n">result3</span><span class="o">=</span><span class="n">html</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;//*[@class=&#39;bold&#39;]&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span> <span class="c1">#.tag表示获取标签名</span></span></span></code></pre></div><div class="highlight" id="id-29"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#爬取糗事百科段子</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.qiushibaike.com/&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; WOW64)</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s1">	AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s1">	.2743.116 Safari/537.36&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s1">&#39;Accept-Language&#39;</span><span class="p">:</span> <span class="s1">&#39;zh-CN,zh;q=0.8&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">response</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">html</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result1</span><span class="o">=</span><span class="n">html</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div//a[@class=&#34;recmd-content&#34;]/@href&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#print(result1)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#https://www.qiushibaike.com/article/121207030</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">result1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">xurl</span><span class="o">=</span><span class="s2">&#34;https://www.qiushibaike.com&#34;</span><span class="o">+</span><span class="n">site</span>
</span></span><span class="line"><span class="cl">	<span class="n">response2</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">xurl</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">	<span class="n">html2</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">response2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">result2</span><span class="o">=</span><span class="n">html2</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;//div[@class=&#39;content&#39;]&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nb">print</span><span class="p">(</span><span class="n">result2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span></span></span></code></pre></div><div class="highlight" id="id-30"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#百度贴吧图片爬虫</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">urllib</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">urllib.request</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 全局取消证书验证</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">ssl</span>
</span></span><span class="line"><span class="cl"><span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Spider</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">beginPage</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">endPage</span><span class="o">=</span><span class="mi">3</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="o">=</span><span class="s2">&#34;http://tieba.baidu.com/f?&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">ua_header</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;User-Agent&#34;</span> <span class="p">:</span> <span class="s2">&#34;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1 Trident/5.0;&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">fileName</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#构造url</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">tiebaSpider</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beginPage</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">endPage</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">pn</span><span class="o">=</span><span class="p">(</span><span class="n">page</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">50</span>
</span></span><span class="line"><span class="cl">            <span class="n">wo</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">pn</span><span class="p">,</span><span class="s1">&#39;kw&#39;</span><span class="p">:</span><span class="n">tiebaName</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">word</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">wo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">myurl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="o">+</span><span class="n">word</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">loadPage</span><span class="p">(</span><span class="n">myurl</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#爬取页面内容</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">loadPage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">url</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">req</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ua_header</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">html</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">links</span><span class="o">=</span><span class="n">html</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@class=&#34;threadlist_lz clearfix&#34;]/div/a/@href&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">link</span><span class="o">=</span><span class="s2">&#34;http://tieba.baidu.com&#34;</span><span class="o">+</span><span class="n">link</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">loadImages</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#爬取帖子详情页，获得图片的链接</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">loadImages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">link</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">req</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">link</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ua_header</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">html</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">links</span><span class="o">=</span><span class="n">html</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//img[@class=&#34;BDE_Image&#34;]/@src&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">imageslink</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">writeImages</span><span class="p">(</span><span class="n">imageslink</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#通过图片所在链接，爬取图片并保存图片到本地：</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">writeImages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">imagesLink</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;正在存储图片：&#34;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">fileName</span><span class="p">,</span><span class="s2">&#34;....&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">image</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">imagesLink</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">#保存图片到本地</span>
</span></span><span class="line"><span class="cl">        <span class="n">file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;/Users/yuanshuai/Desktop/img//&#34;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileName</span><span class="p">)</span><span class="o">+</span><span class="s2">&#34;.jpg&#34;</span><span class="p">,</span><span class="s2">&#34;wb&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">fileName</span><span class="o">+=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">tiebaName</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;请输入要爬取的贴吧名：&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">mySpider</span><span class="o">=</span><span class="n">Spider</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">mySpider</span><span class="o">.</span><span class="n">tiebaSpider</span><span class="p">()</span></span></span></code></pre></div><h2 id="五beautifulsoup">五、BeautifulSoup</h2>
<div class="highlight" id="id-31"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#BeautifulSoup模块简介和安装</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#CSS 选择器：BeautifulSoup4</span>
</span></span><span class="line"><span class="cl"><span class="c1">#和lxml 一样，Beautiful Soup 也是一个HTML/XML的解析器</span>
</span></span><span class="line"><span class="cl"><span class="c1">#主要的功能也是如何解析和提取 HTML/XML 数据。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#模块下载安装：pip install bs4</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#基础例子</span>
</span></span><span class="line"><span class="cl"><span class="n">html</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;html&gt;&lt;head&gt;&lt;title&gt;The Dormouse&#39;s story&lt;/title&gt;&lt;/head&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;body&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;p class=&#34;title&#34; name=&#34;dromouse&#34;&gt;&lt;b&gt;The Dormouse&#39;s story&lt;/b&gt;&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;p class=&#34;story&#34;&gt;Once upon a time there were three little sisters; and their names were
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;a href=&#34;http://example.com/elsie&#34; class=&#34;sister&#34; id=&#34;link1&#34;&gt;&lt;!-- Elsie --&gt;&lt;/a&gt;,
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;a href=&#34;http://example.com/lacie&#34; class=&#34;sister&#34; id=&#34;link2&#34;&gt;Lacie&lt;/a&gt; and
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;a href=&#34;http://example.com/tillie&#34; class=&#34;sister&#34; id=&#34;link3&#34;&gt;Tillie&lt;/a&gt;;
</span></span></span><span class="line"><span class="cl"><span class="s2">and they lived at the bottom of a well.&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;p class=&#34;story&#34;&gt;...&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#解析字符串形式的html</span>
</span></span><span class="line"><span class="cl"><span class="n">soup</span><span class="o">=</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span><span class="s2">&#34;lxml&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># #解析本地html文件</span>
</span></span><span class="line"><span class="cl"><span class="c1"># soup2=BeautifulSoup(open(&#34;index.html&#34;))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#格式化输出soup对象</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">soup</span><span class="o">.</span><span class="n">prettify</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># #根据标签名获取标签信息 soup.标签名</span>
</span></span><span class="line"><span class="cl"><span class="c1"># print(soup.title)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># #获取标签内容</span>
</span></span><span class="line"><span class="cl"><span class="c1"># print(soup.title.string)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># #获取标签名</span>
</span></span><span class="line"><span class="cl"><span class="c1"># print(soup.title.name)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># #获取标签内所有属性</span>
</span></span><span class="line"><span class="cl"><span class="c1"># print(soup.p.attrs[&#34;name&#34;])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#获取直接子标签，结果是一个列表</span>
</span></span><span class="line"><span class="cl"><span class="c1"># print(soup.head.contents)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#获取直接子标签，结果是一个生成器</span>
</span></span><span class="line"><span class="cl"><span class="c1"># for i in soup.head.children:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 	print(i)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#获取所有子标签，结果是一个生成器</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">descendants</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1">#根据字符串查找所有的a标签，返回一个结果集，里面装的是标签对象</span>
</span></span><span class="line"><span class="cl"><span class="c1"># data=soup.find_all(&#34;a&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># for i in data:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 	print(i.string)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#根据正则表达式查找标签</span>
</span></span><span class="line"><span class="cl"><span class="c1"># data2=soup.find_all(re.compile(&#34;^b&#34;))</span>
</span></span><span class="line"><span class="cl"><span class="c1"># for i in data2:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 	print(i.string)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#根据属性查找标签</span>
</span></span><span class="line"><span class="cl"><span class="c1"># data3=soup.find_all(id=&#34;link2&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># for i in data3:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 	print(i)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#根据标签内容获取标签内容</span>
</span></span><span class="line"><span class="cl"><span class="n">data4</span><span class="o">=</span><span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&#34;Lacie&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">data5</span><span class="o">=</span><span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;Lacie&#34;</span><span class="p">,</span><span class="s2">&#34;Tillie&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">data6</span><span class="o">=</span><span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&#34;Do&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">data6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#CSS选择器类型：标签选择器、类选择器、id选择器</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#通过标签名查找</span>
</span></span><span class="line"><span class="cl"><span class="c1"># data=soup.select(&#34;a&#34;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#通过类名查找</span>
</span></span><span class="line"><span class="cl"><span class="c1"># data=soup.select(&#34;.sister&#34;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#通过id查找</span>
</span></span><span class="line"><span class="cl"><span class="c1"># data=soup.select(&#34;#link2&#34;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#组合查找</span>
</span></span><span class="line"><span class="cl"><span class="c1"># data=soup.select(&#34;p #link1&#34;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#通过其他属性查找</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="o">=</span><span class="n">soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;a[href=&#34;http://example.com/tillie&#34;]&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></span></span></code></pre></div><h2 id="六多线程">六、多线程</h2>
<div class="highlight" id="id-32"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">threading</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="s2">&#34;线程执行了！&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#创建2个线程对象</span>
</span></span><span class="line"><span class="cl"><span class="n">t1</span><span class="o">=</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">run</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="s2">&#34;t1&#34;</span><span class="p">,))</span>
</span></span><span class="line"><span class="cl"><span class="n">t2</span><span class="o">=</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">run</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="s2">&#34;t2&#34;</span><span class="p">,))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#启动线程</span>
</span></span><span class="line"><span class="cl"><span class="n">t1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">t2</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#等待子线程执行完毕后再执行主线程后面的内容</span>
</span></span><span class="line"><span class="cl"><span class="n">t1</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">t2</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;执行完毕&#34;</span><span class="p">)</span></span></span></code></pre></div><div class="highlight" id="id-33"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 使用 threading 模块创建线程 </span>
</span></span><span class="line"><span class="cl"><span class="c1"># 创建一个新的子类继承threading.Thread.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 并实例化后调用 start() 方法启动新线程，即它调用了线程的 run() 方法</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">threading</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#线程类</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">myThread</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;开始线程&#34;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;线程执行中---1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;线程执行中---2&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;线程执行中---3&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;线程执行中---4&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;线程执行中---5&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;结束线程&#34;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#创建线程</span>
</span></span><span class="line"><span class="cl"><span class="n">t1</span><span class="o">=</span><span class="n">myThread</span><span class="p">(</span><span class="s2">&#34;t1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">t2</span><span class="o">=</span><span class="n">myThread</span><span class="p">(</span><span class="s2">&#34;t2&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">t3</span><span class="o">=</span><span class="n">myThread</span><span class="p">(</span><span class="s2">&#34;t3&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#开启线程</span>
</span></span><span class="line"><span class="cl"><span class="n">t1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">t2</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">t3</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">t1</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">t2</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">t3</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;执行完毕&#34;</span><span class="p">)</span></span></span></code></pre></div><div class="highlight" id="id-34"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#队列Queue</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">queue</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#Queue是python标准库中的线程安全的实现,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#提供了一个适用于多线程编程的先进先出的数据结构，</span>
</span></span><span class="line"><span class="cl"><span class="c1">#即队列，用来在生产者和消费者线程之间的信息传递。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#对于资源，加锁是个重要的环节。</span>
</span></span><span class="line"><span class="cl"><span class="c1">#因为python原生的list,dict等，都是非线程安全的。</span>
</span></span><span class="line"><span class="cl"><span class="c1">#而Queue，是线程安全的，因此在满足使用条件下，建议使用队列。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#创建队列</span>
</span></span><span class="line"><span class="cl"><span class="n">q</span><span class="o">=</span><span class="n">queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="c1">#往队列里面放值</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># print(q.get())</span>
</span></span><span class="line"><span class="cl"><span class="c1"># print(q.get())</span>
</span></span><span class="line"><span class="cl"><span class="c1"># print(q.get())</span>
</span></span><span class="line"><span class="cl"><span class="c1"># print(q.get())</span>
</span></span><span class="line"><span class="cl"><span class="c1"># print(q.get())</span>
</span></span><span class="line"><span class="cl"><span class="c1"># print(q.get())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#判断队列是否为空，循环取出所有值</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="ow">not</span> <span class="n">q</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">())</span></span></span></code></pre></div><div class="highlight" id="id-35"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#多线程爬取糗事百科</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 使用了线程库</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">threading</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 队列</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">queue</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># https://www.qiushibaike.com/8hr/page/1/</span>
</span></span><span class="line"><span class="cl"><span class="c1"># https://www.qiushibaike.com/8hr/page/2/</span>
</span></span><span class="line"><span class="cl"><span class="c1"># https://www.qiushibaike.com/8hr/page/3/</span>
</span></span><span class="line"><span class="cl"><span class="c1">#&#39;//div/a[@class=&#34;recmd-content&#34;]&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#采集网页线程--爬取段子列表所在的网页，放进队列</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Thread1</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threadName</span><span class="p">,</span><span class="n">pageQueue</span><span class="p">,</span><span class="n">dataQueue</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">threadName</span> <span class="o">=</span> <span class="n">threadName</span> <span class="c1">#线程名</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">pageQueue</span> <span class="o">=</span> <span class="n">pageQueue</span> <span class="c1">#页码队列</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">dataQueue</span> <span class="o">=</span> <span class="n">dataQueue</span> <span class="c1">#数据队列</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;User-Agent&#34;</span> <span class="p">:</span> <span class="s2">&#34;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0;&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;启动线程&#34;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">threadName</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="ow">not</span> <span class="n">flag1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">page</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pageQueue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="n">url</span><span class="o">=</span><span class="s2">&#34;https://www.qiushibaike.com/8hr/page/&#34;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">+</span><span class="s2">&#34;/&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">content</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">dataQueue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="c1">#将数据放入数据队列中</span>
</span></span><span class="line"><span class="cl">            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">pass</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;结束线程&#34;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">threadName</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#解析网页线程--从对、队列中拿到列表网页，进行解析，并存储到本地</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Thread2</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threadName</span><span class="p">,</span><span class="n">dataQueue</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">threadName</span> <span class="o">=</span> <span class="n">threadName</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">dataQueue</span> <span class="o">=</span> <span class="n">dataQueue</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;启动线程&#34;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">threadName</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="ow">not</span> <span class="n">flag2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">data1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataQueue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="n">html</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">data1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">node_list</span><span class="o">=</span><span class="n">html</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div/a[@class=&#34;recmd-content&#34;]&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">node_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">data</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;结束线程&#34;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">threadName</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">flag1</span><span class="o">=</span><span class="kc">False</span> <span class="c1">#判断页码队列中是否为空</span>
</span></span><span class="line"><span class="cl"><span class="n">flag2</span><span class="o">=</span><span class="kc">False</span> <span class="c1">#判断数据队列中是否为空</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#页码队列</span>
</span></span><span class="line"><span class="cl">    <span class="n">pageQueue</span><span class="o">=</span><span class="n">queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">pageQueue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#存放采集结果的数据队列</span>
</span></span><span class="line"><span class="cl">    <span class="n">dataQueue</span><span class="o">=</span><span class="n">queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#保存到本地的文件</span>
</span></span><span class="line"><span class="cl">    <span class="n">filename</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;C:\file\dianzi.txt&#34;</span><span class="p">,</span><span class="s2">&#34;a&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#启动线程</span>
</span></span><span class="line"><span class="cl">    <span class="n">t1</span><span class="o">=</span><span class="n">Thread1</span><span class="p">(</span><span class="s2">&#34;采集线程&#34;</span><span class="p">,</span><span class="n">pageQueue</span><span class="p">,</span><span class="n">dataQueue</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">t1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">t2</span><span class="o">=</span><span class="n">Thread2</span><span class="p">(</span><span class="s2">&#34;解析线程&#34;</span><span class="p">,</span><span class="n">dataQueue</span><span class="p">,</span><span class="n">filename</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">t2</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#当pageQueue为空时，结束采集线程</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="ow">not</span> <span class="n">pageQueue</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="n">flag1</span>
</span></span><span class="line"><span class="cl">    <span class="n">flag1</span><span class="o">=</span><span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#当dataQueue为空时，结束解析线程</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="ow">not</span> <span class="n">dataQueue</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="n">flag2</span>
</span></span><span class="line"><span class="cl">    <span class="n">flag2</span><span class="o">=</span><span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">t1</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">t2</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">filename</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;结束！&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span></span></span></code></pre></div><h2 id="七验证码识别">七、验证码识别</h2>
<div class="highlight" id="id-36"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#识别车牌号</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">aip</span> <span class="kn">import</span> <span class="n">AipOcr</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">APP_ID</span> <span class="o">=</span> <span class="s1">&#39;15469265&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">API_KEY</span> <span class="o">=</span> <span class="s1">&#39;rAGFtOChXtO7mnRPiwXg1Frf&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s1">&#39;Ailvoijh4X7lQIAoZ58UsGPlaDCmLIt7&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">client</span> <span class="o">=</span> <span class="n">AipOcr</span><span class="p">(</span><span class="n">APP_ID</span><span class="p">,</span> <span class="n">API_KEY</span><span class="p">,</span> <span class="n">SECRET_KEY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34; 读取图片 &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_file_content</span><span class="p">(</span><span class="n">filePath</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">image</span> <span class="o">=</span> <span class="n">get_file_content</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;C:\Users\Administrator\Desktop\img\ee.jpg&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34; 调用通用文字识别, 图片参数为本地图片 &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">basicGeneral</span><span class="p">(</span><span class="n">image</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pat</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;{&#39;words&#39;:&#39;(.*?)&#39;}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">=</span><span class="n">pat</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></span></span></code></pre></div><div class="highlight" id="id-37"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#人工智能接口申请</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">aip</span> <span class="kn">import</span> <span class="n">AipOcr</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">APP_ID</span><span class="o">=</span><span class="s2">&#34;15725370&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">API_KEY</span><span class="o">=</span><span class="s2">&#34;t85bppstXXudNNSU0klALWgj&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">SECRET_KEY</span><span class="o">=</span><span class="s2">&#34;Zt7z61AXutINgWS1lqWe3xsWp9uePSFF&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">client</span><span class="o">=</span><span class="n">AipOcr</span><span class="p">(</span><span class="n">APP_ID</span><span class="p">,</span><span class="n">API_KEY</span><span class="p">,</span><span class="n">SECRET_KEY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;C:\Users\Administrator\Desktop\img\ee.jpg&#34;</span><span class="p">,</span><span class="s2">&#34;rb&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">image</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">basicGeneral</span><span class="p">(</span><span class="n">image</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pat</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;{&#39;words&#39;:&#39;(.*?)&#39;}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">=</span><span class="n">pat</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></span></span></code></pre></div><div class="highlight" id="id-38"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#文字识别</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">aip</span> <span class="kn">import</span> <span class="n">AipOcr</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">APP_ID</span><span class="o">=</span><span class="s2">&#34;15725370&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">API_KEY</span><span class="o">=</span><span class="s2">&#34;t85bppstXXudNNSU0klALWgj&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">SECRET_KEY</span><span class="o">=</span><span class="s2">&#34;Zt7z61AXutINgWS1lqWe3xsWp9uePSFF&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">client</span><span class="o">=</span><span class="n">AipOcr</span><span class="p">(</span><span class="n">APP_ID</span><span class="p">,</span><span class="n">API_KEY</span><span class="p">,</span><span class="n">SECRET_KEY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;http://127.0.0.1:8020/登陆验证码/login.html&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pat</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&lt;img src=&#34;(.*?)&#34; style&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span><span class="o">=</span><span class="s2">&#34;http://127.0.0.1:8020/登陆验证码/&#34;</span><span class="o">+</span><span class="n">pat</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">image</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">content</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">basicGeneral</span><span class="p">(</span><span class="n">image</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pat</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;{&#39;words&#39;:&#39;(.*?)&#39;}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">=</span><span class="n">pat</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></span></span></code></pre></div><div class="highlight" id="id-39"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#模拟验证码识别</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">aip</span> <span class="kn">import</span> <span class="n">AipOcr</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">APP_ID</span><span class="o">=</span><span class="s2">&#34;15725370&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">API_KEY</span><span class="o">=</span><span class="s2">&#34;t85bppstXXudNNSU0klALWgj&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">SECRET_KEY</span><span class="o">=</span><span class="s2">&#34;Zt7z61AXutINgWS1lqWe3xsWp9uePSFF&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">client</span><span class="o">=</span><span class="n">AipOcr</span><span class="p">(</span><span class="n">APP_ID</span><span class="p">,</span><span class="n">API_KEY</span><span class="p">,</span><span class="n">SECRET_KEY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;http://127.0.0.1:8020/登陆验证码/login.html&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pat</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&lt;img src=&#34;(.*?)&#34; style&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span><span class="o">=</span><span class="s2">&#34;http://127.0.0.1:8020/登陆验证码/&#34;</span><span class="o">+</span><span class="n">pat</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">image</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">content</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">basicGeneral</span><span class="p">(</span><span class="n">image</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pat</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;{&#39;words&#39;:&#39;(.*?)&#39;}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">=</span><span class="n">pat</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></span></span></code></pre></div><h2 id="八scrapy框架">八、scrapy框架</h2>
<ol>
<li>创建项目</li>
</ol>
<blockquote>
<p>scrapy startproject 项目名</p>
</blockquote>
<ol start="2">
<li>创建爬虫</li>
</ol>
<blockquote>
<p>scrapy  genspider  爬虫识别名称   &lsquo;要爬取的主机地址&rsquo;</p>
</blockquote>
<ol start="3">
<li>运行爬虫</li>
</ol>
<blockquote>
<p>scrapy crawl 爬虫识别名称</p>
</blockquote>
<h3 id="1scrapy框架的安装">1.Scrapy框架的安装</h3>
<blockquote>
<p>pip3 install scrapy</p>
</blockquote>
<h3 id="2scrapy框架的简单使用">2.Scrapy框架的简单使用</h3>
<ul>
<li>常用命令</li>
</ul>
<blockquote>
<p>创建项目：scrapy startproject xxx
进入项目：cd xxx #进入某个文件夹下
创建爬虫：scrapy genspider xxx（爬虫名） xxx.com （爬取域）
生成文件：scrapy crawl xxx -o xxx.json (生成某种类型的文件)
运行爬虫：scrapy crawl XXX
列出所有爬虫：scrapy list
获得配置信息：scrapy settings [options]</p>
</blockquote>
<ul>
<li>Scrapy项目下包含</li>
</ul>
<blockquote>
<p>scrapy.cfg: 项目的配置文件
tutorial/: 该项目的python模块。在此放入代码（核心）
tutorial/items.py: 项目中的item文件.（这是创建容器的地方，爬取的信息分别放到不同容器里）
tutorial/pipelines.py: 项目中的pipelines文件.
tutorial/settings.py: 项目的设置文件.（我用到的设置一下基础参数，比如加个文件头，设置一个编码）
tutorial/spiders/: 放置spider代码的目录. （放爬虫的地方）</p>
</blockquote>
<ul>
<li>
<p>容器（items）的定义，容器不一定是一开始全部都定义好的，可以跟随项目的更新一点点向里面添加</p>
<p>也就是定义我们要爬取的内容</p>
</li>
</ul>
<blockquote>
<p>import scrapy
class DmozItem(scrapy.Item): #创建一个类，继承scrapy.item类，就是继承人家写好的容器
title = scrapy.Field() # 需要取哪些内容，就创建哪些容器
link = scrapy.Field()
desc = scrapy.Field()</p>
</blockquote>
<ul>
<li>一个简单爬虫小例子</li>
</ul>
<div class="highlight" id="id-40"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">scrapy</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DmozSpider</span><span class="p">(</span><span class="n">scrapy</span><span class="o">.</span><span class="n">Spider</span><span class="p">):</span> <span class="c1"># 继承Spider类</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;dmoz&#34;</span> <span class="c1"># 爬虫的唯一标识，不能重复，启动爬虫的时候要用</span>
</span></span><span class="line"><span class="cl">    <span class="n">allowed_domains</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;dmoz.org&#34;</span><span class="p">]</span> <span class="c1"># 限定域名，只爬取该域名下的网页</span>
</span></span><span class="line"><span class="cl">    <span class="n">start_urls</span> <span class="o">=</span> <span class="p">[</span> <span class="c1"># 开始爬取的链接</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;https://www.baidu.com/&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">filename</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># 获取url，用”/”分段，获去倒数第二个字段</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="p">)</span> <span class="c1"># 把访问的得到的网页源码写入文件</span></span></span></code></pre></div><p>里面的parse方法，这个方法有两个作用
1.负责解析start_url下载的Response 对象，根据item提取数据（解析item数据的前提是parse里全部requests请求都被加入了爬取队列）
2.如果有新的url则加入爬取队列，负责进一步处理，URL的Request 对象
这两点简单来说就是编写爬虫的主要部分</p>
<p>那么爬虫编写完，我们需要启动爬虫</p>
<blockquote>
<p>cd XXX</p>
</blockquote>
<p>进入到你的文件夹下
输入命令,启动爬虫</p>
<blockquote>
<p>scrapy crawl dmoz</p>
</blockquote>
<p>那么启动爬虫时发生了什么？
Scrapy为Spider的 start_urls 属性中的每个url创建了Request 对象，并将 parse 方法作为回调函数(callback)赋值给了requests,而requests对象经过调度器的调度，执行生成response对象并送回给parse() 方法进行解析,所以请求链接的改变是靠回调函数实现的。</p>
<blockquote>
<p>yield scrapy.Request(self.url, callback=self.parse)</p>
</blockquote>
<h3 id="3scrapy框架的整体架构和组成">3.Scrapy框架的整体架构和组成</h3>
<ul>
<li>官方的Scrapy的架构图</li>
</ul>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/1.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/1.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/1.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/1.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/1.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/1.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<blockquote>
<p>图中绿色的是数据的流向
我们看到图里有这么几个东西，分别是
Spiders：爬虫，定义了爬取的逻辑和网页内容的解析规则，主要负责解析响应并生成结果和新的请求
Engine：引擎，处理整个系统的数据流处理，出发事物，框架的核心。
Scheduler：调度器，接受引擎发过来的请求，并将其加入队列中，在引擎再次请求时将请求提供给引擎
Downloader：下载器，下载网页内容，并将下载内容返回给spider
ItemPipeline：项目管道，负责处理spider从网页中抽取的数据，主要是负责清洗，验证和向数据库中存储数据
Downloader Middlewares：下载中间件，是处于Scrapy的Request和Requesponse之间的处理模块
Spider Middlewares：spider中间件，位于引擎和spider之间的框架，主要处理spider输入的响应和输出的结果及新的请求middlewares.py里实现</p>
</blockquote>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/2.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/2.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/2.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/2.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/2.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/2.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<ul>
<li>最后我们来顺一下scrapy框架的整体执行流程：</li>
</ul>
<blockquote>
<p>1.spider的yeild将request发送给engine
2.engine对request不做任何处理发送给scheduler
3.scheduler，生成request交给engine
4.engine拿到request，通过middleware发送给downloader
5.downloader在\获取到response之后，又经过middleware发送给engine
6.engine获取到response之后，返回给spider，spider的parse()方法对获取到的response进行处理，解析出items或者requests
7.将解析出来的items或者requests发送给engine
8.engine获取到items或者requests，将items发送给ItemPipeline，将requests发送给scheduler（ps，只有调度器中不存在request时，程序才停止，及时请求失败scrapy也会重新进行请求）</p>
</blockquote>
<h3 id="4中间件介绍">4.中间件介绍</h3>
<p>请查看xmind思维导图：Scrapy.xmind</p>
<h3 id="5附件">5.附件</h3>
<p>阳光问政平台爬虫（Scrapy实现：2020.7.21） sunSpider文件夹</p>
<h2 id="九fiddler手机抓包">九、fiddler手机抓包</h2>
<ul>
<li>fiddler官网：https://www.telerik.com/fiddler</li>
</ul>
<p>通过Fiddler抓包工具，可以抓取手机的网络通信，但前提是手机和电脑处于同一局域网内（WI-FI或热点），然后进行以下设置：</p>
<ul>
<li>
<h3 id="用fiddler对android应用进行抓包">用Fiddler对Android应用进行抓包</h3>
</li>
</ul>
<ol>
<li>打开Fiddler设置</li>
</ol>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler1.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler1.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler1.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler1.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler1.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler1.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>在<code>Connections</code>里设置允许连接远程计算机，确认后重新启动Fiddler</p>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler2.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler2.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler2.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler2.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler2.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler2.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<ol start="2">
<li>在命令提示符下输入<code>ipconfig</code>查看本机IP</li>
</ol>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler3.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler3.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler3.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler3.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler3.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler3.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<ol start="3">
<li>打开Android设备的“设置”-&gt;“WLAN”，找到你要连接的网络，在上面长按，然后选择“修改网络”，弹出网络设置对话框，然后勾选“显示高级选项”。</li>
</ol>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler4.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler4.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler4.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler4.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler4.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler4.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<ol start="4">
<li>在“代理”后面的输入框选择“手动”，在“代理服务器主机名”后面的输入框输入电脑的ip地址，在“代理服务器端口”后面的输入框输入8888，然后点击“保存”按钮。</li>
</ol>
<p><img loading="lazy" src="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler5.png" srcset="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler5.png, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler5.png 1.5x, https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler5.png 2x" sizes="auto" data-title="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler5.png" data-alt="https://hexobbblog.oss-cn-beijing.aliyuncs.com/images/python_spider/fiddler5.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<ol start="5">
<li>启动Android设备中的浏览器，访问网页即可在Fiddler中可以看到完成的请求和响应数据。</li>
</ol>
<ul>
<li>
<h3 id="用fiddler对iphone手机应用进行抓包">用Fiddler对iPhone手机应用进行抓包</h3>
</li>
</ul>
<p>基本流程差不多，只是手机设置不太一样：</p>
<p>iPhone手机：点击设置 &gt; 无线局域网 &gt; 无线网络 &gt; HTTP代理 &gt; 手动：</p>
<p>代理地址(电脑IP)：192.168.xx.xxx</p>
<p>端口号：8888</p>
<h2 id="十数据写入">十、数据写入</h2>
<div class="highlight" id="id-41"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#写入到Excel</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">xlsxwriter</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#创建文件，并添加一个工作表</span>
</span></span><span class="line"><span class="cl"><span class="n">workbook</span><span class="o">=</span><span class="n">xlsxwriter</span><span class="o">.</span><span class="n">Workbook</span><span class="p">(</span><span class="s1">&#39;demo.xlsx&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">worksheet</span><span class="o">=</span><span class="n">workbook</span><span class="o">.</span><span class="n">add_worksheet</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#在指定位置写入数据</span>
</span></span><span class="line"><span class="cl"><span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&#34;A1&#34;</span><span class="p">,</span><span class="s2">&#34;这是A1的数据&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&#34;A2&#34;</span><span class="p">,</span><span class="s2">&#34;这是A2的数据&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#关闭表格文件</span>
</span></span><span class="line"><span class="cl"><span class="n">workbook</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></span></span></code></pre></div><div class="highlight" id="id-42"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#爬取便民查询网常用号码，并写入到Excel</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">xlsxwriter</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;User-Agent&#34;</span><span class="p">:</span> <span class="s2">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) Ap</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">pleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Sa</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">fari/537.36&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">response</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;http://changyongdianhuahaoma.51240.com/&#34;</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pat1</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;&lt;tr bgcolor=&#34;#EFF7F0&#34;&gt;[\s\S]*?&lt;td&gt;(.*?)&lt;/td&gt;[\s\S]*?&lt;td&gt;[\s\S]*?&lt;/td&gt;[\s\S]*?&lt;/tr&gt;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">pat2</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;&lt;tr bgcolor=&#34;#EFF7F0&#34;&gt;[\s\S]*?&lt;td&gt;[\s\S]*?&lt;/td&gt;[\s\S]*?&lt;td&gt;(.*?)&lt;/td&gt;[\s\S]*?&lt;/tr&gt;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pattern1</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pat1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pattern2</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pat2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data1</span><span class="o">=</span><span class="n">pattern1</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">data2</span><span class="o">=</span><span class="n">pattern2</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">resultlist</span><span class="o">=</span><span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#创建表格</span>
</span></span><span class="line"><span class="cl"><span class="n">workbook</span><span class="o">=</span><span class="n">xlsxwriter</span><span class="o">.</span><span class="n">Workbook</span><span class="p">(</span><span class="s2">&#34;demo2.xlsx&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">worksheet</span><span class="o">=</span><span class="n">workbook</span><span class="o">.</span><span class="n">add_worksheet</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">data1</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">	<span class="n">resultlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">data2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">#写入数据</span>
</span></span><span class="line"><span class="cl">	<span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&#34;A&#34;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">data1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="n">worksheet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&#34;B&#34;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">data2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">resultlist</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 关闭表格资源，这样才会完成创建</span>
</span></span><span class="line"><span class="cl"><span class="n">workbook</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></span></span></code></pre></div><div class="highlight" id="id-43"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#爬取便民查询网常用号码，并写入到Mysql </span>
</span></span><span class="line"><span class="cl"><span class="c1">#注意：需要提前创建对应字段的数据库</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pymysql</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#建立数据库连接</span>
</span></span><span class="line"><span class="cl"><span class="n">db</span><span class="o">=</span><span class="n">pymysql</span><span class="o">.</span><span class="n">Connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;localhost&#34;</span><span class="p">,</span><span class="n">port</span><span class="o">=</span><span class="mi">3306</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="s2">&#34;root&#34;</span><span class="p">,</span><span class="n">passwd</span><span class="o">=</span><span class="s2">&#34;AA123456&#34;</span><span class="p">,</span><span class="n">db</span><span class="o">=</span><span class="s2">&#34;spider_test&#34;</span><span class="p">,</span><span class="n">charset</span><span class="o">=</span><span class="s2">&#34;utf8&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">cursor</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#爬取数据</span>
</span></span><span class="line"><span class="cl"><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;User-Agent&#34;</span><span class="p">:</span> <span class="s2">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) Ap</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">pleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Sa</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">fari/537.36&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">response</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;http://changyongdianhuahaoma.51240.com/&#34;</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#处理数据</span>
</span></span><span class="line"><span class="cl"><span class="n">pat1</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;&lt;tr bgcolor=&#34;#EFF7F0&#34;&gt;[\s\S]*?&lt;td&gt;(.*?)&lt;/td&gt;[\s\S]*?&lt;td&gt;[\s\S]*?&lt;/td&gt;[\s\S]*?&lt;/tr&gt;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">pat2</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;&lt;tr bgcolor=&#34;#EFF7F0&#34;&gt;[\s\S]*?&lt;td&gt;[\s\S]*?&lt;/td&gt;[\s\S]*?&lt;td&gt;(.*?)&lt;/td&gt;[\s\S]*?&lt;/tr&gt;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pattern1</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pat1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pattern2</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pat2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data1</span><span class="o">=</span><span class="n">pattern1</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">data2</span><span class="o">=</span><span class="n">pattern2</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#清空数据库原来的内容</span>
</span></span><span class="line"><span class="cl"><span class="n">sqll</span><span class="o">=</span><span class="s2">&#34;delete from tel&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sqll</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">resultlist</span><span class="o">=</span><span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">data1</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">	<span class="n">resultlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">data2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">sql</span><span class="o">=</span><span class="s2">&#34;insert into tel(name,phone) values(&#39;&#34;</span><span class="o">+</span><span class="n">data1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s2">&#34;&#39;,&#39;&#34;</span><span class="o">+</span><span class="n">data2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s2">&#34;&#39;)&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">resultlist</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></span></span></code></pre></div><p>完结撒花~</p>
<p>2020.7.22 下午5：11</p>
</div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="更新于 0001-01-01 00:00:00">更新于 0001-01-01&nbsp;</span>
      </div><div class="post-info-license">
          <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span>
        </div></div>
    <div class="post-info-line">
      <div class="post-info-md"></div>
      <div class="post-info-share">
        <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://yuanshuai1122.github.com/posts/python%E7%88%AC%E8%99%AB%E5%85%A8-python%E7%88%AC%E8%99%AB%E5%85%A8/" data-title="Python爬虫（全）" data-hashtags="Python,爬虫"><i class="fa-brands fa-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://yuanshuai1122.github.com/posts/python%E7%88%AC%E8%99%AB%E5%85%A8-python%E7%88%AC%E8%99%AB%E5%85%A8/" data-hashtag="Python"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://yuanshuai1122.github.com/posts/python%E7%88%AC%E8%99%AB%E5%85%A8-python%E7%88%AC%E8%99%AB%E5%85%A8/" data-title="Python爬虫（全）"><i class="fa-brands fa-weibo fa-fw" aria-hidden="true"></i></a>
  </span>
      </div>
    </div>
  </div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/tags/python/' class="post-tag">Python</a><a href='/tags/%E7%88%AC%E8%99%AB/' class="post-tag">爬虫</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="/posts/python%E7%88%AC%E8%99%AB%E4%B9%8Bbeautifulsoup-python%E7%88%AC%E8%99%AB%E4%B9%8Bbeautifulsoup/" class="post-nav-item" rel="prev" title="Python爬虫之BeautifulSoup"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>Python爬虫之BeautifulSoup</a>
      <a href="/posts/nps%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E7%9A%84%E6%90%AD%E5%BB%BA%E4%B8%8E%E6%BC%94%E7%A4%BA-nps%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E7%9A%84%E6%90%AD%E5%BB%BA%E4%B8%8E%E6%BC%94%E7%A4%BA/" class="post-nav-item" rel="next" title="NPS内网穿透的搭建与演示">NPS内网穿透的搭建与演示<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></main><footer class="footer">
    <div class="footer-container"><div class="footer-line powered">由 <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.119.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.2.18-lts.2"><img class="fixit-icon" src="/fixit.min.svg" alt="FixIt logo" />&nbsp;FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2023</span><span class="author" itemprop="copyrightHolder">
              <a href="/"></a></span></div><div class="footer-line statistics"></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="回到顶部"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">FixIt 主题在启用 JavaScript 的情况下效果最佳。</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/katex/katex.min.js" defer></script><script src="/lib/katex/auto-render.min.js" defer></script><script src="/lib/katex/copy-tex.min.js" defer></script><script src="/lib/katex/mhchem.min.js" defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script>window.config={"code":{"copyTitle":"复制到剪贴板","editLockTitle":"锁定可编辑代码块","editUnLockTitle":"解锁可编辑代码块","editable":true,"maxShownLines":10},"comment":{"enable":false},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验。"},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script src="/js/theme.min.js" defer></script></body>
</html>
