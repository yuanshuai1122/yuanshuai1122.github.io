<!DOCTYPE html>
<html class="js no-touch  progressive-image  no-reduced-motion progressive" lang="zh-hans">
  <head>
    <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="icon" href="/img/favicon.ico">

    <meta name="keyword" content=""><meta property="og:title" content="Kubernetes-Podæ§åˆ¶å™¨è¯¦è§£" />
<meta property="og:description" content="ä¸€ã€Podæ§åˆ¶å™¨ä»‹ç» Podæ˜¯kubernetesçš„æœ€å°ç®¡ç†å•å…ƒï¼Œåœ¨kubernetesä¸­ï¼ŒæŒ‰ç…§podçš„åˆ›å»ºæ–¹å¼å¯ä»¥å°†å…¶åˆ†ä¸ºä¸¤ç±»ï¼š è‡ªä¸»å¼pod" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yuanshuai1122.github.io/11/kubernetes-pod%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AF%A6%E8%A7%A3/" /><meta property="article:section" content="11" />
<meta property="article:published_time" content="2023-07-19T18:12:20+00:00" />
<meta property="article:modified_time" content="2023-07-19T18:12:20+00:00" />
<title>Kubernetes-Podæ§åˆ¶å™¨è¯¦è§£</title>

    <link rel="canonical" href="/11/kubernetes-pod%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AF%A6%E8%A7%A3/">

    <link rel="stylesheet" href="/css/global.css">

    <link rel="stylesheet" href="/css/custom.css">

    <link rel="stylesheet" href="/css/search.css" />

    
    

    
    

</head>
  </head>
  <body class=" page-article   ">
    <header>
      <nav class="nav">
  <div class="nav-wrapper">
    <div class="nav-content-wrapper">
      <div class="nav-content">
        <a href="/ " class="nav-title">ğŸ§€</a>
        <div class="nav-menu">
          <div class="nav-item-wrapper">
            <a href="/posts " class="nav-item-content">ç›®å½•</a>
          </div><div class="nav-item-wrapper">
            <a href="/about" class="nav-item-content">å…³äº</a>
          </div><div class="nav-item-wrapper">
            <a href="/index.xml" class="nav-item-content" target="_blank">RSS</a>
          </div></div>
      </div>
    </div>
  </div>
</nav>

<script>
  function toggleSearchModal(){
    const template = `
    <div class="modal-body">
      <div id="autocomplete" onclick="event.stopPropagation();"></div>
    </div>
    `
    const modal = document.querySelector("#modal-wrapper")
    if(!modal){
      const div = document.createElement("div")
      document.body.setAttribute("style","overflow: hidden;")
      div.setAttribute("id", "modal-wrapper")
      div.setAttribute("onclick", "toggleSearchModal()")
      div.innerHTML = template
      const script = document.createElement("script");script.setAttribute("src", "https://yuanshuai1122.github.io/js/algolia.js")
      div.appendChild(script)
      document.body.append(div)
    } else {
      document.body.removeAttribute("style")
      document.body.removeChild(modal)
    }
  }
</script>
    </header>
    
  
  
  <main id="main" class="main">
      <section>
        <article class="article">
          
          <div class=" article-header ">
            <div class="category component">
              <div class="component-content">
                <div class="category-eyebrow">
                  <span class="category-eyebrow__category category_original">
                    
                      
                        docker
                      
                    
                  </span>
                  <span class="category-eyebrow__date">2023å¹´7æœˆ19æ—¥</span>
                </div>
              </div>
            </div>
            <div class="pagetitle component">
              <div class="component-content">
                <h1 class="hero-headline">Kubernetes-Podæ§åˆ¶å™¨è¯¦è§£</h1>
              </div>
            </div>
            <div class="component  article-subhead ">
              <div class="component-content"></div>
            </div>

            <div class="tagssheet component">
              <div class="component-content">
                
                  
                  <a href="/tags/docker" class="tag">
                    docker
                  </a>
                
                  
                  <a href="/tags/k8s" class="tag">
                    k8s
                  </a>
                
                  
                  <a href="/tags/%E5%AE%B9%E5%99%A8" class="tag">
                    å®¹å™¨
                  </a>
                
              </div>
            </div>
          </div>
          
          <div class="pagebody">
            
            
            
            
            
            
            
            
            
<div class="component-content pagebody component">
  <h2 id="ä¸€podæ§åˆ¶å™¨ä»‹ç»" class="pagebody-header">
    ä¸€ã€Podæ§åˆ¶å™¨ä»‹ç»
  </h2>
</div><p class="component-content component">Podæ˜¯kubernetesçš„æœ€å°ç®¡ç†å•å…ƒï¼Œåœ¨kubernetesä¸­ï¼ŒæŒ‰ç…§podçš„åˆ›å»ºæ–¹å¼å¯ä»¥å°†å…¶åˆ†ä¸ºä¸¤ç±»ï¼š</p>
<div class="component-content component"><ul>
<li>è‡ªä¸»å¼podï¼škubernetesç›´æ¥åˆ›å»ºå‡ºæ¥çš„Podï¼Œè¿™ç§podåˆ é™¤åå°±æ²¡æœ‰äº†ï¼Œä¹Ÿä¸ä¼šé‡å»º</li>
<li>æ§åˆ¶å™¨åˆ›å»ºçš„podï¼škubernetesé€šè¿‡æ§åˆ¶å™¨åˆ›å»ºçš„podï¼Œè¿™ç§podåˆ é™¤äº†ä¹‹åè¿˜ä¼šè‡ªåŠ¨é‡å»º</li>
</ul></div>
<blockquote>
<p class="component-content component">ä»€ä¹ˆæ˜¯Podæ§åˆ¶å™¨</p>
<p class="component-content component">Podæ§åˆ¶å™¨æ˜¯ç®¡ç†podçš„ä¸­é—´å±‚ï¼Œä½¿ç”¨Podæ§åˆ¶å™¨ä¹‹åï¼Œåªéœ€è¦å‘Šè¯‰Podæ§åˆ¶å™¨ï¼Œæƒ³è¦å¤šå°‘ä¸ªä»€ä¹ˆæ ·çš„Podå°±å¯ä»¥äº†ï¼Œå®ƒä¼šåˆ›å»ºå‡ºæ»¡è¶³æ¡ä»¶çš„Podå¹¶ç¡®ä¿æ¯ä¸€ä¸ªPodèµ„æºå¤„äºç”¨æˆ·æœŸæœ›çš„ç›®æ ‡çŠ¶æ€ã€‚å¦‚æœPodèµ„æºåœ¨è¿è¡Œä¸­å‡ºç°æ•…éšœï¼Œå®ƒä¼šåŸºäºæŒ‡å®šç­–ç•¥é‡æ–°ç¼–æ’Podã€‚</p>
</blockquote>
<p class="component-content component">åœ¨kubernetesä¸­ï¼Œæœ‰å¾ˆå¤šç±»å‹çš„podæ§åˆ¶å™¨ï¼Œæ¯ç§éƒ½æœ‰è‡ªå·±çš„é€‚åˆçš„åœºæ™¯ï¼Œå¸¸è§çš„æœ‰ä¸‹é¢è¿™äº›ï¼š</p>
<div class="component-content component"><ul>
<li>ReplicationControllerï¼šæ¯”è¾ƒåŸå§‹çš„podæ§åˆ¶å™¨ï¼Œå·²ç»è¢«åºŸå¼ƒï¼Œç”±ReplicaSetæ›¿ä»£</li>
<li>ReplicaSetï¼šä¿è¯å‰¯æœ¬æ•°é‡ä¸€ç›´ç»´æŒåœ¨æœŸæœ›å€¼ï¼Œå¹¶æ”¯æŒpodæ•°é‡æ‰©ç¼©å®¹ï¼Œé•œåƒç‰ˆæœ¬å‡çº§</li>
<li>Deploymentï¼šé€šè¿‡æ§åˆ¶ReplicaSetæ¥æ§åˆ¶Podï¼Œå¹¶æ”¯æŒæ»šåŠ¨å‡çº§ã€å›é€€ç‰ˆæœ¬</li>
<li>Horizontal Pod Autoscalerï¼šå¯ä»¥æ ¹æ®é›†ç¾¤è´Ÿè½½è‡ªåŠ¨æ°´å¹³è°ƒæ•´Podçš„æ•°é‡ï¼Œå®ç°å‰Šå³°å¡«è°·</li>
<li>DaemonSetï¼šåœ¨é›†ç¾¤ä¸­çš„æŒ‡å®šNodeä¸Šè¿è¡Œä¸”ä»…è¿è¡Œä¸€ä¸ªå‰¯æœ¬ï¼Œä¸€èˆ¬ç”¨äºå®ˆæŠ¤è¿›ç¨‹ç±»çš„ä»»åŠ¡</li>
<li>Jobï¼šå®ƒåˆ›å»ºå‡ºæ¥çš„podåªè¦å®Œæˆä»»åŠ¡å°±ç«‹å³é€€å‡ºï¼Œä¸éœ€è¦é‡å¯æˆ–é‡å»ºï¼Œç”¨äºæ‰§è¡Œä¸€æ¬¡æ€§ä»»åŠ¡</li>
<li>Cronjobï¼šå®ƒåˆ›å»ºçš„Podè´Ÿè´£å‘¨æœŸæ€§ä»»åŠ¡æ§åˆ¶ï¼Œä¸éœ€è¦æŒç»­åå°è¿è¡Œ</li>
<li>StatefulSetï¼šç®¡ç†æœ‰çŠ¶æ€åº”ç”¨</li>
</ul></div>

<div class="component-content pagebody component">
  <h2 id="äºŒreplicasetrs" class="pagebody-header">
    äºŒã€ReplicaSet(RS)
  </h2>
</div><p class="component-content component">ReplicaSetçš„ä¸»è¦ä½œç”¨æ˜¯ä¿è¯ä¸€å®šæ•°é‡çš„podæ­£å¸¸è¿è¡Œï¼Œå®ƒä¼šæŒç»­ç›‘å¬è¿™äº›Podçš„è¿è¡ŒçŠ¶æ€ï¼Œä¸€æ—¦Podå‘ç”Ÿæ•…éšœï¼Œå°±ä¼šé‡å¯æˆ–é‡å»ºã€‚åŒæ—¶å®ƒè¿˜æ”¯æŒå¯¹podæ•°é‡çš„æ‰©ç¼©å®¹å’Œé•œåƒç‰ˆæœ¬çš„å‡é™çº§ã€‚</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-a6733cfcbda75e78400511600f4cbc30" id="lhta6733cfcbda75e78400511600f4cbc30">
        <picture  class="picture">
          <img class="picture-image" data-src="https://aabb-2023.oss-cn-beijing.aliyuncs.com/202308210840790.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">ReplicaSetçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span> <span style="color:#75715e"># ç‰ˆæœ¬å·</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ReplicaSet</span> <span style="color:#75715e"># ç±»å‹       </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>: <span style="color:#75715e"># å…ƒæ•°æ®</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#75715e"># rsåç§° </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#75715e"># æ‰€å±å‘½åç©ºé—´ </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>: <span style="color:#75715e">#æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">controller</span>: <span style="color:#ae81ff">rs</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>: <span style="color:#75715e"># è¯¦æƒ…æè¿°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span> <span style="color:#75715e"># å‰¯æœ¬æ•°é‡</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>: <span style="color:#75715e"># é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:      <span style="color:#75715e"># LabelsåŒ¹é…è§„åˆ™</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx-pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchExpressions</span>: <span style="color:#75715e"># ExpressionsåŒ¹é…è§„åˆ™</span>
</span></span><span style="display:flex;"><span>      - {<span style="color:#f92672">key: app, operator: In, values</span>: [<span style="color:#ae81ff">nginx-pod]}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>: <span style="color:#75715e"># æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx-pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">åœ¨è¿™é‡Œé¢ï¼Œéœ€è¦æ–°äº†è§£çš„é…ç½®é¡¹å°±æ˜¯specä¸‹é¢å‡ ä¸ªé€‰é¡¹ï¼š</p>
<div class="component-content component"><ul>
<li>replicasï¼šæŒ‡å®šå‰¯æœ¬æ•°é‡ï¼Œå…¶å®å°±æ˜¯å½“å‰rsåˆ›å»ºå‡ºæ¥çš„podçš„æ•°é‡ï¼Œé»˜è®¤ä¸º1</li>
<li>selectorï¼šé€‰æ‹©å™¨ï¼Œå®ƒçš„ä½œç”¨æ˜¯å»ºç«‹podæ§åˆ¶å™¨å’Œpodä¹‹é—´çš„å…³è”å…³ç³»ï¼Œé‡‡ç”¨çš„Label Selectoræœºåˆ¶</li>
<li>åœ¨podæ¨¡æ¿ä¸Šå®šä¹‰labelï¼Œåœ¨æ§åˆ¶å™¨ä¸Šå®šä¹‰é€‰æ‹©å™¨ï¼Œå°±å¯ä»¥è¡¨æ˜å½“å‰æ§åˆ¶å™¨èƒ½ç®¡ç†å“ªäº›podäº†</li>
<li>templateï¼šæ¨¡æ¿ï¼Œå°±æ˜¯å½“å‰æ§åˆ¶å™¨åˆ›å»ºpodæ‰€ä½¿ç”¨çš„æ¨¡æ¿æ¿ï¼Œé‡Œé¢å…¶å®å°±æ˜¯å‰ä¸€ç« å­¦è¿‡çš„podçš„å®šä¹‰</li>
</ul></div>
<p class="component-content component"><strong>åˆ›å»ºReplicaSet</strong></p>
<p class="component-content component">åˆ›å»ºpc-replicaset.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ReplicaSet   </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pc-replicaset</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>: 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx-pod</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx-pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span></span></span></code></pre></div></div>
  
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºrs</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pc-replicaset.yaml</span>
</span></span><span style="display:flex;"><span>replicaset.apps/pc-replicaset created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹rs</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># DESIRED:æœŸæœ›å‰¯æœ¬æ•°é‡  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># CURRENT:å½“å‰å‰¯æœ¬æ•°é‡  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># READY:å·²ç»å‡†å¤‡å¥½æä¾›æœåŠ¡çš„å‰¯æœ¬æ•°é‡</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get rs pc-replicaset -n dev -o wide</span>
</span></span><span style="display:flex;"><span>NAME          DESIRED   CURRENT READY AGE   CONTAINERS   IMAGES             SELECTOR
</span></span><span style="display:flex;"><span>pc-replicaset <span style="color:#ae81ff">3</span>         <span style="color:#ae81ff">3</span>       <span style="color:#ae81ff">3</span>     22s   nginx        nginx:1.17.1       app<span style="color:#f92672">=</span>nginx-pod
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹å½“å‰æ§åˆ¶å™¨åˆ›å»ºå‡ºæ¥çš„pod</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¿™é‡Œå‘ç°æ§åˆ¶å™¨åˆ›å»ºå‡ºæ¥çš„podçš„åç§°æ˜¯åœ¨æ§åˆ¶å™¨åç§°åé¢æ‹¼æ¥äº†-xxxxxéšæœºç </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pod -n dev</span>
</span></span><span style="display:flex;"><span>NAME                          READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pc-replicaset-6vmvt   1/1     Running   <span style="color:#ae81ff">0</span>          54s
</span></span><span style="display:flex;"><span>pc-replicaset-fmb8f   1/1     Running   <span style="color:#ae81ff">0</span>          54s
</span></span><span style="display:flex;"><span>pc-replicaset-snrk2   1/1     Running   <span style="color:#ae81ff">0</span>          54s</span></span></code></pre></div></div>
  
</div><p class="component-content component">æ‰©ç¼©å®¹</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ç¼–è¾‘rsçš„å‰¯æœ¬æ•°é‡ï¼Œä¿®æ”¹spec:replicas: 6å³å¯</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl edit rs pc-replicaset -n dev</span>
</span></span><span style="display:flex;"><span>replicaset.apps/pc-replicaset edited
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods -n dev</span>
</span></span><span style="display:flex;"><span>NAME                          READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pc-replicaset-6vmvt   1/1     Running   <span style="color:#ae81ff">0</span>          114m
</span></span><span style="display:flex;"><span>pc-replicaset-cftnp   1/1     Running   <span style="color:#ae81ff">0</span>          10s
</span></span><span style="display:flex;"><span>pc-replicaset-fjlm6   1/1     Running   <span style="color:#ae81ff">0</span>          10s
</span></span><span style="display:flex;"><span>pc-replicaset-fmb8f   1/1     Running   <span style="color:#ae81ff">0</span>          114m
</span></span><span style="display:flex;"><span>pc-replicaset-s2whj   1/1     Running   <span style="color:#ae81ff">0</span>          10s
</span></span><span style="display:flex;"><span>pc-replicaset-snrk2   1/1     Running   <span style="color:#ae81ff">0</span>          114m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å‘½ä»¤å®ç°</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨scaleå‘½ä»¤å®ç°æ‰©ç¼©å®¹ï¼Œ åé¢--replicas=nç›´æ¥æŒ‡å®šç›®æ ‡æ•°é‡å³å¯</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl scale rs pc-replicaset --replicas=2 -n dev</span>
</span></span><span style="display:flex;"><span>replicaset.apps/pc-replicaset scaled
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‘½ä»¤è¿è¡Œå®Œæ¯•ï¼Œç«‹å³æŸ¥çœ‹ï¼Œå‘ç°å·²ç»æœ‰4ä¸ªå¼€å§‹å‡†å¤‡é€€å‡ºäº†</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods -n dev</span>
</span></span><span style="display:flex;"><span>NAME                       READY   STATUS        RESTARTS   AGE
</span></span><span style="display:flex;"><span>pc-replicaset-6vmvt   0/1     Terminating   <span style="color:#ae81ff">0</span>          118m
</span></span><span style="display:flex;"><span>pc-replicaset-cftnp   0/1     Terminating   <span style="color:#ae81ff">0</span>          4m17s
</span></span><span style="display:flex;"><span>pc-replicaset-fjlm6   0/1     Terminating   <span style="color:#ae81ff">0</span>          4m17s
</span></span><span style="display:flex;"><span>pc-replicaset-fmb8f   1/1     Running       <span style="color:#ae81ff">0</span>          118m
</span></span><span style="display:flex;"><span>pc-replicaset-s2whj   0/1     Terminating   <span style="color:#ae81ff">0</span>          4m17s
</span></span><span style="display:flex;"><span>pc-replicaset-snrk2   1/1     Running       <span style="color:#ae81ff">0</span>          118m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ç¨ç­‰ç‰‡åˆ»ï¼Œå°±åªå‰©ä¸‹2ä¸ªäº†</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods -n dev</span>
</span></span><span style="display:flex;"><span>NAME                       READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pc-replicaset-fmb8f   1/1     Running   <span style="color:#ae81ff">0</span>          119m
</span></span><span style="display:flex;"><span>pc-replicaset-snrk2   1/1     Running   <span style="color:#ae81ff">0</span>          119m</span></span></code></pre></div></div>
  
</div><p class="component-content component">é•œåƒå‡çº§</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ç¼–è¾‘rsçš„å®¹å™¨é•œåƒ - image: nginx:1.17.2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl edit rs pc-replicaset -n dev</span>
</span></span><span style="display:flex;"><span>replicaset.apps/pc-replicaset edited
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç°é•œåƒç‰ˆæœ¬å·²ç»å˜æ›´äº†</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get rs -n dev -o wide</span>
</span></span><span style="display:flex;"><span>NAME                DESIRED  CURRENT   READY   AGE    CONTAINERS   IMAGES        ...
</span></span><span style="display:flex;"><span>pc-replicaset       <span style="color:#ae81ff">2</span>        <span style="color:#ae81ff">2</span>         <span style="color:#ae81ff">2</span>       140m   nginx         nginx:1.17.2  ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åŒæ ·çš„é“ç†ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤å®Œæˆè¿™ä¸ªå·¥ä½œ</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># kubectl set image rs rsåç§° å®¹å™¨=é•œåƒç‰ˆæœ¬ -n namespace</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl set image rs pc-replicaset nginx=nginx:1.17.1  -n dev</span>
</span></span><span style="display:flex;"><span>replicaset.apps/pc-replicaset image updated
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç°é•œåƒç‰ˆæœ¬å·²ç»å˜æ›´äº†</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get rs -n dev -o wide</span>
</span></span><span style="display:flex;"><span>NAME                 DESIRED  CURRENT   READY   AGE    CONTAINERS   IMAGES            ...
</span></span><span style="display:flex;"><span>pc-replicaset        <span style="color:#ae81ff">2</span>        <span style="color:#ae81ff">2</span>         <span style="color:#ae81ff">2</span>       145m   nginx        nginx:1.17.1 ... </span></span></code></pre></div></div>
  
</div><p class="component-content component">åˆ é™¤ReplicaSet</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨kubectl deleteå‘½ä»¤ä¼šåˆ é™¤æ­¤RSä»¥åŠå®ƒç®¡ç†çš„Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨kubernetesåˆ é™¤RSå‰ï¼Œä¼šå°†RSçš„replicasclearè°ƒæ•´ä¸º0ï¼Œç­‰å¾…æ‰€æœ‰çš„Podè¢«åˆ é™¤åï¼Œåœ¨æ‰§è¡ŒRSå¯¹è±¡çš„åˆ é™¤</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl delete rs pc-replicaset -n dev</span>
</span></span><span style="display:flex;"><span>replicaset.apps <span style="color:#e6db74">&#34;pc-replicaset&#34;</span> deleted
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pod -n dev -o wide</span>
</span></span><span style="display:flex;"><span>No resources found in dev namespace.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¦‚æœå¸Œæœ›ä»…ä»…åˆ é™¤RSå¯¹è±¡ï¼ˆä¿ç•™Podï¼‰ï¼Œå¯ä»¥ä½¿ç”¨kubectl deleteå‘½ä»¤æ—¶æ·»åŠ --cascade=falseé€‰é¡¹ï¼ˆä¸æ¨èï¼‰ã€‚</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl delete rs pc-replicaset -n dev --cascade=false</span>
</span></span><span style="display:flex;"><span>replicaset.apps <span style="color:#e6db74">&#34;pc-replicaset&#34;</span> deleted
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods -n dev</span>
</span></span><span style="display:flex;"><span>NAME                  READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pc-replicaset-cl82j   1/1     Running   <span style="color:#ae81ff">0</span>          75s
</span></span><span style="display:flex;"><span>pc-replicaset-dslhb   1/1     Running   <span style="color:#ae81ff">0</span>          75s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¹Ÿå¯ä»¥ä½¿ç”¨yamlç›´æ¥åˆ é™¤(æ¨è)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl delete -f pc-replicaset.yaml</span>
</span></span><span style="display:flex;"><span>replicaset.apps <span style="color:#e6db74">&#34;pc-replicaset&#34;</span> deleted</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h2 id="ä¸‰deploymentdeploy" class="pagebody-header">
    ä¸‰ã€Deployment(Deploy)
  </h2>
</div><p class="component-content component">ä¸ºäº†æ›´å¥½çš„è§£å†³æœåŠ¡ç¼–æ’çš„é—®é¢˜ï¼Œkubernetesåœ¨V1.2ç‰ˆæœ¬å¼€å§‹ï¼Œå¼•å…¥äº†Deploymentæ§åˆ¶å™¨ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¿™ç§æ§åˆ¶å™¨å¹¶ä¸ç›´æ¥ç®¡ç†podï¼Œè€Œæ˜¯é€šè¿‡ç®¡ç†ReplicaSetæ¥ç®€ä»‹ç®¡ç†Podï¼Œå³ï¼šDeploymentç®¡ç†ReplicaSetï¼ŒReplicaSetç®¡ç†Podã€‚æ‰€ä»¥Deploymentæ¯”ReplicaSetåŠŸèƒ½æ›´åŠ å¼ºå¤§ã€‚</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-cdeafd4d7a9b22c7035bd81c7d43d9c1" id="lhtcdeafd4d7a9b22c7035bd81c7d43d9c1">
        <picture  class="picture">
          <img class="picture-image" data-src="https://aabb-2023.oss-cn-beijing.aliyuncs.com/202308210840290.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">Deploymentä¸»è¦åŠŸèƒ½æœ‰ä¸‹é¢å‡ ä¸ªï¼š</p>
<div class="component-content component"><ul>
<li>æ”¯æŒReplicaSetçš„æ‰€æœ‰åŠŸèƒ½</li>
<li>æ”¯æŒå‘å¸ƒçš„åœæ­¢ã€ç»§ç»­</li>
<li>æ”¯æŒæ»šåŠ¨å‡çº§å’Œå›æ»šç‰ˆæœ¬</li>
</ul></div>
<p class="component-content component">Deploymentçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span> <span style="color:#75715e"># ç‰ˆæœ¬å·</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span> <span style="color:#75715e"># ç±»å‹       </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>: <span style="color:#75715e"># å…ƒæ•°æ®</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#75715e"># rsåç§° </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#75715e"># æ‰€å±å‘½åç©ºé—´ </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>: <span style="color:#75715e">#æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">controller</span>: <span style="color:#ae81ff">deploy</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>: <span style="color:#75715e"># è¯¦æƒ…æè¿°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span> <span style="color:#75715e"># å‰¯æœ¬æ•°é‡</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">revisionHistoryLimit</span>: <span style="color:#ae81ff">3</span> <span style="color:#75715e"># ä¿ç•™å†å²ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">paused</span>: <span style="color:#66d9ef">false</span> <span style="color:#75715e"># æš‚åœéƒ¨ç½²ï¼Œé»˜è®¤æ˜¯false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">progressDeadlineSeconds</span>: <span style="color:#ae81ff">600</span> <span style="color:#75715e"># éƒ¨ç½²è¶…æ—¶æ—¶é—´ï¼ˆsï¼‰ï¼Œé»˜è®¤æ˜¯600</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>: <span style="color:#75715e"># ç­–ç•¥</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate</span> <span style="color:#75715e"># æ»šåŠ¨æ›´æ–°ç­–ç•¥</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>: <span style="color:#75715e"># æ»šåŠ¨æ›´æ–°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxè¿è§„è¯æ±‡</span>: <span style="color:#ae81ff">30</span><span style="color:#ae81ff">%</span> <span style="color:#75715e"># æœ€å¤§é¢å¤–å¯ä»¥å­˜åœ¨çš„å‰¯æœ¬æ•°ï¼Œå¯ä»¥ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">30</span><span style="color:#ae81ff">%</span> <span style="color:#75715e"># æœ€å¤§ä¸å¯ç”¨çŠ¶æ€çš„ Pod çš„æœ€å¤§å€¼ï¼Œå¯ä»¥ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>: <span style="color:#75715e"># é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:      <span style="color:#75715e"># LabelsåŒ¹é…è§„åˆ™</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx-pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchExpressions</span>: <span style="color:#75715e"># ExpressionsåŒ¹é…è§„åˆ™</span>
</span></span><span style="display:flex;"><span>      - {<span style="color:#f92672">key: app, operator: In, values</span>: [<span style="color:#ae81ff">nginx-pod]}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>: <span style="color:#75715e"># æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx-pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="31-åˆ›å»ºdeployment" class="pagebody-header">
    3.1 åˆ›å»ºdeployment
  </h3>
</div><p class="component-content component">åˆ›å»ºpc-deployment.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment      </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pc-deployment</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>: 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx-pod</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx-pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span></span></span></code></pre></div></div>
  
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºdeployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pc-deployment.yaml --record=true</span>
</span></span><span style="display:flex;"><span>deployment.apps/pc-deployment created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># UP-TO-DATE æœ€æ–°ç‰ˆæœ¬çš„podçš„æ•°é‡</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># AVAILABLE  å½“å‰å¯ç”¨çš„podçš„æ•°é‡</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get deploy pc-deployment -n dev</span>
</span></span><span style="display:flex;"><span>NAME            READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style="display:flex;"><span>pc-deployment   3/3     <span style="color:#ae81ff">3</span>            <span style="color:#ae81ff">3</span>           15s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹rs</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‘ç°rsçš„åç§°æ˜¯åœ¨åŸæ¥deploymentçš„åå­—åé¢æ·»åŠ äº†ä¸€ä¸ª10ä½æ•°çš„éšæœºä¸²</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get rs -n dev</span>
</span></span><span style="display:flex;"><span>NAME                       DESIRED   CURRENT   READY   AGE
</span></span><span style="display:flex;"><span>pc-deployment-6696798b78   <span style="color:#ae81ff">3</span>         <span style="color:#ae81ff">3</span>         <span style="color:#ae81ff">3</span>       23s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods -n dev</span>
</span></span><span style="display:flex;"><span>NAME                             READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pc-deployment-6696798b78-d2c8n   1/1     Running   <span style="color:#ae81ff">0</span>          107s
</span></span><span style="display:flex;"><span>pc-deployment-6696798b78-smpvp   1/1     Running   <span style="color:#ae81ff">0</span>          107s
</span></span><span style="display:flex;"><span>pc-deployment-6696798b78-wvjd8   1/1     Running   <span style="color:#ae81ff">0</span>          107s</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="32-æ‰©ç¼©å®¹" class="pagebody-header">
    3.2 æ‰©ç¼©å®¹
  </h3>
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># å˜æ›´å‰¯æœ¬æ•°é‡ä¸º5ä¸ª</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl scale deploy pc-deployment --replicas=5  -n dev</span>
</span></span><span style="display:flex;"><span>deployment.apps/pc-deployment scaled
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get deploy pc-deployment -n dev</span>
</span></span><span style="display:flex;"><span>NAME            READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style="display:flex;"><span>pc-deployment   5/5     <span style="color:#ae81ff">5</span>            <span style="color:#ae81ff">5</span>           2m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e">#  kubectl get pods -n dev</span>
</span></span><span style="display:flex;"><span>NAME                             READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pc-deployment-6696798b78-d2c8n   1/1     Running   <span style="color:#ae81ff">0</span>          4m19s
</span></span><span style="display:flex;"><span>pc-deployment-6696798b78-jxmdq   1/1     Running   <span style="color:#ae81ff">0</span>          94s
</span></span><span style="display:flex;"><span>pc-deployment-6696798b78-mktqv   1/1     Running   <span style="color:#ae81ff">0</span>          93s
</span></span><span style="display:flex;"><span>pc-deployment-6696798b78-smpvp   1/1     Running   <span style="color:#ae81ff">0</span>          4m19s
</span></span><span style="display:flex;"><span>pc-deployment-6696798b78-wvjd8   1/1     Running   <span style="color:#ae81ff">0</span>          4m19s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¼–è¾‘deploymentçš„å‰¯æœ¬æ•°é‡ï¼Œä¿®æ”¹spec:replicas: 4å³å¯</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl edit deploy pc-deployment -n dev</span>
</span></span><span style="display:flex;"><span>deployment.apps/pc-deployment edited
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods -n dev</span>
</span></span><span style="display:flex;"><span>NAME                             READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pc-deployment-6696798b78-d2c8n   1/1     Running   <span style="color:#ae81ff">0</span>          5m23s
</span></span><span style="display:flex;"><span>pc-deployment-6696798b78-jxmdq   1/1     Running   <span style="color:#ae81ff">0</span>          2m38s
</span></span><span style="display:flex;"><span>pc-deployment-6696798b78-smpvp   1/1     Running   <span style="color:#ae81ff">0</span>          5m23s
</span></span><span style="display:flex;"><span>pc-deployment-6696798b78-wvjd8   1/1     Running   <span style="color:#ae81ff">0</span>          5m23s</span></span></code></pre></div></div>
  
</div><p class="component-content component">é•œåƒæ›´æ–°</p>
<p class="component-content component"><code>deployment</code>æ”¯æŒä¸¤ç§æ›´æ–°ç­–ç•¥:<code>é‡å»ºæ›´æ–°</code>å’Œ<code>æ»šåŠ¨æ›´æ–°</code>,å¯ä»¥é€šè¿‡<code>strategy</code>æŒ‡å®šç­–ç•¥ç±»å‹,æ”¯æŒä¸¤ä¸ªå±æ€§:</p>
<blockquote>
<p class="component-content component">strategyï¼šæŒ‡å®šæ–°çš„Podæ›¿æ¢æ—§çš„Podçš„ç­–ç•¥ï¼Œ æ”¯æŒä¸¤ä¸ªå±æ€§ï¼š
typeï¼šæŒ‡å®šç­–ç•¥ç±»å‹ï¼Œæ”¯æŒä¸¤ç§ç­–ç•¥
Recreateï¼šåœ¨åˆ›å»ºå‡ºæ–°çš„Podä¹‹å‰ä¼šå…ˆæ€æ‰æ‰€æœ‰å·²å­˜åœ¨çš„Pod
RollingUpdateï¼šæ»šåŠ¨æ›´æ–°ï¼Œå°±æ˜¯æ€æ­»ä¸€éƒ¨åˆ†ï¼Œå°±å¯åŠ¨ä¸€éƒ¨åˆ†ï¼Œåœ¨æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸¤ä¸ªç‰ˆæœ¬Pod
rollingUpdateï¼šå½“typeä¸ºRollingUpdateæ—¶ç”Ÿæ•ˆï¼Œç”¨äºä¸ºRollingUpdateè®¾ç½®å‚æ•°ï¼Œæ”¯æŒä¸¤ä¸ªå±æ€§ï¼š
maxUnavailableï¼šç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­ä¸å¯ç”¨Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%ã€‚
maxè¿è§„è¯æ±‡ï¼š ç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­å¯ä»¥è¶…è¿‡æœŸæœ›çš„Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%ã€‚</p>
</blockquote>
<p class="component-content component">é‡å»ºæ›´æ–°</p>
<div class="component-content component"><ol>
<li>ç¼–è¾‘pc-deployment.yaml,åœ¨specèŠ‚ç‚¹ä¸‹æ·»åŠ æ›´æ–°ç­–ç•¥</li>
</ol></div>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>: <span style="color:#75715e"># ç­–ç•¥</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Recreate</span> <span style="color:#75715e"># é‡å»ºæ›´æ–°</span></span></span></code></pre></div></div>
  
</div><ol start="2">
<li>åˆ›å»ºdeployè¿›è¡ŒéªŒè¯</li>
</ol></div>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># å˜æ›´é•œåƒ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl set image deployment pc-deployment nginx=nginx:1.17.2 -n dev</span>
</span></span><span style="display:flex;"><span>deployment.apps/pc-deployment image updated
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è§‚å¯Ÿå‡çº§è¿‡ç¨‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e">#  kubectl get pods -n dev -w</span>
</span></span><span style="display:flex;"><span>NAME                             READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-65qcw   1/1     Running   <span style="color:#ae81ff">0</span>          31s
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-w5nzv   1/1     Running   <span style="color:#ae81ff">0</span>          31s
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-xpt7w   1/1     Running   <span style="color:#ae81ff">0</span>          31s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-xpt7w   1/1     Terminating   <span style="color:#ae81ff">0</span>          41s
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-65qcw   1/1     Terminating   <span style="color:#ae81ff">0</span>          41s
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-w5nzv   1/1     Terminating   <span style="color:#ae81ff">0</span>          41s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pc-deployment-675d469f8b-grn8z   0/1     Pending       <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>pc-deployment-675d469f8b-hbl4v   0/1     Pending       <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>pc-deployment-675d469f8b-67nz2   0/1     Pending       <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pc-deployment-675d469f8b-grn8z   0/1     ContainerCreating   <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>pc-deployment-675d469f8b-hbl4v   0/1     ContainerCreating   <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>pc-deployment-675d469f8b-67nz2   0/1     ContainerCreating   <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pc-deployment-675d469f8b-grn8z   1/1     Running             <span style="color:#ae81ff">0</span>          1s
</span></span><span style="display:flex;"><span>pc-deployment-675d469f8b-67nz2   1/1     Running             <span style="color:#ae81ff">0</span>          1s
</span></span><span style="display:flex;"><span>pc-deployment-675d469f8b-hbl4v   1/1     Running             <span style="color:#ae81ff">0</span>          2s</span></span></code></pre></div></div>
  
</div><p class="component-content component">æ»šåŠ¨æ›´æ–°</p>
<div class="component-content component"><ol>
<li>ç¼–è¾‘pc-deployment.yaml,åœ¨specèŠ‚ç‚¹ä¸‹æ·»åŠ æ›´æ–°ç­–ç•¥</li>
</ol></div>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>: <span style="color:#75715e"># ç­–ç•¥</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate</span> <span style="color:#75715e"># æ»šåŠ¨æ›´æ–°ç­–ç•¥</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxè¿è§„è¯æ±‡</span>: <span style="color:#ae81ff">25</span><span style="color:#ae81ff">% </span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">25</span><span style="color:#ae81ff">%</span></span></span></code></pre></div></div>
  
</div><ol start="2">
<li>åˆ›å»ºdeployè¿›è¡ŒéªŒè¯</li>
</ol></div>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># å˜æ›´é•œåƒ</span>
</span></span><span style="display:flex;"><span>[<span style="color:#ae81ff">root@k8s-master01 ~]# kubectl set image deployment pc-deployment nginx=nginx:1.17.3 -n dev </span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">deployment.apps/pc-deployment image updated</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è§‚å¯Ÿå‡çº§è¿‡ç¨‹</span>
</span></span><span style="display:flex;"><span>[<span style="color:#ae81ff">root@k8s-master01 ~]# kubectl get pods -n dev -w</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">NAME                           READY   STATUS    RESTARTS   AGE</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">pc-deployment-c848d767-8rbzt   1/1     Running   0          31m</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">pc-deployment-c848d767-h4p68   1/1     Running   0          31m</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">pc-deployment-c848d767-hlmz4   1/1     Running   0          31m</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">pc-deployment-c848d767-rrqcn   1/1     Running   0          31m</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">pc-deployment-966bf7f44-226rx   0/1     Pending             0          0s</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">pc-deployment-966bf7f44-226rx   0/1     ContainerCreating   0          0s</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">pc-deployment-966bf7f44-226rx   1/1     Running             0          1s</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">pc-deployment-c848d767-h4p68    0/1     Terminating         0          34m</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">pc-deployment-966bf7f44-cnd44   0/1     Pending             0          0s</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">pc-deployment-966bf7f44-cnd44   0/1     ContainerCreating   0          0s</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">pc-deployment-966bf7f44-cnd44   1/1     Running             0          2s</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">pc-deployment-c848d767-hlmz4    0/1     Terminating         0          34m</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">pc-deployment-966bf7f44-px48p   0/1     Pending             0          0s</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">pc-deployment-966bf7f44-px48p   0/1     ContainerCreating   0          0s</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">pc-deployment-966bf7f44-px48p   1/1     Running             0          0s</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">pc-deployment-c848d767-8rbzt    0/1     Terminating         0          34m</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">pc-deployment-966bf7f44-dkmqp   0/1     Pending             0          0s</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">pc-deployment-966bf7f44-dkmqp   0/1     ContainerCreating   0          0s</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">pc-deployment-966bf7f44-dkmqp   1/1     Running             0          2s</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">pc-deployment-c848d767-rrqcn    0/1     Terminating         0          34m</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è‡³æ­¤ï¼Œæ–°ç‰ˆæœ¬çš„podåˆ›å»ºå®Œæ¯•ï¼Œå°±ç‰ˆæœ¬çš„podé”€æ¯å®Œæ¯•</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸­é—´è¿‡ç¨‹æ˜¯æ»šåŠ¨è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¾¹é”€æ¯è¾¹åˆ›å»º</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">æ»šåŠ¨æ›´æ–°çš„è¿‡ç¨‹ï¼š</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-eb23a41fda4ae0fb708c030c125717d4" id="lhteb23a41fda4ae0fb708c030c125717d4">
        <picture  class="picture">
          <img class="picture-image" data-src="https://aabb-2023.oss-cn-beijing.aliyuncs.com/202308210841230.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">é•œåƒæ›´æ–°ä¸­rsçš„å˜åŒ–</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹rs,å‘ç°åŸæ¥çš„rsçš„ä¾æ—§å­˜åœ¨ï¼Œåªæ˜¯podæ•°é‡å˜ä¸ºäº†0ï¼Œè€Œååˆæ–°äº§ç”Ÿäº†ä¸€ä¸ªrsï¼Œpodæ•°é‡ä¸º4</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å…¶å®è¿™å°±æ˜¯deploymentèƒ½å¤Ÿè¿›è¡Œç‰ˆæœ¬å›é€€çš„å¥¥å¦™æ‰€åœ¨ï¼Œåé¢ä¼šè¯¦ç»†è§£é‡Š</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get rs -n dev</span>
</span></span><span style="display:flex;"><span>NAME                       DESIRED   CURRENT   READY   AGE
</span></span><span style="display:flex;"><span>pc-deployment-6696798b78   <span style="color:#ae81ff">0</span>         <span style="color:#ae81ff">0</span>         <span style="color:#ae81ff">0</span>       7m37s
</span></span><span style="display:flex;"><span>pc-deployment-6696798b11   <span style="color:#ae81ff">0</span>         <span style="color:#ae81ff">0</span>         <span style="color:#ae81ff">0</span>       5m37s
</span></span><span style="display:flex;"><span>pc-deployment-c848d76789   <span style="color:#ae81ff">4</span>         <span style="color:#ae81ff">4</span>         <span style="color:#ae81ff">4</span>       72s</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="33-ç‰ˆæœ¬å›é€€" class="pagebody-header">
    3.3 ç‰ˆæœ¬å›é€€
  </h3>
</div><p class="component-content component">deploymentæ”¯æŒç‰ˆæœ¬å‡çº§è¿‡ç¨‹ä¸­çš„æš‚åœã€ç»§ç»­åŠŸèƒ½ä»¥åŠç‰ˆæœ¬å›é€€ç­‰è¯¸å¤šåŠŸèƒ½ï¼Œä¸‹é¢å…·ä½“æ¥çœ‹.</p>
<p class="component-content component">kubectl rolloutï¼š ç‰ˆæœ¬å‡çº§ç›¸å…³åŠŸèƒ½ï¼Œæ”¯æŒä¸‹é¢çš„é€‰é¡¹ï¼š</p>
<div class="component-content component"><ul>
<li>status æ˜¾ç¤ºå½“å‰å‡çº§çŠ¶æ€</li>
<li>history æ˜¾ç¤º å‡çº§å†å²è®°å½•</li>
<li>pause æš‚åœç‰ˆæœ¬å‡çº§è¿‡ç¨‹</li>
<li>resume ç»§ç»­å·²ç»æš‚åœçš„ç‰ˆæœ¬å‡çº§è¿‡ç¨‹</li>
<li>restart é‡å¯ç‰ˆæœ¬å‡çº§è¿‡ç¨‹</li>
<li>undo å›æ»šåˆ°ä¸Šä¸€çº§ç‰ˆæœ¬ï¼ˆå¯ä»¥ä½¿ç”¨â€“to-revisionå›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬ï¼‰</li>
</ul></div>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹å½“å‰å‡çº§ç‰ˆæœ¬çš„çŠ¶æ€</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl rollout status deploy pc-deployment -n dev</span>
</span></span><span style="display:flex;"><span>deployment <span style="color:#e6db74">&#34;pc-deployment&#34;</span> successfully rolled out
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹å‡çº§å†å²è®°å½•</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl rollout history deploy pc-deployment -n dev</span>
</span></span><span style="display:flex;"><span>deployment.apps/pc-deployment
</span></span><span style="display:flex;"><span>REVISION  CHANGE-CAUSE
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>         kubectl create --filename<span style="color:#f92672">=</span>pc-deployment.yaml --record<span style="color:#f92672">=</span>true
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>         kubectl create --filename<span style="color:#f92672">=</span>pc-deployment.yaml --record<span style="color:#f92672">=</span>true
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span>         kubectl create --filename<span style="color:#f92672">=</span>pc-deployment.yaml --record<span style="color:#f92672">=</span>true
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯ä»¥å‘ç°æœ‰ä¸‰æ¬¡ç‰ˆæœ¬è®°å½•ï¼Œè¯´æ˜å®Œæˆè¿‡ä¸¤æ¬¡å‡çº§</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç‰ˆæœ¬å›æ»š</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¿™é‡Œç›´æ¥ä½¿ç”¨--to-revision=1å›æ»šåˆ°äº†1ç‰ˆæœ¬ï¼Œ å¦‚æœçœç•¥è¿™ä¸ªé€‰é¡¹ï¼Œå°±æ˜¯å›é€€åˆ°ä¸Šä¸ªç‰ˆæœ¬ï¼Œå°±æ˜¯2ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl rollout undo deployment pc-deployment --to-revision=1 -n dev</span>
</span></span><span style="display:flex;"><span>deployment.apps/pc-deployment rolled back
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹å‘ç°ï¼Œé€šè¿‡nginxé•œåƒç‰ˆæœ¬å¯ä»¥å‘ç°åˆ°äº†ç¬¬ä¸€ç‰ˆ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get deploy -n dev -o wide</span>
</span></span><span style="display:flex;"><span>NAME            READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES         
</span></span><span style="display:flex;"><span>pc-deployment   4/4     <span style="color:#ae81ff">4</span>            <span style="color:#ae81ff">4</span>           74m   nginx        nginx:1.17.1   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹rsï¼Œå‘ç°ç¬¬ä¸€ä¸ªrsä¸­æœ‰4ä¸ªpodè¿è¡Œï¼Œåé¢ä¸¤ä¸ªç‰ˆæœ¬çš„rsä¸­podä¸ºè¿è¡Œ</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å…¶å®deploymentä¹‹æ‰€ä»¥å¯æ˜¯å®ç°ç‰ˆæœ¬çš„å›æ»šï¼Œå°±æ˜¯é€šè¿‡è®°å½•ä¸‹å†å²rsæ¥å®ç°çš„ï¼Œ</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸€æ—¦æƒ³å›æ»šåˆ°å“ªä¸ªç‰ˆæœ¬ï¼Œåªéœ€è¦å°†å½“å‰ç‰ˆæœ¬podæ•°é‡é™ä¸º0ï¼Œç„¶åå°†å›æ»šç‰ˆæœ¬çš„podæå‡ä¸ºç›®æ ‡æ•°é‡å°±å¯ä»¥äº†</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get rs -n dev</span>
</span></span><span style="display:flex;"><span>NAME                       DESIRED   CURRENT   READY   AGE
</span></span><span style="display:flex;"><span>pc-deployment-6696798b78   <span style="color:#ae81ff">4</span>         <span style="color:#ae81ff">4</span>         <span style="color:#ae81ff">4</span>       78m
</span></span><span style="display:flex;"><span>pc-deployment-966bf7f44    <span style="color:#ae81ff">0</span>         <span style="color:#ae81ff">0</span>         <span style="color:#ae81ff">0</span>       37m
</span></span><span style="display:flex;"><span>pc-deployment-c848d767     <span style="color:#ae81ff">0</span>         <span style="color:#ae81ff">0</span>         <span style="color:#ae81ff">0</span>       71m</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="34-é‡‘ä¸é›€å‘å¸ƒ" class="pagebody-header">
    3.4 é‡‘ä¸é›€å‘å¸ƒ
  </h3>
</div><p class="component-content component">Deploymentæ§åˆ¶å™¨æ”¯æŒæ§åˆ¶æ›´æ–°è¿‡ç¨‹ä¸­çš„æ§åˆ¶ï¼Œå¦‚â€œæš‚åœ(pause)â€æˆ–â€œç»§ç»­(resume)â€æ›´æ–°æ“ä½œã€‚</p>
<p class="component-content component">æ¯”å¦‚æœ‰ä¸€æ‰¹æ–°çš„Podèµ„æºåˆ›å»ºå®Œæˆåç«‹å³æš‚åœæ›´æ–°è¿‡ç¨‹ï¼Œæ­¤æ—¶ï¼Œä»…å­˜åœ¨ä¸€éƒ¨åˆ†æ–°ç‰ˆæœ¬çš„åº”ç”¨ï¼Œä¸»ä½“éƒ¨åˆ†è¿˜æ˜¯æ—§çš„ç‰ˆæœ¬ã€‚ç„¶åï¼Œå†ç­›é€‰ä¸€å°éƒ¨åˆ†çš„ç”¨æˆ·è¯·æ±‚è·¯ç”±åˆ°æ–°ç‰ˆæœ¬çš„Podåº”ç”¨ï¼Œç»§ç»­è§‚å¯Ÿèƒ½å¦ç¨³å®šåœ°æŒ‰æœŸæœ›çš„æ–¹å¼è¿è¡Œã€‚ç¡®å®šæ²¡é—®é¢˜ä¹‹åå†ç»§ç»­å®Œæˆä½™ä¸‹çš„Podèµ„æºæ»šåŠ¨æ›´æ–°ï¼Œå¦åˆ™ç«‹å³å›æ»šæ›´æ–°æ“ä½œã€‚è¿™å°±æ˜¯æ‰€è°“çš„é‡‘ä¸é›€å‘å¸ƒã€‚</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æ›´æ–°deploymentçš„ç‰ˆæœ¬ï¼Œå¹¶é…ç½®æš‚åœdeployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e">#  kubectl set image deploy pc-deployment nginx=nginx:1.17.4 -n dev &amp;&amp; kubectl rollout pause deployment pc-deployment  -n dev</span>
</span></span><span style="display:flex;"><span>deployment.apps/pc-deployment image updated
</span></span><span style="display:flex;"><span>deployment.apps/pc-deployment paused
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#è§‚å¯Ÿæ›´æ–°çŠ¶æ€</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl rollout status deploy pc-deployment -n devã€€</span>
</span></span><span style="display:flex;"><span>Waiting <span style="color:#66d9ef">for</span> deployment <span style="color:#e6db74">&#34;pc-deployment&#34;</span> rollout to finish: <span style="color:#ae81ff">2</span> out of <span style="color:#ae81ff">4</span> new replicas have been updated...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç›‘æ§æ›´æ–°çš„è¿‡ç¨‹ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»æ–°å¢äº†ä¸€ä¸ªèµ„æºï¼Œä½†æ˜¯å¹¶æœªæŒ‰ç…§é¢„æœŸçš„çŠ¶æ€å»åˆ é™¤ä¸€ä¸ªæ—§çš„èµ„æºï¼Œå°±æ˜¯å› ä¸ºä½¿ç”¨äº†pauseæš‚åœå‘½ä»¤</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get rs -n dev -o wide</span>
</span></span><span style="display:flex;"><span>NAME                       DESIRED   CURRENT   READY   AGE     CONTAINERS   IMAGES         
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9   <span style="color:#ae81ff">3</span>         <span style="color:#ae81ff">3</span>         <span style="color:#ae81ff">3</span>       19m     nginx        nginx:1.17.1   
</span></span><span style="display:flex;"><span>pc-deployment-675d469f8b   <span style="color:#ae81ff">0</span>         <span style="color:#ae81ff">0</span>         <span style="color:#ae81ff">0</span>       14m     nginx        nginx:1.17.2   
</span></span><span style="display:flex;"><span>pc-deployment-6c9f56fcfb   <span style="color:#ae81ff">2</span>         <span style="color:#ae81ff">2</span>         <span style="color:#ae81ff">2</span>       3m16s   nginx        nginx:1.17.4   
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods -n dev</span>
</span></span><span style="display:flex;"><span>NAME                             READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-rj8sq   1/1     Running   <span style="color:#ae81ff">0</span>          7m33s
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-ttwgg   1/1     Running   <span style="color:#ae81ff">0</span>          7m35s
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-v4wvc   1/1     Running   <span style="color:#ae81ff">0</span>          7m34s
</span></span><span style="display:flex;"><span>pc-deployment-6c9f56fcfb-996rt   1/1     Running   <span style="color:#ae81ff">0</span>          3m31s
</span></span><span style="display:flex;"><span>pc-deployment-6c9f56fcfb-j2gtj   1/1     Running   <span style="color:#ae81ff">0</span>          3m31s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¡®ä¿æ›´æ–°çš„podæ²¡é—®é¢˜äº†ï¼Œç»§ç»­æ›´æ–°</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl rollout resume deploy pc-deployment -n dev</span>
</span></span><span style="display:flex;"><span>deployment.apps/pc-deployment resumed
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹æœ€åçš„æ›´æ–°æƒ…å†µ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get rs -n dev -o wide</span>
</span></span><span style="display:flex;"><span>NAME                       DESIRED   CURRENT   READY   AGE     CONTAINERS   IMAGES         
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9   <span style="color:#ae81ff">0</span>         <span style="color:#ae81ff">0</span>         <span style="color:#ae81ff">0</span>       21m     nginx        nginx:1.17.1   
</span></span><span style="display:flex;"><span>pc-deployment-675d469f8b   <span style="color:#ae81ff">0</span>         <span style="color:#ae81ff">0</span>         <span style="color:#ae81ff">0</span>       16m     nginx        nginx:1.17.2   
</span></span><span style="display:flex;"><span>pc-deployment-6c9f56fcfb   <span style="color:#ae81ff">4</span>         <span style="color:#ae81ff">4</span>         <span style="color:#ae81ff">4</span>       5m11s   nginx        nginx:1.17.4   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods -n dev</span>
</span></span><span style="display:flex;"><span>NAME                             READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pc-deployment-6c9f56fcfb-7bfwh   1/1     Running   <span style="color:#ae81ff">0</span>          37s
</span></span><span style="display:flex;"><span>pc-deployment-6c9f56fcfb-996rt   1/1     Running   <span style="color:#ae81ff">0</span>          5m27s
</span></span><span style="display:flex;"><span>pc-deployment-6c9f56fcfb-j2gtj   1/1     Running   <span style="color:#ae81ff">0</span>          5m27s
</span></span><span style="display:flex;"><span>pc-deployment-6c9f56fcfb-rf84v   1/1     Running   <span style="color:#ae81ff">0</span>          37s</span></span></code></pre></div></div>
  
</div><p class="component-content component">åˆ é™¤Deployment</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ é™¤deploymentï¼Œå…¶ä¸‹çš„rså’Œpodä¹Ÿå°†è¢«åˆ é™¤</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl delete -f pc-deployment.yaml</span>
</span></span><span style="display:flex;"><span>deployment.apps <span style="color:#e6db74">&#34;pc-deployment&#34;</span> deleted</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h2 id="å››horizontal-pod-autoscalerhpa" class="pagebody-header">
    å››ã€Horizontal Pod Autoscaler(HPA)
  </h2>
</div><p class="component-content component">åœ¨å‰é¢ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å®ç°é€šè¿‡æ‰‹å·¥æ‰§è¡Œkubectl scaleå‘½ä»¤å®ç°Podæ‰©å®¹æˆ–ç¼©å®¹ï¼Œä½†æ˜¯è¿™æ˜¾ç„¶ä¸ç¬¦åˆKubernetesçš„å®šä½ç›®æ ‡â€“è‡ªåŠ¨åŒ–ã€æ™ºèƒ½åŒ–ã€‚ KubernetesæœŸæœ›å¯ä»¥å®ç°é€šè¿‡ç›‘æµ‹Podçš„ä½¿ç”¨æƒ…å†µï¼Œå®ç°podæ•°é‡çš„è‡ªåŠ¨è°ƒæ•´ï¼Œäºæ˜¯å°±äº§ç”Ÿäº†Horizontal Pod Autoscalerï¼ˆHPAï¼‰è¿™ç§æ§åˆ¶å™¨ã€‚</p>
<p class="component-content component">HPAå¯ä»¥è·å–æ¯ä¸ªPodåˆ©ç”¨ç‡ï¼Œç„¶åå’ŒHPAä¸­å®šä¹‰çš„æŒ‡æ ‡è¿›è¡Œå¯¹æ¯”ï¼ŒåŒæ—¶è®¡ç®—å‡ºéœ€è¦ä¼¸ç¼©çš„å…·ä½“å€¼ï¼Œæœ€åå®ç°Podçš„æ•°é‡çš„è°ƒæ•´ã€‚å…¶å®HPAä¸ä¹‹å‰çš„Deploymentä¸€æ ·ï¼Œä¹Ÿå±äºä¸€ç§Kubernetesèµ„æºå¯¹è±¡ï¼Œå®ƒé€šè¿‡è¿½è¸ªåˆ†æRCæ§åˆ¶çš„æ‰€æœ‰ç›®æ ‡Podçš„è´Ÿè½½å˜åŒ–æƒ…å†µï¼Œæ¥ç¡®å®šæ˜¯å¦éœ€è¦é’ˆå¯¹æ€§åœ°è°ƒæ•´ç›®æ ‡Podçš„å‰¯æœ¬æ•°ï¼Œè¿™æ˜¯HPAçš„å®ç°åŸç†ã€‚</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-8ceff66b23e11264c9f7caa0889e799c" id="lht8ceff66b23e11264c9f7caa0889e799c">
        <picture  class="picture">
          <img class="picture-image" data-src="https://aabb-2023.oss-cn-beijing.aliyuncs.com/202308210841514.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥åšä¸€ä¸ªå®éªŒ</p>

<div class="component-content pagebody component">
  <h3 id="41-å®‰è£…metrics-server" class="pagebody-header">
    4.1 å®‰è£…metrics-server
  </h3>
</div><p class="component-content component">metrics-serverå¯ä»¥ç”¨æ¥æ”¶é›†é›†ç¾¤ä¸­çš„èµ„æºä½¿ç”¨æƒ…å†µ</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…git</span>
</span></span><span style="display:flex;"><span>[<span style="color:#ae81ff">root@k8s-master01 ~]# yum install git -y</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è·å–metrics-server, æ³¨æ„ä½¿ç”¨çš„ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>[<span style="color:#ae81ff">root@k8s-master01 ~]# git clone -b v0.3.6 https://github.com/kubernetes-incubator/metrics-server</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹deployment, æ³¨æ„ä¿®æ”¹çš„æ˜¯é•œåƒå’Œåˆå§‹åŒ–å‚æ•°</span>
</span></span><span style="display:flex;"><span>[<span style="color:#ae81ff">root@k8s-master01 ~]# cd /root/metrics-server/deploy/1.8+/</span>
</span></span><span style="display:flex;"><span>[<span style="color:#ae81ff">root@k8s-master01 1.8+]# vim metrics-server-deployment.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">æŒ‰å›¾ä¸­æ·»åŠ ä¸‹é¢é€‰é¡¹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">hostNetwork</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">image</span>: <span style="color:#ae81ff">registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server-amd64:v0.3.6</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">args</span>:
</span></span><span style="display:flex;"><span>- --<span style="color:#ae81ff">kubelet-insecure-tls</span>
</span></span><span style="display:flex;"><span>- --<span style="color:#ae81ff">kubelet-preferred-address-types=InternalIP,Hostname,InternalDNS,ExternalDNS,ExternalIP</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-11fe267511853f456b07a3af2fea7312" id="lht11fe267511853f456b07a3af2fea7312">
        <picture  class="picture">
          <img class="picture-image" data-src="https://aabb-2023.oss-cn-beijing.aliyuncs.com/202308210841011.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…metrics-server</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 1.8+<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl apply -f ./</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹podè¿è¡Œæƒ…å†µ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 1.8+<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pod -n kube-system</span>
</span></span><span style="display:flex;"><span>metrics-server-6b976979db-2xwbj   1/1     Running   <span style="color:#ae81ff">0</span>          90s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨kubectl top node æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 1.8+<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl top node</span>
</span></span><span style="display:flex;"><span>NAME           CPU<span style="color:#f92672">(</span>cores<span style="color:#f92672">)</span>   CPU%   MEMORY<span style="color:#f92672">(</span>bytes<span style="color:#f92672">)</span>   MEMORY%
</span></span><span style="display:flex;"><span>k8s-master01   289m         14%    1582Mi          54%       
</span></span><span style="display:flex;"><span>k8s-node01     81m          4%     1195Mi          40%       
</span></span><span style="display:flex;"><span>k8s-node02     72m          3%     1211Mi          41%  
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 1.8+<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl top pod -n kube-system</span>
</span></span><span style="display:flex;"><span>NAME                              CPU<span style="color:#f92672">(</span>cores<span style="color:#f92672">)</span>   MEMORY<span style="color:#f92672">(</span>bytes<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>coredns-6955765f44-7ptsb          3m           9Mi
</span></span><span style="display:flex;"><span>coredns-6955765f44-vcwr5          3m           8Mi
</span></span><span style="display:flex;"><span>etcd-master                       14m          145Mi
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è‡³æ­¤,metrics-serverå®‰è£…å®Œæˆ</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="42-å‡†å¤‡deploymentå’Œservie" class="pagebody-header">
    4.2 å‡†å¤‡deploymentå’Œservie
  </h3>
</div><p class="component-content component">åˆ›å»ºpc-hpa-pod.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>: <span style="color:#75715e"># ç­–ç•¥</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate</span> <span style="color:#75715e"># æ»šåŠ¨æ›´æ–°ç­–ç•¥</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx-pod</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx-pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">resources</span>: <span style="color:#75715e"># èµ„æºé…é¢</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">limits</span>:  <span style="color:#75715e"># é™åˆ¶èµ„æºï¼ˆä¸Šé™ï¼‰</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#75715e"># CPUé™åˆ¶ï¼Œå•ä½æ˜¯coreæ•°</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">requests</span>: <span style="color:#75715e"># è¯·æ±‚èµ„æºï¼ˆä¸‹é™ï¼‰</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#e6db74">&#34;100m&#34;</span>  <span style="color:#75715e"># CPUé™åˆ¶ï¼Œå•ä½æ˜¯coreæ•°</span></span></span></code></pre></div></div>
  
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºdeployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 1.8+<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl run nginx --image=nginx:1.17.1 --requests=cpu=100m -n dev</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºservice</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 1.8+<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl expose deployment nginx --type=NodePort --port=80 -n dev</span></span></span></code></pre></div></div>
  
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 1.8+<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get deployment,pod,svc -n dev</span>
</span></span><span style="display:flex;"><span>NAME                    READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style="display:flex;"><span>deployment.apps/nginx   1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           47s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME                         READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pod/nginx-7df9756ccc-bh8dr   1/1     Running   <span style="color:#ae81ff">0</span>          47s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME            TYPE       CLUSTER-IP      EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>        AGE
</span></span><span style="display:flex;"><span>service/nginx   NodePort   10.101.18.29   &lt;none&gt;        80:31830/TCP   35s</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="43-éƒ¨ç½²hpa" class="pagebody-header">
    4.3 éƒ¨ç½²HPA
  </h3>
</div><p class="component-content component">åˆ›å»ºpc-hpa.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">autoscaling/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">HorizontalPodAutoscaler</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pc-hpa</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">minReplicas</span>: <span style="color:#ae81ff">1</span>  <span style="color:#75715e">#æœ€å°podæ•°é‡</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">maxReplicas</span>: <span style="color:#ae81ff">10</span> <span style="color:#75715e">#æœ€å¤§podæ•°é‡</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">targetCPUUtilizationPercentage</span>: <span style="color:#ae81ff">3</span> <span style="color:#75715e"># CPUä½¿ç”¨ç‡æŒ‡æ ‡</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">scaleTargetRef</span>:   <span style="color:#75715e"># æŒ‡å®šè¦æ§åˆ¶çš„nginxä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">apiVersion</span>:  <span style="color:#ae81ff">/v1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span></span></span></code></pre></div></div>
  
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºhpa</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 1.8+<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pc-hpa.yaml</span>
</span></span><span style="display:flex;"><span>horizontalpodautoscaler.autoscaling/pc-hpa created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹hpa</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[</span>root@k8s-master01 1.8+<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get hpa -n dev</span>
</span></span><span style="display:flex;"><span>NAME     REFERENCE          TARGETS   MINPODS   MAXPODS   REPLICAS   AGE
</span></span><span style="display:flex;"><span>pc-hpa   Deployment/nginx   0%/3%     <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">10</span>        <span style="color:#ae81ff">1</span>          62s</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="44-æµ‹è¯•" class="pagebody-header">
    4.4 æµ‹è¯•
  </h3>
</div><p class="component-content component">ä½¿ç”¨å‹æµ‹å·¥å…·å¯¹serviceåœ°å€192.168.5.4:31830è¿›è¡Œå‹æµ‹ï¼Œç„¶åé€šè¿‡æ§åˆ¶å°æŸ¥çœ‹hpaå’Œpodçš„å˜åŒ–</p>
<p class="component-content component">hpaå˜åŒ–</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get hpa -n dev -w</span>
</span></span><span style="display:flex;"><span>NAME   REFERENCE      TARGETS  MINPODS  MAXPODS  REPLICAS  AGE
</span></span><span style="display:flex;"><span>pc-hpa  Deployment/nginx  0%/3%   <span style="color:#ae81ff">1</span>     <span style="color:#ae81ff">10</span>     <span style="color:#ae81ff">1</span>      4m11s
</span></span><span style="display:flex;"><span>pc-hpa  Deployment/nginx  0%/3%   <span style="color:#ae81ff">1</span>     <span style="color:#ae81ff">10</span>     <span style="color:#ae81ff">1</span>      5m19s
</span></span><span style="display:flex;"><span>pc-hpa  Deployment/nginx  22%/3%   <span style="color:#ae81ff">1</span>     <span style="color:#ae81ff">10</span>     <span style="color:#ae81ff">1</span>      6m50s
</span></span><span style="display:flex;"><span>pc-hpa  Deployment/nginx  22%/3%   <span style="color:#ae81ff">1</span>     <span style="color:#ae81ff">10</span>     <span style="color:#ae81ff">4</span>      7m5s
</span></span><span style="display:flex;"><span>pc-hpa  Deployment/nginx  22%/3%   <span style="color:#ae81ff">1</span>     <span style="color:#ae81ff">10</span>     <span style="color:#ae81ff">8</span>      7m21s
</span></span><span style="display:flex;"><span>pc-hpa  Deployment/nginx  6%/3%   <span style="color:#ae81ff">1</span>     <span style="color:#ae81ff">10</span>     <span style="color:#ae81ff">8</span>      7m51s
</span></span><span style="display:flex;"><span>pc-hpa  Deployment/nginx  0%/3%   <span style="color:#ae81ff">1</span>     <span style="color:#ae81ff">10</span>     <span style="color:#ae81ff">8</span>      9m6s
</span></span><span style="display:flex;"><span>pc-hpa  Deployment/nginx  0%/3%   <span style="color:#ae81ff">1</span>     <span style="color:#ae81ff">10</span>     <span style="color:#ae81ff">8</span>      13m
</span></span><span style="display:flex;"><span>pc-hpa  Deployment/nginx  0%/3%   <span style="color:#ae81ff">1</span>     <span style="color:#ae81ff">10</span>     <span style="color:#ae81ff">1</span>      14m</span></span></code></pre></div></div>
  
</div><p class="component-content component">deploymentå˜åŒ–</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get deployment -n dev -w</span>
</span></span><span style="display:flex;"><span>NAME    READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style="display:flex;"><span>nginx   1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           11m
</span></span><span style="display:flex;"><span>nginx   1/4     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           13m
</span></span><span style="display:flex;"><span>nginx   1/4     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           13m
</span></span><span style="display:flex;"><span>nginx   1/4     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           13m
</span></span><span style="display:flex;"><span>nginx   1/4     <span style="color:#ae81ff">4</span>            <span style="color:#ae81ff">1</span>           13m
</span></span><span style="display:flex;"><span>nginx   1/8     <span style="color:#ae81ff">4</span>            <span style="color:#ae81ff">1</span>           14m
</span></span><span style="display:flex;"><span>nginx   1/8     <span style="color:#ae81ff">4</span>            <span style="color:#ae81ff">1</span>           14m
</span></span><span style="display:flex;"><span>nginx   1/8     <span style="color:#ae81ff">4</span>            <span style="color:#ae81ff">1</span>           14m
</span></span><span style="display:flex;"><span>nginx   1/8     <span style="color:#ae81ff">8</span>            <span style="color:#ae81ff">1</span>           14m
</span></span><span style="display:flex;"><span>nginx   2/8     <span style="color:#ae81ff">8</span>            <span style="color:#ae81ff">2</span>           14m
</span></span><span style="display:flex;"><span>nginx   3/8     <span style="color:#ae81ff">8</span>            <span style="color:#ae81ff">3</span>           14m
</span></span><span style="display:flex;"><span>nginx   4/8     <span style="color:#ae81ff">8</span>            <span style="color:#ae81ff">4</span>           14m
</span></span><span style="display:flex;"><span>nginx   5/8     <span style="color:#ae81ff">8</span>            <span style="color:#ae81ff">5</span>           14m
</span></span><span style="display:flex;"><span>nginx   6/8     <span style="color:#ae81ff">8</span>            <span style="color:#ae81ff">6</span>           14m
</span></span><span style="display:flex;"><span>nginx   7/8     <span style="color:#ae81ff">8</span>            <span style="color:#ae81ff">7</span>           14m
</span></span><span style="display:flex;"><span>nginx   8/8     <span style="color:#ae81ff">8</span>            <span style="color:#ae81ff">8</span>           15m
</span></span><span style="display:flex;"><span>nginx   8/1     <span style="color:#ae81ff">8</span>            <span style="color:#ae81ff">8</span>           20m
</span></span><span style="display:flex;"><span>nginx   8/1     <span style="color:#ae81ff">8</span>            <span style="color:#ae81ff">8</span>           20m
</span></span><span style="display:flex;"><span>nginx   1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           20m</span></span></code></pre></div></div>
  
</div><p class="component-content component">podå˜åŒ–</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods -n dev -w</span>
</span></span><span style="display:flex;"><span>NAME                     READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-bh8dr   1/1     Running   <span style="color:#ae81ff">0</span>          11m
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-cpgrv   0/1     Pending   <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-8zhwk   0/1     Pending   <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-rr9bn   0/1     Pending   <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-cpgrv   0/1     ContainerCreating   <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-8zhwk   0/1     ContainerCreating   <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-rr9bn   0/1     ContainerCreating   <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-m9gsj   0/1     Pending             <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-g56qb   0/1     Pending             <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-sl9c6   0/1     Pending             <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-fgst7   0/1     Pending             <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-g56qb   0/1     ContainerCreating   <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-m9gsj   0/1     ContainerCreating   <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-sl9c6   0/1     ContainerCreating   <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-fgst7   0/1     ContainerCreating   <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-8zhwk   1/1     Running             <span style="color:#ae81ff">0</span>          19s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-rr9bn   1/1     Running             <span style="color:#ae81ff">0</span>          30s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-m9gsj   1/1     Running             <span style="color:#ae81ff">0</span>          21s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-cpgrv   1/1     Running             <span style="color:#ae81ff">0</span>          47s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-sl9c6   1/1     Running             <span style="color:#ae81ff">0</span>          33s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-g56qb   1/1     Running             <span style="color:#ae81ff">0</span>          48s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-fgst7   1/1     Running             <span style="color:#ae81ff">0</span>          66s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-fgst7   1/1     Terminating         <span style="color:#ae81ff">0</span>          6m50s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-8zhwk   1/1     Terminating         <span style="color:#ae81ff">0</span>          7m5s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-cpgrv   1/1     Terminating         <span style="color:#ae81ff">0</span>          7m5s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-g56qb   1/1     Terminating         <span style="color:#ae81ff">0</span>          6m50s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-rr9bn   1/1     Terminating         <span style="color:#ae81ff">0</span>          7m5s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-m9gsj   1/1     Terminating         <span style="color:#ae81ff">0</span>          6m50s
</span></span><span style="display:flex;"><span>nginx-7df9756ccc-sl9c6   1/1     Terminating         <span style="color:#ae81ff">0</span>          6m50s</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h2 id="äº”daemonsetds" class="pagebody-header">
    äº”ã€DaemonSet(DS)
  </h2>
</div><p class="component-content component">DaemonSetç±»å‹çš„æ§åˆ¶å™¨å¯ä»¥ä¿è¯åœ¨é›†ç¾¤ä¸­çš„æ¯ä¸€å°ï¼ˆæˆ–æŒ‡å®šï¼‰èŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œä¸€ä¸ªå‰¯æœ¬ã€‚ä¸€èˆ¬é€‚ç”¨äºæ—¥å¿—æ”¶é›†ã€èŠ‚ç‚¹ç›‘æ§ç­‰åœºæ™¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªPodæä¾›çš„åŠŸèƒ½æ˜¯èŠ‚ç‚¹çº§åˆ«çš„ï¼ˆæ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦ä¸”åªéœ€è¦ä¸€ä¸ªï¼‰ï¼Œé‚£ä¹ˆè¿™ç±»Podå°±é€‚åˆä½¿ç”¨DaemonSetç±»å‹çš„æ§åˆ¶å™¨åˆ›å»ºã€‚</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-7fa4a4113e2843c86409ad5549b6b315" id="lht7fa4a4113e2843c86409ad5549b6b315">
        <picture  class="picture">
          <img class="picture-image" data-src="https://aabb-2023.oss-cn-beijing.aliyuncs.com/202308210841881.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">DaemonSetæ§åˆ¶å™¨çš„ç‰¹ç‚¹ï¼š</p>
<div class="component-content component"><ul>
<li>æ¯å½“å‘é›†ç¾¤ä¸­æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼ŒæŒ‡å®šçš„ Pod å‰¯æœ¬ä¹Ÿå°†æ·»åŠ åˆ°è¯¥èŠ‚ç‚¹ä¸Š</li>
<li>å½“èŠ‚ç‚¹ä»é›†ç¾¤ä¸­ç§»é™¤æ—¶ï¼ŒPod ä¹Ÿå°±è¢«åƒåœ¾å›æ”¶äº†</li>
</ul></div>
<p class="component-content component">ä¸‹é¢å…ˆæ¥çœ‹ä¸‹DaemonSetçš„èµ„æºæ¸…å•æ–‡ä»¶</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span> <span style="color:#75715e"># ç‰ˆæœ¬å·</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">DaemonSet</span> <span style="color:#75715e"># ç±»å‹       </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>: <span style="color:#75715e"># å…ƒæ•°æ®</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#75715e"># rsåç§° </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#75715e"># æ‰€å±å‘½åç©ºé—´ </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>: <span style="color:#75715e">#æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">controller</span>: <span style="color:#ae81ff">daemonset</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>: <span style="color:#75715e"># è¯¦æƒ…æè¿°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">revisionHistoryLimit</span>: <span style="color:#ae81ff">3</span> <span style="color:#75715e"># ä¿ç•™å†å²ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">updateStrategy</span>: <span style="color:#75715e"># æ›´æ–°ç­–ç•¥</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate</span> <span style="color:#75715e"># æ»šåŠ¨æ›´æ–°ç­–ç•¥</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>: <span style="color:#75715e"># æ»šåŠ¨æ›´æ–°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">1</span> <span style="color:#75715e"># æœ€å¤§ä¸å¯ç”¨çŠ¶æ€çš„ Pod çš„æœ€å¤§å€¼ï¼Œå¯ä»¥ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>: <span style="color:#75715e"># é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:      <span style="color:#75715e"># LabelsåŒ¹é…è§„åˆ™</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx-pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchExpressions</span>: <span style="color:#75715e"># ExpressionsåŒ¹é…è§„åˆ™</span>
</span></span><span style="display:flex;"><span>      - {<span style="color:#f92672">key: app, operator: In, values</span>: [<span style="color:#ae81ff">nginx-pod]}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>: <span style="color:#75715e"># æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx-pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">åˆ›å»ºpc-daemonset.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">DaemonSet      </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pc-daemonset</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>: 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx-pod</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx-pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span></span></span></code></pre></div></div>
  
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºdaemonset</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f  pc-daemonset.yaml</span>
</span></span><span style="display:flex;"><span>daemonset.apps/pc-daemonset created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹daemonset</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e">#  kubectl get ds -n dev -o wide</span>
</span></span><span style="display:flex;"><span>NAME        DESIRED  CURRENT  READY  UP-TO-DATE  AVAILABLE   AGE   CONTAINERS   IMAGES         
</span></span><span style="display:flex;"><span>pc-daemonset   <span style="color:#ae81ff">2</span>        <span style="color:#ae81ff">2</span>        <span style="color:#ae81ff">2</span>      <span style="color:#ae81ff">2</span>           <span style="color:#ae81ff">2</span>        24s   nginx        nginx:1.17.1   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹pod,å‘ç°åœ¨æ¯ä¸ªNodeä¸Šéƒ½è¿è¡Œä¸€ä¸ªpod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e">#  kubectl get pods -n dev -o wide</span>
</span></span><span style="display:flex;"><span>NAME                 READY   STATUS    RESTARTS   AGE   IP            NODE    
</span></span><span style="display:flex;"><span>pc-daemonset-9bck8   1/1     Running   <span style="color:#ae81ff">0</span>          37s   10.244.1.43   node1     
</span></span><span style="display:flex;"><span>pc-daemonset-k224w   1/1     Running   <span style="color:#ae81ff">0</span>          37s   10.244.2.74   node2      
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ é™¤daemonset</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl delete -f pc-daemonset.yaml</span>
</span></span><span style="display:flex;"><span>daemonset.apps <span style="color:#e6db74">&#34;pc-daemonset&#34;</span> deleted</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h2 id="å…­job" class="pagebody-header">
    å…­ã€Job
  </h2>
</div><p class="component-content component">Jobï¼Œä¸»è¦ç”¨äºè´Ÿè´£**æ‰¹é‡å¤„ç†(ä¸€æ¬¡è¦å¤„ç†æŒ‡å®šæ•°é‡ä»»åŠ¡)çŸ­æš‚çš„ä¸€æ¬¡æ€§(æ¯ä¸ªä»»åŠ¡ä»…è¿è¡Œä¸€æ¬¡å°±ç»“æŸ)**ä»»åŠ¡ã€‚Jobç‰¹ç‚¹å¦‚ä¸‹ï¼š</p>
<div class="component-content component"><ul>
<li>å½“Jobåˆ›å»ºçš„podæ‰§è¡ŒæˆåŠŸç»“æŸæ—¶ï¼ŒJobå°†è®°å½•æˆåŠŸç»“æŸçš„podæ•°é‡</li>
<li>å½“æˆåŠŸç»“æŸçš„podè¾¾åˆ°æŒ‡å®šçš„æ•°é‡æ—¶ï¼ŒJobå°†å®Œæˆæ‰§è¡Œ</li>
</ul></div>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-a382b55e627c3b1badd418fb55359238" id="lhta382b55e627c3b1badd418fb55359238">
        <picture  class="picture">
          <img class="picture-image" data-src="https://aabb-2023.oss-cn-beijing.aliyuncs.com/202308210841970.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">Jobçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">batch/v1</span> <span style="color:#75715e"># ç‰ˆæœ¬å·</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Job</span> <span style="color:#75715e"># ç±»å‹       </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>: <span style="color:#75715e"># å…ƒæ•°æ®</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#75715e"># rsåç§° </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#75715e"># æ‰€å±å‘½åç©ºé—´ </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>: <span style="color:#75715e">#æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">controller</span>: <span style="color:#ae81ff">job</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>: <span style="color:#75715e"># è¯¦æƒ…æè¿°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">completions: 1 # æŒ‡å®šjobéœ€è¦æˆåŠŸè¿è¡ŒPodsçš„æ¬¡æ•°ã€‚é»˜è®¤å€¼</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">parallelism: 1 # æŒ‡å®šjobåœ¨ä»»ä¸€æ—¶åˆ»åº”è¯¥å¹¶å‘è¿è¡ŒPodsçš„æ•°é‡ã€‚é»˜è®¤å€¼</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">activeDeadlineSeconds</span>: <span style="color:#ae81ff">30</span> <span style="color:#75715e"># æŒ‡å®šjobå¯è¿è¡Œçš„æ—¶é—´æœŸé™ï¼Œè¶…è¿‡æ—¶é—´è¿˜æœªç»“æŸï¼Œç³»ç»Ÿå°†ä¼šå°è¯•è¿›è¡Œç»ˆæ­¢ã€‚</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">backoffLimit</span>: <span style="color:#ae81ff">6</span> <span style="color:#75715e"># æŒ‡å®šjobå¤±è´¥åè¿›è¡Œé‡è¯•çš„æ¬¡æ•°ã€‚é»˜è®¤æ˜¯6</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">manualSelector</span>: <span style="color:#66d9ef">true</span> <span style="color:#75715e"># æ˜¯å¦å¯ä»¥ä½¿ç”¨selectoré€‰æ‹©å™¨é€‰æ‹©podï¼Œé»˜è®¤æ˜¯false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>: <span style="color:#75715e"># é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:      <span style="color:#75715e"># LabelsåŒ¹é…è§„åˆ™</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">counter-pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchExpressions</span>: <span style="color:#75715e"># ExpressionsåŒ¹é…è§„åˆ™</span>
</span></span><span style="display:flex;"><span>      - {<span style="color:#f92672">key: app, operator: In, values</span>: [<span style="color:#ae81ff">counter-pod]}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>: <span style="color:#75715e"># æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">counter-pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">restartPolicy</span>: <span style="color:#ae81ff">Never</span> <span style="color:#75715e"># é‡å¯ç­–ç•¥åªèƒ½è®¾ç½®ä¸ºNeveræˆ–è€…OnFailure</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">counter</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 2;done&#34;</span>]</span></span></code></pre></div></div>
  
</div><blockquote>
<p class="component-content component">å…³äºé‡å¯ç­–ç•¥è®¾ç½®çš„è¯´æ˜ï¼š
å¦‚æœæŒ‡å®šä¸ºOnFailureï¼Œåˆ™jobä¼šåœ¨podå‡ºç°æ•…éšœæ—¶é‡å¯å®¹å™¨ï¼Œè€Œä¸æ˜¯åˆ›å»ºpodï¼Œfailedæ¬¡æ•°ä¸å˜
å¦‚æœæŒ‡å®šä¸ºNeverï¼Œåˆ™jobä¼šåœ¨podå‡ºç°æ•…éšœæ—¶åˆ›å»ºæ–°çš„podï¼Œå¹¶ä¸”æ•…éšœpodä¸ä¼šæ¶ˆå¤±ï¼Œä¹Ÿä¸ä¼šé‡å¯ï¼Œfailedæ¬¡æ•°åŠ 1
å¦‚æœæŒ‡å®šä¸ºAlwaysçš„è¯ï¼Œå°±æ„å‘³ç€ä¸€ç›´é‡å¯ï¼Œæ„å‘³ç€jobä»»åŠ¡ä¼šé‡å¤å»æ‰§è¡Œäº†ï¼Œå½“ç„¶ä¸å¯¹ï¼Œæ‰€ä»¥ä¸èƒ½è®¾ç½®ä¸ºAlways</p>
</blockquote>
<p class="component-content component">åˆ›å»ºpc-job.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">batch/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Job      </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pc-job</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">manualSelector</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">counter-pod</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">counter-pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">restartPolicy</span>: <span style="color:#ae81ff">Never</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">counter</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 3;done&#34;</span>]</span></span></code></pre></div></div>
  
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºjob</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pc-job.yaml</span>
</span></span><span style="display:flex;"><span>job.batch/pc-job created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹job</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get job -n dev -o wide  -w</span>
</span></span><span style="display:flex;"><span>NAME     COMPLETIONS   DURATION   AGE   CONTAINERS   IMAGES         SELECTOR
</span></span><span style="display:flex;"><span>pc-job   0/1           21s        21s   counter      busybox:1.30   app<span style="color:#f92672">=</span>counter-pod
</span></span><span style="display:flex;"><span>pc-job   1/1           31s        79s   counter      busybox:1.30   app<span style="color:#f92672">=</span>counter-pod
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é€šè¿‡è§‚å¯ŸpodçŠ¶æ€å¯ä»¥çœ‹åˆ°ï¼Œpodåœ¨è¿è¡Œå®Œæ¯•ä»»åŠ¡åï¼Œå°±ä¼šå˜æˆCompletedçŠ¶æ€</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods -n dev -w</span>
</span></span><span style="display:flex;"><span>NAME           READY   STATUS     RESTARTS      AGE
</span></span><span style="display:flex;"><span>pc-job-rxg96   1/1     Running     <span style="color:#ae81ff">0</span>            29s
</span></span><span style="display:flex;"><span>pc-job-rxg96   0/1     Completed   <span style="color:#ae81ff">0</span>            33s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¥ä¸‹æ¥ï¼Œè°ƒæ•´ä¸‹podè¿è¡Œçš„æ€»æ•°é‡å’Œå¹¶è¡Œæ•°é‡ å³ï¼šåœ¨specä¸‹è®¾ç½®ä¸‹é¢ä¸¤ä¸ªé€‰é¡¹</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  completions: 6 # æŒ‡å®šjobéœ€è¦æˆåŠŸè¿è¡ŒPodsçš„æ¬¡æ•°ä¸º6</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  parallelism: 3 # æŒ‡å®šjobå¹¶å‘è¿è¡ŒPodsçš„æ•°é‡ä¸º3</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  ç„¶åé‡æ–°è¿è¡Œjobï¼Œè§‚å¯Ÿæ•ˆæœï¼Œæ­¤æ—¶ä¼šå‘ç°ï¼Œjobä¼šæ¯æ¬¡è¿è¡Œ3ä¸ªpodï¼Œæ€»å…±æ‰§è¡Œäº†6ä¸ªpod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods -n dev -w</span>
</span></span><span style="display:flex;"><span>NAME           READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pc-job-684ft   1/1     Running   <span style="color:#ae81ff">0</span>          5s
</span></span><span style="display:flex;"><span>pc-job-jhj49   1/1     Running   <span style="color:#ae81ff">0</span>          5s
</span></span><span style="display:flex;"><span>pc-job-pfcvh   1/1     Running   <span style="color:#ae81ff">0</span>          5s
</span></span><span style="display:flex;"><span>pc-job-684ft   0/1     Completed   <span style="color:#ae81ff">0</span>          11s
</span></span><span style="display:flex;"><span>pc-job-v7rhr   0/1     Pending     <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>pc-job-v7rhr   0/1     Pending     <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>pc-job-v7rhr   0/1     ContainerCreating   <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>pc-job-jhj49   0/1     Completed           <span style="color:#ae81ff">0</span>          11s
</span></span><span style="display:flex;"><span>pc-job-fhwf7   0/1     Pending             <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>pc-job-fhwf7   0/1     Pending             <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>pc-job-pfcvh   0/1     Completed           <span style="color:#ae81ff">0</span>          11s
</span></span><span style="display:flex;"><span>pc-job-5vg2j   0/1     Pending             <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>pc-job-fhwf7   0/1     ContainerCreating   <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>pc-job-5vg2j   0/1     Pending             <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>pc-job-5vg2j   0/1     ContainerCreating   <span style="color:#ae81ff">0</span>          0s
</span></span><span style="display:flex;"><span>pc-job-fhwf7   1/1     Running             <span style="color:#ae81ff">0</span>          2s
</span></span><span style="display:flex;"><span>pc-job-v7rhr   1/1     Running             <span style="color:#ae81ff">0</span>          2s
</span></span><span style="display:flex;"><span>pc-job-5vg2j   1/1     Running             <span style="color:#ae81ff">0</span>          3s
</span></span><span style="display:flex;"><span>pc-job-fhwf7   0/1     Completed           <span style="color:#ae81ff">0</span>          12s
</span></span><span style="display:flex;"><span>pc-job-v7rhr   0/1     Completed           <span style="color:#ae81ff">0</span>          12s
</span></span><span style="display:flex;"><span>pc-job-5vg2j   0/1     Completed           <span style="color:#ae81ff">0</span>          12s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ é™¤job</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl delete -f pc-job.yaml</span>
</span></span><span style="display:flex;"><span>job.batch <span style="color:#e6db74">&#34;pc-job&#34;</span> deleted</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h2 id="ä¸ƒcronjobcj" class="pagebody-header">
    ä¸ƒã€CronJob(CJ)
  </h2>
</div><p class="component-content component">CronJobæ§åˆ¶å™¨ä»¥ Jobæ§åˆ¶å™¨èµ„æºä¸ºå…¶ç®¡æ§å¯¹è±¡ï¼Œå¹¶å€ŸåŠ©å®ƒç®¡ç†podèµ„æºå¯¹è±¡ï¼ŒJobæ§åˆ¶å™¨å®šä¹‰çš„ä½œä¸šä»»åŠ¡åœ¨å…¶æ§åˆ¶å™¨èµ„æºåˆ›å»ºä¹‹åä¾¿ä¼šç«‹å³æ‰§è¡Œï¼Œä½†CronJobå¯ä»¥ä»¥ç±»ä¼¼äºLinuxæ“ä½œç³»ç»Ÿçš„å‘¨æœŸæ€§ä»»åŠ¡ä½œä¸šè®¡åˆ’çš„æ–¹å¼æ§åˆ¶å…¶è¿è¡Œæ—¶é—´ç‚¹åŠé‡å¤è¿è¡Œçš„æ–¹å¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒCronJobå¯ä»¥åœ¨ç‰¹å®šçš„æ—¶é—´ç‚¹(åå¤çš„)å»è¿è¡Œjobä»»åŠ¡ã€‚</p>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-88f46a1b0f738ef6a3560966ea6bb2d2" id="lht88f46a1b0f738ef6a3560966ea6bb2d2">
        <picture  class="picture">
          <img class="picture-image" data-src="https://aabb-2023.oss-cn-beijing.aliyuncs.com/202308210842037.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">CronJobçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">batch/v1beta1</span> <span style="color:#75715e"># ç‰ˆæœ¬å·</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">CronJob</span> <span style="color:#75715e"># ç±»å‹       </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>: <span style="color:#75715e"># å…ƒæ•°æ®</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#75715e"># rsåç§° </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#75715e"># æ‰€å±å‘½åç©ºé—´ </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>: <span style="color:#75715e">#æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">controller</span>: <span style="color:#ae81ff">cronjob</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>: <span style="color:#75715e"># è¯¦æƒ…æè¿°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">schedule</span>: <span style="color:#75715e"># cronæ ¼å¼çš„ä½œä¸šè°ƒåº¦è¿è¡Œæ—¶é—´ç‚¹,ç”¨äºæ§åˆ¶ä»»åŠ¡åœ¨ä»€ä¹ˆæ—¶é—´æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">concurrencyPolicy</span>: <span style="color:#75715e"># å¹¶å‘æ‰§è¡Œç­–ç•¥ï¼Œç”¨äºå®šä¹‰å‰ä¸€æ¬¡ä½œä¸šè¿è¡Œå°šæœªå®Œæˆæ—¶æ˜¯å¦ä»¥åŠå¦‚ä½•è¿è¡Œåä¸€æ¬¡çš„ä½œä¸š</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">failedJobHistoryLimit</span>: <span style="color:#75715e"># ä¸ºå¤±è´¥çš„ä»»åŠ¡æ‰§è¡Œä¿ç•™çš„å†å²è®°å½•æ•°ï¼Œé»˜è®¤ä¸º1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">successfulJobHistoryLimit</span>: <span style="color:#75715e"># ä¸ºæˆåŠŸçš„ä»»åŠ¡æ‰§è¡Œä¿ç•™çš„å†å²è®°å½•æ•°ï¼Œé»˜è®¤ä¸º3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">startingDeadlineSeconds</span>: <span style="color:#75715e"># å¯åŠ¨ä½œä¸šé”™è¯¯çš„è¶…æ—¶æ—¶é•¿</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">jobTemplate</span>: <span style="color:#75715e"># jobæ§åˆ¶å™¨æ¨¡æ¿ï¼Œç”¨äºä¸ºcronjobæ§åˆ¶å™¨ç”Ÿæˆjobå¯¹è±¡;ä¸‹é¢å…¶å®å°±æ˜¯jobçš„å®šä¹‰</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">completions</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">parallelism</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">activeDeadlineSeconds</span>: <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">backoffLimit</span>: <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">manualSelector</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">app</span>: <span style="color:#ae81ff">counter-pod</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">matchExpressions</span>: <span style="color:#ae81ff">è§„åˆ™</span>
</span></span><span style="display:flex;"><span>          - {<span style="color:#f92672">key: app, operator: In, values</span>: [<span style="color:#ae81ff">counter-pod]}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">app</span>: <span style="color:#ae81ff">counter-pod</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">restartPolicy</span>: <span style="color:#ae81ff">Never </span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">counter</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 20;done&#34;</span>]</span></span></code></pre></div></div>
  
</div><blockquote>
<p class="component-content component">éœ€è¦é‡ç‚¹è§£é‡Šçš„å‡ ä¸ªé€‰é¡¹ï¼š
schedule: cronè¡¨è¾¾å¼ï¼Œç”¨äºæŒ‡å®šä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´
*/1    *      *    *     *
&lt;åˆ†é’Ÿ&gt; &lt;å°æ—¶&gt; &lt;æ—¥&gt; &lt;æœˆä»½&gt; &lt;æ˜ŸæœŸ&gt;</p>
<p class="component-content component">â€‹	åˆ†é’Ÿ å€¼ä» 0 åˆ° 59.
â€‹	å°æ—¶ å€¼ä» 0 åˆ° 23.
â€‹	æ—¥ å€¼ä» 1 åˆ° 31.
â€‹	æœˆ å€¼ä» 1 åˆ° 12.
â€‹	æ˜ŸæœŸ å€¼ä» 0 åˆ° 6, 0 ä»£è¡¨æ˜ŸæœŸæ—¥
â€‹	å¤šä¸ªæ—¶é—´å¯ä»¥ç”¨é€—å·éš”å¼€ï¼› èŒƒå›´å¯ä»¥ç”¨è¿å­—ç¬¦ç»™å‡ºï¼›*å¯ä»¥ä½œä¸ºé€šé…ç¬¦ï¼› /è¡¨ç¤ºæ¯&hellip;</p>
<p class="component-content component">concurrencyPolicy:
Allow:   å…è®¸Jobså¹¶å‘è¿è¡Œ(é»˜è®¤)
Forbid:  ç¦æ­¢å¹¶å‘è¿è¡Œï¼Œå¦‚æœä¸Šä¸€æ¬¡è¿è¡Œå°šæœªå®Œæˆï¼Œåˆ™è·³è¿‡ä¸‹ä¸€æ¬¡è¿è¡Œ
Replace: æ›¿æ¢ï¼Œå–æ¶ˆå½“å‰æ­£åœ¨è¿è¡Œçš„ä½œä¸šå¹¶ç”¨æ–°ä½œä¸šæ›¿æ¢å®ƒ</p>
</blockquote>
<p class="component-content component">åˆ›å»ºpc-cronjob.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">batch/v1beta1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">CronJob</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pc-cronjob</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">controller</span>: <span style="color:#ae81ff">cronjob</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">schedule</span>: <span style="color:#e6db74">&#34;*/1 * * * *&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">jobTemplate</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">restartPolicy</span>: <span style="color:#ae81ff">Never</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">counter</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 3;done&#34;</span>]</span></span></code></pre></div></div>
  
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºcronjob</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pc-cronjob.yaml</span>
</span></span><span style="display:flex;"><span>cronjob.batch/pc-cronjob created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹cronjob</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get cronjobs -n dev</span>
</span></span><span style="display:flex;"><span>NAME         SCHEDULE      SUSPEND   ACTIVE   LAST SCHEDULE   AGE
</span></span><span style="display:flex;"><span>pc-cronjob   */1 * * * *   False     <span style="color:#ae81ff">0</span>        &lt;none&gt;          6s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹job</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get jobs -n dev</span>
</span></span><span style="display:flex;"><span>NAME                    COMPLETIONS   DURATION   AGE
</span></span><span style="display:flex;"><span>pc-cronjob-1592587800   1/1           28s        3m26s
</span></span><span style="display:flex;"><span>pc-cronjob-1592587860   1/1           28s        2m26s
</span></span><span style="display:flex;"><span>pc-cronjob-1592587920   1/1           28s        86s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods -n dev</span>
</span></span><span style="display:flex;"><span>pc-cronjob-1592587800-x4tsm   0/1     Completed   <span style="color:#ae81ff">0</span>          2m24s
</span></span><span style="display:flex;"><span>pc-cronjob-1592587860-r5gv4   0/1     Completed   <span style="color:#ae81ff">0</span>          84s
</span></span><span style="display:flex;"><span>pc-cronjob-1592587920-9dxxq   1/1     Running     <span style="color:#ae81ff">0</span>          24s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ é™¤cronjob</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl  delete -f pc-cronjob.yaml</span>
</span></span><span style="display:flex;"><span>cronjob.batch <span style="color:#e6db74">&#34;pc-cronjob&#34;</span> deleted</span></span></code></pre></div></div>
  
</div>
          </div><div class="component">
            <div class="component-content">
              <div class="article-copyright">
                <p class="content">
                  ç‰ˆæƒå£°æ˜: <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed" target="_blank">ç‰ˆæƒå£°æ˜ï¼šç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™… (CC BY-NC-SA 4.0)</a>
                </p>
                <p class="content">ä½œè€…:  yuanshuai </p>
                <p class="content">å‘è¡¨æ—¥æœŸ:  2023å¹´7æœˆ19æ—¥</p>
              </div>
            </div>
          </div></article>
      </section>
  </main>

  <script>
    var script = document.createElement("script");script.src = "https://yuanshuai1122.github.io/js/initPost.js";
    document.head.appendChild(script);
  </script>

    
    <div class="footer-main ">
  <div class="content-body footer-wraper">
    <div class="footer-box">
      <div class="foot-nav">
        <div class="foot-nav-items">
          <div class="item">
            <div class="logo"></div>
            <div class="email">Email: <a href="mailto:shuaiyuan@gmail.com">shuaiyuan@gmail.com</a></div>
          </div>

          <div class="item community">
            <div class="item-title">ç¤¾äº¤åª’ä½“</div>
            
              <a href="https://github.com/yuanshuai1122" target="_blank">Github</a>
            
          </div>

          <div class="item resources">
            <div class="item-title">å‹é“¾</div>
            
              <a href="https://yuanshuaicn.com/" target="_blank">ğŸ‘‹</a>
            
          </div>
        </div>
      </div>
      <div class="bottom">
        <div class="item copyright">
          &copy; 2023
          Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> & <a href="https://github.com/floyd-li/hugo-theme-itheme" target="_blank">iTheme</a>
        </div>
      </div>
    </div>
  </div>
</div>

  </body>
    
    

    
    
</html>
