<!DOCTYPE html>
<html class="js no-touch  progressive-image  no-reduced-motion progressive" lang="zh-hans">
  <head>
    <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="icon" href="/img/favicon.ico">

    <meta name="keyword" content=""><meta property="og:title" content="Kubernetes-Podè¯¦è§£" />
<meta property="og:description" content="ä¸€ã€Podä»‹ç» 1.1 Podç»“æ„ æ¯ä¸ªPodä¸­éƒ½å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ï¼Œè¿™äº›å®¹å™¨å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š ç”¨æˆ·ç¨‹åºæ‰€åœ¨çš„å®¹å™¨ï¼Œæ•°é‡å¯å¤šå¯å°‘ Pauseå®¹å™¨ï¼Œè¿™æ˜¯" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yuanshuai1122.github.io/11/kubernetes-pod%E8%AF%A6%E8%A7%A3/" /><meta property="article:section" content="11" />
<meta property="article:published_time" content="2023-07-19T18:12:20+00:00" />
<meta property="article:modified_time" content="2023-07-19T18:12:20+00:00" />
<title>Kubernetes-Podè¯¦è§£</title>

    <link rel="canonical" href="/11/kubernetes-pod%E8%AF%A6%E8%A7%A3/">

    <link rel="stylesheet" href="/css/global.css">

    <link rel="stylesheet" href="/css/custom.css">

    <link rel="stylesheet" href="/css/search.css" />

    
    

    
    

</head>
  </head>
  <body class=" page-article   ">
    <header>
      <nav class="nav">
  <div class="nav-wrapper">
    <div class="nav-content-wrapper">
      <div class="nav-content">
        <a href="/ " class="nav-title">ğŸ§€</a>
        <div class="nav-menu">
          <div class="nav-item-wrapper">
            <a href="/posts " class="nav-item-content">ç›®å½•</a>
          </div><div class="nav-item-wrapper">
            <a href="/about" class="nav-item-content">å…³äº</a>
          </div><div class="nav-item-wrapper">
            <a href="/index.xml" class="nav-item-content" target="_blank">RSS</a>
          </div></div>
      </div>
    </div>
  </div>
</nav>

<script>
  function toggleSearchModal(){
    const template = `
    <div class="modal-body">
      <div id="autocomplete" onclick="event.stopPropagation();"></div>
    </div>
    `
    const modal = document.querySelector("#modal-wrapper")
    if(!modal){
      const div = document.createElement("div")
      document.body.setAttribute("style","overflow: hidden;")
      div.setAttribute("id", "modal-wrapper")
      div.setAttribute("onclick", "toggleSearchModal()")
      div.innerHTML = template
      const script = document.createElement("script");script.setAttribute("src", "https://yuanshuai1122.github.io/js/algolia.js")
      div.appendChild(script)
      document.body.append(div)
    } else {
      document.body.removeAttribute("style")
      document.body.removeChild(modal)
    }
  }
</script>
    </header>
    
  
  
  <main id="main" class="main">
      <section>
        <article class="article">
          
          <div class=" article-header ">
            <div class="category component">
              <div class="component-content">
                <div class="category-eyebrow">
                  <span class="category-eyebrow__category category_original">
                    
                      
                        docker
                      
                    
                  </span>
                  <span class="category-eyebrow__date">2023å¹´7æœˆ19æ—¥</span>
                </div>
              </div>
            </div>
            <div class="pagetitle component">
              <div class="component-content">
                <h1 class="hero-headline">Kubernetes-Podè¯¦è§£</h1>
              </div>
            </div>
            <div class="component  article-subhead ">
              <div class="component-content"></div>
            </div>

            <div class="tagssheet component">
              <div class="component-content">
                
                  
                  <a href="/tags/docker" class="tag">
                    docker
                  </a>
                
                  
                  <a href="/tags/k8s" class="tag">
                    k8s
                  </a>
                
                  
                  <a href="/tags/%E5%AE%B9%E5%99%A8" class="tag">
                    å®¹å™¨
                  </a>
                
              </div>
            </div>
          </div>
          
          <div class="pagebody">
            
            
            
            
            
            
            
            
            
<div class="component-content pagebody component">
  <h2 id="ä¸€podä»‹ç»" class="pagebody-header">
    ä¸€ã€Podä»‹ç»
  </h2>
</div>
<div class="component-content pagebody component">
  <h3 id="11-podç»“æ„" class="pagebody-header">
    1.1 Podç»“æ„
  </h3>
</div><p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-95f8a86b80a7f530c028104ca38fae65" id="lht95f8a86b80a7f530c028104ca38fae65">
        <picture  class="picture">
          <img class="picture-image" data-src="https://aabb-2023.oss-cn-beijing.aliyuncs.com/202308201737437.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">æ¯ä¸ªPodä¸­éƒ½å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ï¼Œè¿™äº›å®¹å™¨å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š</p>
<p class="component-content component">ç”¨æˆ·ç¨‹åºæ‰€åœ¨çš„å®¹å™¨ï¼Œæ•°é‡å¯å¤šå¯å°‘</p>
<p class="component-content component">Pauseå®¹å™¨ï¼Œè¿™æ˜¯æ¯ä¸ªPodéƒ½ä¼šæœ‰çš„ä¸€ä¸ªæ ¹å®¹å™¨ï¼Œå®ƒçš„ä½œç”¨æœ‰ä¸¤ä¸ªï¼š</p>
<p class="component-content component">å¯ä»¥ä»¥å®ƒä¸ºä¾æ®ï¼Œè¯„ä¼°æ•´ä¸ªPodçš„å¥åº·çŠ¶æ€</p>
<p class="component-content component">å¯ä»¥åœ¨æ ¹å®¹å™¨ä¸Šè®¾ç½®Ipåœ°å€ï¼Œå…¶å®ƒå®¹å™¨éƒ½æ­¤Ipï¼ˆPod IPï¼‰ï¼Œä»¥å®ç°Podå†…éƒ¨çš„ç½‘è·¯é€šä¿¡</p>
<blockquote>
<p class="component-content component">è¿™é‡Œæ˜¯Podå†…éƒ¨çš„é€šè®¯ï¼ŒPodçš„ä¹‹é—´çš„é€šè®¯é‡‡ç”¨è™šæ‹ŸäºŒå±‚ç½‘ç»œæŠ€æœ¯æ¥å®ç°ï¼Œæˆ‘ä»¬å½“å‰ç¯å¢ƒç”¨çš„æ˜¯Flannel</p>
</blockquote>

<div class="component-content pagebody component">
  <h3 id="22-podå®šä¹‰" class="pagebody-header">
    2.2 Podå®šä¹‰
  </h3>
</div><p class="component-content component">ä¸‹é¢æ˜¯Podçš„èµ„æºæ¸…å•ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1    </span> <span style="color:#75715e">#å¿…é€‰ï¼Œç‰ˆæœ¬å·ï¼Œä¾‹å¦‚v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod       ã€€</span> <span style="color:#75715e">#å¿…é€‰ï¼Œèµ„æºç±»å‹ï¼Œä¾‹å¦‚ Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:       ã€€ <span style="color:#75715e">#å¿…é€‰ï¼Œå…ƒæ•°æ®</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">string    </span> <span style="color:#75715e">#å¿…é€‰ï¼ŒPodåç§°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">string </span> <span style="color:#75715e">#Podæ‰€å±çš„å‘½åç©ºé—´,é»˜è®¤ä¸º&#34;default&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:       ã€€ã€€  <span style="color:#75715e">#è‡ªå®šä¹‰æ ‡ç­¾åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">string      ã€€          </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:  <span style="color:#75715e">#å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:  <span style="color:#75715e">#å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">string  </span> <span style="color:#75715e">#å¿…é€‰ï¼Œå®¹å™¨åç§°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">string </span> <span style="color:#75715e">#å¿…é€‰ï¼Œå®¹å™¨çš„é•œåƒåç§°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">imagePullPolicy</span>: [ <span style="color:#ae81ff">Always|Never|IfNotPresent ] </span> <span style="color:#75715e">#è·å–é•œåƒçš„ç­–ç•¥ </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#ae81ff">string]  </span> <span style="color:#75715e">#å®¹å™¨çš„å¯åŠ¨å‘½ä»¤åˆ—è¡¨ï¼Œå¦‚ä¸æŒ‡å®šï¼Œä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">args</span>: [<span style="color:#ae81ff">string]     </span> <span style="color:#75715e">#å®¹å™¨çš„å¯åŠ¨å‘½ä»¤å‚æ•°åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">workingDir</span>: <span style="color:#ae81ff">string </span> <span style="color:#75715e">#å®¹å™¨çš„å·¥ä½œç›®å½•</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:       <span style="color:#75715e">#æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½®</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">string     </span> <span style="color:#75715e">#å¼•ç”¨podå®šä¹‰çš„å…±äº«å­˜å‚¨å·çš„åç§°ï¼Œéœ€ç”¨volumes[]éƒ¨åˆ†å®šä¹‰çš„çš„å·å</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">string</span> <span style="color:#75715e">#å­˜å‚¨å·åœ¨å®¹å™¨å†…mountçš„ç»å¯¹è·¯å¾„ï¼Œåº”å°‘äº512å­—ç¬¦</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">readOnly</span>: <span style="color:#ae81ff">boolean</span> <span style="color:#75715e">#æ˜¯å¦ä¸ºåªè¯»æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>: <span style="color:#75715e">#éœ€è¦æš´éœ²çš„ç«¯å£åº“å·åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">string       </span> <span style="color:#75715e">#ç«¯å£çš„åç§°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">int </span> <span style="color:#75715e">#å®¹å™¨éœ€è¦ç›‘å¬çš„ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">hostPort</span>: <span style="color:#ae81ff">int      </span> <span style="color:#75715e">#å®¹å™¨æ‰€åœ¨ä¸»æœºéœ€è¦ç›‘å¬çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸Containerç›¸åŒ</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">string   </span> <span style="color:#75715e">#ç«¯å£åè®®ï¼Œæ”¯æŒTCPå’ŒUDPï¼Œé»˜è®¤TCP</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">env</span>:   <span style="color:#75715e">#å®¹å™¨è¿è¡Œå‰éœ€è®¾ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">string </span> <span style="color:#75715e">#ç¯å¢ƒå˜é‡åç§°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">value</span>: <span style="color:#ae81ff">string</span> <span style="color:#75715e">#ç¯å¢ƒå˜é‡çš„å€¼</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: <span style="color:#75715e">#èµ„æºé™åˆ¶å’Œè¯·æ±‚çš„è®¾ç½®</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">limits</span>:  <span style="color:#75715e">#èµ„æºé™åˆ¶çš„è®¾ç½®</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">string    </span> <span style="color:#75715e">#Cpuçš„é™åˆ¶ï¼Œå•ä½ä¸ºcoreæ•°ï¼Œå°†ç”¨äºdocker run --cpu-shareså‚æ•°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">string </span> <span style="color:#75715e">#å†…å­˜é™åˆ¶ï¼Œå•ä½å¯ä»¥ä¸ºMib/Gibï¼Œå°†ç”¨äºdocker run --memoryå‚æ•°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">requests</span>: <span style="color:#75715e">#èµ„æºè¯·æ±‚çš„è®¾ç½®</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">string   </span> <span style="color:#75715e">#Cpuè¯·æ±‚ï¼Œå®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">string</span> <span style="color:#75715e">#å†…å­˜è¯·æ±‚,å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">lifecycle</span>: <span style="color:#75715e">#ç”Ÿå‘½å‘¨æœŸé’©å­</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">postStart</span>: <span style="color:#75715e">#å®¹å™¨å¯åŠ¨åç«‹å³æ‰§è¡Œæ­¤é’©å­,å¦‚æœæ‰§è¡Œå¤±è´¥,ä¼šæ ¹æ®é‡å¯ç­–ç•¥è¿›è¡Œé‡å¯</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">preStop</span>: <span style="color:#75715e">#å®¹å™¨ç»ˆæ­¢å‰æ‰§è¡Œæ­¤é’©å­,æ— è®ºç»“æœå¦‚ä½•,å®¹å™¨éƒ½ä¼šç»ˆæ­¢</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">livenessProbe</span>:  <span style="color:#75715e">#å¯¹Podå†…å„å®¹å™¨å¥åº·æ£€æŸ¥çš„è®¾ç½®ï¼Œå½“æ¢æµ‹æ— å“åº”å‡ æ¬¡åå°†è‡ªåŠ¨é‡å¯è¯¥å®¹å™¨</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">exec</span>:       ã€€ <span style="color:#75715e">#å¯¹Podå®¹å™¨å†…æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºexecæ–¹å¼</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>: [<span style="color:#ae81ff">string] </span> <span style="color:#75715e">#execæ–¹å¼éœ€è¦åˆ¶å®šçš„å‘½ä»¤æˆ–è„šæœ¬</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">httpGet</span>:       <span style="color:#75715e">#å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹æ³•è®¾ç½®ä¸ºHttpGetï¼Œéœ€è¦åˆ¶å®šPathã€port</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">port</span>: <span style="color:#ae81ff">number</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">host</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">scheme</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">HttpHeaders</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">tcpSocket</span>:     <span style="color:#75715e">#å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºtcpSocketæ–¹å¼</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">port</span>: <span style="color:#ae81ff">number</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">0</span>       <span style="color:#75715e">#å®¹å™¨å¯åŠ¨å®Œæˆåé¦–æ¬¡æ¢æµ‹çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">0</span>    ã€€ã€€    <span style="color:#75715e">#å¯¹å®¹å™¨å¥åº·æ£€æŸ¥æ¢æµ‹ç­‰å¾…å“åº”çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’ï¼Œé»˜è®¤1ç§’</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">0</span>     ã€€ã€€    <span style="color:#75715e">#å¯¹å®¹å™¨ç›‘æ§æ£€æŸ¥çš„å®šæœŸæ¢æµ‹æ—¶é—´è®¾ç½®ï¼Œå•ä½ç§’ï¼Œé»˜è®¤10ç§’ä¸€æ¬¡</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">securityContext</span>:
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">privileged</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">restartPolicy</span>: [<span style="color:#ae81ff">Always | Never | OnFailure] </span> <span style="color:#75715e">#Podçš„é‡å¯ç­–ç•¥</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nodeName</span>: <span style="color:#ae81ff">&lt;string&gt;</span> <span style="color:#75715e">#è®¾ç½®NodeNameè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°æŒ‡å®šåˆ°åç§°çš„nodeèŠ‚ç‚¹ä¸Š</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nodeSelector</span>: <span style="color:#ae81ff">obeject</span> <span style="color:#75715e">#è®¾ç½®NodeSelectorè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°åŒ…å«è¿™ä¸ªlabelçš„nodeä¸Š</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">imagePullSecrets</span>: <span style="color:#75715e">#Pullé•œåƒæ—¶ä½¿ç”¨çš„secretåç§°ï¼Œä»¥keyï¼šsecretkeyæ ¼å¼æŒ‡å®š</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hostNetwork</span>: <span style="color:#66d9ef">false</span>   <span style="color:#75715e">#æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:   <span style="color:#75715e">#åœ¨è¯¥podä¸Šå®šä¹‰å…±äº«å­˜å‚¨å·åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">string   </span> <span style="color:#75715e">#å…±äº«å­˜å‚¨å·åç§° ï¼ˆvolumesç±»å‹æœ‰å¾ˆå¤šç§ï¼‰</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">emptyDir</span>: {}       <span style="color:#75715e">#ç±»å‹ä¸ºemtyDirçš„å­˜å‚¨å·ï¼Œä¸PodåŒç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªä¸´æ—¶ç›®å½•ã€‚ä¸ºç©ºå€¼</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostPath</span>: <span style="color:#ae81ff">string  </span> <span style="color:#75715e">#ç±»å‹ä¸ºhostPathçš„å­˜å‚¨å·ï¼Œè¡¨ç¤ºæŒ‚è½½Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">path</span>: <span style="color:#ae81ff">string      ã€€ã€€       </span> <span style="color:#75715e">#Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•ï¼Œå°†è¢«ç”¨äºåŒæœŸä¸­mountçš„ç›®å½•</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">secret</span>:       ã€€ã€€ã€€<span style="color:#75715e">#ç±»å‹ä¸ºsecretçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é›†ç¾¤ä¸å®šä¹‰çš„secretå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">scretname</span>: <span style="color:#ae81ff">string  </span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">items</span>:     
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">configMap</span>:         <span style="color:#75715e">#ç±»å‹ä¸ºconfigMapçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é¢„å®šä¹‰çš„configMapå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">items</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">string</span></span></span></code></pre></div></div>
  
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#å°æç¤ºï¼š</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#   åœ¨è¿™é‡Œï¼Œå¯é€šè¿‡ä¸€ä¸ªå‘½ä»¤æ¥æŸ¥çœ‹æ¯ç§èµ„æºçš„å¯é…ç½®é¡¹</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#   kubectl explain èµ„æºç±»å‹         æŸ¥çœ‹æŸç§èµ„æºå¯ä»¥é…ç½®çš„ä¸€çº§å±æ€§</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#   kubectl explain èµ„æºç±»å‹.å±æ€§     æŸ¥çœ‹å±æ€§çš„å­å±æ€§</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl explain pod</span>
</span></span><span style="display:flex;"><span>KIND:     Pod
</span></span><span style="display:flex;"><span>VERSION:  v1
</span></span><span style="display:flex;"><span>FIELDS:
</span></span><span style="display:flex;"><span>   apiVersion   &lt;string&gt;
</span></span><span style="display:flex;"><span>   kind &lt;string&gt;
</span></span><span style="display:flex;"><span>   metadata     &lt;Object&gt;
</span></span><span style="display:flex;"><span>   spec &lt;Object&gt;
</span></span><span style="display:flex;"><span>   status       &lt;Object&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl explain pod.metadata</span>
</span></span><span style="display:flex;"><span>KIND:     Pod
</span></span><span style="display:flex;"><span>VERSION:  v1
</span></span><span style="display:flex;"><span>RESOURCE: metadata &lt;Object&gt;
</span></span><span style="display:flex;"><span>FIELDS:
</span></span><span style="display:flex;"><span>   annotations  &lt;map<span style="color:#f92672">[</span>string<span style="color:#f92672">]</span>string&gt;
</span></span><span style="display:flex;"><span>   clusterName  &lt;string&gt;
</span></span><span style="display:flex;"><span>   creationTimestamp    &lt;string&gt;
</span></span><span style="display:flex;"><span>   deletionGracePeriodSeconds   &lt;integer&gt;
</span></span><span style="display:flex;"><span>   deletionTimestamp    &lt;string&gt;
</span></span><span style="display:flex;"><span>   finalizers   &lt;<span style="color:#f92672">[]</span>string&gt;
</span></span><span style="display:flex;"><span>   generateName &lt;string&gt;
</span></span><span style="display:flex;"><span>   generation   &lt;integer&gt;
</span></span><span style="display:flex;"><span>   labels       &lt;map<span style="color:#f92672">[</span>string<span style="color:#f92672">]</span>string&gt;
</span></span><span style="display:flex;"><span>   managedFields        &lt;<span style="color:#f92672">[]</span>Object&gt;
</span></span><span style="display:flex;"><span>   name &lt;string&gt;
</span></span><span style="display:flex;"><span>   namespace    &lt;string&gt;
</span></span><span style="display:flex;"><span>   ownerReferences      &lt;<span style="color:#f92672">[]</span>Object&gt;
</span></span><span style="display:flex;"><span>   resourceVersion      &lt;string&gt;
</span></span><span style="display:flex;"><span>   selfLink     &lt;string&gt;
</span></span><span style="display:flex;"><span>   uid  &lt;string&gt;</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h2 id="äºŒpodé…ç½®" class="pagebody-header">
    äºŒã€Podé…ç½®
  </h2>
</div><p class="component-content component">æœ¬å°èŠ‚ä¸»è¦æ¥ç ”ç©¶pod.spec.containerså±æ€§ï¼Œè¿™ä¹Ÿæ˜¯podé…ç½®ä¸­æœ€ä¸ºå…³é”®çš„ä¸€é¡¹é…ç½®ã€‚</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>[<span style="color:#ae81ff">root@k8s-master01 ~]# kubectl explain pod.spec.containers</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">KIND</span>:     <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">VERSION</span>:  <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">RESOURCE</span>: <span style="color:#ae81ff">containers &lt;[]Object&gt;  </span> <span style="color:#75715e"># æ•°ç»„ï¼Œä»£è¡¨å¯ä»¥æœ‰å¤šä¸ªå®¹å™¨</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">FIELDS</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">name  &lt;string&gt;    </span> <span style="color:#75715e"># å®¹å™¨åç§°</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">image &lt;string&gt;    </span> <span style="color:#75715e"># å®¹å™¨éœ€è¦çš„é•œåƒåœ°å€</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">imagePullPolicy  &lt;string&gt;</span> <span style="color:#75715e"># é•œåƒæ‹‰å–ç­–ç•¥ </span>
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">command  &lt;[]string&gt;</span> <span style="color:#75715e"># å®¹å™¨çš„å¯åŠ¨å‘½ä»¤åˆ—è¡¨ï¼Œå¦‚ä¸æŒ‡å®šï¼Œä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">args     &lt;[]string&gt;</span> <span style="color:#75715e"># å®¹å™¨çš„å¯åŠ¨å‘½ä»¤éœ€è¦çš„å‚æ•°åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">env      &lt;[]Object&gt;</span> <span style="color:#75715e"># å®¹å™¨ç¯å¢ƒå˜é‡çš„é…ç½®</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">ports    &lt;[]Object&gt;    </span> <span style="color:#75715e"># å®¹å™¨éœ€è¦æš´éœ²çš„ç«¯å£å·åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">resources &lt;Object&gt;     </span> <span style="color:#75715e"># èµ„æºé™åˆ¶å’Œèµ„æºè¯·æ±‚çš„è®¾ç½®</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="21-åŸºæœ¬é…ç½®" class="pagebody-header">
    2.1 åŸºæœ¬é…ç½®
  </h3>
</div><p class="component-content component">åˆ›å»ºpod-base.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-base</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">user</span>: <span style="color:#ae81ff">heima</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">ä¸Šé¢å®šä¹‰äº†ä¸€ä¸ªæ¯”è¾ƒç®€å•Podçš„é…ç½®ï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªå®¹å™¨ï¼š</p>
<div class="component-content component"><ul>
<li>nginxï¼šç”¨1.17.1ç‰ˆæœ¬çš„nginxé•œåƒåˆ›å»ºï¼Œï¼ˆnginxæ˜¯ä¸€ä¸ªè½»é‡çº§webå®¹å™¨ï¼‰</li>
<li>busyboxï¼šç”¨1.30ç‰ˆæœ¬çš„busyboxé•œåƒåˆ›å»ºï¼Œï¼ˆbusyboxæ˜¯ä¸€ä¸ªå°å·§çš„linuxå‘½ä»¤é›†åˆï¼‰</li>
</ul></div>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºPod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 pod<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl apply -f pod-base.yaml</span>
</span></span><span style="display:flex;"><span>pod/pod-base created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹PodçŠ¶å†µ</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># READY 1/2 : è¡¨ç¤ºå½“å‰Podä¸­æœ‰2ä¸ªå®¹å™¨ï¼Œå…¶ä¸­1ä¸ªå‡†å¤‡å°±ç»ªï¼Œ1ä¸ªæœªå°±ç»ª</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># RESTARTS  : é‡å¯æ¬¡æ•°ï¼Œå› ä¸ºæœ‰1ä¸ªå®¹å™¨æ•…éšœäº†ï¼ŒPodä¸€ç›´åœ¨é‡å¯è¯•å›¾æ¢å¤å®ƒ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 pod<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pod -n dev</span>
</span></span><span style="display:flex;"><span>NAME       READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pod-base   1/2     Running   <span style="color:#ae81ff">4</span>          95s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯ä»¥é€šè¿‡describeæŸ¥çœ‹å†…éƒ¨çš„è¯¦æƒ…</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ­¤æ—¶å·²ç»è¿è¡Œèµ·æ¥äº†ä¸€ä¸ªåŸºæœ¬çš„Podï¼Œè™½ç„¶å®ƒæš‚æ—¶æœ‰é—®é¢˜</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 pod<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl describe pod pod-base -n dev</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="22-é•œåƒæ‹‰å–" class="pagebody-header">
    2.2 é•œåƒæ‹‰å–
  </h3>
</div><p class="component-content component">åˆ›å»ºpod-imagepullpolicy.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-imagepullpolicy</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">Never</span> <span style="color:#75715e"># ç”¨äºè®¾ç½®é•œåƒæ‹‰å–ç­–ç•¥</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">imagePullPolicyï¼Œç”¨äºè®¾ç½®é•œåƒæ‹‰å–ç­–ç•¥ï¼Œkubernetesæ”¯æŒé…ç½®ä¸‰ç§æ‹‰å–ç­–ç•¥ï¼š</p>
<div class="component-content component"><ul>
<li>Alwaysï¼šæ€»æ˜¯ä»è¿œç¨‹ä»“åº“æ‹‰å–é•œåƒï¼ˆä¸€ç›´è¿œç¨‹ä¸‹è½½ï¼‰</li>
<li>IfNotPresentï¼šæœ¬åœ°æœ‰åˆ™ä½¿ç”¨æœ¬åœ°é•œåƒï¼Œæœ¬åœ°æ²¡æœ‰åˆ™ä»è¿œç¨‹ä»“åº“æ‹‰å–é•œåƒï¼ˆæœ¬åœ°æœ‰å°±æœ¬åœ° æœ¬åœ°æ²¡è¿œç¨‹ä¸‹è½½ï¼‰</li>
<li>Neverï¼šåªä½¿ç”¨æœ¬åœ°é•œåƒï¼Œä»ä¸å»è¿œç¨‹ä»“åº“æ‹‰å–ï¼Œæœ¬åœ°æ²¡æœ‰å°±æŠ¥é”™ ï¼ˆä¸€ç›´ä½¿ç”¨æœ¬åœ°ï¼‰</li>
</ul></div>
<blockquote>
<p class="component-content component">é»˜è®¤å€¼è¯´æ˜ï¼š
å¦‚æœé•œåƒtagä¸ºå…·ä½“ç‰ˆæœ¬å·ï¼Œ é»˜è®¤ç­–ç•¥æ˜¯ï¼šIfNotPresent
å¦‚æœé•œåƒtagä¸ºï¼šlatestï¼ˆæœ€ç»ˆç‰ˆæœ¬ï¼‰ ï¼Œé»˜è®¤ç­–ç•¥æ˜¯always</p>
</blockquote>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºPod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 pod<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pod-imagepullpolicy.yaml</span>
</span></span><span style="display:flex;"><span>pod/pod-imagepullpolicy created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹Podè¯¦æƒ…</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ­¤æ—¶æ˜æ˜¾å¯ä»¥çœ‹åˆ°nginxé•œåƒæœ‰ä¸€æ­¥Pulling image &#34;nginx:1.17.1&#34;çš„è¿‡ç¨‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 pod<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl describe pod pod-imagepullpolicy -n dev</span>
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span>Events:
</span></span><span style="display:flex;"><span>  Type     Reason     Age               From               Message
</span></span><span style="display:flex;"><span>  ----     ------     ----              ----               -------
</span></span><span style="display:flex;"><span>  Normal   Scheduled  &lt;unknown&gt;         default-scheduler  Successfully assigned dev/pod-imagePullPolicy to node1
</span></span><span style="display:flex;"><span>  Normal   Pulling    32s               kubelet, node1     Pulling image <span style="color:#e6db74">&#34;nginx:1.17.1&#34;</span>
</span></span><span style="display:flex;"><span>  Normal   Pulled     26s               kubelet, node1     Successfully pulled image <span style="color:#e6db74">&#34;nginx:1.17.1&#34;</span>
</span></span><span style="display:flex;"><span>  Normal   Created    26s               kubelet, node1     Created container nginx
</span></span><span style="display:flex;"><span>  Normal   Started    25s               kubelet, node1     Started container nginx
</span></span><span style="display:flex;"><span>  Normal   Pulled     7s <span style="color:#f92672">(</span>x3 over 25s<span style="color:#f92672">)</span>  kubelet, node1     Container image <span style="color:#e6db74">&#34;busybox:1.30&#34;</span> already present on machine
</span></span><span style="display:flex;"><span>  Normal   Created    7s <span style="color:#f92672">(</span>x3 over 25s<span style="color:#f92672">)</span>  kubelet, node1     Created container busybox
</span></span><span style="display:flex;"><span>  Normal   Started    7s <span style="color:#f92672">(</span>x3 over 25s<span style="color:#f92672">)</span>  kubelet, node1     Started container busybox</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="23-å¯åŠ¨å‘½ä»¤" class="pagebody-header">
    2.3 å¯åŠ¨å‘½ä»¤
  </h3>
</div><p class="component-content component">åœ¨å‰é¢çš„æ¡ˆä¾‹ä¸­ï¼Œä¸€ç›´æœ‰ä¸€ä¸ªé—®é¢˜æ²¡æœ‰è§£å†³ï¼Œå°±æ˜¯çš„busyboxå®¹å™¨ä¸€ç›´æ²¡æœ‰æˆåŠŸè¿è¡Œï¼Œé‚£ä¹ˆåˆ°åº•æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´è¿™ä¸ªå®¹å™¨çš„æ•…éšœå‘¢ï¼Ÿ</p>
<p class="component-content component">åŸæ¥busyboxå¹¶ä¸æ˜¯ä¸€ä¸ªç¨‹åºï¼Œè€Œæ˜¯ç±»ä¼¼äºä¸€ä¸ªå·¥å…·ç±»çš„é›†åˆï¼Œkubernetesé›†ç¾¤å¯åŠ¨ç®¡ç†åï¼Œå®ƒä¼šè‡ªåŠ¨å…³é—­ã€‚è§£å†³æ–¹æ³•å°±æ˜¯è®©å…¶ä¸€ç›´åœ¨è¿è¡Œï¼Œè¿™å°±ç”¨åˆ°äº†commandé…ç½®ã€‚</p>
<p class="component-content component">åˆ›å»ºpod-command.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-command</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;touch /tmp/hello.txt;while true;do /bin/echo $(date +%T) &gt;&gt; /tmp/hello.txt; sleep 3; done;&#34;</span>]</span></span></code></pre></div></div>
  
</div><p class="component-content component"><code>command</code>ï¼Œç”¨äºåœ¨podä¸­çš„å®¹å™¨åˆå§‹åŒ–å®Œæ¯•ä¹‹åè¿è¡Œä¸€ä¸ªå‘½ä»¤ã€‚</p>
<blockquote>
<p class="component-content component">ç¨å¾®è§£é‡Šä¸‹ä¸Šé¢å‘½ä»¤çš„æ„æ€ï¼š</p>
<p class="component-content component">â€œ/bin/shâ€,â€œ-câ€, ä½¿ç”¨shæ‰§è¡Œå‘½ä»¤</p>
<p class="component-content component">touch /tmp/hello.txt; åˆ›å»ºä¸€ä¸ª/tmp/hello.txt æ–‡ä»¶</p>
<p class="component-content component">while true;do /bin/echo $(date +%T) &raquo; /tmp/hello.txt; sleep 3; done; æ¯éš”3ç§’å‘æ–‡ä»¶ä¸­å†™å…¥å½“å‰æ—¶é—´</p>
</blockquote>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºPod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 pod<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create  -f pod-command.yaml</span>
</span></span><span style="display:flex;"><span>pod/pod-command created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹PodçŠ¶æ€</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ­¤æ—¶å‘ç°ä¸¤ä¸ªpodéƒ½æ­£å¸¸è¿è¡Œäº†</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 pod<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods pod-command -n dev</span>
</span></span><span style="display:flex;"><span>NAME          READY   STATUS   RESTARTS   AGE
</span></span><span style="display:flex;"><span>pod-command   2/2     Runing   <span style="color:#ae81ff">0</span>          2s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¿›å…¥podä¸­çš„busyboxå®¹å™¨ï¼ŒæŸ¥çœ‹æ–‡ä»¶å†…å®¹</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¡¥å……ä¸€ä¸ªå‘½ä»¤: kubectl exec  podåç§° -n å‘½åç©ºé—´ -it -c å®¹å™¨åç§° /bin/sh  åœ¨å®¹å™¨å†…éƒ¨æ‰§è¡Œå‘½ä»¤</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å°±å¯ä»¥è¿›å…¥æŸä¸ªå®¹å™¨çš„å†…éƒ¨ï¼Œç„¶åè¿›è¡Œç›¸å…³æ“ä½œäº†</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¯”å¦‚ï¼Œå¯ä»¥æŸ¥çœ‹txtæ–‡ä»¶çš„å†…å®¹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 pod<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl exec pod-command -n dev -it -c busybox /bin/sh</span>
</span></span><span style="display:flex;"><span>/ <span style="color:#75715e"># tail -f /tmp/hello.txt</span>
</span></span><span style="display:flex;"><span>14:44:19
</span></span><span style="display:flex;"><span>14:44:22
</span></span><span style="display:flex;"><span>14:44:25</span></span></code></pre></div></div>
  
</div><blockquote>
<p class="component-content component">ç‰¹åˆ«è¯´æ˜ï¼š
é€šè¿‡ä¸Šé¢å‘ç°commandå·²ç»å¯ä»¥å®Œæˆå¯åŠ¨å‘½ä»¤å’Œä¼ é€’å‚æ•°çš„åŠŸèƒ½ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œè¿˜è¦æä¾›ä¸€ä¸ªargsé€‰é¡¹ï¼Œç”¨äºä¼ é€’å‚æ•°å‘¢?è¿™å…¶å®è·Ÿdockeræœ‰ç‚¹å…³ç³»ï¼Œkubernetesä¸­çš„commandã€argsä¸¤é¡¹å…¶å®æ˜¯å®ç°è¦†ç›–Dockerfileä¸­ENTRYPOINTçš„åŠŸèƒ½ã€‚
1 å¦‚æœcommandå’Œargså‡æ²¡æœ‰å†™ï¼Œé‚£ä¹ˆç”¨Dockerfileçš„é…ç½®ã€‚
2 å¦‚æœcommandå†™äº†ï¼Œä½†argsæ²¡æœ‰å†™ï¼Œé‚£ä¹ˆDockerfileé»˜è®¤çš„é…ç½®ä¼šè¢«å¿½ç•¥ï¼Œæ‰§è¡Œè¾“å…¥çš„command
3 å¦‚æœcommandæ²¡å†™ï¼Œä½†argså†™äº†ï¼Œé‚£ä¹ˆDockerfileä¸­é…ç½®çš„ENTRYPOINTçš„å‘½ä»¤ä¼šè¢«æ‰§è¡Œï¼Œä½¿ç”¨å½“å‰argsçš„å‚æ•°
4 å¦‚æœcommandå’Œargséƒ½å†™äº†ï¼Œé‚£ä¹ˆDockerfileçš„é…ç½®è¢«å¿½ç•¥ï¼Œæ‰§è¡Œcommandå¹¶è¿½åŠ ä¸Šargså‚æ•°</p>
</blockquote>

<div class="component-content pagebody component">
  <h3 id="24-ç¯å¢ƒå˜é‡" class="pagebody-header">
    2.4 ç¯å¢ƒå˜é‡
  </h3>
</div><p class="component-content component">åˆ›å»ºpod-env.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-env</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;while true;do /bin/echo $(date +%T);sleep 60; done;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">env</span>: <span style="color:#75715e"># è®¾ç½®ç¯å¢ƒå˜é‡åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;username&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;admin&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;password&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;123456&#34;</span></span></span></code></pre></div></div>
  
</div><p class="component-content component"><code>env</code>ï¼Œç¯å¢ƒå˜é‡ï¼Œç”¨äºåœ¨podä¸­çš„å®¹å™¨è®¾ç½®ç¯å¢ƒå˜é‡ã€‚</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºPod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pod-env.yaml</span>
</span></span><span style="display:flex;"><span>pod/pod-env created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¿›å…¥å®¹å™¨ï¼Œè¾“å‡ºç¯å¢ƒå˜é‡</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl exec pod-env -n dev -c busybox -it /bin/sh</span>
</span></span><span style="display:flex;"><span>/ <span style="color:#75715e"># echo $username</span>
</span></span><span style="display:flex;"><span>admin
</span></span><span style="display:flex;"><span>/ <span style="color:#75715e"># echo $password</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">123456</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">è¿™ç§æ–¹å¼ä¸æ˜¯å¾ˆæ¨èï¼Œæ¨èå°†è¿™äº›é…ç½®å•ç‹¬å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œè¿™ç§æ–¹å¼å°†åœ¨åé¢ä»‹ç»ã€‚</p>

<div class="component-content pagebody component">
  <h3 id="25-ç«¯å£è®¾ç½®" class="pagebody-header">
    2.5 ç«¯å£è®¾ç½®
  </h3>
</div><p class="component-content component">æœ¬å°èŠ‚æ¥ä»‹ç»å®¹å™¨çš„ç«¯å£è®¾ç½®ï¼Œä¹Ÿå°±æ˜¯containersçš„portsé€‰é¡¹ã€‚</p>
<p class="component-content component">é¦–å…ˆçœ‹ä¸‹portsæ”¯æŒçš„å­é€‰é¡¹ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl explain pod.spec.containers.ports</span>
</span></span><span style="display:flex;"><span>KIND:     Pod
</span></span><span style="display:flex;"><span>VERSION:  v1
</span></span><span style="display:flex;"><span>RESOURCE: ports &lt;<span style="color:#f92672">[]</span>Object&gt;
</span></span><span style="display:flex;"><span>FIELDS:
</span></span><span style="display:flex;"><span>   name         &lt;string&gt;  <span style="color:#75715e"># ç«¯å£åç§°ï¼Œå¦‚æœæŒ‡å®šï¼Œå¿…é¡»ä¿è¯nameåœ¨podä¸­æ˜¯å”¯ä¸€çš„		</span>
</span></span><span style="display:flex;"><span>   containerPort&lt;integer&gt; <span style="color:#75715e"># å®¹å™¨è¦ç›‘å¬çš„ç«¯å£(0&lt;x&lt;65536)</span>
</span></span><span style="display:flex;"><span>   hostPort     &lt;integer&gt; <span style="color:#75715e"># å®¹å™¨è¦åœ¨ä¸»æœºä¸Šå…¬å¼€çš„ç«¯å£ï¼Œå¦‚æœè®¾ç½®ï¼Œä¸»æœºä¸Šåªèƒ½è¿è¡Œå®¹å™¨çš„ä¸€ä¸ªå‰¯æœ¬(ä¸€èˆ¬çœç•¥) </span>
</span></span><span style="display:flex;"><span>   hostIP       &lt;string&gt;  <span style="color:#75715e"># è¦å°†å¤–éƒ¨ç«¯å£ç»‘å®šåˆ°çš„ä¸»æœºIP(ä¸€èˆ¬çœç•¥)</span>
</span></span><span style="display:flex;"><span>   protocol     &lt;string&gt;  <span style="color:#75715e"># ç«¯å£åè®®ã€‚å¿…é¡»æ˜¯UDPã€TCPæˆ–SCTPã€‚é»˜è®¤ä¸ºâ€œTCPâ€ã€‚</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">æ¥ä¸‹æ¥ï¼Œç¼–å†™ä¸€ä¸ªæµ‹è¯•æ¡ˆä¾‹ï¼Œåˆ›å»ºpod-ports.yaml</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-ports</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>: <span style="color:#75715e"># è®¾ç½®å®¹å™¨æš´éœ²çš„ç«¯å£åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-port</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span></span></span></code></pre></div></div>
  
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºPod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pod-ports.yaml</span>
</span></span><span style="display:flex;"><span>pod/pod-ports created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹pod</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨ä¸‹é¢å¯ä»¥æ˜æ˜¾çœ‹åˆ°é…ç½®ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pod pod-ports -n dev -o yaml</span>
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span>spec:
</span></span><span style="display:flex;"><span>  containers:
</span></span><span style="display:flex;"><span>  - image: nginx:1.17.1
</span></span><span style="display:flex;"><span>    imagePullPolicy: IfNotPresent
</span></span><span style="display:flex;"><span>    name: nginx
</span></span><span style="display:flex;"><span>    ports:
</span></span><span style="display:flex;"><span>    - containerPort: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>      name: nginx-port
</span></span><span style="display:flex;"><span>      protocol: TCP
</span></span><span style="display:flex;"><span>......</span></span></code></pre></div></div>
  
</div><p class="component-content component">è®¿é—®å®¹å™¨ä¸­çš„ç¨‹åºéœ€è¦ä½¿ç”¨çš„æ˜¯<code>Podip:containerPort</code></p>

<div class="component-content pagebody component">
  <h3 id="26-èµ„æºé…é¢" class="pagebody-header">
    2.6 èµ„æºé…é¢
  </h3>
</div><p class="component-content component">å®¹å™¨ä¸­çš„ç¨‹åºè¦è¿è¡Œï¼Œè‚¯å®šæ˜¯è¦å ç”¨ä¸€å®šèµ„æºçš„ï¼Œæ¯”å¦‚cpuå’Œå†…å­˜ç­‰ï¼Œå¦‚æœä¸å¯¹æŸä¸ªå®¹å™¨çš„èµ„æºåšé™åˆ¶ï¼Œé‚£ä¹ˆå®ƒå°±å¯èƒ½åƒæ‰å¤§é‡èµ„æºï¼Œå¯¼è‡´å…¶å®ƒå®¹å™¨æ— æ³•è¿è¡Œã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œkubernetesæä¾›äº†å¯¹å†…å­˜å’Œcpuçš„èµ„æºè¿›è¡Œé…é¢çš„æœºåˆ¶ï¼Œè¿™ç§æœºåˆ¶ä¸»è¦é€šè¿‡resourcesé€‰é¡¹å®ç°ï¼Œä»–æœ‰ä¸¤ä¸ªå­é€‰é¡¹ï¼š</p>
<p class="component-content component">limitsï¼šç”¨äºé™åˆ¶è¿è¡Œæ—¶å®¹å™¨çš„æœ€å¤§å ç”¨èµ„æºï¼Œå½“å®¹å™¨å ç”¨èµ„æºè¶…è¿‡limitsæ—¶ä¼šè¢«ç»ˆæ­¢ï¼Œå¹¶è¿›è¡Œé‡å¯
requests ï¼šç”¨äºè®¾ç½®å®¹å™¨éœ€è¦çš„æœ€å°èµ„æºï¼Œå¦‚æœç¯å¢ƒèµ„æºä¸å¤Ÿï¼Œå®¹å™¨å°†æ— æ³•å¯åŠ¨
å¯ä»¥é€šè¿‡ä¸Šé¢ä¸¤ä¸ªé€‰é¡¹è®¾ç½®èµ„æºçš„ä¸Šä¸‹é™ã€‚</p>
<p class="component-content component">æ¥ä¸‹æ¥ï¼Œç¼–å†™ä¸€ä¸ªæµ‹è¯•æ¡ˆä¾‹ï¼Œåˆ›å»ºpod-resources.yaml</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>apiVersion: v1
</span></span><span style="display:flex;"><span>kind: Pod
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  name: pod-resources
</span></span><span style="display:flex;"><span>  namespace: dev
</span></span><span style="display:flex;"><span>spec:
</span></span><span style="display:flex;"><span>  containers:
</span></span><span style="display:flex;"><span>  - name: nginx
</span></span><span style="display:flex;"><span>    image: nginx:1.17.1
</span></span><span style="display:flex;"><span>    resources: <span style="color:#75715e"># èµ„æºé…é¢</span>
</span></span><span style="display:flex;"><span>      limits:  <span style="color:#75715e"># é™åˆ¶èµ„æºï¼ˆä¸Šé™ï¼‰</span>
</span></span><span style="display:flex;"><span>        cpu: <span style="color:#e6db74">&#34;2&#34;</span> <span style="color:#75715e"># CPUé™åˆ¶ï¼Œå•ä½æ˜¯coreæ•°</span>
</span></span><span style="display:flex;"><span>        memory: <span style="color:#e6db74">&#34;10Gi&#34;</span> <span style="color:#75715e"># å†…å­˜é™åˆ¶</span>
</span></span><span style="display:flex;"><span>      requests: <span style="color:#75715e"># è¯·æ±‚èµ„æºï¼ˆä¸‹é™ï¼‰</span>
</span></span><span style="display:flex;"><span>        cpu: <span style="color:#e6db74">&#34;1&#34;</span>  <span style="color:#75715e"># CPUé™åˆ¶ï¼Œå•ä½æ˜¯coreæ•°</span>
</span></span><span style="display:flex;"><span>        memory: <span style="color:#e6db74">&#34;10Mi&#34;</span>  <span style="color:#75715e"># å†…å­˜é™åˆ¶</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">åœ¨è¿™å¯¹cpuå’Œmemoryçš„å•ä½åšä¸€ä¸ªè¯´æ˜ï¼š</p>
<div class="component-content component"><ul>
<li>cpuï¼šcoreæ•°ï¼Œå¯ä»¥ä¸ºæ•´æ•°æˆ–å°æ•°</li>
<li>memoryï¼š å†…å­˜å¤§å°ï¼Œå¯ä»¥ä½¿ç”¨Giã€Miã€Gã€Mç­‰å½¢å¼</li>
</ul></div>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># è¿è¡ŒPod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create  -f pod-resources.yaml</span>
</span></span><span style="display:flex;"><span>pod/pod-resources created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹å‘ç°podè¿è¡Œæ­£å¸¸</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pod pod-resources -n dev</span>
</span></span><span style="display:flex;"><span>NAME            READY   STATUS    RESTARTS   AGE  
</span></span><span style="display:flex;"><span>pod-resources   1/1     Running   <span style="color:#ae81ff">0</span>          39s   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¥ä¸‹æ¥ï¼Œåœæ­¢Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl delete  -f pod-resources.yaml</span>
</span></span><span style="display:flex;"><span>pod <span style="color:#e6db74">&#34;pod-resources&#34;</span> deleted
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¼–è¾‘podï¼Œä¿®æ”¹resources.requests.memoryçš„å€¼ä¸º10Gi</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># vim pod-resources.yaml</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å†æ¬¡å¯åŠ¨pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create  -f pod-resources.yaml</span>
</span></span><span style="display:flex;"><span>pod/pod-resources created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹PodçŠ¶æ€ï¼Œå‘ç°Podå¯åŠ¨å¤±è´¥</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pod pod-resources -n dev -o wide</span>
</span></span><span style="display:flex;"><span>NAME            READY   STATUS    RESTARTS   AGE          
</span></span><span style="display:flex;"><span>pod-resources   0/1     Pending   <span style="color:#ae81ff">0</span>          20s    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹podè¯¦æƒ…ä¼šå‘ç°ï¼Œå¦‚ä¸‹æç¤º</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl describe pod pod-resources -n dev</span>
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span>Warning  FailedScheduling  35s   default-scheduler  0/3 nodes are available: <span style="color:#ae81ff">1</span> node<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span> had taint <span style="color:#f92672">{</span>node-role.kubernetes.io/master: <span style="color:#f92672">}</span>, that the pod didn<span style="color:#960050;background-color:#1e0010">&#39;</span>t tolerate, <span style="color:#ae81ff">2</span> Insufficient memory.<span style="color:#f92672">(</span>å†…å­˜ä¸è¶³<span style="color:#f92672">)</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h2 id="ä¸‰podç”Ÿå‘½å‘¨æœŸ" class="pagebody-header">
    ä¸‰ã€Podç”Ÿå‘½å‘¨æœŸ
  </h2>
</div><p class="component-content component">æˆ‘ä»¬ä¸€èˆ¬å°†podå¯¹è±¡ä»åˆ›å»ºè‡³ç»ˆçš„è¿™æ®µæ—¶é—´èŒƒå›´ç§°ä¸ºpodçš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒä¸»è¦åŒ…å«ä¸‹é¢çš„è¿‡ç¨‹ï¼š</p>
<div class="component-content component"><ul>
<li>podåˆ›å»ºè¿‡ç¨‹</li>
<li>è¿è¡Œåˆå§‹åŒ–å®¹å™¨ï¼ˆinit containerï¼‰è¿‡ç¨‹</li>
<li>è¿è¡Œä¸»å®¹å™¨ï¼ˆmain containerï¼‰</li>
<li>å®¹å™¨å¯åŠ¨åé’©å­ï¼ˆpost startï¼‰ã€å®¹å™¨ç»ˆæ­¢å‰é’©å­ï¼ˆpre stopï¼‰</li>
<li>å®¹å™¨çš„å­˜æ´»æ€§æ¢æµ‹ï¼ˆliveness probeï¼‰ã€å°±ç»ªæ€§æ¢æµ‹ï¼ˆreadiness probeï¼‰</li>
</ul></div>
<p class="component-content component">podç»ˆæ­¢è¿‡ç¨‹</p>
<!-- raw HTML omitted -->
<p class="component-content component">åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼ŒPodä¼šå‡ºç°5ç§çŠ¶æ€ï¼ˆç›¸ä½ï¼‰ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p>
<div class="component-content component"><ul>
<li>æŒ‚èµ·ï¼ˆPendingï¼‰ï¼šapiserverå·²ç»åˆ›å»ºäº†podèµ„æºå¯¹è±¡ï¼Œä½†å®ƒå°šæœªè¢«è°ƒåº¦å®Œæˆæˆ–è€…ä»å¤„äºä¸‹è½½é•œåƒçš„è¿‡ç¨‹ä¸­</li>
<li>è¿è¡Œä¸­ï¼ˆRunningï¼‰ï¼špodå·²ç»è¢«è°ƒåº¦è‡³æŸèŠ‚ç‚¹ï¼Œå¹¶ä¸”æ‰€æœ‰å®¹å™¨éƒ½å·²ç»è¢«kubeletåˆ›å»ºå®Œæˆ</li>
<li>æˆåŠŸï¼ˆSucceededï¼‰ï¼špodä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½å·²ç»æˆåŠŸç»ˆæ­¢å¹¶ä¸”ä¸ä¼šè¢«é‡å¯</li>
<li>å¤±è´¥ï¼ˆFailedï¼‰ï¼šæ‰€æœ‰å®¹å™¨éƒ½å·²ç»ç»ˆæ­¢ï¼Œä½†è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨ç»ˆæ­¢å¤±è´¥ï¼Œå³å®¹å™¨è¿”å›äº†é0å€¼çš„é€€å‡ºçŠ¶æ€</li>
<li>æœªçŸ¥ï¼ˆUnknownï¼‰ï¼šapiserveræ— æ³•æ­£å¸¸è·å–åˆ°podå¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯ï¼Œé€šå¸¸ç”±ç½‘ç»œé€šä¿¡å¤±è´¥æ‰€å¯¼è‡´</li>
</ul></div>

<div class="component-content pagebody component">
  <h3 id="31-åˆ›å»ºå’Œç»ˆæ­¢" class="pagebody-header">
    3.1 åˆ›å»ºå’Œç»ˆæ­¢
  </h3>
</div><p class="component-content component">podçš„åˆ›å»ºè¿‡ç¨‹</p>
<div class="component-content component"><ol>
<li>ç”¨æˆ·é€šè¿‡kubectlæˆ–å…¶ä»–apiå®¢æˆ·ç«¯æäº¤éœ€è¦åˆ›å»ºçš„podä¿¡æ¯ç»™apiServer</li>
<li>apiServerå¼€å§‹ç”Ÿæˆpodå¯¹è±¡çš„ä¿¡æ¯ï¼Œå¹¶å°†ä¿¡æ¯å­˜å…¥etcdï¼Œç„¶åè¿”å›ç¡®è®¤ä¿¡æ¯è‡³å®¢æˆ·ç«¯</li>
<li>apiServerå¼€å§‹åæ˜ etcdä¸­çš„podå¯¹è±¡çš„å˜åŒ–ï¼Œå…¶å®ƒç»„ä»¶ä½¿ç”¨watchæœºåˆ¶æ¥è·Ÿè¸ªæ£€æŸ¥apiServerä¸Šçš„å˜åŠ¨</li>
<li>schedulerå‘ç°æœ‰æ–°çš„podå¯¹è±¡è¦åˆ›å»ºï¼Œå¼€å§‹ä¸ºPodåˆ†é…ä¸»æœºå¹¶å°†ç»“æœä¿¡æ¯æ›´æ–°è‡³apiServer</li>
<li>nodeèŠ‚ç‚¹ä¸Šçš„kubeletå‘ç°æœ‰podè°ƒåº¦è¿‡æ¥ï¼Œå°è¯•è°ƒç”¨dockerå¯åŠ¨å®¹å™¨ï¼Œå¹¶å°†ç»“æœå›é€è‡³apiServer</li>
<li>apiServerå°†æ¥æ”¶åˆ°çš„podçŠ¶æ€ä¿¡æ¯å­˜å…¥etcdä¸­</li>
</ol></div>
<!-- raw HTML omitted -->
<p class="component-content component">podçš„ç»ˆæ­¢è¿‡ç¨‹</p>
<div class="component-content component"><ol>
<li>ç”¨æˆ·å‘apiServerå‘é€åˆ é™¤podå¯¹è±¡çš„å‘½ä»¤</li>
<li>apiServcerä¸­çš„podå¯¹è±¡ä¿¡æ¯ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œæ›´æ–°ï¼Œåœ¨å®½é™æœŸå†…ï¼ˆé»˜è®¤30sï¼‰ï¼Œpodè¢«è§†ä¸ºdead</li>
<li>å°†podæ ‡è®°ä¸ºterminatingçŠ¶æ€</li>
<li>kubeletåœ¨ç›‘æ§åˆ°podå¯¹è±¡è½¬ä¸ºterminatingçŠ¶æ€çš„åŒæ—¶å¯åŠ¨podå…³é—­è¿‡ç¨‹</li>
<li>ç«¯ç‚¹æ§åˆ¶å™¨ç›‘æ§åˆ°podå¯¹è±¡çš„å…³é—­è¡Œä¸ºæ—¶å°†å…¶ä»æ‰€æœ‰åŒ¹é…åˆ°æ­¤ç«¯ç‚¹çš„serviceèµ„æºçš„ç«¯ç‚¹åˆ—è¡¨ä¸­ç§»é™¤</li>
<li>å¦‚æœå½“å‰podå¯¹è±¡å®šä¹‰äº†preStopé’©å­å¤„ç†å™¨ï¼Œåˆ™åœ¨å…¶æ ‡è®°ä¸ºterminatingåå³ä¼šä»¥åŒæ­¥çš„æ–¹å¼å¯åŠ¨æ‰§è¡Œ</li>
<li>podå¯¹è±¡ä¸­çš„å®¹å™¨è¿›ç¨‹æ”¶åˆ°åœæ­¢ä¿¡å·</li>
<li>å®½é™æœŸç»“æŸåï¼Œè‹¥podä¸­è¿˜å­˜åœ¨ä»åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œé‚£ä¹ˆpodå¯¹è±¡ä¼šæ”¶åˆ°ç«‹å³ç»ˆæ­¢çš„ä¿¡å·</li>
<li>kubeletè¯·æ±‚apiServerå°†æ­¤podèµ„æºçš„å®½é™æœŸè®¾ç½®ä¸º0ä»è€Œå®Œæˆåˆ é™¤æ“ä½œï¼Œæ­¤æ—¶podå¯¹äºç”¨æˆ·å·²ä¸å¯è§</li>
</ol></div>

<div class="component-content pagebody component">
  <h3 id="32-åˆå§‹åŒ–å®¹å™¨" class="pagebody-header">
    3.2 åˆå§‹åŒ–å®¹å™¨
  </h3>
</div><p class="component-content component">åˆå§‹åŒ–å®¹å™¨æ˜¯åœ¨podçš„ä¸»å®¹å™¨å¯åŠ¨ä¹‹å‰è¦è¿è¡Œçš„å®¹å™¨ï¼Œä¸»è¦æ˜¯åšä¸€äº›ä¸»å®¹å™¨çš„å‰ç½®å·¥ä½œï¼Œå®ƒå…·æœ‰ä¸¤å¤§ç‰¹å¾ï¼š</p>
<div class="component-content component"><ol>
<li>åˆå§‹åŒ–å®¹å™¨å¿…é¡»è¿è¡Œå®Œæˆç›´è‡³ç»“æŸï¼Œè‹¥æŸåˆå§‹åŒ–å®¹å™¨è¿è¡Œå¤±è´¥ï¼Œé‚£ä¹ˆkuberneteséœ€è¦é‡å¯å®ƒç›´åˆ°æˆåŠŸå®Œæˆ</li>
<li>åˆå§‹åŒ–å®¹å™¨å¿…é¡»æŒ‰ç…§å®šä¹‰çš„é¡ºåºæ‰§è¡Œï¼Œå½“ä¸”ä»…å½“å‰ä¸€ä¸ªæˆåŠŸä¹‹åï¼Œåé¢çš„ä¸€ä¸ªæ‰èƒ½è¿è¡Œ</li>
</ol></div>
<p class="component-content component">åˆå§‹åŒ–å®¹å™¨æœ‰å¾ˆå¤šçš„åº”ç”¨åœºæ™¯ï¼Œä¸‹é¢åˆ—å‡ºçš„æ˜¯æœ€å¸¸è§çš„å‡ ä¸ªï¼š</p>
<div class="component-content component"><ul>
<li>æä¾›ä¸»å®¹å™¨é•œåƒä¸­ä¸å…·å¤‡çš„å·¥å…·ç¨‹åºæˆ–è‡ªå®šä¹‰ä»£ç </li>
<li>åˆå§‹åŒ–å®¹å™¨è¦å…ˆäºåº”ç”¨å®¹å™¨ä¸²è¡Œå¯åŠ¨å¹¶è¿è¡Œå®Œæˆï¼Œå› æ­¤å¯ç”¨äºå»¶ååº”ç”¨å®¹å™¨çš„å¯åŠ¨ç›´è‡³å…¶ä¾èµ–çš„æ¡ä»¶å¾—åˆ°æ»¡è¶³</li>
</ul></div>
<p class="component-content component">æ¥ä¸‹æ¥åšä¸€ä¸ªæ¡ˆä¾‹ï¼Œæ¨¡æ‹Ÿä¸‹é¢è¿™ä¸ªéœ€æ±‚ï¼š</p>
<p class="component-content component">å‡è®¾è¦ä»¥ä¸»å®¹å™¨æ¥è¿è¡Œnginxï¼Œä½†æ˜¯è¦æ±‚åœ¨è¿è¡Œnginxä¹‹å‰å…ˆè¦èƒ½å¤Ÿè¿æ¥ä¸Šmysqlå’Œredisæ‰€åœ¨æœåŠ¡å™¨</p>
<p class="component-content component">ä¸ºäº†ç®€åŒ–æµ‹è¯•ï¼Œäº‹å…ˆè§„å®šå¥½mysql(192.168.90.14)å’Œredis(192.168.90.15)æœåŠ¡å™¨çš„åœ°å€</p>
<p class="component-content component">åˆ›å»ºpod-initcontainer.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-initcontainer</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">main-container</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>: 
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-port</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">initContainers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">test-mysql</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#39;sh&#39;</span>, <span style="color:#e6db74">&#39;-c&#39;</span>, <span style="color:#e6db74">&#39;until ping 192.168.90.14 -c 1 ; do echo waiting for mysql...; sleep 2; done;&#39;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">test-redis</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#39;sh&#39;</span>, <span style="color:#e6db74">&#39;-c&#39;</span>, <span style="color:#e6db74">&#39;until ping 192.168.90.15 -c 1 ; do echo waiting for reids...; sleep 2; done;&#39;</span>]</span></span></code></pre></div></div>
  
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºpod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pod-initcontainer.yaml</span>
</span></span><span style="display:flex;"><span>pod/pod-initcontainer created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹podçŠ¶æ€</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‘ç°podå¡åœ¨å¯åŠ¨ç¬¬ä¸€ä¸ªåˆå§‹åŒ–å®¹å™¨è¿‡ç¨‹ä¸­ï¼Œåé¢çš„å®¹å™¨ä¸ä¼šè¿è¡Œ</span>
</span></span><span style="display:flex;"><span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl describe pod  pod-initcontainer -n dev</span>
</span></span><span style="display:flex;"><span>........
</span></span><span style="display:flex;"><span>Events:
</span></span><span style="display:flex;"><span>  Type    Reason     Age   From               Message
</span></span><span style="display:flex;"><span>  ----    ------     ----  ----               -------
</span></span><span style="display:flex;"><span>  Normal  Scheduled  49s   default-scheduler  Successfully assigned dev/pod-initcontainer to node1
</span></span><span style="display:flex;"><span>  Normal  Pulled     48s   kubelet, node1     Container image <span style="color:#e6db74">&#34;busybox:1.30&#34;</span> already present on machine
</span></span><span style="display:flex;"><span>  Normal  Created    48s   kubelet, node1     Created container test-mysql
</span></span><span style="display:flex;"><span>  Normal  Started    48s   kubelet, node1     Started container test-mysql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åŠ¨æ€æŸ¥çœ‹pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods pod-initcontainer -n dev -w</span>
</span></span><span style="display:flex;"><span>NAME                             READY   STATUS     RESTARTS   AGE
</span></span><span style="display:flex;"><span>pod-initcontainer                0/1     Init:0/2   <span style="color:#ae81ff">0</span>          15s
</span></span><span style="display:flex;"><span>pod-initcontainer                0/1     Init:1/2   <span style="color:#ae81ff">0</span>          52s
</span></span><span style="display:flex;"><span>pod-initcontainer                0/1     Init:1/2   <span style="color:#ae81ff">0</span>          53s
</span></span><span style="display:flex;"><span>pod-initcontainer                0/1     PodInitializing   <span style="color:#ae81ff">0</span>          89s
</span></span><span style="display:flex;"><span>pod-initcontainer                1/1     Running           <span style="color:#ae81ff">0</span>          90s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¥ä¸‹æ¥æ–°å¼€ä¸€ä¸ªshellï¼Œä¸ºå½“å‰æœåŠ¡å™¨æ–°å¢ä¸¤ä¸ªipï¼Œè§‚å¯Ÿpodçš„å˜åŒ–</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ifconfig ens33:1 192.168.90.14 netmask 255.255.255.0 up</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ifconfig ens33:2 192.168.90.15 netmask 255.255.255.0 up</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="33-é’©å­å‡½æ•°" class="pagebody-header">
    3.3 é’©å­å‡½æ•°
  </h3>
</div><p class="component-content component">é’©å­å‡½æ•°èƒ½å¤Ÿæ„ŸçŸ¥è‡ªèº«ç”Ÿå‘½å‘¨æœŸä¸­çš„äº‹ä»¶ï¼Œå¹¶åœ¨ç›¸åº”çš„æ—¶åˆ»åˆ°æ¥æ—¶è¿è¡Œç”¨æˆ·æŒ‡å®šçš„ç¨‹åºä»£ç ã€‚</p>
<p class="component-content component">kubernetesåœ¨ä¸»å®¹å™¨çš„å¯åŠ¨ä¹‹åå’Œåœæ­¢ä¹‹å‰æä¾›äº†ä¸¤ä¸ªé’©å­å‡½æ•°ï¼š</p>
<div class="component-content component"><ul>
<li>post startï¼šå®¹å™¨åˆ›å»ºä¹‹åæ‰§è¡Œï¼Œå¦‚æœå¤±è´¥äº†ä¼šé‡å¯å®¹å™¨</li>
<li>pre stop ï¼šå®¹å™¨ç»ˆæ­¢ä¹‹å‰æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæˆä¹‹åå®¹å™¨å°†æˆåŠŸç»ˆæ­¢ï¼Œåœ¨å…¶å®Œæˆä¹‹å‰ä¼šé˜»å¡åˆ é™¤å®¹å™¨çš„æ“ä½œ</li>
</ul></div>
<p class="component-content component">é’©å­å¤„ç†å™¨æ”¯æŒä½¿ç”¨ä¸‹é¢ä¸‰ç§æ–¹å¼å®šä¹‰åŠ¨ä½œï¼š</p>
<div class="component-content component"><ul>
<li>Execå‘½ä»¤ï¼šåœ¨å®¹å™¨å†…æ‰§è¡Œä¸€æ¬¡å‘½ä»¤</li>
</ul></div>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ae81ff">â€¦â€¦</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">lifecycle</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">postStart</span>: 
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">exec</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">cat</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">/tmp/healthy</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">â€¦â€¦</span></span></span></code></pre></div></div>
  
</div><div class="component-content component"><ul>
<li>TCPSocketï¼šåœ¨å½“å‰å®¹å™¨å°è¯•è®¿é—®æŒ‡å®šçš„socket</li>
</ul></div>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ae81ff">â€¦â€¦      </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">lifecycle</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">postStart</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">tcpSocket</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">port</span>: <span style="color:#ae81ff">8080</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">â€¦â€¦</span></span></span></code></pre></div></div>
  
</div><div class="component-content component"><ul>
<li>HTTPGetï¼šåœ¨å½“å‰å®¹å™¨ä¸­å‘æŸurlå‘èµ·httpè¯·æ±‚</li>
</ul></div>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ae81ff">â€¦â€¦</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">lifecycle</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">postStart</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">httpGet</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/</span> <span style="color:#75715e">#URIåœ°å€</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span> <span style="color:#75715e">#ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">host</span>: <span style="color:#ae81ff">192.168.5.3</span> <span style="color:#75715e">#ä¸»æœºåœ°å€</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">scheme</span>: <span style="color:#ae81ff">HTTP</span> <span style="color:#75715e">#æ”¯æŒçš„åè®®ï¼Œhttpæˆ–è€…https</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">â€¦â€¦</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">æ¥ä¸‹æ¥ï¼Œä»¥execæ–¹å¼ä¸ºä¾‹ï¼Œæ¼”ç¤ºä¸‹é’©å­å‡½æ•°çš„ä½¿ç”¨ï¼Œåˆ›å»ºpod-hook-exec.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-hook-exec</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">main-container</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-port</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">lifecycle</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">postStart</span>: 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">exec</span>: <span style="color:#75715e"># åœ¨å®¹å™¨å¯åŠ¨çš„æ—¶å€™æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œä¿®æ”¹æ‰nginxçš„é»˜è®¤é¦–é¡µå†…å®¹</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>, <span style="color:#e6db74">&#34;-c&#34;</span>, <span style="color:#e6db74">&#34;echo postStart... &gt; /usr/share/nginx/html/index.html&#34;</span>]
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">preStop</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">exec</span>: <span style="color:#75715e"># åœ¨å®¹å™¨åœæ­¢ä¹‹å‰åœæ­¢nginxæœåŠ¡</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/usr/sbin/nginx&#34;</span>,<span style="color:#e6db74">&#34;-s&#34;</span>,<span style="color:#e6db74">&#34;quit&#34;</span>]</span></span></code></pre></div></div>
  
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºpod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pod-hook-exec.yaml</span>
</span></span><span style="display:flex;"><span>pod/pod-hook-exec created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods  pod-hook-exec -n dev -o wide</span>
</span></span><span style="display:flex;"><span>NAME           READY   STATUS     RESTARTS   AGE    IP            NODE    
</span></span><span style="display:flex;"><span>pod-hook-exec  1/1     Running    <span style="color:#ae81ff">0</span>          29s    10.244.2.48   node2   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è®¿é—®pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># curl 10.244.2.48</span>
</span></span><span style="display:flex;"><span>postStart...</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="34-å®¹å™¨æ¢æµ‹" class="pagebody-header">
    3.4 å®¹å™¨æ¢æµ‹
  </h3>
</div><p class="component-content component">å®¹å™¨æ¢æµ‹ç”¨äºæ£€æµ‹å®¹å™¨ä¸­çš„åº”ç”¨å®ä¾‹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œæ˜¯ä¿éšœä¸šåŠ¡å¯ç”¨æ€§çš„ä¸€ç§ä¼ ç»Ÿæœºåˆ¶ã€‚å¦‚æœç»è¿‡æ¢æµ‹ï¼Œå®ä¾‹çš„çŠ¶æ€ä¸ç¬¦åˆé¢„æœŸï¼Œé‚£ä¹ˆkuberneteså°±ä¼šæŠŠè¯¥é—®é¢˜å®ä¾‹&quot; æ‘˜é™¤ &ldquo;ï¼Œä¸æ‰¿æ‹…ä¸šåŠ¡æµé‡ã€‚kubernetesæä¾›äº†ä¸¤ç§æ¢é’ˆæ¥å®ç°å®¹å™¨æ¢æµ‹ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<div class="component-content component"><ul>
<li>liveness probesï¼šå­˜æ´»æ€§æ¢é’ˆï¼Œç”¨äºæ£€æµ‹åº”ç”¨å®ä¾‹å½“å‰æ˜¯å¦å¤„äºæ­£å¸¸è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯ï¼Œk8sä¼šé‡å¯å®¹å™¨</li>
<li>readiness probesï¼šå°±ç»ªæ€§æ¢é’ˆï¼Œç”¨äºæ£€æµ‹åº”ç”¨å®ä¾‹å½“å‰æ˜¯å¦å¯ä»¥æ¥æ”¶è¯·æ±‚ï¼Œå¦‚æœä¸èƒ½ï¼Œk8sä¸ä¼šè½¬å‘æµé‡</li>
</ul></div>
<blockquote>
<p class="component-content component">livenessProbe å†³å®šæ˜¯å¦é‡å¯å®¹å™¨ï¼ŒreadinessProbe å†³å®šæ˜¯å¦å°†è¯·æ±‚è½¬å‘ç»™å®¹å™¨ã€‚</p>
</blockquote>
<p class="component-content component">ä¸Šé¢ä¸¤ç§æ¢é’ˆç›®å‰å‡æ”¯æŒä¸‰ç§æ¢æµ‹æ–¹å¼ï¼š</p>
<div class="component-content component"><ul>
<li>Execå‘½ä»¤ï¼šåœ¨å®¹å™¨å†…æ‰§è¡Œä¸€æ¬¡å‘½ä»¤ï¼Œå¦‚æœå‘½ä»¤æ‰§è¡Œçš„é€€å‡ºç ä¸º0ï¼Œåˆ™è®¤ä¸ºç¨‹åºæ­£å¸¸ï¼Œå¦åˆ™ä¸æ­£å¸¸</li>
</ul></div>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ae81ff">â€¦â€¦</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">livenessProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">exec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">command</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">cat</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/tmp/healthy</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">â€¦â€¦</span></span></span></code></pre></div></div>
  
</div><div class="component-content component"><ul>
<li>TCPSocketï¼šå°†ä¼šå°è¯•è®¿é—®ä¸€ä¸ªç”¨æˆ·å®¹å™¨çš„ç«¯å£ï¼Œå¦‚æœèƒ½å¤Ÿå»ºç«‹è¿™æ¡è¿æ¥ï¼Œåˆ™è®¤ä¸ºç¨‹åºæ­£å¸¸ï¼Œå¦åˆ™ä¸æ­£å¸¸</li>
</ul></div>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ae81ff">â€¦â€¦      </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">livenessProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">tcpSocket</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">port</span>: <span style="color:#ae81ff">8080</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">â€¦â€¦</span></span></span></code></pre></div></div>
  
</div><div class="component-content component"><ul>
<li>HTTPGetï¼šè°ƒç”¨å®¹å™¨å†…Webåº”ç”¨çš„URLï¼Œå¦‚æœè¿”å›çš„çŠ¶æ€ç åœ¨200å’Œ399ä¹‹é—´ï¼Œåˆ™è®¤ä¸ºç¨‹åºæ­£å¸¸ï¼Œå¦åˆ™ä¸æ­£å¸¸</li>
</ul></div>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ae81ff">â€¦â€¦</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">livenessProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">httpGet</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/</span> <span style="color:#75715e">#URIåœ°å€</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span> <span style="color:#75715e">#ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">host</span>: <span style="color:#ae81ff">127.0.0.1</span> <span style="color:#75715e">#ä¸»æœºåœ°å€</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">scheme</span>: <span style="color:#ae81ff">HTTP</span> <span style="color:#75715e">#æ”¯æŒçš„åè®®ï¼Œhttpæˆ–è€…https</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">â€¦â€¦</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">ä¸‹é¢ä»¥liveness probesä¸ºä¾‹ï¼Œåšå‡ ä¸ªæ¼”ç¤ºï¼š</p>
<p class="component-content component"><strong>æ–¹å¼ä¸€ï¼šExec</strong></p>
<p class="component-content component">åˆ›å»ºpod-liveness-exec.yaml</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-liveness-exec</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>: 
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-port</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">livenessProbe</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">exec</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/cat&#34;</span>,<span style="color:#e6db74">&#34;/tmp/hello.txt&#34;</span>] <span style="color:#75715e"># æ‰§è¡Œä¸€ä¸ªæŸ¥çœ‹æ–‡ä»¶çš„å‘½ä»¤</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">åˆ›å»ºpodï¼Œè§‚å¯Ÿæ•ˆæœ</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºPod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pod-liveness-exec.yaml</span>
</span></span><span style="display:flex;"><span>pod/pod-liveness-exec created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹Podè¯¦æƒ…</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl describe pods pod-liveness-exec -n dev</span>
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span>  Normal   Created    20s <span style="color:#f92672">(</span>x2 over 50s<span style="color:#f92672">)</span>  kubelet, node1     Created container nginx
</span></span><span style="display:flex;"><span>  Normal   Started    20s <span style="color:#f92672">(</span>x2 over 50s<span style="color:#f92672">)</span>  kubelet, node1     Started container nginx
</span></span><span style="display:flex;"><span>  Normal   Killing    20s                kubelet, node1     Container nginx failed liveness probe, will be restarted
</span></span><span style="display:flex;"><span>  Warning  Unhealthy  0s <span style="color:#f92672">(</span>x5 over 40s<span style="color:#f92672">)</span>   kubelet, node1     Liveness probe failed: cat: can<span style="color:#e6db74">&#39;t open &#39;</span>/tmp/hello11.txt<span style="color:#960050;background-color:#1e0010">&#39;</span>: No such file or directory
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è§‚å¯Ÿä¸Šé¢çš„ä¿¡æ¯å°±ä¼šå‘ç°nginxå®¹å™¨å¯åŠ¨ä¹‹åå°±è¿›è¡Œäº†å¥åº·æ£€æŸ¥</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ£€æŸ¥å¤±è´¥ä¹‹åï¼Œå®¹å™¨è¢«killæ‰ï¼Œç„¶åå°è¯•è¿›è¡Œé‡å¯ï¼ˆè¿™æ˜¯é‡å¯ç­–ç•¥çš„ä½œç”¨ï¼Œåé¢è®²è§£ï¼‰</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¨ç­‰ä¸€ä¼šä¹‹åï¼Œå†è§‚å¯Ÿpodä¿¡æ¯ï¼Œå°±å¯ä»¥çœ‹åˆ°RESTARTSä¸å†æ˜¯0ï¼Œè€Œæ˜¯ä¸€ç›´å¢é•¿</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods pod-liveness-exec -n dev</span>
</span></span><span style="display:flex;"><span>NAME                READY   STATUS             RESTARTS   AGE
</span></span><span style="display:flex;"><span>pod-liveness-exec   0/1     CrashLoopBackOff   <span style="color:#ae81ff">2</span>          3m19s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å½“ç„¶æ¥ä¸‹æ¥ï¼Œå¯ä»¥ä¿®æ”¹æˆä¸€ä¸ªå­˜åœ¨çš„æ–‡ä»¶ï¼Œæ¯”å¦‚/tmp/hello.txtï¼Œå†è¯•ï¼Œç»“æœå°±æ­£å¸¸äº†......</span></span></span></code></pre></div></div>
  
</div><p class="component-content component"><strong>æ–¹å¼äºŒï¼šTCPSocket</strong></p>
<p class="component-content component">åˆ›å»ºpod-liveness-tcpsocket.yaml</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-liveness-tcpsocket</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>: 
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-port</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">livenessProbe</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">tcpSocket</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">port</span>: <span style="color:#ae81ff">8080</span> <span style="color:#75715e"># å°è¯•è®¿é—®8080ç«¯å£</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">åˆ›å»ºpodï¼Œè§‚å¯Ÿæ•ˆæœ</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºPod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pod-liveness-tcpsocket.yaml</span>
</span></span><span style="display:flex;"><span>pod/pod-liveness-tcpsocket created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹Podè¯¦æƒ…</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl describe pods pod-liveness-tcpsocket -n dev</span>
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span>  Normal   Scheduled  31s                            default-scheduler  Successfully assigned dev/pod-liveness-tcpsocket to node2
</span></span><span style="display:flex;"><span>  Normal   Pulled     &lt;invalid&gt;                      kubelet, node2     Container image <span style="color:#e6db74">&#34;nginx:1.17.1&#34;</span> already present on machine
</span></span><span style="display:flex;"><span>  Normal   Created    &lt;invalid&gt;                      kubelet, node2     Created container nginx
</span></span><span style="display:flex;"><span>  Normal   Started    &lt;invalid&gt;                      kubelet, node2     Started container nginx
</span></span><span style="display:flex;"><span>  Warning  Unhealthy  &lt;invalid&gt; <span style="color:#f92672">(</span>x2 over &lt;invalid&gt;<span style="color:#f92672">)</span>  kubelet, node2     Liveness probe failed: dial tcp 10.244.2.44:8080: connect: connection refused
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è§‚å¯Ÿä¸Šé¢çš„ä¿¡æ¯ï¼Œå‘ç°å°è¯•è®¿é—®8080ç«¯å£,ä½†æ˜¯å¤±è´¥äº†</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¨ç­‰ä¸€ä¼šä¹‹åï¼Œå†è§‚å¯Ÿpodä¿¡æ¯ï¼Œå°±å¯ä»¥çœ‹åˆ°RESTARTSä¸å†æ˜¯0ï¼Œè€Œæ˜¯ä¸€ç›´å¢é•¿</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods pod-liveness-tcpsocket  -n dev</span>
</span></span><span style="display:flex;"><span>NAME                     READY   STATUS             RESTARTS   AGE
</span></span><span style="display:flex;"><span>pod-liveness-tcpsocket   0/1     CrashLoopBackOff   <span style="color:#ae81ff">2</span>          3m19s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å½“ç„¶æ¥ä¸‹æ¥ï¼Œå¯ä»¥ä¿®æ”¹æˆä¸€ä¸ªå¯ä»¥è®¿é—®çš„ç«¯å£ï¼Œæ¯”å¦‚80ï¼Œå†è¯•ï¼Œç»“æœå°±æ­£å¸¸äº†......</span></span></span></code></pre></div></div>
  
</div><p class="component-content component"><strong>æ–¹å¼ä¸‰ï¼šHTTPGet</strong></p>
<p class="component-content component">åˆ›å»ºpod-liveness-httpget.yaml</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-liveness-httpget</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-port</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">livenessProbe</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">httpGet</span>:  <span style="color:#75715e"># å…¶å®å°±æ˜¯è®¿é—®http://127.0.0.1:80/hello  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">scheme</span>: <span style="color:#ae81ff">HTTP</span> <span style="color:#75715e">#æ”¯æŒçš„åè®®ï¼Œhttpæˆ–è€…https</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span> <span style="color:#75715e">#ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/hello</span> <span style="color:#75715e">#URIåœ°å€</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">åˆ›å»ºpodï¼Œè§‚å¯Ÿæ•ˆæœ</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºPod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pod-liveness-httpget.yaml</span>
</span></span><span style="display:flex;"><span>pod/pod-liveness-httpget created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹Podè¯¦æƒ…</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl describe pod pod-liveness-httpget -n dev</span>
</span></span><span style="display:flex;"><span>.......
</span></span><span style="display:flex;"><span>  Normal   Pulled     6s <span style="color:#f92672">(</span>x3 over 64s<span style="color:#f92672">)</span>  kubelet, node1     Container image <span style="color:#e6db74">&#34;nginx:1.17.1&#34;</span> already present on machine
</span></span><span style="display:flex;"><span>  Normal   Created    6s <span style="color:#f92672">(</span>x3 over 64s<span style="color:#f92672">)</span>  kubelet, node1     Created container nginx
</span></span><span style="display:flex;"><span>  Normal   Started    6s <span style="color:#f92672">(</span>x3 over 63s<span style="color:#f92672">)</span>  kubelet, node1     Started container nginx
</span></span><span style="display:flex;"><span>  Warning  Unhealthy  6s <span style="color:#f92672">(</span>x6 over 56s<span style="color:#f92672">)</span>  kubelet, node1     Liveness probe failed: HTTP probe failed with statuscode: <span style="color:#ae81ff">404</span>
</span></span><span style="display:flex;"><span>  Normal   Killing    6s <span style="color:#f92672">(</span>x2 over 36s<span style="color:#f92672">)</span>  kubelet, node1     Container nginx failed liveness probe, will be restarted
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è§‚å¯Ÿä¸Šé¢ä¿¡æ¯ï¼Œå°è¯•è®¿é—®è·¯å¾„ï¼Œä½†æ˜¯æœªæ‰¾åˆ°,å‡ºç°404é”™è¯¯</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¨ç­‰ä¸€ä¼šä¹‹åï¼Œå†è§‚å¯Ÿpodä¿¡æ¯ï¼Œå°±å¯ä»¥çœ‹åˆ°RESTARTSä¸å†æ˜¯0ï¼Œè€Œæ˜¯ä¸€ç›´å¢é•¿</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pod pod-liveness-httpget -n dev</span>
</span></span><span style="display:flex;"><span>NAME                   READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pod-liveness-httpget   1/1     Running   <span style="color:#ae81ff">5</span>          3m17s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å½“ç„¶æ¥ä¸‹æ¥ï¼Œå¯ä»¥ä¿®æ”¹æˆä¸€ä¸ªå¯ä»¥è®¿é—®çš„è·¯å¾„pathï¼Œæ¯”å¦‚/ï¼Œå†è¯•ï¼Œç»“æœå°±æ­£å¸¸äº†......</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">è‡³æ­¤ï¼Œå·²ç»ä½¿ç”¨liveness Probeæ¼”ç¤ºäº†ä¸‰ç§æ¢æµ‹æ–¹å¼ï¼Œä½†æ˜¯æŸ¥çœ‹livenessProbeçš„å­å±æ€§ï¼Œä¼šå‘ç°é™¤äº†è¿™ä¸‰ç§æ–¹å¼ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„é…ç½®ï¼Œåœ¨è¿™é‡Œä¸€å¹¶è§£é‡Šä¸‹ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl explain pod.spec.containers.livenessProbe</span>
</span></span><span style="display:flex;"><span>FIELDS:
</span></span><span style="display:flex;"><span>   exec &lt;Object&gt;  
</span></span><span style="display:flex;"><span>   tcpSocket    &lt;Object&gt;
</span></span><span style="display:flex;"><span>   httpGet      &lt;Object&gt;
</span></span><span style="display:flex;"><span>   initialDelaySeconds  &lt;integer&gt;  <span style="color:#75715e"># å®¹å™¨å¯åŠ¨åç­‰å¾…å¤šå°‘ç§’æ‰§è¡Œç¬¬ä¸€æ¬¡æ¢æµ‹</span>
</span></span><span style="display:flex;"><span>   timeoutSeconds       &lt;integer&gt;  <span style="color:#75715e"># æ¢æµ‹è¶…æ—¶æ—¶é—´ã€‚é»˜è®¤1ç§’ï¼Œæœ€å°1ç§’</span>
</span></span><span style="display:flex;"><span>   periodSeconds        &lt;integer&gt;  <span style="color:#75715e"># æ‰§è¡Œæ¢æµ‹çš„é¢‘ç‡ã€‚é»˜è®¤æ˜¯10ç§’ï¼Œæœ€å°1ç§’</span>
</span></span><span style="display:flex;"><span>   failureThreshold     &lt;integer&gt;  <span style="color:#75715e"># è¿ç»­æ¢æµ‹å¤±è´¥å¤šå°‘æ¬¡æ‰è¢«è®¤å®šä¸ºå¤±è´¥ã€‚é»˜è®¤æ˜¯3ã€‚æœ€å°å€¼æ˜¯1</span>
</span></span><span style="display:flex;"><span>   successThreshold     &lt;integer&gt;  <span style="color:#75715e"># è¿ç»­æ¢æµ‹æˆåŠŸå¤šå°‘æ¬¡æ‰è¢«è®¤å®šä¸ºæˆåŠŸã€‚é»˜è®¤æ˜¯1</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">ä¸‹é¢ç¨å¾®é…ç½®ä¸¤ä¸ªï¼Œæ¼”ç¤ºä¸‹æ•ˆæœå³å¯ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>[<span style="color:#ae81ff">root@k8s-master01 ~]# more pod-liveness-httpget.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-liveness-httpget</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-port</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">livenessProbe</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">httpGet</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">scheme</span>: <span style="color:#ae81ff">HTTP</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">30</span> <span style="color:#75715e"># å®¹å™¨å¯åŠ¨å30så¼€å§‹æ¢æµ‹</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span> <span style="color:#75715e"># æ¢æµ‹è¶…æ—¶æ—¶é—´ä¸º5s</span></span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="35-é‡å¯ç­–ç•¥" class="pagebody-header">
    3.5 é‡å¯ç­–ç•¥
  </h3>
</div><p class="component-content component">åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œä¸€æ—¦å®¹å™¨æ¢æµ‹å‡ºç°äº†é—®é¢˜ï¼Œkuberneteså°±ä¼šå¯¹å®¹å™¨æ‰€åœ¨çš„Podè¿›è¡Œé‡å¯ï¼Œå…¶å®è¿™æ˜¯ç”±podçš„é‡å¯ç­–ç•¥å†³å®šçš„ï¼Œpodçš„é‡å¯ç­–ç•¥æœ‰ 3 ç§ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p>
<div class="component-content component"><ul>
<li>Always ï¼šå®¹å™¨å¤±æ•ˆæ—¶ï¼Œè‡ªåŠ¨é‡å¯è¯¥å®¹å™¨ï¼Œè¿™ä¹Ÿæ˜¯é»˜è®¤å€¼ã€‚</li>
<li>OnFailure ï¼š å®¹å™¨ç»ˆæ­¢è¿è¡Œä¸”é€€å‡ºç ä¸ä¸º0æ—¶é‡å¯</li>
<li>Never ï¼š ä¸è®ºçŠ¶æ€ä¸ºä½•ï¼Œéƒ½ä¸é‡å¯è¯¥å®¹å™¨</li>
</ul></div>
<p class="component-content component">é‡å¯ç­–ç•¥é€‚ç”¨äºpodå¯¹è±¡ä¸­çš„æ‰€æœ‰å®¹å™¨ï¼Œé¦–æ¬¡éœ€è¦é‡å¯çš„å®¹å™¨ï¼Œå°†åœ¨å…¶éœ€è¦æ—¶ç«‹å³è¿›è¡Œé‡å¯ï¼Œéšåå†æ¬¡éœ€è¦é‡å¯çš„æ“ä½œå°†ç”±kubeletå»¶è¿Ÿä¸€æ®µæ—¶é—´åè¿›è¡Œï¼Œä¸”åå¤çš„é‡å¯æ“ä½œçš„å»¶è¿Ÿæ—¶é•¿ä»¥æ­¤ä¸º10sã€20sã€40sã€80sã€160så’Œ300sï¼Œ300sæ˜¯æœ€å¤§å»¶è¿Ÿæ—¶é•¿ã€‚</p>
<p class="component-content component">åˆ›å»ºpod-restartpolicy.yamlï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-restartpolicy</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-port</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">livenessProbe</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">httpGet</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">scheme</span>: <span style="color:#ae81ff">HTTP</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/hello</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">restartPolicy</span>: <span style="color:#ae81ff">Never</span> <span style="color:#75715e"># è®¾ç½®é‡å¯ç­–ç•¥ä¸ºNever</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">è¿è¡ŒPodæµ‹è¯•</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºPod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pod-restartpolicy.yaml</span>
</span></span><span style="display:flex;"><span>pod/pod-restartpolicy created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹Podè¯¦æƒ…ï¼Œå‘ç°nginxå®¹å™¨å¤±è´¥</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl  describe pods pod-restartpolicy  -n dev</span>
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span>  Warning  Unhealthy  15s <span style="color:#f92672">(</span>x3 over 35s<span style="color:#f92672">)</span>  kubelet, node1     Liveness probe failed: HTTP probe failed with statuscode: <span style="color:#ae81ff">404</span>
</span></span><span style="display:flex;"><span>  Normal   Killing    15s                kubelet, node1     Container nginx failed liveness probe
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¤šç­‰ä¸€ä¼šï¼Œå†è§‚å¯Ÿpodçš„é‡å¯æ¬¡æ•°ï¼Œå‘ç°ä¸€ç›´æ˜¯0ï¼Œå¹¶æœªé‡å¯   </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl  get pods pod-restartpolicy -n dev</span>
</span></span><span style="display:flex;"><span>NAME                   READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pod-restartpolicy      0/1     Running   <span style="color:#ae81ff">0</span>          5min42s</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h2 id="å››podè°ƒåº¦" class="pagebody-header">
    å››ã€Podè°ƒåº¦
  </h2>
</div><p class="component-content component">åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªPodåœ¨å“ªä¸ªNodeèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œæ˜¯ç”±Schedulerç»„ä»¶é‡‡ç”¨ç›¸åº”çš„ç®—æ³•è®¡ç®—å‡ºæ¥çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸å—äººå·¥æ§åˆ¶çš„ã€‚ä½†æ˜¯åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œè¿™å¹¶ä¸æ»¡è¶³çš„éœ€æ±‚ï¼Œå› ä¸ºå¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æƒ³æ§åˆ¶æŸäº›Podåˆ°è¾¾æŸäº›èŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆåº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿè¿™å°±è¦æ±‚äº†è§£kuberneteså¯¹Podçš„è°ƒåº¦è§„åˆ™ï¼Œkubernetesæä¾›äº†å››å¤§ç±»è°ƒåº¦æ–¹å¼ï¼š</p>
<div class="component-content component"><ul>
<li>è‡ªåŠ¨è°ƒåº¦ï¼šè¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šå®Œå…¨ç”±Schedulerç»è¿‡ä¸€ç³»åˆ—çš„ç®—æ³•è®¡ç®—å¾—å‡º</li>
<li>å®šå‘è°ƒåº¦ï¼šNodeNameã€NodeSelector</li>
<li>äº²å’Œæ€§è°ƒåº¦ï¼šNodeAffinityã€PodAffinityã€PodAntiAffinity</li>
<li>æ±¡ç‚¹ï¼ˆå®¹å¿ï¼‰è°ƒåº¦ï¼šTaintsã€Toleration</li>
</ul></div>

<div class="component-content pagebody component">
  <h3 id="41-å®šå‘è°ƒåº¦" class="pagebody-header">
    4.1 å®šå‘è°ƒåº¦
  </h3>
</div><p class="component-content component">å®šå‘è°ƒåº¦ï¼ŒæŒ‡çš„æ˜¯åˆ©ç”¨åœ¨podä¸Šå£°æ˜nodeNameæˆ–è€…nodeSelectorï¼Œä»¥æ­¤å°†Podè°ƒåº¦åˆ°æœŸæœ›çš„nodeèŠ‚ç‚¹ä¸Šã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„è°ƒåº¦æ˜¯å¼ºåˆ¶çš„ï¼Œè¿™å°±æ„å‘³ç€å³ä½¿è¦è°ƒåº¦çš„ç›®æ ‡Nodeä¸å­˜åœ¨ï¼Œä¹Ÿä¼šå‘ä¸Šé¢è¿›è¡Œè°ƒåº¦ï¼Œåªä¸è¿‡podè¿è¡Œå¤±è´¥è€Œå·²ã€‚</p>
<p class="component-content component"><strong>NodeName</strong></p>
<p class="component-content component">NodeNameç”¨äºå¼ºåˆ¶çº¦æŸå°†Podè°ƒåº¦åˆ°æŒ‡å®šçš„Nameçš„NodeèŠ‚ç‚¹ä¸Šã€‚è¿™ç§æ–¹å¼ï¼Œå…¶å®æ˜¯ç›´æ¥è·³è¿‡Schedulerçš„è°ƒåº¦é€»è¾‘ï¼Œç›´æ¥å°†Podè°ƒåº¦åˆ°æŒ‡å®šåç§°çš„èŠ‚ç‚¹ã€‚</p>
<p class="component-content component">æ¥ä¸‹æ¥ï¼Œå®éªŒä¸€ä¸‹ï¼šåˆ›å»ºä¸€ä¸ªpod-nodename.yamlæ–‡ä»¶</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-nodename</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nodeName</span>: <span style="color:#ae81ff">node1</span> <span style="color:#75715e"># æŒ‡å®šè°ƒåº¦åˆ°node1èŠ‚ç‚¹ä¸Š</span></span></span></code></pre></div></div>
  
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#åˆ›å»ºPod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pod-nodename.yaml</span>
</span></span><span style="display:flex;"><span>pod/pod-nodename created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æŸ¥çœ‹Podè°ƒåº¦åˆ°NODEå±æ€§ï¼Œç¡®å®æ˜¯è°ƒåº¦åˆ°äº†node1èŠ‚ç‚¹ä¸Š</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods pod-nodename -n dev -o wide</span>
</span></span><span style="display:flex;"><span>NAME           READY   STATUS    RESTARTS   AGE   IP            NODE      ......
</span></span><span style="display:flex;"><span>pod-nodename   1/1     Running   <span style="color:#ae81ff">0</span>          56s   10.244.1.87   node1     ......   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¥ä¸‹æ¥ï¼Œåˆ é™¤podï¼Œä¿®æ”¹nodeNameçš„å€¼ä¸ºnode3ï¼ˆå¹¶æ²¡æœ‰node3èŠ‚ç‚¹ï¼‰</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl delete -f pod-nodename.yaml</span>
</span></span><span style="display:flex;"><span>pod <span style="color:#e6db74">&#34;pod-nodename&#34;</span> deleted
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># vim pod-nodename.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pod-nodename.yaml</span>
</span></span><span style="display:flex;"><span>pod/pod-nodename created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç°å·²ç»å‘Node3èŠ‚ç‚¹è°ƒåº¦ï¼Œä½†æ˜¯ç”±äºä¸å­˜åœ¨node3èŠ‚ç‚¹ï¼Œæ‰€ä»¥podæ— æ³•æ­£å¸¸è¿è¡Œ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods pod-nodename -n dev -o wide</span>
</span></span><span style="display:flex;"><span>NAME           READY   STATUS    RESTARTS   AGE   IP       NODE    ......
</span></span><span style="display:flex;"><span>pod-nodename   0/1     Pending   <span style="color:#ae81ff">0</span>          6s    &lt;none&gt;   node3   ......           </span></span></code></pre></div></div>
  
</div><p class="component-content component"><strong>NodeSelector</strong></p>
<p class="component-content component">NodeSelectorç”¨äºå°†podè°ƒåº¦åˆ°æ·»åŠ äº†æŒ‡å®šæ ‡ç­¾çš„nodeèŠ‚ç‚¹ä¸Šã€‚å®ƒæ˜¯é€šè¿‡kubernetesçš„label-selectoræœºåˆ¶å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨podåˆ›å»ºä¹‹å‰ï¼Œä¼šç”±schedulerä½¿ç”¨MatchNodeSelectorè°ƒåº¦ç­–ç•¥è¿›è¡ŒlabelåŒ¹é…ï¼Œæ‰¾å‡ºç›®æ ‡nodeï¼Œç„¶åå°†podè°ƒåº¦åˆ°ç›®æ ‡èŠ‚ç‚¹ï¼Œè¯¥åŒ¹é…è§„åˆ™æ˜¯å¼ºåˆ¶çº¦æŸã€‚</p>
<p class="component-content component">æ¥ä¸‹æ¥ï¼Œå®éªŒä¸€ä¸‹ï¼š</p>
<div class="component-content component"><ol>
<li>é¦–å…ˆåˆ†åˆ«ä¸ºnodeèŠ‚ç‚¹æ·»åŠ æ ‡ç­¾</li>
</ol></div>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl label nodes node1 nodeenv=pro</span>
</span></span><span style="display:flex;"><span>node/node2 labeled
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl label nodes node2 nodeenv=test</span>
</span></span><span style="display:flex;"><span>node/node2 labeled</span></span></code></pre></div></div>
  
</div><ol start="2">
<li>åˆ›å»ºä¸€ä¸ªpod-nodeselector.yamlæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨å®ƒåˆ›å»ºPod</li>
</ol></div>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-nodeselector</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nodeSelector</span>: 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nodeenv</span>: <span style="color:#ae81ff">pro</span> <span style="color:#75715e"># æŒ‡å®šè°ƒåº¦åˆ°å…·æœ‰nodeenv=proæ ‡ç­¾çš„èŠ‚ç‚¹ä¸Š</span></span></span></code></pre></div></div>
  
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#åˆ›å»ºPod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pod-nodeselector.yaml</span>
</span></span><span style="display:flex;"><span>pod/pod-nodeselector created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æŸ¥çœ‹Podè°ƒåº¦åˆ°NODEå±æ€§ï¼Œç¡®å®æ˜¯è°ƒåº¦åˆ°äº†node1èŠ‚ç‚¹ä¸Š</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods pod-nodeselector -n dev -o wide</span>
</span></span><span style="display:flex;"><span>NAME               READY   STATUS    RESTARTS   AGE     IP          NODE    ......
</span></span><span style="display:flex;"><span>pod-nodeselector   1/1     Running   <span style="color:#ae81ff">0</span>          47s   10.244.1.87   node1   ......
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¥ä¸‹æ¥ï¼Œåˆ é™¤podï¼Œä¿®æ”¹nodeSelectorçš„å€¼ä¸ºnodeenv: xxxxï¼ˆä¸å­˜åœ¨æ‰“æœ‰æ­¤æ ‡ç­¾çš„èŠ‚ç‚¹ï¼‰</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl delete -f pod-nodeselector.yaml</span>
</span></span><span style="display:flex;"><span>pod <span style="color:#e6db74">&#34;pod-nodeselector&#34;</span> deleted
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># vim pod-nodeselector.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pod-nodeselector.yaml</span>
</span></span><span style="display:flex;"><span>pod/pod-nodeselector created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç°podæ— æ³•æ­£å¸¸è¿è¡Œ,Nodeçš„å€¼ä¸ºnone</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods -n dev -o wide</span>
</span></span><span style="display:flex;"><span>NAME               READY   STATUS    RESTARTS   AGE     IP       NODE    
</span></span><span style="display:flex;"><span>pod-nodeselector   0/1     Pending   <span style="color:#ae81ff">0</span>          2m20s   &lt;none&gt;   &lt;none&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹è¯¦æƒ…,å‘ç°node selectoråŒ¹é…å¤±è´¥çš„æç¤º</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl describe pods pod-nodeselector -n dev</span>
</span></span><span style="display:flex;"><span>.......
</span></span><span style="display:flex;"><span>Events:
</span></span><span style="display:flex;"><span>  Type     Reason            Age        From               Message
</span></span><span style="display:flex;"><span>  ----     ------            ----       ----               -------
</span></span><span style="display:flex;"><span>  Warning  FailedScheduling  &lt;unknown&gt;  default-scheduler  0/3 nodes are available: <span style="color:#ae81ff">3</span> node<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span> didn<span style="color:#960050;background-color:#1e0010">&#39;</span>t match node selector.</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="42-äº²å’Œæ€§è°ƒåº¦" class="pagebody-header">
    4.2 äº²å’Œæ€§è°ƒåº¦
  </h3>
</div><p class="component-content component">ä¸Šä¸€èŠ‚ï¼Œä»‹ç»äº†ä¸¤ç§å®šå‘è°ƒåº¦çš„æ–¹å¼ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€å®šçš„é—®é¢˜ï¼Œé‚£å°±æ˜¯å¦‚æœæ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„Nodeï¼Œé‚£ä¹ˆPodå°†ä¸ä¼šè¢«è¿è¡Œï¼Œå³ä½¿åœ¨é›†ç¾¤ä¸­è¿˜æœ‰å¯ç”¨Nodeåˆ—è¡¨ä¹Ÿä¸è¡Œï¼Œè¿™å°±é™åˆ¶äº†å®ƒçš„ä½¿ç”¨åœºæ™¯ã€‚</p>
<p class="component-content component">åŸºäºä¸Šé¢çš„é—®é¢˜ï¼Œkubernetesè¿˜æä¾›äº†ä¸€ç§äº²å’Œæ€§è°ƒåº¦ï¼ˆAffinityï¼‰ã€‚å®ƒåœ¨NodeSelectorçš„åŸºç¡€ä¹‹ä¸Šçš„è¿›è¡Œäº†æ‰©å±•ï¼Œå¯ä»¥é€šè¿‡é…ç½®çš„å½¢å¼ï¼Œå®ç°ä¼˜å…ˆé€‰æ‹©æ»¡è¶³æ¡ä»¶çš„Nodeè¿›è¡Œè°ƒåº¦ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä¹Ÿå¯ä»¥è°ƒåº¦åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹ä¸Šï¼Œä½¿è°ƒåº¦æ›´åŠ çµæ´»ã€‚</p>
<p class="component-content component">Affinityä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼š</p>
<div class="component-content component"><ul>
<li>nodeAffinity(nodeäº²å’Œæ€§ï¼‰: ä»¥nodeä¸ºç›®æ ‡ï¼Œè§£å†³podå¯ä»¥è°ƒåº¦åˆ°å“ªäº›nodeçš„é—®é¢˜</li>
<li>podAffinity(podäº²å’Œæ€§) : ä»¥podä¸ºç›®æ ‡ï¼Œè§£å†³podå¯ä»¥å’Œå“ªäº›å·²å­˜åœ¨çš„podéƒ¨ç½²åœ¨åŒä¸€ä¸ªæ‹“æ‰‘åŸŸä¸­çš„é—®é¢˜</li>
<li>podAntiAffinity(podåäº²å’Œæ€§) : ä»¥podä¸ºç›®æ ‡ï¼Œè§£å†³podä¸èƒ½å’Œå“ªäº›å·²å­˜åœ¨podéƒ¨ç½²åœ¨åŒä¸€ä¸ªæ‹“æ‰‘åŸŸä¸­çš„é—®é¢˜
å…³äºäº²å’Œæ€§(åäº²å’Œæ€§)ä½¿ç”¨åœºæ™¯çš„è¯´æ˜ï¼š</li>
</ul></div>
<blockquote>
<p class="component-content component">äº²å’Œæ€§ï¼šå¦‚æœä¸¤ä¸ªåº”ç”¨é¢‘ç¹äº¤äº’ï¼Œé‚£å°±æœ‰å¿…è¦åˆ©ç”¨äº²å’Œæ€§è®©ä¸¤ä¸ªåº”ç”¨çš„å°½å¯èƒ½çš„é è¿‘ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å› ç½‘ç»œé€šä¿¡è€Œå¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚</p>
<p class="component-content component">åäº²å’Œæ€§ï¼šå½“åº”ç”¨çš„é‡‡ç”¨å¤šå‰¯æœ¬éƒ¨ç½²æ—¶ï¼Œæœ‰å¿…è¦é‡‡ç”¨åäº²å’Œæ€§è®©å„ä¸ªåº”ç”¨å®ä¾‹æ‰“æ•£åˆ†å¸ƒåœ¨å„ä¸ªnodeä¸Šï¼Œè¿™æ ·å¯ä»¥æé«˜æœåŠ¡çš„é«˜å¯ç”¨æ€§ã€‚</p>
<p class="component-content component">NodeAffinity</p>
</blockquote>
<p class="component-content component">é¦–å…ˆæ¥çœ‹ä¸€ä¸‹NodeAffinityçš„å¯é…ç½®é¡¹ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <pre><code class="">pod.spec.affinity.nodeAffinity
  requiredDuringSchedulingIgnoredDuringExecution  NodeèŠ‚ç‚¹å¿…é¡»æ»¡è¶³æŒ‡å®šçš„æ‰€æœ‰è§„åˆ™æ‰å¯ä»¥ï¼Œç›¸å½“äºç¡¬é™åˆ¶
    nodeSelectorTerms  èŠ‚ç‚¹é€‰æ‹©åˆ—è¡¨
      matchFields   æŒ‰èŠ‚ç‚¹å­—æ®µåˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨
      matchExpressions   æŒ‰èŠ‚ç‚¹æ ‡ç­¾åˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨(æ¨è)
        key    é”®
        values å€¼
        operat or å…³ç³»ç¬¦ æ”¯æŒExists, DoesNotExist, In, NotIn, Gt, Lt
  preferredDuringSchedulingIgnoredDuringExecution ä¼˜å…ˆè°ƒåº¦åˆ°æ»¡è¶³æŒ‡å®šçš„è§„åˆ™çš„Nodeï¼Œç›¸å½“äºè½¯é™åˆ¶ (å€¾å‘)
    preference   ä¸€ä¸ªèŠ‚ç‚¹é€‰æ‹©å™¨é¡¹ï¼Œä¸ç›¸åº”çš„æƒé‡ç›¸å…³è”
      matchFields   æŒ‰èŠ‚ç‚¹å­—æ®µåˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨
      matchExpressions   æŒ‰èŠ‚ç‚¹æ ‡ç­¾åˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨(æ¨è)
        key    é”®
        values å€¼
        operator å…³ç³»ç¬¦ æ”¯æŒIn, NotIn, Exists, DoesNotExist, Gt, Lt
	weight å€¾å‘æƒé‡ï¼Œåœ¨èŒƒå›´1-100ã€‚</code></pre>
  
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">å…³ç³»ç¬¦çš„ä½¿ç”¨è¯´æ˜</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">matchExpressions</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">nodeenv             </span> <span style="color:#75715e"># åŒ¹é…å­˜åœ¨æ ‡ç­¾çš„keyä¸ºnodeenvçš„èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">Exists</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">nodeenv             </span> <span style="color:#75715e"># åŒ¹é…æ ‡ç­¾çš„keyä¸ºnodeenv,ä¸”valueæ˜¯&#34;xxx&#34;æˆ–&#34;yyy&#34;çš„èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">In</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">values</span>: [<span style="color:#e6db74">&#34;xxx&#34;</span>,<span style="color:#e6db74">&#34;yyy&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">nodeenv             </span> <span style="color:#75715e"># åŒ¹é…æ ‡ç­¾çš„keyä¸ºnodeenv,ä¸”valueå¤§äº&#34;xxx&#34;çš„èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">Gt</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">values</span>: <span style="color:#e6db74">&#34;xxx&#34;</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">æ¥ä¸‹æ¥é¦–å…ˆæ¼”ç¤ºä¸€ä¸‹<code>requiredDuringSchedulingIgnoredDuringExecution</code> ,</p>
<p class="component-content component">åˆ›å»ºpod-nodeaffinity-required.yaml</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-nodeaffinity-required</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">affinity</span>:  <span style="color:#75715e">#äº²å’Œæ€§è®¾ç½®</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nodeAffinity</span>: <span style="color:#75715e">#è®¾ç½®nodeäº²å’Œæ€§</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">requiredDuringSchedulingIgnoredDuringExecution</span>: <span style="color:#75715e"># ç¡¬é™åˆ¶</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">nodeSelectorTerms</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">matchExpressions</span>: <span style="color:#75715e"># åŒ¹é…envçš„å€¼åœ¨[&#34;xxx&#34;,&#34;yyy&#34;]ä¸­çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">nodeenv</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">In</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">values</span>: [<span style="color:#e6db74">&#34;xxx&#34;</span>,<span style="color:#e6db74">&#34;yyy&#34;</span>]</span></span></code></pre></div></div>
  
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºpod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pod-nodeaffinity-required.yaml</span>
</span></span><span style="display:flex;"><span>pod/pod-nodeaffinity-required created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹podçŠ¶æ€ ï¼ˆè¿è¡Œå¤±è´¥ï¼‰</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods pod-nodeaffinity-required -n dev -o wide</span>
</span></span><span style="display:flex;"><span>NAME                        READY   STATUS    RESTARTS   AGE   IP       NODE    ...... 
</span></span><span style="display:flex;"><span>pod-nodeaffinity-required   0/1     Pending   <span style="color:#ae81ff">0</span>          16s   &lt;none&gt;   &lt;none&gt;  ......
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹Podçš„è¯¦æƒ…</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‘ç°è°ƒåº¦å¤±è´¥ï¼Œæç¤ºnodeé€‰æ‹©å¤±è´¥</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl describe pod pod-nodeaffinity-required -n dev</span>
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span>  Warning  FailedScheduling  &lt;unknown&gt;  default-scheduler  0/3 nodes are available: <span style="color:#ae81ff">3</span> node<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span> didn<span style="color:#e6db74">&#39;t match node selector.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  Warning  FailedScheduling  &lt;unknown&gt;  default-scheduler  0/3 nodes are available: 3 node(s) didn&#39;</span>t match node selector.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æ¥ä¸‹æ¥ï¼Œåœæ­¢pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl delete -f pod-nodeaffinity-required.yaml</span>
</span></span><span style="display:flex;"><span>pod <span style="color:#e6db74">&#34;pod-nodeaffinity-required&#34;</span> deleted
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹æ–‡ä»¶ï¼Œå°†values: [&#34;xxx&#34;,&#34;yyy&#34;]------&gt; [&#34;pro&#34;,&#34;yyy&#34;]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># vim pod-nodeaffinity-required.yaml</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å†æ¬¡å¯åŠ¨</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pod-nodeaffinity-required.yaml</span>
</span></span><span style="display:flex;"><span>pod/pod-nodeaffinity-required created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ­¤æ—¶æŸ¥çœ‹ï¼Œå‘ç°è°ƒåº¦æˆåŠŸï¼Œå·²ç»å°†podè°ƒåº¦åˆ°äº†node1ä¸Š</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods pod-nodeaffinity-required -n dev -o wide</span>
</span></span><span style="display:flex;"><span>NAME                        READY   STATUS    RESTARTS   AGE   IP            NODE  ...... 
</span></span><span style="display:flex;"><span>pod-nodeaffinity-required   1/1     Running   <span style="color:#ae81ff">0</span>          11s   10.244.1.89   node1 ......</span></span></code></pre></div></div>
  
</div><p class="component-content component">æ¥ä¸‹æ¥å†æ¼”ç¤ºä¸€ä¸‹<code>requiredDuringSchedulingIgnoredDuringExecution</code> ,</p>
<p class="component-content component">åˆ›å»ºpod-nodeaffinity-preferred.yaml</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-nodeaffinity-preferred</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">affinity</span>:  <span style="color:#75715e">#äº²å’Œæ€§è®¾ç½®</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nodeAffinity</span>: <span style="color:#75715e">#è®¾ç½®nodeäº²å’Œæ€§</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">preferredDuringSchedulingIgnoredDuringExecution</span>: <span style="color:#75715e"># è½¯é™åˆ¶</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">weight</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">preference</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">matchExpressions</span>: <span style="color:#75715e"># åŒ¹é…envçš„å€¼åœ¨[&#34;xxx&#34;,&#34;yyy&#34;]ä¸­çš„æ ‡ç­¾(å½“å‰ç¯å¢ƒæ²¡æœ‰)</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">nodeenv</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">In</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">values</span>: [<span style="color:#e6db74">&#34;xxx&#34;</span>,<span style="color:#e6db74">&#34;yyy&#34;</span>]</span></span></code></pre></div></div>
  
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºpod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pod-nodeaffinity-preferred.yaml</span>
</span></span><span style="display:flex;"><span>pod/pod-nodeaffinity-preferred created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹podçŠ¶æ€ ï¼ˆè¿è¡ŒæˆåŠŸï¼‰</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pod pod-nodeaffinity-preferred -n dev</span>
</span></span><span style="display:flex;"><span>NAME                         READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pod-nodeaffinity-preferred   1/1     Running   <span style="color:#ae81ff">0</span>          40s</span></span></code></pre></div></div>
  
</div><blockquote>
<p class="component-content component">NodeAffinityè§„åˆ™è®¾ç½®çš„æ³¨æ„äº‹é¡¹ï¼š
1 å¦‚æœåŒæ—¶å®šä¹‰äº†nodeSelectorå’ŒnodeAffinityï¼Œé‚£ä¹ˆå¿…é¡»ä¸¤ä¸ªæ¡ä»¶éƒ½å¾—åˆ°æ»¡è¶³ï¼ŒPodæ‰èƒ½è¿è¡Œåœ¨æŒ‡å®šçš„Nodeä¸Š
2 å¦‚æœnodeAffinityæŒ‡å®šäº†å¤šä¸ªnodeSelectorTermsï¼Œé‚£ä¹ˆåªéœ€è¦å…¶ä¸­ä¸€ä¸ªèƒ½å¤ŸåŒ¹é…æˆåŠŸå³å¯
3 å¦‚æœä¸€ä¸ªnodeSelectorTermsä¸­æœ‰å¤šä¸ªmatchExpressions ï¼Œåˆ™ä¸€ä¸ªèŠ‚ç‚¹å¿…é¡»æ»¡è¶³æ‰€æœ‰çš„æ‰èƒ½åŒ¹é…æˆåŠŸ
4 å¦‚æœä¸€ä¸ªpodæ‰€åœ¨çš„Nodeåœ¨Podè¿è¡ŒæœŸé—´å…¶æ ‡ç­¾å‘ç”Ÿäº†æ”¹å˜ï¼Œä¸å†ç¬¦åˆè¯¥Podçš„èŠ‚ç‚¹äº²å’Œæ€§éœ€æ±‚ï¼Œåˆ™ç³»ç»Ÿå°†å¿½ç•¥æ­¤å˜åŒ–</p>
</blockquote>
<p class="component-content component"><strong>PodAffinity</strong></p>
<p class="component-content component">PodAffinityä¸»è¦å®ç°ä»¥è¿è¡Œçš„Podä¸ºå‚ç…§ï¼Œå®ç°è®©æ–°åˆ›å»ºçš„Podè·Ÿå‚ç…§podåœ¨ä¸€ä¸ªåŒºåŸŸçš„åŠŸèƒ½ã€‚</p>
<p class="component-content component">é¦–å…ˆæ¥çœ‹ä¸€ä¸‹PodAffinityçš„å¯é…ç½®é¡¹ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>pod.spec.affinity.podAffinity
</span></span><span style="display:flex;"><span>  requiredDuringSchedulingIgnoredDuringExecution  ç¡¬é™åˆ¶
</span></span><span style="display:flex;"><span>    namespaces       æŒ‡å®šå‚ç…§podçš„namespace
</span></span><span style="display:flex;"><span>    topologyKey      æŒ‡å®šè°ƒåº¦ä½œç”¨åŸŸ
</span></span><span style="display:flex;"><span>    labelSelector    æ ‡ç­¾é€‰æ‹©å™¨
</span></span><span style="display:flex;"><span>      matchExpressions  æŒ‰èŠ‚ç‚¹æ ‡ç­¾åˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨(æ¨è)
</span></span><span style="display:flex;"><span>        key    é”®
</span></span><span style="display:flex;"><span>        values å€¼
</span></span><span style="display:flex;"><span>        operator å…³ç³»ç¬¦ æ”¯æŒIn, NotIn, Exists, DoesNotExist.
</span></span><span style="display:flex;"><span>      matchLabels    æŒ‡å¤šä¸ªmatchExpressionsæ˜ å°„çš„å†…å®¹
</span></span><span style="display:flex;"><span>  preferredDuringSchedulingIgnoredDuringExecution è½¯é™åˆ¶
</span></span><span style="display:flex;"><span>    podAffinityTerm  é€‰é¡¹
</span></span><span style="display:flex;"><span>      namespaces      
</span></span><span style="display:flex;"><span>      topologyKey
</span></span><span style="display:flex;"><span>      labelSelector
</span></span><span style="display:flex;"><span>        matchExpressions  
</span></span><span style="display:flex;"><span>          key    é”®
</span></span><span style="display:flex;"><span>          values å€¼
</span></span><span style="display:flex;"><span>          operator
</span></span><span style="display:flex;"><span>        matchLabels 
</span></span><span style="display:flex;"><span>    weight å€¾å‘æƒé‡ï¼Œåœ¨èŒƒå›´1-100</span></span></code></pre></div></div>
  
</div><blockquote>
<p class="component-content component">topologyKeyç”¨äºæŒ‡å®šè°ƒåº¦æ—¶ä½œç”¨åŸŸ,ä¾‹å¦‚:
å¦‚æœæŒ‡å®šä¸ºkubernetes.io/hostnameï¼Œé‚£å°±æ˜¯ä»¥NodeèŠ‚ç‚¹ä¸ºåŒºåˆ†èŒƒå›´
å¦‚æœæŒ‡å®šä¸ºbeta.kubernetes.io/os,åˆ™ä»¥NodeèŠ‚ç‚¹çš„æ“ä½œç³»ç»Ÿç±»å‹æ¥åŒºåˆ†</p>
</blockquote>
<p class="component-content component">æ¥ä¸‹æ¥ï¼Œæ¼”ç¤ºä¸‹<code>requiredDuringSchedulingIgnoredDuringExecution</code>,</p>
<p class="component-content component">1ï¼‰é¦–å…ˆåˆ›å»ºä¸€ä¸ªå‚ç…§Podï¼Œpod-podaffinity-target.yamlï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-podaffinity-target</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">podenv</span>: <span style="color:#ae81ff">pro</span> <span style="color:#75715e">#è®¾ç½®æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nodeName</span>: <span style="color:#ae81ff">node1</span> <span style="color:#75715e"># å°†ç›®æ ‡podåç¡®æŒ‡å®šåˆ°node1ä¸Š</span></span></span></code></pre></div></div>
  
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨ç›®æ ‡pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pod-podaffinity-target.yaml</span>
</span></span><span style="display:flex;"><span>pod/pod-podaffinity-target created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹podçŠ¶å†µ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods  pod-podaffinity-target -n dev</span>
</span></span><span style="display:flex;"><span>NAME                     READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pod-podaffinity-target   1/1     Running   <span style="color:#ae81ff">0</span>          4s</span></span></code></pre></div></div>
  
</div><p class="component-content component">2ï¼‰åˆ›å»ºpod-podaffinity-required.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-podaffinity-required</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">affinity</span>:  <span style="color:#75715e">#äº²å’Œæ€§è®¾ç½®</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">podAffinity</span>: <span style="color:#75715e">#è®¾ç½®podäº²å’Œæ€§</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">requiredDuringSchedulingIgnoredDuringExecution</span>: <span style="color:#75715e"># ç¡¬é™åˆ¶</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">labelSelector</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">matchExpressions</span>: <span style="color:#75715e"># åŒ¹é…envçš„å€¼åœ¨[&#34;xxx&#34;,&#34;yyy&#34;]ä¸­çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">podenv</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">In</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">values</span>: [<span style="color:#e6db74">&#34;xxx&#34;</span>,<span style="color:#e6db74">&#34;yyy&#34;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">topologyKey</span>: <span style="color:#ae81ff">kubernetes.io/hostname</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">ä¸Šé¢é…ç½®è¡¨è¾¾çš„æ„æ€æ˜¯ï¼šæ–°Podå¿…é¡»è¦ä¸æ‹¥æœ‰æ ‡ç­¾nodeenv=xxxæˆ–è€…nodeenv=yyyçš„podåœ¨åŒä¸€Nodeä¸Šï¼Œæ˜¾ç„¶ç°åœ¨æ²¡æœ‰è¿™æ ·podï¼Œæ¥ä¸‹æ¥ï¼Œè¿è¡Œæµ‹è¯•ä¸€ä¸‹ã€‚</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pod-podaffinity-required.yaml</span>
</span></span><span style="display:flex;"><span>pod/pod-podaffinity-required created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹podçŠ¶æ€ï¼Œå‘ç°æœªè¿è¡Œ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods pod-podaffinity-required -n dev</span>
</span></span><span style="display:flex;"><span>NAME                       READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pod-podaffinity-required   0/1     Pending   <span style="color:#ae81ff">0</span>          9s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl describe pods pod-podaffinity-required  -n dev</span>
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span>Events:
</span></span><span style="display:flex;"><span>  Type     Reason            Age        From               Message
</span></span><span style="display:flex;"><span>  ----     ------            ----       ----               -------
</span></span><span style="display:flex;"><span>  Warning  FailedScheduling  &lt;unknown&gt;  default-scheduler  0/3 nodes are available: <span style="color:#ae81ff">2</span> node<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span> didn<span style="color:#e6db74">&#39;t match pod affinity rules, 1 node(s) had taints that the pod didn&#39;</span>t tolerate.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¥ä¸‹æ¥ä¿®æ”¹  values: [&#34;xxx&#34;,&#34;yyy&#34;]-----&gt;values:[&#34;pro&#34;,&#34;yyy&#34;]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ„æ€æ˜¯ï¼šæ–°Podå¿…é¡»è¦ä¸æ‹¥æœ‰æ ‡ç­¾nodeenv=xxxæˆ–è€…nodeenv=yyyçš„podåœ¨åŒä¸€Nodeä¸Š</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># vim pod-podaffinity-required.yaml</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç„¶åé‡æ–°åˆ›å»ºpodï¼ŒæŸ¥çœ‹æ•ˆæœ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl delete -f  pod-podaffinity-required.yaml</span>
</span></span><span style="display:flex;"><span>pod <span style="color:#e6db74">&#34;pod-podaffinity-required&#34;</span> de leted
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pod-podaffinity-required.yaml</span>
</span></span><span style="display:flex;"><span>pod/pod-podaffinity-required created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‘ç°æ­¤æ—¶Podè¿è¡Œæ­£å¸¸</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods pod-podaffinity-required -n dev</span>
</span></span><span style="display:flex;"><span>NAME                       READY   STATUS    RESTARTS   AGE   LABELS
</span></span><span style="display:flex;"><span>pod-podaffinity-required   1/1     Running   <span style="color:#ae81ff">0</span>          6s    &lt;none&gt;</span></span></code></pre></div></div>
  
</div><p class="component-content component">å…³äºPodAffinityçš„ preferredDuringSchedulingIgnoredDuringExecutionï¼Œè¿™é‡Œä¸å†æ¼”ç¤ºã€‚</p>
<p class="component-content component"><strong>PodAntiAffinity</strong></p>
<p class="component-content component">PodAntiAffinityä¸»è¦å®ç°ä»¥è¿è¡Œçš„Podä¸ºå‚ç…§ï¼Œè®©æ–°åˆ›å»ºçš„Podè·Ÿå‚ç…§podä¸åœ¨ä¸€ä¸ªåŒºåŸŸä¸­çš„åŠŸèƒ½ã€‚</p>
<p class="component-content component">å®ƒçš„é…ç½®æ–¹å¼å’Œé€‰é¡¹è·ŸPodAffintyæ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œä¸å†åšè¯¦ç»†è§£é‡Šï¼Œç›´æ¥åšä¸€ä¸ªæµ‹è¯•æ¡ˆä¾‹ã€‚</p>
<p class="component-content component">1ï¼‰ç»§ç»­ä½¿ç”¨ä¸Šä¸ªæ¡ˆä¾‹ä¸­ç›®æ ‡pod</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods -n dev -o wide --show-labels</span>
</span></span><span style="display:flex;"><span>NAME                     READY   STATUS    RESTARTS   AGE     IP            NODE    LABELS
</span></span><span style="display:flex;"><span>pod-podaffinity-required 1/1     Running   <span style="color:#ae81ff">0</span>          3m29s   10.244.1.38   node1   &lt;none&gt;     
</span></span><span style="display:flex;"><span>pod-podaffinity-target   1/1     Running   <span style="color:#ae81ff">0</span>          9m25s   10.244.1.37   node1   podenv<span style="color:#f92672">=</span>pro</span></span></code></pre></div></div>
  
</div><p class="component-content component">2ï¼‰åˆ›å»ºpod-podantiaffinity-required.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-podantiaffinity-required</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">affinity</span>:  <span style="color:#75715e">#äº²å’Œæ€§è®¾ç½®</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">podAntiAffinity</span>: <span style="color:#75715e">#è®¾ç½®podäº²å’Œæ€§</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">requiredDuringSchedulingIgnoredDuringExecution</span>: <span style="color:#75715e"># ç¡¬é™åˆ¶</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">labelSelector</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">matchExpressions</span>: <span style="color:#75715e"># åŒ¹é…podenvçš„å€¼åœ¨[&#34;pro&#34;]ä¸­çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">podenv</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">In</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">values</span>: [<span style="color:#e6db74">&#34;pro&#34;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">topologyKey</span>: <span style="color:#ae81ff">kubernetes.io/hostname</span></span></span></code></pre></div></div>
  
</div><p class="component-content component">ä¸Šé¢é…ç½®è¡¨è¾¾çš„æ„æ€æ˜¯ï¼šæ–°Podå¿…é¡»è¦ä¸æ‹¥æœ‰æ ‡ç­¾nodeenv=proçš„podä¸åœ¨åŒä¸€Nodeä¸Šï¼Œè¿è¡Œæµ‹è¯•ä¸€ä¸‹ã€‚</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºpod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl create -f pod-podantiaffinity-required.yaml</span>
</span></span><span style="display:flex;"><span>pod/pod-podantiaffinity-required created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹pod</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‘ç°è°ƒåº¦åˆ°äº†node2ä¸Š</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods pod-podantiaffinity-required -n dev -o wide</span>
</span></span><span style="display:flex;"><span>NAME                           READY   STATUS    RESTARTS   AGE   IP            NODE   .. 
</span></span><span style="display:flex;"><span>pod-podantiaffinity-required   1/1     Running   <span style="color:#ae81ff">0</span>          30s   10.244.1.96   node2  ..</span></span></code></pre></div></div>
  
</div>
<div class="component-content pagebody component">
  <h3 id="43-æ±¡ç‚¹å’Œå®¹å¿" class="pagebody-header">
    4.3 æ±¡ç‚¹å’Œå®¹å¿
  </h3>
</div><p class="component-content component"><strong>æ±¡ç‚¹ï¼ˆTaintsï¼‰</strong></p>
<p class="component-content component">å‰é¢çš„è°ƒåº¦æ–¹å¼éƒ½æ˜¯ç«™åœ¨Podçš„è§’åº¦ä¸Šï¼Œé€šè¿‡åœ¨Podä¸Šæ·»åŠ å±æ€§ï¼Œæ¥ç¡®å®šPodæ˜¯å¦è¦è°ƒåº¦åˆ°æŒ‡å®šçš„Nodeä¸Šï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥ç«™åœ¨Nodeçš„è§’åº¦ä¸Šï¼Œé€šè¿‡åœ¨Nodeä¸Šæ·»åŠ æ±¡ç‚¹å±æ€§ï¼Œæ¥å†³å®šæ˜¯å¦å…è®¸Podè°ƒåº¦è¿‡æ¥ã€‚</p>
<p class="component-content component">Nodeè¢«è®¾ç½®ä¸Šæ±¡ç‚¹ä¹‹åå°±å’ŒPodä¹‹é—´å­˜åœ¨äº†ä¸€ç§ç›¸æ–¥çš„å…³ç³»ï¼Œè¿›è€Œæ‹’ç»Podè°ƒåº¦è¿›æ¥ï¼Œç”šè‡³å¯ä»¥å°†å·²ç»å­˜åœ¨çš„Podé©±é€å‡ºå»ã€‚</p>
<p class="component-content component">æ±¡ç‚¹çš„æ ¼å¼ä¸ºï¼škey=value:effect, keyå’Œvalueæ˜¯æ±¡ç‚¹çš„æ ‡ç­¾ï¼Œeffectæè¿°æ±¡ç‚¹çš„ä½œç”¨ï¼Œæ”¯æŒå¦‚ä¸‹ä¸‰ä¸ªé€‰é¡¹ï¼š</p>
<div class="component-content component"><ul>
<li>PreferNoScheduleï¼škuberneteså°†å°½é‡é¿å…æŠŠPodè°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„Nodeä¸Šï¼Œé™¤éæ²¡æœ‰å…¶ä»–èŠ‚ç‚¹å¯è°ƒåº¦</li>
<li>NoScheduleï¼škuberneteså°†ä¸ä¼šæŠŠPodè°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„Nodeä¸Šï¼Œä½†ä¸ä¼šå½±å“å½“å‰Nodeä¸Šå·²å­˜åœ¨çš„Pod</li>
<li>NoExecuteï¼škuberneteså°†ä¸ä¼šæŠŠPodè°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„Nodeä¸Šï¼ŒåŒæ—¶ä¹Ÿä¼šå°†Nodeä¸Šå·²å­˜åœ¨çš„Podé©±ç¦»</li>
</ul></div>
<p class="component-content component">








<figure class="image component image-fullbleed body-copy-wide nr-scroll-animation nr-scroll-animation--on image-big">  <div class="component-content">
    <div class="image-sharesheet">
      <div class="image image-load image-asset image-0a827b8eac644e5eba43fe309125f9f4" id="lht0a827b8eac644e5eba43fe309125f9f4">
        <picture  class="picture">
          <img class="picture-image" data-src="https://aabb-2023.oss-cn-beijing.aliyuncs.com/202308201741766.png" alt=""  />
        </picture>
      </div>
    </div>
    <div class="image-description">
      <div class="image-caption">
        
      </div>
    </div>
  </div>
</figure>
</p>
<p class="component-content component">ä½¿ç”¨kubectlè®¾ç½®å’Œå»é™¤æ±¡ç‚¹çš„å‘½ä»¤ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># è®¾ç½®æ±¡ç‚¹</span>
</span></span><span style="display:flex;"><span>kubectl taint nodes node1 key<span style="color:#f92672">=</span>value:effect
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å»é™¤æ±¡ç‚¹</span>
</span></span><span style="display:flex;"><span>kubectl taint nodes node1 key:effect-
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å»é™¤æ‰€æœ‰æ±¡ç‚¹</span>
</span></span><span style="display:flex;"><span>kubectl taint nodes node1 key-</span></span></code></pre></div></div>
  
</div><p class="component-content component">æ¥ä¸‹æ¥ï¼Œæ¼”ç¤ºä¸‹æ±¡ç‚¹çš„æ•ˆæœï¼š</p>
<div class="component-content component"><ol>
<li>å‡†å¤‡èŠ‚ç‚¹node1ï¼ˆä¸ºäº†æ¼”ç¤ºæ•ˆæœæ›´åŠ æ˜æ˜¾ï¼Œæš‚æ—¶åœæ­¢node2èŠ‚ç‚¹ï¼‰</li>
<li>ä¸ºnode1èŠ‚ç‚¹è®¾ç½®ä¸€ä¸ªæ±¡ç‚¹: tag=heima:PreferNoScheduleï¼›ç„¶ååˆ›å»ºpod1( pod1 å¯ä»¥ )</li>
<li>ä¿®æ”¹ä¸ºnode1èŠ‚ç‚¹è®¾ç½®ä¸€ä¸ªæ±¡ç‚¹: tag=heima:NoScheduleï¼›ç„¶ååˆ›å»ºpod2( pod1 æ­£å¸¸ pod2 å¤±è´¥ )</li>
<li>ä¿®æ”¹ä¸ºnode1èŠ‚ç‚¹è®¾ç½®ä¸€ä¸ªæ±¡ç‚¹: tag=heima:NoExecuteï¼›ç„¶ååˆ›å»ºpod3 ( 3ä¸ªpodéƒ½å¤±è´¥ )</li>
</ol></div>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä¸ºnode1è®¾ç½®æ±¡ç‚¹(PreferNoSchedule)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl taint nodes node1 tag=heima:PreferNoSchedule</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºpod1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl run taint1 --image=nginx:1.17.1 -n dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods -n dev -o wide</span>
</span></span><span style="display:flex;"><span>NAME                      READY   STATUS    RESTARTS   AGE     IP           NODE   
</span></span><span style="display:flex;"><span>taint1-7665f7fd85-574h4   1/1     Running   <span style="color:#ae81ff">0</span>          2m24s   10.244.1.59   node1    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸ºnode1è®¾ç½®æ±¡ç‚¹(å–æ¶ˆPreferNoScheduleï¼Œè®¾ç½®NoSchedule)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl taint nodes node1 tag:PreferNoSchedule-</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl taint nodes node1 tag=heima:NoSchedule</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºpod2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl run taint2 --image=nginx:1.17.1 -n dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods taint2 -n dev -o wide</span>
</span></span><span style="display:flex;"><span>NAME                      READY   STATUS    RESTARTS   AGE     IP            NODE
</span></span><span style="display:flex;"><span>taint1-7665f7fd85-574h4   1/1     Running   <span style="color:#ae81ff">0</span>          2m24s   10.244.1.59   node1 
</span></span><span style="display:flex;"><span>taint2-544694789-6zmlf    0/1     Pending   <span style="color:#ae81ff">0</span>          21s     &lt;none&gt;        &lt;none&gt;   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸ºnode1è®¾ç½®æ±¡ç‚¹(å–æ¶ˆNoScheduleï¼Œè®¾ç½®NoExecute)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl taint nodes node1 tag:NoSchedule-</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl taint nodes node1 tag=heima:NoExecute</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºpod3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl run taint3 --image=nginx:1.17.1 -n dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods -n dev -o wide</span>
</span></span><span style="display:flex;"><span>NAME                      READY   STATUS    RESTARTS   AGE   IP       NODE     NOMINATED 
</span></span><span style="display:flex;"><span>taint1-7665f7fd85-htkmp   0/1     Pending   <span style="color:#ae81ff">0</span>          35s   &lt;none&gt;   &lt;none&gt;   &lt;none&gt;    
</span></span><span style="display:flex;"><span>taint2-544694789-bn7wb    0/1     Pending   <span style="color:#ae81ff">0</span>          35s   &lt;none&gt;   &lt;none&gt;   &lt;none&gt;     
</span></span><span style="display:flex;"><span>taint3-6d78dbd749-tktkq   0/1     Pending   <span style="color:#ae81ff">0</span>          6s    &lt;none&gt;   &lt;none&gt;   &lt;none&gt;     </span></span></code></pre></div></div>
  
</div><blockquote>
<p class="component-content component">å°æç¤ºï¼š
ä½¿ç”¨kubeadmæ­å»ºçš„é›†ç¾¤ï¼Œé»˜è®¤å°±ä¼šç»™masterèŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªæ±¡ç‚¹æ ‡è®°,æ‰€ä»¥podå°±ä¸ä¼šè°ƒåº¦åˆ°masterèŠ‚ç‚¹ä¸Š.</p>
</blockquote>
<p class="component-content component"><strong>å®¹å¿ï¼ˆTolerationï¼‰</strong></p>
<p class="component-content component">ä¸Šé¢ä»‹ç»äº†æ±¡ç‚¹çš„ä½œç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨nodeä¸Šæ·»åŠ æ±¡ç‚¹ç”¨äºæ‹’ç»podè°ƒåº¦ä¸Šæ¥ï¼Œä½†æ˜¯å¦‚æœå°±æ˜¯æƒ³å°†ä¸€ä¸ªpodè°ƒåº¦åˆ°ä¸€ä¸ªæœ‰æ±¡ç‚¹çš„nodeä¸Šå»ï¼Œè¿™æ—¶å€™åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿè¿™å°±è¦ä½¿ç”¨åˆ°å®¹å¿ã€‚</p>
<!-- raw HTML omitted -->
<blockquote>
<p class="component-content component">æ±¡ç‚¹å°±æ˜¯æ‹’ç»ï¼Œå®¹å¿å°±æ˜¯å¿½ç•¥ï¼ŒNodeé€šè¿‡æ±¡ç‚¹æ‹’ç»podè°ƒåº¦ä¸Šå»ï¼ŒPodé€šè¿‡å®¹å¿å¿½ç•¥æ‹’ç»</p>
</blockquote>
<p class="component-content component">ä¸‹é¢å…ˆé€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹çœ‹ä¸‹æ•ˆæœï¼š</p>
<div class="component-content component"><ol>
<li>ä¸Šä¸€å°èŠ‚ï¼Œå·²ç»åœ¨node1èŠ‚ç‚¹ä¸Šæ‰“ä¸Šäº†NoExecuteçš„æ±¡ç‚¹ï¼Œæ­¤æ—¶podæ˜¯è°ƒåº¦ä¸ä¸Šå»çš„</li>
<li>æœ¬å°èŠ‚ï¼Œå¯ä»¥é€šè¿‡ç»™podæ·»åŠ å®¹å¿ï¼Œç„¶åå°†å…¶è°ƒåº¦ä¸Šå»</li>
</ol></div>
<p class="component-content component">åˆ›å»ºpod-toleration.yaml,å†…å®¹å¦‚ä¸‹</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-toleration</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">tolerations</span>:      <span style="color:#75715e"># æ·»åŠ å®¹å¿</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">key</span>: <span style="color:#e6db74">&#34;tag&#34;</span>        <span style="color:#75715e"># è¦å®¹å¿çš„æ±¡ç‚¹çš„key</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">operator</span>: <span style="color:#e6db74">&#34;Equal&#34;</span> <span style="color:#75715e"># æ“ä½œç¬¦</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;heima&#34;</span>    <span style="color:#75715e"># å®¹å¿çš„æ±¡ç‚¹çš„value</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">effect</span>: <span style="color:#e6db74">&#34;NoExecute&#34;</span>   <span style="color:#75715e"># æ·»åŠ å®¹å¿çš„è§„åˆ™ï¼Œè¿™é‡Œå¿…é¡»å’Œæ ‡è®°çš„æ±¡ç‚¹è§„åˆ™ç›¸åŒ</span></span></span></code></pre></div></div>
  
</div><div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ å®¹å¿ä¹‹å‰çš„pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods -n dev -o wide</span>
</span></span><span style="display:flex;"><span>NAME             READY   STATUS    RESTARTS   AGE   IP       NODE     NOMINATED 
</span></span><span style="display:flex;"><span>pod-toleration   0/1     Pending   <span style="color:#ae81ff">0</span>          3s    &lt;none&gt;   &lt;none&gt;   &lt;none&gt;           
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ å®¹å¿ä¹‹åçš„pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods -n dev -o wide</span>
</span></span><span style="display:flex;"><span>NAME             READY   STATUS    RESTARTS   AGE   IP            NODE    NOMINATED
</span></span><span style="display:flex;"><span>pod-toleration   1/1     Running   <span style="color:#ae81ff">0</span>          3s    10.244.1.62   node1   &lt;none&gt;        </span></span></code></pre></div></div>
  
</div><p class="component-content component">ä¸‹é¢çœ‹ä¸€ä¸‹å®¹å¿çš„è¯¦ç»†é…ç½®:</p>
<div class="component-content pagebody component code">
  
  
  
  <div class=""><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl explain pod.spec.tolerations</span>
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span>FIELDS:
</span></span><span style="display:flex;"><span>   key       <span style="color:#75715e"># å¯¹åº”ç€è¦å®¹å¿çš„æ±¡ç‚¹çš„é”®ï¼Œç©ºæ„å‘³ç€åŒ¹é…æ‰€æœ‰çš„é”®</span>
</span></span><span style="display:flex;"><span>   value     <span style="color:#75715e"># å¯¹åº”ç€è¦å®¹å¿çš„æ±¡ç‚¹çš„å€¼</span>
</span></span><span style="display:flex;"><span>   operator  <span style="color:#75715e"># key-valueçš„è¿ç®—ç¬¦ï¼Œæ”¯æŒEqualå’ŒExistsï¼ˆé»˜è®¤ï¼‰</span>
</span></span><span style="display:flex;"><span>   effect    <span style="color:#75715e"># å¯¹åº”æ±¡ç‚¹çš„effectï¼Œç©ºæ„å‘³ç€åŒ¹é…æ‰€æœ‰å½±å“</span>
</span></span><span style="display:flex;"><span>   tolerationSeconds   <span style="color:#75715e"># å®¹å¿æ—¶é—´, å½“effectä¸ºNoExecuteæ—¶ç”Ÿæ•ˆï¼Œè¡¨ç¤ºpodåœ¨Nodeä¸Šçš„åœç•™æ—¶é—´</span></span></span></code></pre></div></div>
  
</div>
          </div><div class="component">
            <div class="component-content">
              <div class="article-copyright">
                <p class="content">
                  ç‰ˆæƒå£°æ˜: <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed" target="_blank">ç‰ˆæƒå£°æ˜ï¼šç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™… (CC BY-NC-SA 4.0)</a>
                </p>
                <p class="content">ä½œè€…:  yuanshuai </p>
                <p class="content">å‘è¡¨æ—¥æœŸ:  2023å¹´7æœˆ19æ—¥</p>
              </div>
            </div>
          </div></article>
      </section>
  </main>

  <script>
    var script = document.createElement("script");script.src = "https://yuanshuai1122.github.io/js/initPost.js";
    document.head.appendChild(script);
  </script>

    
    <div class="footer-main ">
  <div class="content-body footer-wraper">
    <div class="footer-box">
      <div class="foot-nav">
        <div class="foot-nav-items">
          <div class="item">
            <div class="logo"></div>
            <div class="email">Email: <a href="mailto:shuaiyuan@gmail.com">shuaiyuan@gmail.com</a></div>
          </div>

          <div class="item community">
            <div class="item-title">ç¤¾äº¤åª’ä½“</div>
            
              <a href="https://github.com/yuanshuai1122" target="_blank">Github</a>
            
          </div>

          <div class="item resources">
            <div class="item-title">å‹é“¾</div>
            
              <a href="https://yuanshuaicn.com/" target="_blank">ğŸ‘‹</a>
            
          </div>
        </div>
      </div>
      <div class="bottom">
        <div class="item copyright">
          &copy; 2023
          Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> & <a href="https://github.com/floyd-li/hugo-theme-itheme" target="_blank">iTheme</a>
        </div>
      </div>
    </div>
  </div>
</div>

  </body>
    
    

    
    
</html>
